<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>The Spring Framework - Reference Documentation</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.70.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="d0e1"></a>The Spring Framework - Reference Documentation</h1></div><div><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="authorgroup"><h2>Authors</h2><p></p><span class="author"><span xmlns="" class="firstname">Rod</span> <span xmlns="" class="surname">Johnson</span></span>, <span class="author"><span xmlns="" class="firstname">Juergen</span> <span xmlns="" class="surname">Hoeller</span></span>, <span class="author"><span xmlns="" class="firstname">Alef</span> <span xmlns="" class="surname">Arendsen</span></span>, <span class="author"><span xmlns="" class="firstname">Colin</span> <span xmlns="" class="surname">Sampaleanu</span></span>, <span class="author"><span xmlns="" class="firstname">Rob</span> <span xmlns="" class="surname">Harrop</span></span>, <span class="author"><span xmlns="" class="firstname">Thomas</span> <span xmlns="" class="surname">Risberg</span></span>, <span class="author"><span xmlns="" class="firstname">Darren</span> <span xmlns="" class="surname">Davison</span></span>, <span class="author"><span xmlns="" class="firstname">Dmitriy</span> <span xmlns="" class="surname">Kopylenko</span></span>, <span class="author"><span xmlns="" class="firstname">Mark</span> <span xmlns="" class="surname">Pollack</span></span>, <span class="author"><span xmlns="" class="firstname">Thierry</span> <span xmlns="" class="surname">Templier</span></span>, <span class="author"><span xmlns="" class="firstname">Erwin</span> <span xmlns="" class="surname">Vervaet</span></span>, <span class="author"><span xmlns="" class="firstname">Portia</span> <span xmlns="" class="surname">Tung</span></span>, <span class="author"><span xmlns="" class="firstname">Ben</span> <span xmlns="" class="surname">Hale</span></span>, <span class="author"><span xmlns="" class="firstname">Adrian</span> <span xmlns="" class="surname">Colyer</span></span>, <span class="author"><span xmlns="" class="firstname">John</span> <span xmlns="" class="surname">Lewis</span></span>, <span class="author"><span xmlns="" class="firstname">Costin</span> <span xmlns="" class="surname">Leau</span></span>, <span class="author"><span xmlns="" class="firstname">Rick</span> <span xmlns="" class="surname">Evans</span></span></div></div><div><p class="releaseinfo">2.0.8</p></div><div><div class="legalnotice"><a name="d0e93"></a>
			Copies of this document may be made for your own use and for
			distribution to others, provided that you do not charge any
			fee for such copies and further provided that each copy
			contains this Copyright Notice, whether distributed in print
			or electronically.
		</div></div></div><hr></div><div class="toc"><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#introduction-overview">1.1. Overview</a></span></dt><dt><span class="section"><a href="#overview-usagescenarios">1.2. Usage scenarios</a></span></dt></dl></dd><dt><span class="chapter"><a href="#new-in-2">2. What's new in Spring 2.0?</a></span></dt><dd><dl><dt><span class="section"><a href="#new-in-2-intro">2.1. Introduction</a></span></dt><dt><span class="section"><a href="#new-in-2-ioc">2.2. The Inversion of Control (IoC) container</a></span></dt><dd><dl><dt><span class="section"><a href="#new-in-2-ioc-configuration">2.2.1. Easier XML configuration</a></span></dt><dt><span class="section"><a href="#new-in-2-ioc-scopes">2.2.2. New bean scopes</a></span></dt><dt><span class="section"><a href="#new-in-2-ioc-custom-configuration">2.2.3. Extensible XML authoring</a></span></dt></dl></dd><dt><span class="section"><a href="#new-in-2-aop">2.3. Aspect Oriented Programming (AOP)</a></span></dt><dd><dl><dt><span class="section"><a href="#new-in-2-aop-configuration">2.3.1. Easier AOP XML configuration</a></span></dt><dt><span class="section"><a href="#new-in-2-aop-aspectJ">2.3.2. Support for @AspectJ aspects</a></span></dt></dl></dd><dt><span class="section"><a href="#new-in-2-middle-tier">2.4. The Middle Tier</a></span></dt><dd><dl><dt><span class="section"><a href="#new-in-2-middle-tier-transaction-configuration">2.4.1. Easier configuration of declarative transactions in XML</a></span></dt><dt><span class="section"><a href="#new-in-2-middle-tier-jpa">2.4.2. JPA</a></span></dt><dt><span class="section"><a href="#new-in-2-middle-tier-async-jms">2.4.3. Asynchronous JMS</a></span></dt><dt><span class="section"><a href="#new-in-2-middle-tier-jdbc">2.4.4. JDBC</a></span></dt></dl></dd><dt><span class="section"><a href="#new-in-2-web">2.5. The Web Tier</a></span></dt><dd><dl><dt><span class="section"><a href="#new-in-2-web-form-tags">2.5.1. A form tag library for Spring MVC</a></span></dt><dt><span class="section"><a href="#new-in-2-web-convention">2.5.2. Sensible defaulting in Spring MVC</a></span></dt><dt><span class="section"><a href="#new-in-2-web-portlet">2.5.3. Portlet framework</a></span></dt></dl></dd><dt><span class="section"><a href="#new-in-2-other">2.6. Everything else</a></span></dt><dd><dl><dt><span class="section"><a href="#new-in-2-other-dynamic-language-support">2.6.1. Dynamic language support</a></span></dt><dt><span class="section"><a href="#new-in-2-other-jmx">2.6.2. JMX</a></span></dt><dt><span class="section"><a href="#new-in-2-other-taskexecutor">2.6.3. Task scheduling</a></span></dt><dt><span class="section"><a href="#new-in-2-other-java5">2.6.4. Java 5 (Tiger) support</a></span></dt></dl></dd><dt><span class="section"><a href="#new-in-2-migrating">2.7. Migrating to Spring 2.0</a></span></dt><dd><dl><dt><span class="section"><a href="#new-in-2-migrating-changes">2.7.1. Changes</a></span></dt><dd><dl><dt><span class="section"><a href="#new-in-2-migrating-packaging">2.7.1.1. Jar packaging</a></span></dt><dt><span class="section"><a href="#new-in-2-migrating-xml-configuration">2.7.1.2. XML configuration</a></span></dt><dt><span class="section"><a href="#new-in-2-migrating-deprecated">2.7.1.3. Deprecated classes and methods</a></span></dt><dt><span class="section"><a href="#new-in-2-migrating-ojb">2.7.1.4. Apache OJB</a></span></dt><dt><span class="section"><a href="#new-in-2-migrating-ibatis">2.7.1.5. iBatis</a></span></dt><dt><span class="section"><a href="#new-in-2-migrating-UrlFilenameViewController">2.7.1.6. <code class="classname">UrlFilenameViewController</code></a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#new-in-2-other-applications">2.8. Updated sample applications</a></span></dt><dt><span class="section"><a href="#new-in-2-other-documentation">2.9. Improved documentation</a></span></dt></dl></dd><dt><span class="part"><a href="#spring-core">I. Core Technologies</a></span></dt><dd><dl><dt><span class="chapter"><a href="#beans">3. The IoC container</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-introduction">3.1. Introduction</a></span></dt><dt><span class="section"><a href="#beans-basics">3.2. Basics - containers and beans</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory">3.2.1. The container</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-metadata">3.2.1.1. Configuration metadata</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-instantiation">3.2.2. Instantiating a container</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-xml-import">3.2.2.1. Composing XML-based configuration metadata</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-definition">3.2.3. The beans</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-beanname">3.2.3.1. Naming beans</a></span></dt><dt><span class="section"><a href="#beans-factory-class">3.2.3.2. Instantiating beans</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-client">3.2.4. Using the container</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-dependencies">3.3. Dependencies</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-collaborators">3.3.1. Injecting dependencies</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-setter-injection">3.3.1.1. Setter Injection</a></span></dt><dt><span class="section"><a href="#beans-constructor-injection">3.3.1.2. Constructor Injection</a></span></dt><dt><span class="section"><a href="#beans-some-examples">3.3.1.3. Some examples</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-ctor-arguments-resolution">3.3.2. Constructor Argument Resolution</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-ctor-arguments-type">3.3.2.1. Constructor Argument Type Matching</a></span></dt><dt><span class="section"><a href="#beans-factory-ctor-arguments-index">3.3.2.2. Constructor Argument Index</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-properties-detailed">3.3.3. Bean properties and constructor arguments detailed</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-value-element">3.3.3.1. Straight values (primitives, <code class="literal">Strings</code>, etc.)</a></span></dt><dt><span class="section"><a href="#beans-ref-element">3.3.3.2. References to other beans (collaborators)</a></span></dt><dt><span class="section"><a href="#beans-inner-beans">3.3.3.3. Inner beans</a></span></dt><dt><span class="section"><a href="#beans-collection-elements">3.3.3.4. Collections</a></span></dt><dt><span class="section"><a href="#beans-null-element">3.3.3.5. <code class="literal">Nulls</code></a></span></dt><dt><span class="section"><a href="#xml-config-shortcuts">3.3.3.6. Shortcuts and other convenience options for XML-based configuration metadata</a></span></dt><dt><span class="section"><a href="#beans-compound-property-names">3.3.3.7. Compound property names</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-dependson">3.3.4. Using <code class="literal">depends-on</code></a></span></dt><dt><span class="section"><a href="#beans-factory-lazy-init">3.3.5. Lazily-instantiated beans</a></span></dt><dt><span class="section"><a href="#beans-factory-autowire">3.3.6. Autowiring collaborators</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-autowire-candidate">3.3.6.1. Excluding a bean from being available for autowiring</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-dependencies">3.3.7. Checking for dependencies</a></span></dt><dt><span class="section"><a href="#beans-factory-method-injection">3.3.8. Method Injection</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-lookup-method-injection">3.3.8.1. Lookup method injection</a></span></dt><dt><span class="section"><a href="#beans-factory-arbitrary-method-replacement">3.3.8.2. Arbitrary method replacement</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#beans-factory-scopes">3.4. Bean scopes</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-scopes-singleton">3.4.1. The singleton scope</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-prototype">3.4.2. The prototype scope</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-sing-prot-interaction">3.4.3. Singleton beans with prototype-bean dependencies</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-other">3.4.4. The other scopes</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-scopes-other-web-configuration">3.4.4.1. Initial web configuration</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-request">3.4.4.2. The request scope</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-session">3.4.4.3. The session scope</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-global-session">3.4.4.4. The global session scope</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-other-injection">3.4.4.5. Scoped beans as dependencies</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-scopes-custom">3.4.5. Custom scopes</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-scopes-custom-creating">3.4.5.1. Creating your own custom scope</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-custom-using">3.4.5.2. Using a custom scope</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#beans-factory-nature">3.5. Customizing the nature of a bean</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-lifecycle">3.5.1. Lifecycle interfaces</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-lifecycle-initializingbean">3.5.1.1. Initialization callbacks</a></span></dt><dt><span class="section"><a href="#beans-factory-lifecycle-disposablebean">3.5.1.2. Destruction callbacks</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-aware">3.5.2. Knowing who you are</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-aware-beanfactoryaware">3.5.2.1. 
                    <code class="interfacename">BeanFactoryAware</code>
                </a></span></dt><dt><span class="section"><a href="#beans-factory-aware-beannameaware">3.5.2.2. <code class="interfacename">BeanNameAware</code></a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#beans-child-bean-definitions">3.6. Bean definition inheritance</a></span></dt><dt><span class="section"><a href="#beans-factory-extension">3.7. Container extension points</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-extension-bpp">3.7.1. Customizing beans using <code class="literal">BeanPostProcessors</code></a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-extension-bpp-examples-hw">3.7.1.1. Example: Hello World, <code class="interfacename">BeanPostProcessor</code>-style</a></span></dt><dt><span class="section"><a href="#beans-factory-extension-bpp-examples-rabpp">3.7.1.2. Example: The <code class="classname">RequiredAnnotationBeanPostProcessor</code></a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-extension-factory-postprocessors">3.7.2. Customizing configuration metadata with <code class="literal">BeanFactoryPostProcessors</code></a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-placeholderconfigurer">3.7.2.1. Example: the <code class="interfacename">PropertyPlaceholderConfigurer</code></a></span></dt><dt><span class="section"><a href="#beans-factory-overrideconfigurer">3.7.2.2. Example: the <code class="classname">PropertyOverrideConfigurer</code></a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-extension-factorybean">3.7.3. Customizing instantiation logic using <code class="literal">FactoryBeans</code></a></span></dt></dl></dd><dt><span class="section"><a href="#context-introduction">3.8. The <code class="interfacename">ApplicationContext</code></a></span></dt><dd><dl><dt><span class="section"><a href="#context-functionality-messagesource">3.8.1. Internationalization using <code class="literal">MessageSources</code></a></span></dt><dt><span class="section"><a href="#context-functionality-events">3.8.2. Events</a></span></dt><dt><span class="section"><a href="#context-functionality-resources">3.8.3. Convenient access to low-level resources</a></span></dt><dt><span class="section"><a href="#context-create">3.8.4. Convenient <code class="interfacename">ApplicationContext</code> instantiation for web applications</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-glue-code-and-singletons">3.9. Glue code and the evil singleton</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-singleton-helper">3.9.1. Using the Singleton-helper classes</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#resources">4. Resources</a></span></dt><dd><dl><dt><span class="section"><a href="#resources-introduction">4.1. Introduction</a></span></dt><dt><span class="section"><a href="#resources-resource">4.2. The <code class="interfacename">Resource</code> interface</a></span></dt><dt><span class="section"><a href="#resources-implementations">4.3. Built-in <code class="interfacename">Resource</code> implementations</a></span></dt><dd><dl><dt><span class="section"><a href="#resources-implementations-urlresource">4.3.1. <code class="classname">UrlResource</code></a></span></dt><dt><span class="section"><a href="#resources-implementations-classpathresource">4.3.2. <code class="classname">ClassPathResource</code></a></span></dt><dt><span class="section"><a href="#resources-implementations-filesystemresource">4.3.3. <code class="classname">FileSystemResource</code></a></span></dt><dt><span class="section"><a href="#resources-implementations-servletcontextresource">4.3.4. <code class="classname">ServletContextResource</code></a></span></dt><dt><span class="section"><a href="#resources-implementations-inputstreamresource">4.3.5. <code class="classname">InputStreamResource</code></a></span></dt><dt><span class="section"><a href="#resources-implementations-bytearrayresource">4.3.6. <code class="classname">ByteArrayResource</code></a></span></dt></dl></dd><dt><span class="section"><a href="#resources-resourceloader">4.4. The <code class="interfacename">ResourceLoader</code></a></span></dt><dt><span class="section"><a href="#resources-resourceloaderaware">4.5. The <code class="interfacename">ResourceLoaderAware</code> interface</a></span></dt><dt><span class="section"><a href="#resources-as-dependencies">4.6. <code class="literal">Resources</code> as dependencies</a></span></dt><dt><span class="section"><a href="#resources-app-ctx">4.7. Application contexts and <code class="interfacename">Resource</code> paths</a></span></dt><dd><dl><dt><span class="section"><a href="#resources-app-ctx-construction">4.7.1. Constructing application contexts</a></span></dt><dd><dl><dt><span class="section"><a href="#resources-app-ctx-classpathxml">4.7.1.1. Constructing <code class="classname">ClassPathXmlApplicationContext</code> instances - shortcuts</a></span></dt></dl></dd><dt><span class="section"><a href="#resources-app-ctx-wildcards-in-resource-paths">4.7.2. Wildcards in application context constructor resource paths</a></span></dt><dd><dl><dt><span class="section"><a href="#resources-app-ctx-ant-patterns-in-paths">4.7.2.1. Ant-style Patterns</a></span></dt><dt><span class="section"><a href="#resources-classpath-wildcards">4.7.2.2. The <code class="literal">classpath*:</code> prefix</a></span></dt><dt><span class="section"><a href="#resources-wildcards-in-path-other-stuff">4.7.2.3. Other notes relating to wildcards</a></span></dt></dl></dd><dt><span class="section"><a href="#resources-filesystemresource-caveats">4.7.3. <code class="classname">FileSystemResource</code> caveats</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#validation">5. Validation, Data-binding, the <code class="interfacename">BeanWrapper</code>, and <code class="literal">PropertyEditors</code></a></span></dt><dd><dl><dt><span class="section"><a href="#validation-introduction">5.1. Introduction</a></span></dt><dt><span class="section"><a href="#validator">5.2. Validation using Spring's <code class="interfacename">Validator</code> interface</a></span></dt><dt><span class="section"><a href="#validation-conversion">5.3. Resolving codes to error messages</a></span></dt><dt><span class="section"><a href="#beans-beans">5.4. Bean manipulation and the <code class="interfacename">BeanWrapper</code></a></span></dt><dd><dl><dt><span class="section"><a href="#beans-beans-conventions">5.4.1. Setting and getting basic and nested properties</a></span></dt><dt><span class="section"><a href="#beans-beans-conversion">5.4.2. Built-in <span class="interface">PropertyEditor</span> implementations</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-beans-conversion-customeditor-registration">5.4.2.1. Registering additional custom <code class="literal">PropertyEditors</code></a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#aop">6. Aspect Oriented Programming with Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-introduction">6.1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-introduction-defn">6.1.1. AOP concepts</a></span></dt><dt><span class="section"><a href="#aop-introduction-spring-defn">6.1.2. Spring AOP capabilities and goals</a></span></dt><dt><span class="section"><a href="#aop-introduction-proxies">6.1.3. AOP Proxies</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-ataspectj">6.2. @AspectJ support</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-aspectj-support">6.2.1. Enabling @AspectJ Support</a></span></dt><dt><span class="section"><a href="#aop-at-aspectj">6.2.2. Declaring an aspect</a></span></dt><dt><span class="section"><a href="#aop-pointcuts">6.2.3. Declaring a pointcut</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-pointcuts-designators">6.2.3.1. Supported Pointcut Designators</a></span></dt><dt><span class="section"><a href="#aop-pointcuts-combining">6.2.3.2. Combining pointcut expressions</a></span></dt><dt><span class="section"><a href="#aop-common-pointcuts">6.2.3.3. Sharing common pointcut definitions</a></span></dt><dt><span class="section"><a href="#aop-pointcuts-examples">6.2.3.4. Examples</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-advice">6.2.4. Declaring advice</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-advice-before">6.2.4.1. Before advice</a></span></dt><dt><span class="section"><a href="#aop-advice-after-returning">6.2.4.2. After returning advice</a></span></dt><dt><span class="section"><a href="#aop-advice-after-throwing">6.2.4.3. After throwing advice</a></span></dt><dt><span class="section"><a href="#aop-advice-after-finally">6.2.4.4. After (finally) advice</a></span></dt><dt><span class="section"><a href="#aop-ataspectj-around-advice">6.2.4.5. Around advice</a></span></dt><dt><span class="section"><a href="#aop-ataspectj-advice-params">6.2.4.6. Advice parameters</a></span></dt><dt><span class="section"><a href="#aop-ataspectj-advice-ordering">6.2.4.7. Advice ordering</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-introductions">6.2.5. Introductions</a></span></dt><dt><span class="section"><a href="#aop-instantiation-models">6.2.6. Aspect instantiation models</a></span></dt><dt><span class="section"><a href="#aop-ataspectj-example">6.2.7. Example</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-schema">6.3. Schema-based AOP support</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-schema-declaring-an-aspect">6.3.1. Declaring an aspect</a></span></dt><dt><span class="section"><a href="#aop-schema-pointcuts">6.3.2. Declaring a pointcut</a></span></dt><dt><span class="section"><a href="#aop-schema-advice">6.3.3. Declaring advice</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-schema-advice-before">6.3.3.1. Before advice</a></span></dt><dt><span class="section"><a href="#aop-schema-advice-after-returning">6.3.3.2. After returning advice</a></span></dt><dt><span class="section"><a href="#aop-schema-advice-after-throwing">6.3.3.3. After throwing advice</a></span></dt><dt><span class="section"><a href="#aop-schema-advice-after-finally">6.3.3.4. After (finally) advice</a></span></dt><dt><span class="section"><a href="#aop-schema-advice-around">6.3.3.5. Around advice</a></span></dt><dt><span class="section"><a href="#aop-schema-params">6.3.3.6. Advice parameters</a></span></dt><dt><span class="section"><a href="#aop-ordering">6.3.3.7. Advice ordering</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-schema-introductions">6.3.4. Introductions</a></span></dt><dt><span class="section"><a href="#aop-schema-instatiation-models">6.3.5. Aspect instantiation models</a></span></dt><dt><span class="section"><a href="#aop-schema-advisors">6.3.6. Advisors</a></span></dt><dt><span class="section"><a href="#aop-schema-example">6.3.7. Example</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-choosing">6.4. Choosing which AOP declaration style to use</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-spring-or-aspectj">6.4.1. Spring AOP or full AspectJ?</a></span></dt><dt><span class="section"><a href="#aop-ataspectj-or-xml">6.4.2. @AspectJ or XML for Spring AOP?</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-mixing-styles">6.5. Mixing aspect types</a></span></dt><dt><span class="section"><a href="#aop-proxying">6.6. Proxying mechanisms</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-understanding-aop-proxies">6.6.1. Understanding AOP proxies</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-aspectj-programmatic">6.7. Programmatic creation of @AspectJ Proxies</a></span></dt><dt><span class="section"><a href="#aop-using-aspectj">6.8. Using AspectJ with Spring applications</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-atconfigurable">6.8.1. Using AspectJ to dependency inject domain objects with Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-configurable-testing">6.8.1.1. Unit testing <code class="interfacename">@Configurable</code> objects</a></span></dt><dt><span class="section"><a href="#aop-configurable-container">6.8.1.2. Working with multiple application contexts</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-ajlib-other">6.8.2. Other Spring aspects for AspectJ</a></span></dt><dt><span class="section"><a href="#aop-aj-configure">6.8.3. Configuring AspectJ aspects using Spring IoC</a></span></dt><dt><span class="section"><a href="#aop-aj-ltw">6.8.4. Using AspectJ Load-time weaving (LTW) with Spring applications</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-resources">6.9. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#aop-api">7. Spring AOP APIs</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-api-introduction">7.1. Introduction</a></span></dt><dt><span class="section"><a href="#aop-api-pointcuts">7.2. Pointcut API in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-api-concepts">7.2.1. Concepts</a></span></dt><dt><span class="section"><a href="#aop-api-pointcut-ops">7.2.2. Operations on pointcuts</a></span></dt><dt><span class="section"><a href="#aop-api-pointcuts-aspectj">7.2.3. AspectJ expression pointcuts</a></span></dt><dt><span class="section"><a href="#aop-api-pointcuts-impls">7.2.4. Convenience pointcut implementations</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-api-pointcuts-static">7.2.4.1. Static pointcuts</a></span></dt><dt><span class="section"><a href="#aop-api-pointcuts-dynamic">7.2.4.2. Dynamic pointcuts</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-api-pointcuts-superclasses">7.2.5. Pointcut superclasses</a></span></dt><dt><span class="section"><a href="#aop-api-pointcuts-custom">7.2.6. Custom pointcuts</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-api-advice">7.3. Advice API in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-api-advice-lifecycle">7.3.1. Advice lifecycles</a></span></dt><dt><span class="section"><a href="#aop-api-advice-types">7.3.2. Advice types in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-api-advice-around">7.3.2.1. Interception around advice</a></span></dt><dt><span class="section"><a href="#aop-api-advice-before">7.3.2.2. Before advice</a></span></dt><dt><span class="section"><a href="#aop-api-advice-throws">7.3.2.3. Throws advice</a></span></dt><dt><span class="section"><a href="#aop-api-advice-after-returning">7.3.2.4. After Returning advice</a></span></dt><dt><span class="section"><a href="#aop-api-advice-introduction">7.3.2.5. Introduction advice</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#aop-api-advisor">7.4. Advisor API in Spring</a></span></dt><dt><span class="section"><a href="#aop-pfb">7.5. Using the ProxyFactoryBean to create AOP proxies</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-pfb-1">7.5.1. Basics</a></span></dt><dt><span class="section"><a href="#aop-pfb-2">7.5.2. JavaBean properties</a></span></dt><dt><span class="section"><a href="#aop-pfb-proxy-types">7.5.3. JDK- and CGLIB-based proxies</a></span></dt><dt><span class="section"><a href="#aop-api-proxying-intf">7.5.4. Proxying interfaces</a></span></dt><dt><span class="section"><a href="#aop-api-proxying-class">7.5.5. Proxying classes</a></span></dt><dt><span class="section"><a href="#aop-global-advisors">7.5.6. Using 'global' advisors</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-concise-proxy">7.6. Concise proxy definitions</a></span></dt><dt><span class="section"><a href="#aop-prog">7.7. Creating AOP proxies programmatically with the ProxyFactory</a></span></dt><dt><span class="section"><a href="#aop-api-advised">7.8. Manipulating advised objects</a></span></dt><dt><span class="section"><a href="#aop-autoproxy">7.9. Using the "autoproxy" facility</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-autoproxy-choices">7.9.1. Autoproxy bean definitions</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-api-autoproxy">7.9.1.1. BeanNameAutoProxyCreator</a></span></dt><dt><span class="section"><a href="#aop-api-autoproxy-default">7.9.1.2. DefaultAdvisorAutoProxyCreator</a></span></dt><dt><span class="section"><a href="#aop-api-autoproxy-abstract">7.9.1.3. AbstractAdvisorAutoProxyCreator</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-autoproxy-metadata">7.9.2. Using metadata-driven auto-proxying</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-targetsource">7.10. Using TargetSources</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-ts-swap">7.10.1. Hot swappable target sources</a></span></dt><dt><span class="section"><a href="#aop-ts-pool">7.10.2. Pooling target sources</a></span></dt><dt><span class="section"><a href="#aop-ts-prototype">7.10.3. Prototype target sources</a></span></dt><dt><span class="section"><a href="#aop-ts-threadlocal">7.10.4. <code class="classname">ThreadLocal</code> target sources</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-extensibility">7.11. Defining new <code class="interfacename">Advice</code> types</a></span></dt><dt><span class="section"><a href="#aop-api-resources">7.12. Further resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#testing">8. Testing</a></span></dt><dd><dl><dt><span class="section"><a href="#testing-introduction">8.1. Introduction</a></span></dt><dt><span class="section"><a href="#unit-testing">8.2. Unit testing</a></span></dt><dt><span class="section"><a href="#integration-testing">8.3. Integration testing</a></span></dt><dd><dl><dt><span class="section"><a href="#testing-ctx-management">8.3.1. Context management and caching</a></span></dt><dt><span class="section"><a href="#testing-fixture-di">8.3.2. Dependency Injection of test fixtures</a></span></dt><dd><dl><dt><span class="section"><a href="#testing-fixture-di-field">8.3.2.1. Field level injection</a></span></dt></dl></dd><dt><span class="section"><a href="#testing-tx">8.3.3. Transaction management</a></span></dt><dt><span class="section"><a href="#testing-superclasses">8.3.4. Convenience variables</a></span></dt><dt><span class="section"><a href="#testing-java5-support">8.3.5. Java 5+ specific support</a></span></dt><dd><dl><dt><span class="section"><a href="#testing-java5-support-annotations">8.3.5.1. Annotations</a></span></dt></dl></dd><dt><span class="section"><a href="#testing-examples-petclinic">8.3.6. PetClinic example</a></span></dt></dl></dd><dt><span class="section"><a href="#testing-resources">8.4. Further Resources</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#spring-middle-tier">II. Middle Tier Data Access</a></span></dt><dd><dl><dt><span class="chapter"><a href="#transaction">9. Transaction management</a></span></dt><dd><dl><dt><span class="section"><a href="#transaction-intro">9.1. Introduction</a></span></dt><dt><span class="section"><a href="#transaction-motivation">9.2. Motivations</a></span></dt><dt><span class="section"><a href="#transaction-strategies">9.3. Key abstractions</a></span></dt><dt><span class="section"><a href="#tx-resource-synchronization">9.4. Resource synchronization with transactions</a></span></dt><dd><dl><dt><span class="section"><a href="#tx-resource-synchronization-high">9.4.1. High-level approach</a></span></dt><dt><span class="section"><a href="#tx-resource-synchronization-low">9.4.2. Low-level approach</a></span></dt><dt><span class="section"><a href="#tx-resource-synchronization-tadsp">9.4.3. <code class="classname">TransactionAwareDataSourceProxy</code></a></span></dt></dl></dd><dt><span class="section"><a href="#transaction-declarative">9.5. Declarative transaction management</a></span></dt><dd><dl><dt><span class="section"><a href="#tx-decl-explained">9.5.1. Understanding the Spring Framework's declarative transaction implementation</a></span></dt><dt><span class="section"><a href="#transaction-declarative-first-example">9.5.2. A first example</a></span></dt><dt><span class="section"><a href="#transaction-declarative-rolling-back">9.5.3. Rolling back</a></span></dt><dt><span class="section"><a href="#transaction-declarative-diff-tx">9.5.4. Configuring different transactional semantics for different beans</a></span></dt><dt><span class="section"><a href="#transaction-declarative-txadvice-settings">9.5.5. <code class="literal">&lt;tx:advice/&gt;</code> settings</a></span></dt><dt><span class="section"><a href="#transaction-declarative-annotations">9.5.6. Using <code class="interfacename">@Transactional</code></a></span></dt><dd><dl><dt><span class="section"><a href="#transaction-declarative-attransactional-settings">9.5.6.1. <code class="interfacename">@Transactional</code> settings</a></span></dt></dl></dd><dt><span class="section"><a href="#transaction-declarative-applying-more-than-just-tx-advice">9.5.7. Advising transactional operations</a></span></dt><dt><span class="section"><a href="#transaction-declarative-aspectj">9.5.8. Using <code class="interfacename">@Transactional</code> with AspectJ</a></span></dt></dl></dd><dt><span class="section"><a href="#transaction-programmatic">9.6. Programmatic transaction management</a></span></dt><dd><dl><dt><span class="section"><a href="#tx-prog-template">9.6.1. Using the <code class="classname">TransactionTemplate</code></a></span></dt><dd><dl><dt><span class="section"><a href="#tx-prog-template-settings">9.6.1.1. Specifying transaction settings</a></span></dt></dl></dd><dt><span class="section"><a href="#transaction-programmatic-ptm">9.6.2. Using the <code class="interfacename">PlatformTransactionManager</code></a></span></dt></dl></dd><dt><span class="section"><a href="#tx-decl-vs-prog">9.7. Choosing between programmatic and declarative transaction management</a></span></dt><dt><span class="section"><a href="#transaction-application-server-integration">9.8. Application server-specific integration</a></span></dt><dd><dl><dt><span class="section"><a href="#transaction-application-server-integration-weblogic">9.8.1. BEA WebLogic</a></span></dt><dt><span class="section"><a href="#transaction-application-server-integration-websphere">9.8.2. IBM WebSphere</a></span></dt></dl></dd><dt><span class="section"><a href="#transaction-solutions-to-common-problems">9.9. Solutions to common problems</a></span></dt><dd><dl><dt><span class="section"><a href="#transaction-solutions-to-common-problems-wrong-ptm">9.9.1. Use of the wrong transaction manager for a specific <code class="interfacename">DataSource</code></a></span></dt></dl></dd><dt><span class="section"><a href="#transaction-resources">9.10. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#dao">10. DAO support</a></span></dt><dd><dl><dt><span class="section"><a href="#dao-introduction">10.1. Introduction</a></span></dt><dt><span class="section"><a href="#dao-exceptions">10.2. Consistent exception hierarchy</a></span></dt><dt><span class="section"><a href="#dao-abstract-superclasses">10.3. Consistent abstract classes for DAO support</a></span></dt></dl></dd><dt><span class="chapter"><a href="#jdbc">11. Data access using JDBC</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-introduction">11.1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-packages">11.1.1. The package hierarchy</a></span></dt></dl></dd><dt><span class="section"><a href="#jdbc-core">11.2. Using the JDBC Core classes to control basic JDBC processing and error handling</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-JdbcTemplate">11.2.1. <code class="classname">JdbcTemplate</code></a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-JdbcTemplate-examples">11.2.1.1. Examples</a></span></dt><dt><span class="section"><a href="#jdbc-JdbcTemplate-idioms">11.2.1.2. <code class="classname">JdbcTemplate</code> idioms (best practices)</a></span></dt></dl></dd><dt><span class="section"><a href="#jdbc-NamedParameterJdbcTemplate">11.2.2. <code class="classname">NamedParameterJdbcTemplate</code></a></span></dt><dt><span class="section"><a href="#jdbc-SimpleJdbcTemplate">11.2.3. <code class="classname">SimpleJdbcTemplate</code></a></span></dt><dt><span class="section"><a href="#jdbc-datasource">11.2.4. <code class="interfacename">DataSource</code></a></span></dt><dt><span class="section"><a href="#jdbc-SQLExceptionTranslator">11.2.5. <code class="interfacename">SQLExceptionTranslator</code></a></span></dt><dt><span class="section"><a href="#jdbc-statements-executing">11.2.6. Executing statements</a></span></dt><dt><span class="section"><a href="#jdbc-statements-querying">11.2.7. Running Queries</a></span></dt><dt><span class="section"><a href="#jdbc-updates">11.2.8. Updating the database</a></span></dt></dl></dd><dt><span class="section"><a href="#jdbc-connections">11.3. Controlling database connections</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-DataSourceUtils">11.3.1. <code class="classname">DataSourceUtils</code></a></span></dt><dt><span class="section"><a href="#jdbc-SmartDataSource">11.3.2. <code class="interfacename">SmartDataSource</code></a></span></dt><dt><span class="section"><a href="#jdbc-AbstractDataSource">11.3.3. <code class="classname">AbstractDataSource</code></a></span></dt><dt><span class="section"><a href="#jdbc-SingleConnectionDataSource">11.3.4. <code class="classname">SingleConnectionDataSource</code></a></span></dt><dt><span class="section"><a href="#jdbc-DriverManagerDataSource">11.3.5. <code class="classname">DriverManagerDataSource</code></a></span></dt><dt><span class="section"><a href="#jdbc-TransactionAwareDataSourceProxy">11.3.6. <code class="classname">TransactionAwareDataSourceProxy</code></a></span></dt><dt><span class="section"><a href="#jdbc-DataSourceTransactionManager">11.3.7. <code class="classname">DataSourceTransactionManager</code></a></span></dt></dl></dd><dt><span class="section"><a href="#jdbc-object">11.4. Modeling JDBC operations as Java objects</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-SqlQuery">11.4.1. <code class="classname">SqlQuery</code></a></span></dt><dt><span class="section"><a href="#jdbc-MappingSqlQuery">11.4.2. <code class="classname">MappingSqlQuery</code></a></span></dt><dt><span class="section"><a href="#jdbc-SqlUpdate">11.4.3. <code class="classname">SqlUpdate</code></a></span></dt><dt><span class="section"><a href="#jdbc-StoredProcedure">11.4.4. <code class="classname">StoredProcedure</code></a></span></dt><dt><span class="section"><a href="#jdbc-SqlFunction">11.4.5. <code class="classname">SqlFunction</code></a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#orm">12. Object Relational Mapping (ORM) data access</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-introduction">12.1. Introduction</a></span></dt><dt><span class="section"><a href="#orm-hibernate">12.2. Hibernate</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-resource-mngmnt">12.2.1. Resource management</a></span></dt><dt><span class="section"><a href="#orm-session-factory-setup">12.2.2. <code class="interfacename">SessionFactory</code> setup in a Spring container</a></span></dt><dt><span class="section"><a href="#orm-hibernate-template">12.2.3. The <code class="classname">HibernateTemplate</code></a></span></dt><dt><span class="section"><a href="#orm-hibernate-daos">12.2.4. Implementing Spring-based DAOs without callbacks</a></span></dt><dt><span class="section"><a href="#orm-hibernate-straight">12.2.5. Implementing DAOs based on plain Hibernate 3 API</a></span></dt><dt><span class="section"><a href="#orm-hibernate-tx-programmatic">12.2.6. Programmatic transaction demarcation</a></span></dt><dt><span class="section"><a href="#orm-hibernate-tx-declarative">12.2.7. Declarative transaction demarcation</a></span></dt><dt><span class="section"><a href="#orm-hibernate-tx-strategies">12.2.8. Transaction management strategies</a></span></dt><dt><span class="section"><a href="#orm-hibernate-resources">12.2.9. Container resources versus local resources</a></span></dt><dt><span class="section"><a href="#orm-hibernate-invalid-jdbc-access-error">12.2.10. Spurious application server warnings when using Hibernate</a></span></dt></dl></dd><dt><span class="section"><a href="#orm-jdo">12.3. JDO</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-jdo-setup">12.3.1. <code class="interfacename">PersistenceManagerFactory</code> setup</a></span></dt><dt><span class="section"><a href="#orm-jdo-template">12.3.2. <code class="classname">JdoTemplate</code> and <code class="classname">JdoDaoSupport</code></a></span></dt><dt><span class="section"><a href="#orm-jdo-daos-straight">12.3.3. Implementing DAOs based on the plain JDO API</a></span></dt><dt><span class="section"><a href="#orm-jdo-tx">12.3.4. Transaction management</a></span></dt><dt><span class="section"><a href="#orm-jdo-dialect">12.3.5. <code class="interfacename">JdoDialect</code></a></span></dt></dl></dd><dt><span class="section"><a href="#orm-toplink">12.4. Oracle TopLink</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-toplink-abstraction">12.4.1. <code class="interfacename">SessionFactory</code> abstraction</a></span></dt><dt><span class="section"><a href="#orm-toplink-template">12.4.2. <code class="classname">TopLinkTemplate</code> and <code class="classname">TopLinkDaoSupport</code></a></span></dt><dt><span class="section"><a href="#orm-toplink-straight">12.4.3. Implementing DAOs based on plain TopLink API</a></span></dt><dt><span class="section"><a href="#orm-toplink-tx">12.4.4. Transaction management</a></span></dt></dl></dd><dt><span class="section"><a href="#orm-ibatis">12.5. iBATIS SQL Maps</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-ibatis-setup">12.5.1. Setting up the <code class="classname">SqlMapClient</code></a></span></dt><dt><span class="section"><a href="#orm-ibatis-template">12.5.2. Using <code class="classname">SqlMapClientTemplate</code> and <code class="classname">SqlMapClientDaoSupport</code></a></span></dt><dt><span class="section"><a href="#orm-ibatis-straight">12.5.3. Implementing DAOs based on plain iBATIS API</a></span></dt></dl></dd><dt><span class="section"><a href="#orm-jpa">12.6. JPA</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-jpa-setup">12.6.1. JPA setup in a Spring environment</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-jpa-setup-lemfb">12.6.1.1. <code class="classname">LocalEntityManagerFactoryBean</code></a></span></dt><dt><span class="section"><a href="#orm-jpa-setup-jndi">12.6.1.2. <code class="classname">Obtaining an EntityManagerFactory from JNDI</code></a></span></dt><dt><span class="section"><a href="#orm-jpa-setup-lcemfb">12.6.1.3. <code class="classname">LocalContainerEntityManagerFactoryBean</code></a></span></dt><dt><span class="section"><a href="#orm-jpa-multiple-pu">12.6.1.4. Dealing with multiple persistence units</a></span></dt></dl></dd><dt><span class="section"><a href="#orm-jpa-template">12.6.2. <code class="classname">JpaTemplate</code> and <code class="classname">JpaDaoSupport</code></a></span></dt><dt><span class="section"><a href="#orm-jpa-straight">12.6.3. Implementing DAOs based on plain JPA</a></span></dt><dt><span class="section"><a href="#orm-jpa-exceptions">12.6.4. Exception Translation</a></span></dt></dl></dd><dt><span class="section"><a href="#orm-jpa-tx">12.7. Transaction Management</a></span></dt><dt><span class="section"><a href="#orm-jpa-dialect">12.8. <code class="interfacename">JpaDialect</code></a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#spring-web">III. The Web</a></span></dt><dd><dl><dt><span class="chapter"><a href="#mvc">13. Web MVC framework</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-introduction">13.1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-introduction-pluggability">13.1.1. Pluggability of other MVC implementations</a></span></dt><dt><span class="section"><a href="#mvc-features">13.1.2. Features of Spring Web MVC</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-servlet">13.2. The <code class="classname">DispatcherServlet</code></a></span></dt><dt><span class="section"><a href="#mvc-controller">13.3. Controllers</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-controller-abstractcontroller">13.3.1. <code class="classname">AbstractController</code> and <code class="classname">WebContentGenerator</code></a></span></dt><dt><span class="section"><a href="#mvc-controller-othersimplecontrollers">13.3.2. Other simple controllers</a></span></dt><dt><span class="section"><a href="#mvc-controller-multiaction">13.3.3. The <code class="classname">MultiActionController</code></a></span></dt><dt><span class="section"><a href="#mvc-controller-command">13.3.4. Command controllers</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-handlermapping">13.4. Handler mappings</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-handlermapping-beanname">13.4.1. <code class="classname">BeanNameUrlHandlerMapping</code></a></span></dt><dt><span class="section"><a href="#mvc-handlermapping-urlhandlermapping">13.4.2. <code class="classname">SimpleUrlHandlerMapping</code></a></span></dt><dt><span class="section"><a href="#mvc-handlermapping-interceptor">13.4.3. Intercepting requests - the <code class="interfacename">HandlerInterceptor</code> interface</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-viewresolver">13.5. Views and resolving them</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-viewresolver-resolver">13.5.1. Resolving views - the <code class="interfacename">ViewResolver</code> interface</a></span></dt><dt><span class="section"><a href="#mvc-viewresolver-chaining">13.5.2. Chaining ViewResolvers</a></span></dt><dt><span class="section"><a href="#mvc-redirecting">13.5.3. Redirecting to views</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-redirecting-redirect-view">13.5.3.1. <code class="classname">RedirectView</code></a></span></dt><dt><span class="section"><a href="#mvc-redirecting-redirect-prefix">13.5.3.2. The <code class="literal">redirect:</code> prefix</a></span></dt><dt><span class="section"><a href="#mvc-redirecting-forward-prefix">13.5.3.3. The <code class="literal">forward:</code> prefix</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#mvc-localeresolver">13.6. Using locales</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-localeresolver-acceptheader">13.6.1. <code class="classname">AcceptHeaderLocaleResolver</code></a></span></dt><dt><span class="section"><a href="#mvc-localeresolver-cookie">13.6.2. <code class="classname">CookieLocaleResolver</code></a></span></dt><dt><span class="section"><a href="#mvc-localeresolver-session">13.6.3. <code class="classname">SessionLocaleResolver</code></a></span></dt><dt><span class="section"><a href="#mvc-localeresolver-interceptor">13.6.4. <code class="classname">LocaleChangeInterceptor</code></a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-themeresolver">13.7. Using themes</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-themeresolver-introduction">13.7.1. Introduction</a></span></dt><dt><span class="section"><a href="#mvc-themeresolver-defining">13.7.2. Defining themes</a></span></dt><dt><span class="section"><a href="#mvc-themeresolver-resolving">13.7.3. Theme resolvers</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-multipart">13.8. Spring's multipart (fileupload) support</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-multipart-introduction">13.8.1. Introduction</a></span></dt><dt><span class="section"><a href="#mvc-multipart-resolver">13.8.2. Using the <code class="interfacename">MultipartResolver</code></a></span></dt><dt><span class="section"><a href="#mvc-multipart-forms">13.8.3. Handling a file upload in a form</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-formtaglib">13.9. Using Spring's form tag library</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-formtaglib-configuration">13.9.1. Configuration</a></span></dt><dt><span class="section"><a href="#mvc-formtaglib-formtag">13.9.2. The <code class="literal">form</code> tag</a></span></dt><dt><span class="section"><a href="#mvc-formtaglib-inputtag">13.9.3. The <code class="literal">input</code> tag</a></span></dt><dt><span class="section"><a href="#mvc-formtaglib-checkboxtag">13.9.4. The <code class="literal">checkbox</code> tag</a></span></dt><dt><span class="section"><a href="#mvc-formtaglib-radiobuttontag">13.9.5. The <code class="literal">radiobutton</code> tag</a></span></dt><dt><span class="section"><a href="#mvc-formtaglib-passwordtag">13.9.6. The <code class="literal">password</code> tag</a></span></dt><dt><span class="section"><a href="#mvc-formtaglib-selecttag">13.9.7. The <code class="literal">select</code> tag</a></span></dt><dt><span class="section"><a href="#mvc-formtaglib-optiontag">13.9.8. The <code class="literal">option</code> tag</a></span></dt><dt><span class="section"><a href="#mvc-formtaglib-optionstag">13.9.9. The <code class="literal">options</code> tag</a></span></dt><dt><span class="section"><a href="#mvc-formtaglib-textAreatag">13.9.10. The <code class="literal">textarea</code> tag</a></span></dt><dt><span class="section"><a href="#mvc-formtaglib-hiddeninputtag">13.9.11. The <code class="literal">hidden</code> tag</a></span></dt><dt><span class="section"><a href="#mvc-formtaglib-errorstag">13.9.12. The <code class="literal">errors</code> tag</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-exceptionhandlers">13.10. Handling exceptions</a></span></dt><dt><span class="section"><a href="#mvc-coc">13.11. Convention over configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-coc-ccnhm">13.11.1. The Controller - <code class="classname">ControllerClassNameHandlerMapping</code></a></span></dt><dt><span class="section"><a href="#mvc-coc-modelmap">13.11.2. The Model - <code class="classname">ModelMap</code> (<code class="classname">ModelAndView</code>)</a></span></dt><dt><span class="section"><a href="#mvc-coc-r2vnt">13.11.3. The View - <code class="interfacename">RequestToViewNameTranslator</code></a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-resources">13.12. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#view">14. Integrating view technologies</a></span></dt><dd><dl><dt><span class="section"><a href="#view-introduction">14.1. Introduction</a></span></dt><dt><span class="section"><a href="#view-jsp">14.2. JSP &amp; JSTL</a></span></dt><dd><dl><dt><span class="section"><a href="#view-jsp-resolver">14.2.1. View resolvers</a></span></dt><dt><span class="section"><a href="#view-jsp-jstl">14.2.2. 'Plain-old' JSPs versus JSTL</a></span></dt><dt><span class="section"><a href="#view-jsp-tags">14.2.3. Additional tags facilitating development</a></span></dt></dl></dd><dt><span class="section"><a href="#view-tiles">14.3. Tiles</a></span></dt><dd><dl><dt><span class="section"><a href="#view-tiles-dependencies">14.3.1. Dependencies</a></span></dt><dt><span class="section"><a href="#view-tiles-integrate">14.3.2. How to integrate Tiles</a></span></dt><dd><dl><dt><span class="section"><a href="#view-tiles-url">14.3.2.1. <code class="classname">UrlBasedViewResolver</code></a></span></dt><dt><span class="section"><a href="#view-tiles-resource">14.3.2.2. <code class="classname">ResourceBundleViewResolver</code></a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#view-velocity">14.4. Velocity &amp; FreeMarker</a></span></dt><dd><dl><dt><span class="section"><a href="#view-velocity-dependencies">14.4.1. Dependencies</a></span></dt><dt><span class="section"><a href="#view-velocity-contextconfig">14.4.2. Context configuration</a></span></dt><dt><span class="section"><a href="#view-velocity-createtemplates">14.4.3. Creating templates</a></span></dt><dt><span class="section"><a href="#view-velocity-advancedconfig">14.4.4. Advanced configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#view-velocity-example-velocityproperties">14.4.4.1. velocity.properties</a></span></dt><dt><span class="section"><a href="#views-freemarker">14.4.4.2. FreeMarker</a></span></dt></dl></dd><dt><span class="section"><a href="#view-velocity-forms">14.4.5. Bind support and form handling</a></span></dt><dd><dl><dt><span class="section"><a href="#view-velocity-validation">14.4.5.1. The bind macros</a></span></dt><dt><span class="section"><a href="#view-velocity-validationmessages">14.4.5.2. simple binding</a></span></dt><dt><span class="section"><a href="#views-form-macros">14.4.5.3. form input generation macros</a></span></dt><dt><span class="section"><a href="#views-form-macros-html-escaping">14.4.5.4. HTML escaping and XHTML compliance</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#view-xslt">14.5. XSLT</a></span></dt><dd><dl><dt><span class="section"><a href="#view-xslt-firstwords">14.5.1. My First Words</a></span></dt><dd><dl><dt><span class="section"><a href="#view-xslt-beandefs">14.5.1.1. Bean definitions</a></span></dt><dt><span class="section"><a href="#view-xslt-controllercode">14.5.1.2. Standard MVC controller code</a></span></dt><dt><span class="section"><a href="#view-xslt-subclassing">14.5.1.3. Convert the model data to XML</a></span></dt><dt><span class="section"><a href="#view-xslt-viewdefinitions">14.5.1.4. Defining the view properties</a></span></dt><dt><span class="section"><a href="#view-xslt-transforming">14.5.1.5. Document transformation</a></span></dt></dl></dd><dt><span class="section"><a href="#view-xslt-summary">14.5.2. Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#view-document">14.6. Document views (PDF/Excel)</a></span></dt><dd><dl><dt><span class="section"><a href="#view-document-intro">14.6.1. Introduction</a></span></dt><dt><span class="section"><a href="#view-document-config">14.6.2. Configuration and setup</a></span></dt><dd><dl><dt><span class="section"><a href="#view-document-configviews">14.6.2.1. Document view definitions</a></span></dt><dt><span class="section"><a href="#view-document-configcontroller">14.6.2.2. Controller code</a></span></dt><dt><span class="section"><a href="#view-document-configsubclasses">14.6.2.3. Subclassing for Excel views</a></span></dt><dt><span class="section"><a href="#view-document-configsubclasspdf">14.6.2.4. Subclassing for PDF views</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#view-jasper-reports">14.7. JasperReports</a></span></dt><dd><dl><dt><span class="section"><a href="#view-jasper-reports-dependencies">14.7.1. Dependencies</a></span></dt><dt><span class="section"><a href="#view-jasper-reports-configuration">14.7.2. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#view-jasper-reports-configuration-resolver">14.7.2.1. Configuring the <code class="interfacename">ViewResolver</code></a></span></dt><dt><span class="section"><a href="#view-jasper-reports-configuration-views">14.7.2.2. Configuring the <code class="literal">View</code>s</a></span></dt><dt><span class="section"><a href="#view-jasper-reports-configuration-report-files">14.7.2.3. About Report Files</a></span></dt><dt><span class="section"><a href="#view-jasper-reports-configuration-multiformat-view">14.7.2.4. Using <code class="classname">JasperReportsMultiFormatView</code></a></span></dt></dl></dd><dt><span class="section"><a href="#view-jasper-reports-model">14.7.3. Populating the <code class="classname">ModelAndView</code></a></span></dt><dt><span class="section"><a href="#view-jasper-reports-subreports">14.7.4. Working with Sub-Reports</a></span></dt><dd><dl><dt><span class="section"><a href="#view-jasper-reports-subreports-config-reports">14.7.4.1. Configuring Sub-Report Files</a></span></dt><dt><span class="section"><a href="#view-jasper-reports-subreports-config-datasources">14.7.4.2. Configuring Sub-Report Data Sources</a></span></dt></dl></dd><dt><span class="section"><a href="#view-jasper-reports-exporter-parameters">14.7.5. Configuring Exporter Parameters</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#webintegration">15. Integrating with other web frameworks</a></span></dt><dd><dl><dt><span class="section"><a href="#intro">15.1. Introduction</a></span></dt><dt><span class="section"><a href="#webintegration-common">15.2. Common configuration</a></span></dt><dt><span class="section"><a href="#jsf">15.3. JavaServer Faces</a></span></dt><dd><dl><dt><span class="section"><a href="#jsf-delegatingvariableresolver">15.3.1. DelegatingVariableResolver</a></span></dt><dt><span class="section"><a href="#jsf-facescontextutils">15.3.2. FacesContextUtils</a></span></dt></dl></dd><dt><span class="section"><a href="#struts">15.4. Struts</a></span></dt><dd><dl><dt><span class="section"><a href="#struts-contextloaderplugin">15.4.1. ContextLoaderPlugin</a></span></dt><dd><dl><dt><span class="section"><a href="#struts-delegatingrequestprocessor">15.4.1.1. DelegatingRequestProcessor</a></span></dt><dt><span class="section"><a href="#struts-delegatingactionproxy">15.4.1.2. DelegatingActionProxy</a></span></dt></dl></dd><dt><span class="section"><a href="#struts-actionsupport">15.4.2. ActionSupport Classes</a></span></dt></dl></dd><dt><span class="section"><a href="#view-tapestry">15.5. Tapestry</a></span></dt><dd><dl><dt><span class="section"><a href="#view-tapestry-di">15.5.1. Injecting Spring-managed beans</a></span></dt><dd><dl><dt><span class="section"><a href="#view-tapestry-pre40-style-di">15.5.1.1. Dependency Injecting Spring Beans into Tapestry pages</a></span></dt><dt><span class="section"><a href="#view-tapestry-componentdefs">15.5.1.2. Component definition files</a></span></dt><dt><span class="section"><a href="#view-tapestry-getters">15.5.1.3. Adding abstract accessors</a></span></dt><dt><span class="section"><a href="#view-tapestry-40-style-di">15.5.1.4. Dependency Injecting Spring Beans into Tapestry pages - Tapestry 4.0+ style</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#webwork">15.6. WebWork</a></span></dt><dt><span class="section"><a href="#webintegration-resources">15.7. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#portlet">16. Portlet MVC Framework</a></span></dt><dd><dl><dt><span class="section"><a href="#portlet-introduction">16.1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#portlet-introduction-controller">16.1.1. Controllers - The C in MVC</a></span></dt><dt><span class="section"><a href="#portlet-introduction-view">16.1.2. Views - The V in MVC</a></span></dt><dt><span class="section"><a href="#portlet-introduction-scope">16.1.3. Web-scoped beans</a></span></dt></dl></dd><dt><span class="section"><a href="#portlet-dispatcher">16.2. The <code class="classname">DispatcherPortlet</code></a></span></dt><dt><span class="section"><a href="#portlet-viewservlet">16.3. The <code class="classname">ViewRendererServlet</code></a></span></dt><dt><span class="section"><a href="#portlet-controller">16.4. Controllers</a></span></dt><dd><dl><dt><span class="section"><a href="#portlet-controller-abstractcontroller">16.4.1. <code class="classname">AbstractController</code> and <code class="classname">PortletContentGenerator</code></a></span></dt><dt><span class="section"><a href="#portlet-controller-simple">16.4.2. Other simple controllers</a></span></dt><dt><span class="section"><a href="#portlet-controller-command">16.4.3. Command Controllers</a></span></dt><dt><span class="section"><a href="#portlet-controller-wrapping">16.4.4. <code class="classname">PortletWrappingController</code></a></span></dt></dl></dd><dt><span class="section"><a href="#portlet-handlermapping">16.5. Handler mappings</a></span></dt><dd><dl><dt><span class="section"><a href="#portlet-handlermapping-portletmode">16.5.1. <code class="classname">PortletModeHandlerMapping</code></a></span></dt><dt><span class="section"><a href="#portlet-handlermapping-parameter">16.5.2. <code class="classname">ParameterHandlerMapping</code></a></span></dt><dt><span class="section"><a href="#portlet-handlermapping-portletmodeparameter">16.5.3. <code class="classname">PortletModeParameterHandlerMapping</code></a></span></dt><dt><span class="section"><a href="#portlet-handlermapping-interceptor">16.5.4. Adding <code class="interfacename">HandlerInterceptor</code>s</a></span></dt><dt><span class="section"><a href="#portlet-handlermapping-interceptoradapter">16.5.5. <code class="classname">HandlerInterceptorAdapter</code></a></span></dt><dt><span class="section"><a href="#portlet-handlermapping-parameterinterceptor">16.5.6. <code class="classname">ParameterMappingInterceptor</code></a></span></dt></dl></dd><dt><span class="section"><a href="#portlet-viewresolver">16.6. Views and resolving them</a></span></dt><dt><span class="section"><a href="#portlet-multipart">16.7. Multipart (file upload) support</a></span></dt><dd><dl><dt><span class="section"><a href="#portlet-multipart-resolver">16.7.1. Using the <code class="interfacename">PortletMultipartResolver</code></a></span></dt><dt><span class="section"><a href="#portlet-multipart-forms">16.7.2. Handling a file upload in a form</a></span></dt></dl></dd><dt><span class="section"><a href="#portlet-exceptionresolver">16.8. Handling exceptions</a></span></dt><dt><span class="section"><a href="#portlet-deployment">16.9. Portlet application deployment</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#spring-integration">IV. Integration</a></span></dt><dd><dl><dt><span class="chapter"><a href="#remoting">17. Remoting and web services using Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#remoting-introduction">17.1. Introduction</a></span></dt><dt><span class="section"><a href="#remoting-rmi">17.2. Exposing services using RMI</a></span></dt><dd><dl><dt><span class="section"><a href="#remoting-rmi-server">17.2.1. Exporting the service using the <code class="classname">RmiServiceExporter</code></a></span></dt><dt><span class="section"><a href="#remoting-rmi-client">17.2.2. Linking in the service at the client</a></span></dt></dl></dd><dt><span class="section"><a href="#remoting-caucho-protocols">17.3. Using Hessian or Burlap to remotely call services via HTTP</a></span></dt><dd><dl><dt><span class="section"><a href="#remoting-caucho-protocols-hessian">17.3.1. Wiring up the <code class="classname">DispatcherServlet</code> for Hessian</a></span></dt><dt><span class="section"><a href="#remoting-caucho-protocols-hessian-server">17.3.2. Exposing your beans by using the <code class="classname">HessianServiceExporter</code></a></span></dt><dt><span class="section"><a href="#remoting-caucho-protocols-hessian-client">17.3.3. Linking in the service on the client</a></span></dt><dt><span class="section"><a href="#remoting-caucho-protocols-burlap">17.3.4. Using Burlap</a></span></dt><dt><span class="section"><a href="#remoting-caucho-protocols-securoty">17.3.5. Applying HTTP basic authentication to a service exposed through Hessian or Burlap</a></span></dt></dl></dd><dt><span class="section"><a href="#remoting-httpinvoker">17.4. Exposing services using HTTP invokers</a></span></dt><dd><dl><dt><span class="section"><a href="#remoting-httpinvoker-server">17.4.1. Exposing the service object</a></span></dt><dt><span class="section"><a href="#remoting-httpinvoker-client">17.4.2. Linking in the service at the client</a></span></dt></dl></dd><dt><span class="section"><a href="#remoting-web-services">17.5. Web services</a></span></dt><dd><dl><dt><span class="section"><a href="#remoting-web-services-jaxrpc">17.5.1. Exposing services using JAX-RPC</a></span></dt><dt><span class="section"><a href="#remoting-web-services-jaxrpc-access">17.5.2. Accessing web services</a></span></dt><dt><span class="section"><a href="#remoting-web-services-jaxrpc-mapping-registration">17.5.3. Register Bean Mappings</a></span></dt><dt><span class="section"><a href="#remoting-web-services-jaxrpc-handler-registration">17.5.4. Registering our own Handler</a></span></dt><dt><span class="section"><a href="#remoting-web-services-xfire">17.5.5. Exposing web services using XFire</a></span></dt></dl></dd><dt><span class="section"><a href="#remoting-jms">17.6. JMS</a></span></dt><dd><dl><dt><span class="section"><a href="#remoting-jms-server">17.6.1. Server-side configuration</a></span></dt><dt><span class="section"><a href="#remoting-jms-client">17.6.2. Client-side configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#remoting-autodection-remote-interfaces">17.7. Auto-detection is not implemented for remote interfaces</a></span></dt><dt><span class="section"><a href="#remoting-considerations">17.8. Considerations when choosing a technology</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ejb">18. Enterprise Java Bean (EJB) integration</a></span></dt><dd><dl><dt><span class="section"><a href="#ejb-introduction">18.1. Introduction</a></span></dt><dt><span class="section"><a href="#ejb-access">18.2. Accessing EJBs</a></span></dt><dd><dl><dt><span class="section"><a href="#ejb-access-concepts">18.2.1. Concepts</a></span></dt><dt><span class="section"><a href="#ejb-access-local">18.2.2. Accessing local SLSBs</a></span></dt><dt><span class="section"><a href="#ejb-access-remote">18.2.3. Accessing remote SLSBs</a></span></dt></dl></dd><dt><span class="section"><a href="#ejb-implementation">18.3. Using Spring's convenience EJB implementation classes</a></span></dt></dl></dd><dt><span class="chapter"><a href="#jms">19. JMS</a></span></dt><dd><dl><dt><span class="section"><a href="#jms-introduction">19.1. Introduction</a></span></dt><dt><span class="section"><a href="#jms-using">19.2. Using Spring JMS</a></span></dt><dd><dl><dt><span class="section"><a href="#jms-jmstemplate">19.2.1. <code class="classname">JmsTemplate</code></a></span></dt><dt><span class="section"><a href="#jms-connections">19.2.2. Connections</a></span></dt><dt><span class="section"><a href="#jms-destinations">19.2.3. Destination Management</a></span></dt><dt><span class="section"><a href="#jms-mdp">19.2.4. Message Listener Containers</a></span></dt><dd><dl><dt><span class="section"><a href="#jms-mdp-simple">19.2.4.1. <code class="classname">SimpleMessageListenerContainer</code></a></span></dt><dt><span class="section"><a href="#jms-mdp-default">19.2.4.2. <code class="classname">DefaultMessageListenerContainer</code></a></span></dt><dt><span class="section"><a href="#jms-mdp-server-session">19.2.4.3. <code class="classname">ServerSessionMessageListenerContainer</code></a></span></dt></dl></dd><dt><span class="section"><a href="#jms-tx">19.2.5. Transaction management</a></span></dt></dl></dd><dt><span class="section"><a href="#jms-sending">19.3. Sending a <code class="interfacename">Message</code></a></span></dt><dd><dl><dt><span class="section"><a href="#jms-msg-conversion">19.3.1. Using Message Converters</a></span></dt><dt><span class="section"><a href="#jms-callbacks">19.3.2. <code class="interfacename">SessionCallback</code> and <code class="interfacename">ProducerCallback</code></a></span></dt></dl></dd><dt><span class="section"><a href="#jms-receiving">19.4. Receiving a message</a></span></dt><dd><dl><dt><span class="section"><a href="#jms-receiving-sync">19.4.1. Synchronous Reception</a></span></dt><dt><span class="section"><a href="#jms-asynchronousMessageReception">19.4.2. Asynchronous Reception - Message-Driven POJOs</a></span></dt><dt><span class="section"><a href="#jms-receiving-async-session-aware-message-listener">19.4.3. The <code class="interfacename">SessionAwareMessageListener</code> interface</a></span></dt><dt><span class="section"><a href="#jms-receiving-async-message-listener-adapter">19.4.4. The <code class="classname">MessageListenerAdapter</code></a></span></dt><dt><span class="section"><a href="#jms-tx-participation">19.4.5. Processing messages within transactions</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#jmx">20. JMX</a></span></dt><dd><dl><dt><span class="section"><a href="#jmx-introduction">20.1. Introduction</a></span></dt><dt><span class="section"><a href="#jmx-exporting">20.2. Exporting your beans to JMX</a></span></dt><dd><dl><dt><span class="section"><a href="#jmx-exporting-mbeanserver">20.2.1. Creating an <code class="interfacename">MBeanServer</code></a></span></dt><dt><span class="section"><a href="#jmx-mbean-server">20.2.2. Reusing an existing <code class="interfacename">MBeanServer</code></a></span></dt><dt><span class="section"><a href="#jmx-exporting-lazy">20.2.3. Lazy-initialized MBeans</a></span></dt><dt><span class="section"><a href="#jmx-exporting-auto">20.2.4. Automatic registration of MBeans</a></span></dt><dt><span class="section"><a href="#jmx-exporting-registration-behavior">20.2.5. Controlling the registration behavior</a></span></dt></dl></dd><dt><span class="section"><a href="#jmx-interface">20.3. Controlling the management interface of your beans</a></span></dt><dd><dl><dt><span class="section"><a href="#jmx-interface-assembler">20.3.1. The <code class="interfacename">MBeanInfoAssembler</code>
      Interface</a></span></dt><dt><span class="section"><a href="#jmx-interface-metadata">20.3.2. Using source-Level metadata</a></span></dt><dt><span class="section"><a href="#jmx-interface-annotations">20.3.3. Using JDK 5.0 Annotations</a></span></dt><dt><span class="section"><a href="#jmx-interface-metadata-types">20.3.4. Source-Level Metadata Types</a></span></dt><dt><span class="section"><a href="#jmx-interface-autodetect">20.3.5. The <code class="classname">AutodetectCapableMBeanInfoAssembler</code>
      interface</a></span></dt><dt><span class="section"><a href="#jmx-interface-java">20.3.6. Defining Management interfaces using Java interfaces</a></span></dt><dt><span class="section"><a href="#jmx-interface-methodnames">20.3.7. Using
      <code class="classname">MethodNameBasedMBeanInfoAssembler</code></a></span></dt></dl></dd><dt><span class="section"><a href="#jmx-naming">20.4. Controlling the <code class="classname">ObjectName</code>s for your beans</a></span></dt><dd><dl><dt><span class="section"><a href="#jmx-naming-properties">20.4.1. Reading <code class="classname">ObjectName</code>s from <code class="classname">Properties</code></a></span></dt><dt><span class="section"><a href="#jmx-naming-metadata">20.4.2. Using the <code class="classname">MetadataNamingStrategy</code></a></span></dt></dl></dd><dt><span class="section"><a href="#jmx-jsr160">20.5. JSR-160 Connectors</a></span></dt><dd><dl><dt><span class="section"><a href="#jmx-jsr160-server">20.5.1. Server-side Connectors</a></span></dt><dt><span class="section"><a href="#jmx-jsr160-client">20.5.2. Client-side Connectors</a></span></dt><dt><span class="section"><a href="#jmx-jsr160-protocols">20.5.3. JMX over Burlap/Hessian/SOAP</a></span></dt></dl></dd><dt><span class="section"><a href="#jmx-proxy">20.6. Accessing MBeans via Proxies</a></span></dt><dt><span class="section"><a href="#jmx-notifications">20.7. Notifications</a></span></dt><dd><dl><dt><span class="section"><a href="#jmx-notifications-listeners">20.7.1. Registering Listeners for Notifications</a></span></dt><dt><span class="section"><a href="#jmx-notifications-publishing">20.7.2. Publishing Notifications</a></span></dt></dl></dd><dt><span class="section"><a href="#jmx-resources">20.8. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#cci">21. JCA CCI</a></span></dt><dd><dl><dt><span class="section"><a href="#cci-introduction">21.1. Introduction</a></span></dt><dt><span class="section"><a href="#cci-config">21.2. Configuring CCI</a></span></dt><dd><dl><dt><span class="section"><a href="#cci-config-connector">21.2.1. Connector configuration</a></span></dt><dt><span class="section"><a href="#cci-config-connectionfactory">21.2.2. <code class="interfacename">ConnectionFactory</code> configuration in Spring</a></span></dt><dt><span class="section"><a href="#cci-config-cci-connections">21.2.3. Configuring CCI connections</a></span></dt><dt><span class="section"><a href="#cci-config-single-connection">21.2.4. Using a single CCI connection</a></span></dt></dl></dd><dt><span class="section"><a href="#cci-using">21.3. Using Spring's CCI access support</a></span></dt><dd><dl><dt><span class="section"><a href="#cci-record-creator">21.3.1. Record conversion</a></span></dt><dt><span class="section"><a href="#cci-using-template">21.3.2. The <code class="classname">CciTemplate</code></a></span></dt><dt><span class="section"><a href="#cci-using-dao">21.3.3. DAO support</a></span></dt><dt><span class="section"><a href="#automatic-output-generation">21.3.4. Automatic output record generation</a></span></dt><dt><span class="section"><a href="#template-summary">21.3.5. Summary</a></span></dt><dt><span class="section"><a href="#cci-straight">21.3.6. Using a CCI <code class="interfacename">Connection</code> and <code class="interfacename">Interaction</code> directly</a></span></dt><dt><span class="section"><a href="#cci-template-example">21.3.7. Example for <code class="classname">CciTemplate</code> usage</a></span></dt></dl></dd><dt><span class="section"><a href="#cci-object">21.4. Modeling CCI access as operation objects</a></span></dt><dd><dl><dt><span class="section"><a href="#cci-object-mapping-record">21.4.1. <code class="classname">MappingRecordOperation</code></a></span></dt><dt><span class="section"><a href="#cci-object-mapping-comm-area">21.4.2. <code class="classname">MappingCommAreaOperation</code></a></span></dt><dt><span class="section"><a href="#cci-automatic-record-gen">21.4.3. Automatic output record generation</a></span></dt><dt><span class="section"><a href="#cci-object-summary">21.4.4. Summary</a></span></dt><dt><span class="section"><a href="#cci-objects-mappring-record-example">21.4.5. Example for <code class="classname">MappingRecordOperation</code> usage</a></span></dt><dt><span class="section"><a href="#cci-objects-mapping-comm-area-example">21.4.6. Example for <code class="classname">MappingCommAreaOperation</code> usage</a></span></dt></dl></dd><dt><span class="section"><a href="#cci-tx">21.5. Transactions</a></span></dt></dl></dd><dt><span class="chapter"><a href="#mail">22. Email</a></span></dt><dd><dl><dt><span class="section"><a href="#mail-introduction">22.1. Introduction</a></span></dt><dt><span class="section"><a href="#mail-usage">22.2. Usage</a></span></dt><dd><dl><dt><span class="section"><a href="#mail-usage-simple">22.2.1. Basic <code class="interfacename">MailSender</code> and <code class="classname">SimpleMailMessage</code> usage</a></span></dt><dt><span class="section"><a href="#mail-usage-mime">22.2.2. Using the <code class="interfacename">JavaMailSender</code> and the <code class="classname">MimeMessagePreparator</code></a></span></dt></dl></dd><dt><span class="section"><a href="#mail-javamail-mime">22.3. Using the JavaMail <code class="classname">MimeMessageHelper</code></a></span></dt><dd><dl><dt><span class="section"><a href="#mail-javamail-mime-attachments">22.3.1. Sending attachments and inline resources</a></span></dt><dd><dl><dt><span class="section"><a href="#mail-javamail-mime-attachments-attachment">22.3.1.1. Attachments</a></span></dt><dt><span class="section"><a href="#mail-javamail-mime-attachments-inline">22.3.1.2. Inline resources</a></span></dt></dl></dd><dt><span class="section"><a href="#mail-templates">22.3.2. Creating email content using a templating library</a></span></dt><dd><dl><dt><span class="section"><a href="#mail-templates-example">22.3.2.1. A Velocity-based example</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#scheduling">23. Scheduling and Thread Pooling</a></span></dt><dd><dl><dt><span class="section"><a href="#scheduling-introduction">23.1. Introduction</a></span></dt><dt><span class="section"><a href="#scheduling-quartz">23.2. Using the OpenSymphony Quartz Scheduler</a></span></dt><dd><dl><dt><span class="section"><a href="#scheduling-quartz-jobdetail">23.2.1. Using the JobDetailBean</a></span></dt><dt><span class="section"><a href="#scheduling-quartz-method-invoking-job">23.2.2. Using the <code class="classname">MethodInvokingJobDetailFactoryBean</code></a></span></dt><dt><span class="section"><a href="#scheduling-quartz-cron">23.2.3. Wiring up jobs using triggers and the <code class="classname">SchedulerFactoryBean</code></a></span></dt></dl></dd><dt><span class="section"><a href="#scheduling-jdk-timer">23.3. Using JDK Timer support</a></span></dt><dd><dl><dt><span class="section"><a href="#scheduling-jdk-timer-creating">23.3.1. Creating custom timers</a></span></dt><dt><span class="section"><a href="#scheduling-jdk-timer-method-invoking-task">23.3.2. Using the <code class="classname">MethodInvokingTimerTaskFactoryBean</code></a></span></dt><dt><span class="section"><a href="#scheduling-jdk-timer-factory-bean">23.3.3. Wrapping up: setting up the tasks using the <code class="classname">TimerFactoryBean</code></a></span></dt></dl></dd><dt><span class="section"><a href="#scheduling-task-executor">23.4. The Spring <code class="interfacename">TaskExecutor</code> abstraction</a></span></dt><dd><dl><dt><span class="section"><a href="#scheduling-task-executor-types">23.4.1. <code class="interfacename">TaskExecutor</code> types</a></span></dt><dt><span class="section"><a href="#scheduling-task-executor-usage">23.4.2. Using a <code class="interfacename">TaskExecutor</code></a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#dynamic-language">24. Dynamic language support</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic-language-introduction">24.1. Introduction</a></span></dt><dt><span class="section"><a href="#dynamic-language-a-first-example">24.2. A first example</a></span></dt><dt><span class="section"><a href="#dynamic-language-beans">24.3. Defining beans that are backed by dynamic languages</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic-language-beans-concepts">24.3.1. Common concepts</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic-language-beans-concepts-xml-language-element">24.3.1.1. The <code class="literal">&lt;lang:language/&gt;</code> element</a></span></dt><dt><span class="section"><a href="#dynamic-language-refreshable-beans">24.3.1.2. Refreshable beans</a></span></dt><dt><span class="section"><a href="#dynamic-language-beans-inline">24.3.1.3. Inline dynamic language source files</a></span></dt><dt><span class="section"><a href="#dynamic-language-beans-ctor-injection">24.3.1.4. Understanding Constructor Injection in the context of dynamic-language-backed beans</a></span></dt></dl></dd><dt><span class="section"><a href="#dynamic-language-beans-jruby">24.3.2. JRuby beans</a></span></dt><dt><span class="section"><a href="#dynamic-language-beans-groovy">24.3.3. Groovy beans</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic-language-beans-groovy-customizer">24.3.3.1. Customising Groovy objects via a callback</a></span></dt></dl></dd><dt><span class="section"><a href="#dynamic-language-beans-bsh">24.3.4. BeanShell beans</a></span></dt></dl></dd><dt><span class="section"><a href="#dynamic-language-scenarios">24.4. Scenarios</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic-language-scenarios-controllers">24.4.1. Scripted Spring MVC Controllers</a></span></dt><dt><span class="section"><a href="#dynamic-language-scenarios-validators">24.4.2. Scripted Validators</a></span></dt></dl></dd><dt><span class="section"><a href="#dynamic-language-final-notes">24.5. Bits and bobs</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic-language-final-notes-aop">24.5.1. AOP - advising scripted beans</a></span></dt><dt><span class="section"><a href="#dynamic-language-final-notes-scopes">24.5.2. Scoping</a></span></dt></dl></dd><dt><span class="section"><a href="#dynamic-language-resources">24.6. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#metadata">25. Annotations and Source Level Metadata Support</a></span></dt><dd><dl><dt><span class="section"><a href="#metadata-introduction">25.1. Introduction</a></span></dt><dt><span class="section"><a href="#metadata-spring">25.2. Spring's metadata support</a></span></dt><dt><span class="section"><a href="#metadata-annotations">25.3. Annotations</a></span></dt><dd><dl><dt><span class="section"><a href="#metadata-annotations-required">25.3.1. @<code class="interfacename">Required</code></a></span></dt><dt><span class="section"><a href="#metadata-annotations-other">25.3.2. Other @Annotations in Spring</a></span></dt></dl></dd><dt><span class="section"><a href="#metadata-commons">25.4. Integration with Jakarta Commons Attributes</a></span></dt><dt><span class="section"><a href="#metadata-uses">25.5. Metadata and Spring AOP autoproxying</a></span></dt><dd><dl><dt><span class="section"><a href="#metadata-fundamentals">25.5.1. Fundamentals</a></span></dt><dt><span class="section"><a href="#metadata-tx">25.5.2. Declarative transaction management</a></span></dt><dt><span class="section"><a href="#metadata-pool">25.5.3. Pooling</a></span></dt><dt><span class="section"><a href="#metadata-arbitrary">25.5.4. Custom metadata</a></span></dt></dl></dd><dt><span class="section"><a href="#metadata-attributes-mvc">25.6. Using attributes to minimize MVC web tier configuration</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#spring-samples">V. Sample applications</a></span></dt><dd><dl><dt><span class="chapter"><a href="#showcases">26. Showcase applications</a></span></dt><dd><dl><dt><span class="section"><a href="#showcases-introduction">26.1. Introduction</a></span></dt><dt><span class="section"><a href="#showcases-dynamvc">26.2. Spring MVC Controllers implemented in a dynamic language</a></span></dt><dd><dl><dt><span class="section"><a href="#showcases-dynamvc-build">26.2.1. Build and deployment</a></span></dt></dl></dd><dt><span class="section"><a href="#showcases-java5-dao">26.3. Implementing DAOs using <code class="classname">SimpleJdbcTemplate</code> and <code class="interfacename">@Repository</code>
	</a></span></dt><dd><dl><dt><span class="section"><a href="#showcases-java5-dao-the-domain">26.3.1. The domain</a></span></dt><dt><span class="section"><a href="#showcases-java5-dao-the-daos">26.3.2. The data access objects</a></span></dt><dt><span class="section"><a href="#showcases-java5-dao-build">26.3.3. Build</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="appendix"><a href="#xsd-config">A. XML Schema-based configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#xsd-config-introduction">A.1. Introduction</a></span></dt><dt><span class="section"><a href="#xsd-config-body">A.2. XML Schema-based configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#xsd-config-body-referencing">A.2.1. Referencing the schemas</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-util">A.2.2. The <code class="literal">util</code> schema</a></span></dt><dd><dl><dt><span class="section"><a href="#xsd-config-body-schemas-util-constant">A.2.2.1. <code class="literal">&lt;util:constant/&gt;</code></a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-util-property-path">A.2.2.2. <code class="literal">&lt;util:property-path/&gt;</code></a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-util-properties">A.2.2.3. <code class="literal">&lt;util:properties/&gt;</code></a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-util-list">A.2.2.4. <code class="literal">&lt;util:list/&gt;</code></a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-util-map">A.2.2.5. <code class="literal">&lt;util:map/&gt;</code></a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-util-set">A.2.2.6. <code class="literal">&lt;util:set/&gt;</code></a></span></dt></dl></dd><dt><span class="section"><a href="#xsd-config-body-schemas-jee">A.2.3. The <code class="literal">jee</code> schema</a></span></dt><dd><dl><dt><span class="section"><a href="#xsd-config-body-schemas-jee-jndi-lookup">A.2.3.1. <code class="literal">&lt;jee:jndi-lookup/&gt;</code> (simple)</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-jee-jndi-lookup-environment-single">A.2.3.2. <code class="literal">&lt;jee:jndi-lookup/&gt;</code> (with single JNDI environment setting)</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-jee-jndi-lookup-evironment-multiple">A.2.3.3. <code class="literal">&lt;jee:jndi-lookup/&gt;</code> (with multiple JNDI environment settings)</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-jee-jndi-lookup-complex">A.2.3.4. <code class="literal">&lt;jee:jndi-lookup/&gt;</code> (complex)</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-jee-local-slsb">A.2.3.5. <code class="literal">&lt;jee:local-slsb/&gt;</code> (simple)</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-jee-local-slsb-complex">A.2.3.6. <code class="literal">&lt;jee:local-slsb/&gt;</code> (complex)</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-jee-remote-slsb">A.2.3.7. <code class="literal">&lt;jee:remote-slsb/&gt;</code></a></span></dt></dl></dd><dt><span class="section"><a href="#xsd-config-body-schemas-lang">A.2.4. The <code class="literal">lang</code> schema</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-tx">A.2.5. The <code class="literal">tx</code> (transaction) schema</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-aop">A.2.6. The <code class="literal">aop</code> schema</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-tool">A.2.7. The <code class="literal">tool</code> schema</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-beans">A.2.8. The <code class="literal">beans</code> schema</a></span></dt></dl></dd><dt><span class="section"><a href="#xsd-config-setup">A.3. Setting up your IDE</a></span></dt><dd><dl><dt><span class="section"><a href="#xsd-config-setup-eclipse">A.3.1. Setting up Eclipse</a></span></dt><dt><span class="section"><a href="#xsd-config-setup-idea">A.3.2. Setting up IntelliJ IDEA</a></span></dt><dt><span class="section"><a href="#xsd-config-integration">A.3.3. Integration issues</a></span></dt><dd><dl><dt><span class="section"><a href="#xsd-config-integration-resin">A.3.3.1. XML parsing errors in the Resin v.3 application server</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="appendix"><a href="#extensible-xml">B. Extensible XML authoring</a></span></dt><dd><dl><dt><span class="section"><a href="#extensible-xml-introduction">B.1. Introduction</a></span></dt><dt><span class="section"><a href="#extensible-xml-schema">B.2. Authoring the schema</a></span></dt><dt><span class="section"><a href="#extensible-xml-namespacehandler">B.3. Coding a <code class="interfacename">NamespaceHandler</code></a></span></dt><dt><span class="section"><a href="#extensible-xml-parser">B.4. Coding a <code class="interfacename">BeanDefinitionParser</code></a></span></dt><dt><span class="section"><a href="#extensible-xml-registration">B.5. Registering the handler and the schema</a></span></dt><dd><dl><dt><span class="section"><a href="#extensible-xml-registration-spring-handlers">B.5.1. <code class="filename">'META-INF/spring.handlers'</code></a></span></dt><dt><span class="section"><a href="#extensible-xml-registration-spring-schemas">B.5.2. <code class="filename">'META-INF/spring.schemas'</code></a></span></dt></dl></dd><dt><span class="section"><a href="#extensible-xml-using">B.6. Using a custom extension in your Spring XML configuration</a></span></dt><dt><span class="section"><a href="#extensible-xml-meat">B.7. Meatier examples</a></span></dt><dd><dl><dt><span class="section"><a href="#extensible-xml-custom-nested">B.7.1. Nesting custom tags within custom tags</a></span></dt><dt><span class="section"><a href="#extensible-xml-custom-just-attributes">B.7.2. Custom attributes on 'normal' elements</a></span></dt></dl></dd><dt><span class="section"><a href="#extensible-xml-resources">B.8. Further Resources</a></span></dt></dl></dd><dt><span class="appendix"><a href="#springbeansdtd">C. <code class="literal">spring-beans-2.0.dtd</code></a></span></dt><dt><span class="appendix"><a href="#spring.tld">D. spring.tld</a></span></dt><dd><dl><dt><span class="section"><a href="#spring.tld-intro">D.1. Introduction</a></span></dt><dt><span class="section"><a href="#spring.tld.bind">D.2. The <code class="literal">bind</code> tag</a></span></dt><dt><span class="section"><a href="#spring.tld.escapeBody">D.3. The <code class="literal">escapeBody</code> tag</a></span></dt><dt><span class="section"><a href="#spring.tld.hasBindErrors">D.4. The <code class="literal">hasBindErrors</code> tag</a></span></dt><dt><span class="section"><a href="#spring.tld.htmlEscape">D.5. The <code class="literal">htmlEscape</code> tag</a></span></dt><dt><span class="section"><a href="#spring.tld.message">D.6. The <code class="literal">message</code> tag</a></span></dt><dt><span class="section"><a href="#spring.tld.nestedPath">D.7. The <code class="literal">nestedPath</code> tag</a></span></dt><dt><span class="section"><a href="#spring.tld.theme">D.8. The <code class="literal">theme</code> tag</a></span></dt><dt><span class="section"><a href="#spring.tld.transform">D.9. The <code class="literal">transform</code> tag</a></span></dt></dl></dd><dt><span class="appendix"><a href="#spring-form.tld">E. spring-form.tld</a></span></dt><dd><dl><dt><span class="section"><a href="#spring-form.tld-intro">E.1. Introduction</a></span></dt><dt><span class="section"><a href="#spring-form.tld.checkbox">E.2. The <code class="literal">checkbox</code> tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.errors">E.3. The <code class="literal">errors</code> tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.form">E.4. The <code class="literal">form</code> tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.hidden">E.5. The <code class="literal">hidden</code> tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.input">E.6. The <code class="literal">input</code> tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.label">E.7. The <code class="literal">label</code> tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.option">E.8. The <code class="literal">option</code> tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.options">E.9. The <code class="literal">options</code> tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.password">E.10. The <code class="literal">password</code> tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.radiobutton">E.11. The <code class="literal">radiobutton</code> tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.select">E.12. The <code class="literal">select</code> tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.textarea">E.13. The <code class="literal">textarea</code> tag</a></span></dt></dl></dd></dl></div><div class="preface" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="preface"></a>Preface</h2></div></div></div><p>Developing software applications is hard enough even with good tools and 
    technologies. Implementing applications using platforms which promise 
    everything but turn out to be heavy-weight, hard to control and not very efficient
    during the development cycle makes it even harder. Spring provides a light-weight
    solution for building enterprise-ready applications, while still supporting the
	possibility of using declarative transaction management, remote access to
	your logic using RMI or web services, and various options for persisting your
	data to a database. Spring provides a full-featured
	<a href="#mvc-introduction" title="13.1.&nbsp;Introduction">MVC framework</a>, and transparent ways of
	integrating <a href="#aop-introduction" title="6.1.&nbsp;Introduction">AOP</a> into your software.</p><p>Spring could potentially be a one-stop-shop for all your enterprise
    applications; however, Spring is modular, allowing you to use just those parts
    of it that you need, without having to bring in the rest. You can use the IoC
    container, with Struts on top, but you could also choose to use just the
    <a href="#orm-hibernate" title="12.2.&nbsp;Hibernate">Hibernate integration code</a> or the
    <a href="#jdbc-introduction" title="11.1.&nbsp;Introduction">JDBC abstraction layer</a>. Spring has been
    (and continues to be) designed to be non-intrusive, meaning dependencies on the
    framework itself are generally none (or absolutely minimal, depending on the area
    of use).</p><p>This document provides a reference guide to Spring's features. Since this
	document is still to be considered very much work-in-progress, if you have any
	requests or comments, please post them on the user mailing list or on the support
	forums at <a href="http://forum.springframework.org/" target="_top">http://forum.springframework.org/</a>.</p><p>Before we go on, a few words of gratitude are due to Christian Bauer (of the
    <a href="http://www.hibernate.org/" target="_top">Hibernate</a> team), who prepared
    and adapted the DocBook-XSL software in order to be able to create Hibernate's
    reference guide, thus also allowing us to create this one. Also thanks to Russell
    Healy for doing an extensive and valuable review of some of the material.</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="introduction"></a>Chapter&nbsp;1.&nbsp;Introduction</h2></div></div></div><div class="sidebar"><a name="background-ioc"></a><p class="title"><b>Background</b></p><p>In early 2004, Martin Fowler asked the readers of his site: when talking
	    about Inversion of Control: &#8220;<span class="quote"><span class="emphasis"><em>the question is, what aspect of
	    control are [they] inverting?</em></span></span>&#8221;. Fowler then suggested renaming
	    the principle (or at least giving it a more self-explanatory name), and started
	    to use the term <em class="firstterm">Dependency Injection</em>. His article then
	    continued to explain the ideas underpinning the Inversion of Control
	    (<acronym class="acronym">IoC</acronym>) and Dependency Injection (<acronym class="acronym">DI</acronym>)
	    principle.</p><p>If you need a decent insight into IoC and DI, please do refer to said article :
        <a href="http://martinfowler.com/articles/injection.html" target="_top">http://martinfowler.com/articles/injection.html</a>.</p></div><p>Java applications (a loose term which runs the gamut from constrained applets to
	full-fledged n-tier server-side enterprise applications) typically are composed of a
	number of objects that collaborate with one another to form the application proper.
	The objects in an application can thus be said to have <span class="emphasis"><em>dependencies</em></span>
	between themselves.</p><p>The Java language and platform provides a wealth of functionality for
	architecting and building applications, ranging all the way from the very basic
	building blocks of primitive types and classes (and the means to define new classes),
	to rich full-featured application servers and web frameworks. One area that is decidedly
	conspicuous by its absence is any means of taking the basic building blocks and
	composing them into a coherent whole; this area has typically been left to the purvey
	of the architects and developers tasked with building an application (or applications).
	Now to be fair, there are a number of design patterns devoted to the business of
	composing the various classes and object instances that makeup an all-singing,
	all-dancing application. Design patterns such as <em class="firstterm">Factory</em>,
	<em class="firstterm">Abstract Factory</em>, <em class="firstterm">Builder</em>,
	<em class="firstterm">Decorator</em>, and <em class="firstterm">Service Locator</em>
	(to name but a few) have widespread recognition and acceptance within the software
	development industry (presumably that is why these patterns have been formalized as
	patterns in the first place). This is all very well, but these patterns are just that:
	best practices given a name, typically together with a description of what the pattern
	does, where the pattern is typically best applied, the problems that the application
	of the pattern addresses, and so forth. Notice that the last paragraph used the	phrase
	&#8220;<span class="quote">... a <span class="emphasis"><em>description</em></span> of what the pattern does...</span>&#8221;; pattern
	books and wikis are typically listings of such formalized best practice that you can
	certainly take away, mull over, and then <span class="emphasis"><em>implement yourself</em></span> in
	your application.</p><p>The IoC component of the Spring Framework addresses the enterprise concern of taking
	the classes, objects, and services that are to compose an application, by providing a
	formalized means of composing these various disparate components into a fully working
	application ready for use. The Spring Framework takes best practices that have been
	proven over the years in numerous applications and formalized as design patterns, and
	actually codifies these patterns as first class objects that you as an architect and
	developer can take away and integrate into your own application(s). This is a
	<em class="firstterm">Very Good Thing Indeed</em> as attested to by the numerous organizations
	and institutions that have used the Spring Framework to engineer robust,
	<span class="emphasis"><em>maintainable</em></span> applications.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="introduction-overview"></a>1.1.&nbsp;Overview</h2></div></div></div><p>The Spring Framework contains a lot of features, which are well-organized in
		seven modules shown in the diagram below. This chapter discusses each of the modules
		in turn.</p><p>
			</p><div class="mediaobject" align="center"><img src="images/spring-overview.png" align="middle"><div class="caption"><p>Overview of the Spring Framework</p></div></div><p>
		</p><p>The <a href="#beans-introduction" title="3.1.&nbsp;Introduction"><span class="emphasis"><em>Core</em></span></a> package
		is the most fundamental part of the framework and provides the IoC and Dependency
		Injection features. The basic concept here is the <code class="classname">BeanFactory</code>,
		which provides a sophisticated implementation of the	factory pattern which removes
		the need for programmatic singletons and allows you to decouple the configuration and
		specification of dependencies from your actual program logic.</p><p>The <a href="#context-introduction" title="3.8.&nbsp;The ApplicationContext"><span class="emphasis"><em>Context</em></span></a>
		package build on the solid base provided by the
		<a href="#beans-introduction" title="3.1.&nbsp;Introduction"><span class="emphasis"><em>Core</em></span></a> package:
		it provides a way to access objects in a framework-style manner in a fashion
		somewhat reminiscent of a JNDI-registry. The context package inherits its features from the
		beans package and adds support for internationalization (I18N) (using for example
		resource bundles), event-propagation, resource-loading, and the transparent creation
		of contexts by, for example, a servlet container.</p><p>The <a href="#dao-introduction" title="10.1.&nbsp;Introduction"><span class="emphasis"><em>DAO</em></span></a> package
		provides a JDBC-abstraction layer that removes the need to do tedious JDBC coding and
		parsing of database-vendor specific error codes. Also, the
		<a href="#jdbc-introduction" title="11.1.&nbsp;Introduction">JDBC</a> package provides a way to do programmatic
		as well as declarative transaction management, not only for classes implementing special
		interfaces, but for <span class="emphasis"><em>all your POJOs (plain old Java objects)</em></span>.</p><p>The <a href="#orm-introduction" title="12.1.&nbsp;Introduction"><span class="emphasis"><em>ORM</em></span></a> package provides
		integration layers for popular object-relational mapping APIs, including
		<a href="#orm-jpa" title="12.6.&nbsp;JPA">JPA</a>, <a href="#orm-jdo" title="12.3.&nbsp;JDO">JDO</a>,
		<a href="#orm-hibernate" title="12.2.&nbsp;Hibernate">Hibernate</a>,	and <a href="#orm-ibatis" title="12.5.&nbsp;iBATIS SQL Maps">iBatis</a>.
		Using the ORM package you can use all those O/R-mappers	in combination with all the
		other features Spring offers, such as the simple declarative transaction management
		feature mentioned previously.</p><p>Spring's <a href="#aop-introduction" title="6.1.&nbsp;Introduction"><span class="emphasis"><em>AOP</em></span></a>
		package provides an <span class="emphasis"><em>AOP Alliance</em></span>-compliant aspect-oriented
		programming implementation allowing you to define, for example,
		method-interceptors and pointcuts to cleanly decouple code implementing functionality
		that should logically speaking be separated. Using source-level metadata functionality
		you can also incorporate all kinds of behavioral information into your code,
		in a manner similar to that of .NET attributes.</p><p>Spring's <span class="emphasis"><em>Web</em></span> package provides basic web-oriented integration
		features, such as multipart file-upload functionality, the initialization of the IoC
		container using servlet listeners and a web-oriented application context. When using
		Spring together with WebWork or Struts, this is the package to integrate with.</p><p>Spring's <a href="#mvc-introduction" title="13.1.&nbsp;Introduction"><span class="emphasis"><em>MVC</em></span></a> package
		provides a Model-View-Controller (MVC)	implementation for web-applications. Spring's
		MVC framework is not just any old implementation; it provides a <span class="emphasis"><em>clean</em></span>
		separation between domain model code and web forms, and allows you to use all the other
		features of the Spring Framework.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="overview-usagescenarios"></a>1.2.&nbsp;Usage scenarios</h2></div></div></div><p>With the building blocks described above you can use Spring in all sorts of scenarios,
		from applets up to fully-fledged enterprise applications using Spring's transaction management
		functionality and web framework integration.</p><p>
			</p><div class="mediaobject" align="center"><img src="images/full.gif" align="middle"><div class="caption"><p>Typical full-fledged Spring web application</p></div></div><p>
		</p><p>By using Spring's
		<a href="#transaction-declarative" title="9.5.&nbsp;Declarative transaction management">declarative transaction management features</a>
		the web application is fully transactional, just as it would be when using container
		managed transactions as provided by Enterprise JavaBeans. All your custom business logic
		can be implemented using simple POJOs, managed by Spring's IoC container. Additional
		services include support for sending email, and	validation that is independent of the
		web layer enabling you to choose where to execute validation rules. Spring's ORM
		support is integrated with JPA, Hibernate, JDO and iBatis; for example, when using
		Hibernate, you can continue to use your existing mapping files and standard Hibernate
		<code class="interfacename">SessionFactory</code> configuration. Form controllers seamlessly
		integrate the web-layer with the domain model, removing the need for
		<code class="classname">ActionForms</code> or other classes that transform HTTP parameters to
		values for your domain model.</p><p>
			</p><div class="mediaobject" align="center"><img src="images/thirdparty-web.gif" align="middle"><div class="caption"><p>Spring middle-tier using a third-party web framework</p></div></div><p>
		</p><p>Sometimes the current circumstances do not allow you to completely switch
		to a different framework. The Spring Framework does <span class="emphasis"><em>not</em></span> force
		you to use everything within it; it is not an <span class="emphasis"><em>all-or-nothing</em></span>
		solution. Existing front-ends built using WebWork, Struts, Tapestry, or other UI
		frameworks can be integrated perfectly well with a Spring-based middle-tier,
		allowing you to use the transaction features that Spring offers. The only thing
		you need to do is wire up your business logic using an
		<code class="classname">ApplicationContext</code> and integrate your web layer using a
		<code class="classname">WebApplicationContext</code>.</p><p>
			</p><div class="mediaobject" align="center"><img src="images/remoting.gif" align="middle"><div class="caption"><p>Remoting usage scenario</p></div></div><p>
		</p><p>When you need to access existing code via web services, you can use Spring's
		<code class="literal">Hessian-</code>, <code class="literal">Burlap-</code>, <code class="literal">Rmi-</code>
		or <code class="classname">JaxRpcProxyFactory</code> classes. Enabling remote access to
		existing applications suddenly is not that hard anymore.</p><p>
			</p><div class="mediaobject" align="center"><img src="images/ejb.gif" align="middle"><div class="caption"><p>EJBs - Wrapping existing POJOs</p></div></div><p>
		</p><p>The Spring Framework also provides an
		<a href="#ejb" title="Chapter&nbsp;18.&nbsp;Enterprise Java Bean (EJB) integration">access- and abstraction- layer</a> for Enterprise
		JavaBeans, enabling you to reuse your existing POJOs and wrap them in
		Stateless Session Beans, for use in scalable, failsafe web applications
		that might need declarative security.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="new-in-2"></a>Chapter&nbsp;2.&nbsp;What's new in Spring 2.0?</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-2-intro"></a>2.1.&nbsp;Introduction</h2></div></div></div><p>If you have been using the Spring Framework for some time, you will
    be aware that Spring has just undergone a major revision.</p><div class="sidebar"><a name="new-in-2-intro-jdk"></a><p class="title"><b>JDK Support</b></p><p>The Spring Framework continues to be totally compatible with all
      versions of Java since (and including) Java 1.3. This means that 1.3,
      1.4, and 1.5 are supported, although some advanced functionality of the
      Spring Framework may not be available to you if you are (for example)
      committed to using Java 1.3.</p></div><p>This revision includes a host of new features, and a lot of the
    existing functionality has been reviewed and improved. In fact, so much of
    Spring is shiny and improved that the Spring development team decided that
    the next release of Spring merited an increment of the version number; and
    so Spring 2.0 was announced in December 2005 at the
    <a href="http://www.thespringexperience.com/" target="_top">Spring Experience</a>
    conference in Florida.</p><p>This chapter is a guide to the new and improved features of Spring 
    2.0. It is intended to provide a high-level summary so that seasoned Spring 
    architects and developers can become immediately familiar with the new Spring 2.0 
    functionality. For more in-depth information on the features, please refer to the
    corresponding sections hyperlinked from within this chapter.</p><p>Some of the new and improved functionality described below has
    been (or will be) backported into the Spring 1.2.x release line. Please do consult
    the changelogs for the 1.2.x releases to see if a feature has been backported.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-2-ioc"></a>2.2.&nbsp;The Inversion of Control (IoC) container</h2></div></div></div><p>One of the areas that contains a considerable number of 2.0 improvements
    is Spring's IoC container.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-ioc-configuration"></a>2.2.1.&nbsp;Easier XML configuration</h3></div></div></div><p>Spring XML configuration is now even easier, thanks to the advent
      of the new XML configuration syntax based on XML Schema. If you want to take
      advantage of the new tags that Spring provides (and the Spring team certainly
      suggest that you do because they make configuration less verbose and easier
      to read), then do read the section entitled <a href="#xsd-config" title="Appendix&nbsp;A.&nbsp;XML Schema-based configuration">Appendix&nbsp;A, <i>XML Schema-based configuration</i></a>.</p><p>On a related note, there is a new, updated DTD for Spring 2.0 that
      you may wish to reference if you cannot take advantage of the XML Schema-based
      configuration. The DOCTYPE declaration is included below for your convenience,
      but the interested reader should definitely read the
      <code class="filename">'spring-beans-2.0.dtd'</code> DTD included in the
      <code class="filename">'dist/resources'</code> directory of the Spring
      2.0 distribution.</p><pre class="programlisting">&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN"
		  "http://www.springframework.org/dtd/spring-beans-2.0.dtd"&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-ioc-scopes"></a>2.2.2.&nbsp;New bean scopes</h3></div></div></div><p>Previous versions of Spring had IoC container level support for
      exactly two distinct bean scopes (singleton and prototype). Spring 2.0
      improves on this by not only providing a number of additional scopes
      depending on the environment in which Spring is being deployed (for
      example, request and session scoped beans in a web environment), but
      also by providing integration points so that Spring users can create their own scopes.</p><p>It should be noted that although the underlying (and internal)
      implementation for singleton- and prototype-scoped beans has been
      changed, this change is totally transparent to the end user... no
      existing configuration needs to change, and no existing configuration
      will break.</p><p>Both the new and the original scopes are detailed in the section
      entitled <a href="#beans-factory-scopes" title="3.4.&nbsp;Bean scopes">Section&nbsp;3.4, &#8220;Bean scopes&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-ioc-custom-configuration"></a>2.2.3.&nbsp;Extensible XML authoring</h3></div></div></div><p>Not only is XML configuration easier to write, it is now also extensible.</p><p>What 'extensible' means in this context is that you, as an
      application developer, or (more likely) as a third party framework or
      product vendor, can write custom tags that other developers can then
      plug into their own Spring configuration files. This allows you to have
      your own domain specific language (the term is used loosely here) of
      sorts be reflected in the specific configuration of your own components.</p><p>Implementing custom Spring tags may not be of interest to every single 
      application developer or enterprise architect using Spring in their own projects.
      We expect third-party vendors to be highly interested in developing
      custom configuration tags for use in Spring configuration files.</p><p>The extensible configuration mechanism is documented in <a href="#extensible-xml" title="Appendix&nbsp;B.&nbsp;Extensible XML authoring">Appendix&nbsp;B, <i>Extensible XML authoring</i></a>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-2-aop"></a>2.3.&nbsp;Aspect Oriented Programming (AOP)</h2></div></div></div><p>Spring 2.0 has a much improved AOP offering. The Spring AOP framework
    itself is markedly easier to configure in XML, and significantly less verbose
    as a result; and Spring 2.0 integrates with the AspectJ pointcut language
    and @AspectJ aspect declaration style. The chapter entitled <a href="#aop" title="Chapter&nbsp;6.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;6, <i>Aspect Oriented Programming with Spring</i></a>
    is dedicated to describing this new support.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-aop-configuration"></a>2.3.1.&nbsp;Easier AOP XML configuration</h3></div></div></div><p>Spring 2.0 introduces new schema support for defining aspects backed by
      regular Java objects. This support takes advantage of the AspectJ pointcut
      language and offers fully typed advice (i.e. no more casting and
      <code class="literal">Object[]</code> argument manipulation). Details of this support
      can be found in the section entitled <a href="#aop-schema" title="6.3.&nbsp;Schema-based AOP support">Section&nbsp;6.3, &#8220;Schema-based AOP support&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-aop-aspectJ"></a>2.3.2.&nbsp;Support for @AspectJ aspects</h3></div></div></div><p>Spring 2.0 also supports aspects defined using the @AspectJ annotations.
      These aspects can be shared between AspectJ and Spring AOP, and require (honestly!)
      only some simple configuration. Said support for @AspectJ aspects is discussed in
      <a href="#aop-ataspectj" title="6.2.&nbsp;@AspectJ support">Section&nbsp;6.2, &#8220;@AspectJ support&#8221;</a>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-2-middle-tier"></a>2.4.&nbsp;The Middle Tier</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-middle-tier-transaction-configuration"></a>2.4.1.&nbsp;Easier configuration of declarative transactions in XML</h3></div></div></div><p>The way that transactions are configured in Spring 2.0 has been changed
      significantly. The previous 1.2.x style of configuration continues to be valid
      (and supported), but the new style is markedly less verbose and is the
      recommended style. Spring 2.0 also ships with an AspectJ aspects library that
      you can use to make pretty much any object transactional - even objects not
      created by the Spring IoC container.</p><p>The chapter entitled <a href="#transaction" title="Chapter&nbsp;9.&nbsp;Transaction management">Chapter&nbsp;9, <i>Transaction management</i></a> contains all of the details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-middle-tier-jpa"></a>2.4.2.&nbsp;JPA</h3></div></div></div><p>Spring 2.0 ships with a JPA abstraction layer that is similar in intent
      to Spring's JDBC abstraction layer in terms of scope and general 
      usage patterns.</p><p>If you are interested in using a JPA-implementation as the
      backbone of your persistence layer, the section entitled <a href="#orm-jpa" title="12.6.&nbsp;JPA">Section&nbsp;12.6, &#8220;JPA&#8221;</a> is dedicated to detailing Spring's support and
      value-add in this area.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-middle-tier-async-jms"></a>2.4.3.&nbsp;Asynchronous JMS</h3></div></div></div><p>Prior to Spring 2.0, Spring's JMS offering was limited to
      sending messages and the <span class="emphasis"><em>synchronous</em></span> receiving of
      messages. This functionality (encapsulated in the
      <code class="classname">JmsTemplate</code> class) is great, but it doesn't
      address the requirement for the <span class="emphasis"><em>asynchronous</em></span>
      receiving of messages.</p><p>Spring 2.0 now ships with full support for the reception of
      messages in an asynchronous fashion, as detailed in the section entitled
      <a href="#jms-asynchronousMessageReception" title="19.4.2.&nbsp;Asynchronous Reception - Message-Driven POJOs">Section&nbsp;19.4.2, &#8220;Asynchronous Reception - Message-Driven POJOs&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-middle-tier-jdbc"></a>2.4.4.&nbsp;JDBC</h3></div></div></div><p>There are some small (but nevertheless notable) new classes in the
      Spring Framework's JDBC support library. The first,
      <a href="#jdbc-NamedParameterJdbcTemplate" title="11.2.2.&nbsp;NamedParameterJdbcTemplate"><code class="classname">NamedParameterJdbcTemplate</code></a>,
      provides support for programming JDBC statements using named parameters (as
      opposed to programming JDBC statements using only classic placeholder
      (<code class="literal">'?'</code>) arguments.</p><p>Another of the new classes, the
      <a href="#jdbc-SimpleJdbcTemplate" title="11.2.3.&nbsp;SimpleJdbcTemplate"><code class="classname">SimpleJdbcTemplate</code></a>,
      is aimed at making using the <code class="classname">JdbcTemplate</code> even easier to use when
      you are developing against Java 5+.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-2-web"></a>2.5.&nbsp;The Web Tier</h2></div></div></div><p>The web tier support has been <span class="emphasis"><em>substantially</em></span>
    improved and expanded in Spring 2.0.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-web-form-tags"></a>2.5.1.&nbsp;A form tag library for Spring MVC</h3></div></div></div><p>A rich JSP tag library for Spring MVC was <span class="emphasis"><em>the</em></span>
      JIRA issue that garnered the most votes from Spring users (by a wide
      margin).</p><p>Spring 2.0 ships with a full featured JSP tag library that
      makes the job of authoring JSP pages much easier when using Spring MVC;
      the Spring team is confident it will satisfy all of those developers who
      voted for the issue on JIRA. The new tag library is itself covered in the
      section entitled <a href="#mvc-formtaglib" title="13.9.&nbsp;Using Spring's form tag library">Section&nbsp;13.9, &#8220;Using Spring's form tag library&#8221;</a>, and a quick reference
      to all of the new tags can be found in the appendix entitled
      <a href="#spring-form.tld" title="Appendix&nbsp;E.&nbsp;spring-form.tld">Appendix&nbsp;E, <i>spring-form.tld</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-web-convention"></a>2.5.2.&nbsp;Sensible defaulting in Spring MVC</h3></div></div></div><p>For a lot of projects, sticking to established conventions and
      having reasonable defaults is just what the projects need...
      this theme of convention-over-configuration now has explicit support in
      Spring MVC. What this means is that if you establish a set of naming
      conventions for your <code class="literal">Controllers</code> and views, you can
      <span class="emphasis"><em>substantially</em></span> cut down on the amount of XML configuration
      that is required to setup handler mappings, view resolvers,
      <code class="classname">ModelAndView</code> instances, etc. This is a great boon
      with regards to rapid prototyping, and can also lend a degree of (always
      good-to-have) consistency across a codebase.</p><p>Spring MVC's convention-over-configuration support is detailed in
      the section entitled <a href="#mvc-coc" title="13.11.&nbsp;Convention over configuration">Section&nbsp;13.11, &#8220;Convention over configuration&#8221;</a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-web-portlet"></a>2.5.3.&nbsp;Portlet framework</h3></div></div></div><p>Spring 2.0 ships with a Portlet framework that is conceptually similar 
      to the Spring MVC framework. Detailed coverage of the Spring Portlet framework
      can be found in the section entitled <a href="#portlet" title="Chapter&nbsp;16.&nbsp;Portlet MVC Framework">Chapter&nbsp;16, <i>Portlet MVC Framework</i></a>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-2-other"></a>2.6.&nbsp;Everything else</h2></div></div></div><p>This final section outlines all of the other new and improved Spring 2.0
    features and functionality.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-other-dynamic-language-support"></a>2.6.1.&nbsp;Dynamic language support</h3></div></div></div><p>Spring 2.0 now has support for beans written in languages other than
      Java, with the currently supported dynamic languages being JRuby, Groovy and
      BeanShell. This dynamic language support is comprehensively detailed in the
      section entitled <a href="#dynamic-language" title="Chapter&nbsp;24.&nbsp;Dynamic language support">Chapter&nbsp;24, <i>Dynamic language support</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-other-jmx"></a>2.6.2.&nbsp;JMX</h3></div></div></div><p>The Spring Framework now has support for <code class="literal">Notifications</code>;
      it is also possible to exercise declarative control over the registration
      behavior of MBeans with an <code class="literal">MBeanServer</code>.</p><div class="itemizedlist"><ul type="disc"><li><a href="#jmx-notifications" title="20.7.&nbsp;Notifications">Section&nbsp;20.7, &#8220;Notifications&#8221;</a></li><li><a href="#jmx-exporting-registration-behavior" title="20.2.5.&nbsp;Controlling the registration behavior">Section&nbsp;20.2.5, &#8220;Controlling the registration behavior&#8221;</a></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-other-taskexecutor"></a>2.6.3.&nbsp;Task scheduling</h3></div></div></div><p>Spring 2.0 offers an abstraction around the scheduling of tasks.
      For the interested developer, the section entitled <a href="#scheduling-task-executor" title="23.4.&nbsp;The Spring TaskExecutor abstraction">Section&nbsp;23.4, &#8220;The Spring <code class="interfacename">TaskExecutor</code> abstraction&#8221;</a>
      contains all of the details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-other-java5"></a>2.6.4.&nbsp;Java 5 (Tiger) support</h3></div></div></div><p>Find below pointers to documentation describing some of the new
	  Java 5 support in Spring 2.0.</p><div class="itemizedlist"><ul type="disc"><li><a href="#transaction-declarative-annotations" title="9.5.6.&nbsp;Using @Transactional">Section&nbsp;9.5.6, &#8220;Using <code class="interfacename">@Transactional</code>&#8221;</a></li><li><a href="#metadata-annotations-required" title="25.3.1.&nbsp;@Required">Section&nbsp;25.3.1, &#8220;@<code class="interfacename">Required</code>&#8221;</a></li><li><a href="#jdbc-SimpleJdbcTemplate" title="11.2.3.&nbsp;SimpleJdbcTemplate">Section&nbsp;11.2.3, &#8220;<code class="classname">SimpleJdbcTemplate</code>&#8221;</a></li><li><a href="#orm-jpa" title="12.6.&nbsp;JPA">Section&nbsp;12.6, &#8220;JPA&#8221;</a></li><li><a href="#aop-ataspectj" title="6.2.&nbsp;@AspectJ support">Section&nbsp;6.2, &#8220;@AspectJ support&#8221;</a></li><li><a href="#aop-atconfigurable" title="6.8.1.&nbsp;Using AspectJ to dependency inject domain objects with Spring">Section&nbsp;6.8.1, &#8220;Using AspectJ to dependency inject domain objects with Spring&#8221;</a></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-2-migrating"></a>2.7.&nbsp;Migrating to Spring 2.0</h2></div></div></div><p>This final section details issues that may arise during any migration from Spring 1.2.x
    to Spring 2.0. Feel free to take this next statement with a pinch of salt, but upgrading to Spring 2.0
    from a Spring 1.2 application <span class="emphasis"><em>should</em></span> simply be a matter of dropping the
    Spring 2.0 jar into the appropriate location in your application's directory structure.</p><p>The keyword from the last sentence was of course the &#8220;<span class="quote"><span class="emphasis"><em>should</em></span></span>&#8221;.
    Whether the upgrade is seamless or not depends on how much of the Spring APIs you are using in your
    code. Spring 2.0 removed pretty much all of the classes and methods previously marked as
    deprecated in the Spring 1.2.x codebase, so if you have been using such classes and methods, you
    will of course have to use alternative classes and methods (some of which are summarized below).</p><p>With regards to configuration, Spring 1.2.x style XML configuration is 100%,
    satisfaction-guaranteed compatible with the Spring 2.0 library. Of course if you are still using
    the Spring 1.2.x DTD, then you won't be able to take advantage of some of the new Spring 2.0
    functionality (such as <a href="#new-in-2-ioc-scopes" title="2.2.2.&nbsp;New bean scopes">scopes</a> and
    <a href="#new-in-2-aop-configuration" title="2.3.1.&nbsp;Easier AOP XML configuration">easier AOP</a> and
    <a href="#new-in-2-middle-tier-transaction-configuration" title="2.4.1.&nbsp;Easier configuration of declarative transactions in XML">transaction configuration</a>),
    but nothing will blow up.</p><p>The suggested migration strategy is to drop in the Spring 2.0 jar(s) to benefit from
    the improved code present in the release (bug fixes, optimizations, etc.). You can then, on an
    incremental basis, choose to start using the new Spring 2.0 features and configuration. For
    example, you could choose to start configuring just your aspects in the new Spring 2.0 style; it
    is perfectly valid to have 90% of your configuration using the old-school Spring 1.2.x configuration
    (which references the 1.2.x DTD), and have the other 10% using the new Spring 2.0 configuration
    (which references the 2.0 DTD or XSD). Bear in mind that you are not forced to upgrade your XML
    configuration should you choose to drop in the Spring 2.0 libraries.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-in-2-migrating-changes"></a>2.7.1.&nbsp;Changes</h3></div></div></div><p>For a comprehensive list of changes, consult the <code class="filename">'changelog.txt'</code>
        file that is located in the top level directory of the Spring Framework 2.0 distribution.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="new-in-2-migrating-packaging"></a>2.7.1.1.&nbsp;Jar packaging</h4></div></div></div><p>The packaging of the Spring Framework jars has changed quite substantially
		    between the 1.2.x and 2.0 releases. In particular, there are now dedicated jars for the
		    JDO, Hibernate 2/3, TopLink ORM integration classes: they are no longer bundled in the
		    core <code class="filename">'spring.jar'</code> file anymore.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="new-in-2-migrating-xml-configuration"></a>2.7.1.2.&nbsp;XML configuration</h4></div></div></div><p>Spring 2.0 ships with XSDs that describe Spring's XML metadata format in
		    a much richer fashion than the DTD that shipped with previous versions. The old DTD
		    is still fully supported, but if possible you are encouraged to reference the XSD
		    files at the top of your bean definition files.</p><p>One thing that has changed in a (somewhat) breaking fashion is the way that
		    bean scopes are defined. If you are using the Spring 1.2 DTD you can continue to use
		    the <code class="literal">'singleton'</code> attribute. You can however choose to
		    <a href="#new-in-2-ioc-configuration" title="2.2.1.&nbsp;Easier XML configuration">reference the new Spring 2.0 DTD</a>
		    which does not permit the use of the <code class="literal">'singleton'</code> attribute, but
		    rather uses the <code class="literal">'scope'</code> attribute to define the bean lifecycle scope.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="new-in-2-migrating-deprecated"></a>2.7.1.3.&nbsp;Deprecated classes and methods</h4></div></div></div><p>A number of classes and methods that previously were marked as
		    <code class="literal">@deprecated</code> have been removed from the Spring 2.0 codebase.
		    The Spring team decided that the 2.0 release marked a fresh start of sorts, and that any
		    deprecated 'cruft' was better excised now instead of continuing to haunt the codebase for
		    the foreseeable future.</p><p>As mentioned previously, for a comprehensive list of changes, consult the
            <code class="filename">'changelog.txt'</code> file that is located in the top level directory of
            the Spring Framework 2.0 distribution.</p><p>The following classes/interfaces have been removed from the Spring 2.0 codebase:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="interfacename">ResultReader</code> : Use the
                    <code class="interfacename">RowMapper</code> interface instead.</p></li><li><p><code class="classname">BeanFactoryBootstrap</code> : Consider using a
                    <code class="interfacename">BeanFactoryLocator</code> or a custom bootstrap class instead.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="new-in-2-migrating-ojb"></a>2.7.1.4.&nbsp;Apache OJB</h4></div></div></div><p>Please note that support for Apache OJB was <span class="emphasis"><em>totally removed</em></span>
		    from the main Spring source tree; the Apache OJB integration library is still available,
		    but can be found in it's new home in the
		    <a href="https://springmodules.dev.java.net/" target="_top">Spring Modules project</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="new-in-2-migrating-ibatis"></a>2.7.1.5.&nbsp;iBatis</h4></div></div></div><p>Please note that support for iBATIS SQL Maps 1.3 has been removed. If you
		    haven't done so already, upgrade to iBATIS SQL Maps 2.0/2.1.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="new-in-2-migrating-UrlFilenameViewController"></a>2.7.1.6.&nbsp;<code class="classname">UrlFilenameViewController</code></h4></div></div></div><p>The view name that is determined by the <code class="classname">UrlFilenameViewController</code>
			now takes into account the nested path of the request. This is a breaking change from
			the original contract of the <code class="classname">UrlFilenameViewController</code>, and means
			that if you are upgrading to Spring 2.0 from Spring 1.x and you are using this
			class you <span class="emphasis"><em>might</em></span> have to change your Spring Web MVC
			configuration slightly. Refer to the class level Javadocs of the <code class="classname">UrlFilenameViewController</code>
			to see examples of the new contract for view name determination.
			</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-2-other-applications"></a>2.8.&nbsp;Updated sample applications</h2></div></div></div><p>A number of the sample applications have also been updated to showcase the new and
    improved features of Spring 2.0, so do take the time to investigate them. The aforementioned
    sample applications can be found in the <code class="filename">'samples'</code>
    directory of the full Spring distribution
    (<code class="filename">'spring-with-dependencies.[zip|tar.gz]'</code>), and are documented
	(in part) in the chapter entitled <a href="#showcases" title="Chapter&nbsp;26.&nbsp;Showcase applications">Chapter&nbsp;26, <i>Showcase applications</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-2-other-documentation"></a>2.9.&nbsp;Improved documentation</h2></div></div></div><p>The Spring reference documentation has also substantially been updated to reflect
    all of the above features new in Spring 2.0. While every effort has been made to ensure
	that there are no errors in this documentation, some errors may nevertheless have crept
	in. If you do spot any typos or even more serious errors, and you can spare a few cycles
	during lunch, please do bring the error to the attention of the Spring team by
    <a href="http://opensource.atlassian.com/projects/spring/" target="_top">raising an issue</a>.</p><p>Special thanks to Arthur Loder for his tireless proofreading of the Spring Framework
    reference documentation and Javadocs.</p></div></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="spring-core"></a>Part&nbsp;I.&nbsp;Core Technologies</h1></div></div></div><div class="partintro" lang="en"><div></div><p>
				This initial part of the reference documentation covers
				all of those technologies that are absolutely integral
				to the Spring Framework.
			</p><p>
				Foremost amongst these is the Spring Framework's
				Inversion of Control (IoC) container. A thorough treatment
				of the Spring Framework's IoC container is closely followed
				by comprehensive coverage of Spring's Aspect-Oriented
				Programming (AOP) technologies. The Spring Framework has
				its own AOP	framework, which is conceptually easy to understand,
				and	which successfully addresses the 80% sweet spot of AOP
				requirements in Java enterprise programming.
			</p><p>
				Coverage of Spring's integration with AspectJ (currently
				the richest - in terms of features - and certainly most
				mature AOP implementation in the Java enterprise space)
				is also provided.
			</p><p>
			    Finally, the adoption of the test-driven-development (TDD)
			    approach to software development is certainly advocated by
			    the Spring team, and so coverage of Spring's support for
			    integration testing is covered (alongside best practices for
			    unit testing). The Spring team have found that the correct
			    use of IoC certainly does make both unit and integration
			    testing easier (in that the presence of setter methods and
			    appropriate constructors on classes makes them
			    easier to wire together on a test without having to set up
			    service locator registries and suchlike)... the chapter
			    dedicated solely to testing will hopefully convince you of
			    this as well.
			</p><div class="itemizedlist"><ul type="disc"><li><a href="#beans" title="Chapter&nbsp;3.&nbsp;The IoC container">Chapter&nbsp;3, <i>The IoC container</i></a></li><li><a href="#resources" title="Chapter&nbsp;4.&nbsp;Resources">Chapter&nbsp;4, <i>Resources</i></a></li><li><a href="#validation" title="Chapter&nbsp;5.&nbsp;Validation, Data-binding, the BeanWrapper, and PropertyEditors">Chapter&nbsp;5, <i>Validation, Data-binding, the <code class="interfacename">BeanWrapper</code>, and <code class="literal">PropertyEditors</code></i></a></li><li><a href="#aop" title="Chapter&nbsp;6.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;6, <i>Aspect Oriented Programming with Spring</i></a></li><li><a href="#aop-api" title="Chapter&nbsp;7.&nbsp;Spring AOP APIs">Chapter&nbsp;7, <i>Spring AOP APIs</i></a></li><li><a href="#testing" title="Chapter&nbsp;8.&nbsp;Testing">Chapter&nbsp;8, <i>Testing</i></a></li></ul></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="beans"></a>Chapter&nbsp;3.&nbsp;The IoC container</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-introduction"></a>3.1.&nbsp;Introduction</h2></div></div></div><p>This chapter covers the Spring Framework's implementation of the
		Inversion of Control (IoC)
		<sup>[<a name="d0e806" href="#ftn.d0e806">1</a>]</sup>
		principle.</p><div class="sidebar"><p class="title"><b><code class="interfacename">BeanFactory</code> or <code class="interfacename">ApplicationContext</code>?</b></p><p>Users are sometimes unsure whether a
			<code class="interfacename">BeanFactory</code> or an
			<code class="interfacename">ApplicationContext</code> is best suited for use
			in a particular situation. A <code class="interfacename">BeanFactory</code>
			pretty much just instantiates and configures beans. An
			<code class="interfacename">ApplicationContext</code> also does that,
			<span class="emphasis"><em>and</em></span> it provides the supporting infrastructure to
			enable <span class="emphasis"><em>lots</em></span> of enterprise-specific features such
			as transactions and AOP.</p><p><span class="emphasis"><em>In short, favor the use of an <code class="interfacename">ApplicationContext</code>.</em></span></p></div><p>The <code class="literal">org.springframework.beans</code> and
        <code class="literal">org.springframework.context</code> packages provide the basis
        for the Spring Framework's IoC container. The
        <code class="interfacename"><a href="http://www.springframework.org/docs/api/org/springframework/beans/factory/BeanFactory.html" target="_top">BeanFactory</a></code>
		interface provides an advanced configuration mechanism capable of managing
		objects of any nature. The
        <code class="literal"><a href="http://www.springframework.org/docs/api/org/springframework/context/ApplicationContext.html" target="_top">ApplicationContext</a></code>
        interface builds on top of the <code class="interfacename">BeanFactory</code>
        (it is a sub-interface) and adds other functionality such as easier integration
        with Spring's AOP features, message resource handling (for use in
        internationalization), event propagation, and application-layer specific contexts
        such as the <code class="interfacename">WebApplicationContext</code> for use in web
        applications.</p><p>In short, the <code class="interfacename">BeanFactory</code> provides the
		configuration framework and basic functionality, while the
		<code class="interfacename">ApplicationContext</code> adds more enterprise-centric
		functionality to it. The <code class="interfacename">ApplicationContext</code> is a
		complete superset of the <code class="interfacename">BeanFactory</code>, and any
		description of <code class="interfacename">BeanFactory</code> capabilities and
		behavior is to be considered to apply to the
		<code class="interfacename">ApplicationContext</code> as well.</p><p>This chapter is divided into two parts, with the
		<a href="#beans-factory" title="3.2.1.&nbsp;The container">first part</a> covering the basic principles
		that apply to both the <code class="interfacename">BeanFactory</code> and
		<code class="interfacename">ApplicationContext</code>, and with the
		<a href="#context-introduction" title="3.8.&nbsp;The ApplicationContext">second part</a>	covering those features
		that apply only to the <code class="interfacename">ApplicationContext</code> interface.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-basics"></a>3.2.&nbsp;Basics - containers and beans</h2></div></div></div><p>In Spring, those objects that form the backbone of your application and that
		are managed by the Spring IoC <em class="firstterm">container</em> are referred to as
		<em class="firstterm">beans</em>. A bean is simply an object that is instantiated,
		assembled and otherwise managed by a Spring IoC container; other than that, there is
		nothing special about a bean (it is in all other respects one of probably many objects
		in your application). These beans, and the <em class="firstterm">dependencies</em> between
		them, are reflected in the <em class="firstterm">configuration metadata</em> used by a
		container.</p><div class="sidebar"><p class="title"><b>Why... <span class="emphasis"><em>bean</em></span>?</b></p><p>The motivation for using the name <span class="emphasis"><em>'bean'</em></span>, as opposed
			to <span class="emphasis"><em>'component'</em></span> or <span class="emphasis"><em>'object'</em></span> is rooted
			in the origins of the Spring Framework itself (it arose partly as a response to
			the complexity of Enterprise Java<span class="emphasis"><em>Beans</em></span>).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory"></a>3.2.1.&nbsp;The container</h3></div></div></div><p>The <code class="interfacename">org.springframework.beans.factory.BeanFactory</code>
            is the actual representation of the Spring IoC <span class="emphasis"><em>container</em></span> that is
            responsible for containing and otherwise managing the aforementioned beans.</p><p>The <code class="interfacename">BeanFactory</code> interface is the central IoC container
            interface in Spring. Its responsibilities include instantiating or sourcing application
            objects, configuring such objects, and assembling the dependencies between these objects.</p><p>There are a number of implementations of the <code class="interfacename">BeanFactory</code>
			interface that come supplied straight out-of-the-box with Spring. The most commonly used
			<code class="interfacename">BeanFactory</code> implementation is the
			<code class="classname">XmlBeanFactory</code> class. This implementation allows you to express the
			objects that compose your application, and the doubtless rich interdependencies between such
			objects, in terms of XML. The <code class="classname">XmlBeanFactory</code> takes this
			XML <em class="firstterm">configuration metadata</em> and uses it to create a
			fully configured system or application.</p><p>
				</p><div class="mediaobject" align="center"><img src="images/container-magic.png" align="middle"><div class="caption"><p>The Spring IoC container</p></div></div><p>
			</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-metadata"></a>3.2.1.1.&nbsp;Configuration metadata</h4></div></div></div><p>
					As can be seen in the above image, the Spring IoC container consumes some form of
					<span class="emphasis"><em>configuration metadata</em></span>; this configuration metadata is nothing
					more than how you (as an application developer) inform the Spring container as to
					how to &#8220;<span class="quote"><span class="emphasis"><em>instantiate, configure, and assemble [the objects in your
					application]</em></span></span>&#8221;. This configuration metadata is typically supplied in a
					simple and intuitive XML format. When using XML-based configuration metadata, you
					write <span class="emphasis"><em>bean definitions</em></span> for those beans that you want the
					Spring IoC container to manage, and then let the container do it's stuff.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>XML-based metadata is by far the most commonly used form of configuration
					metadata. It is <span class="emphasis"><em>not</em></span> however the only form of
					configuration metadata that is allowed. The Spring IoC container itself
					is <span class="emphasis"><em>totally</em></span> decoupled from the format in which this
					configuration metadata is actually written.
					At the time of writing, you can supply this configuration metadata
					using either XML, the Java properties format, or programmatically (using
					Spring's public API). The XML-based configuration metadata format really is
					simple though, and so the remainder of this chapter will use the XML format
					to convey key concepts and features of the Spring IoC container.</p></td></tr></table></div></div><div class="sidebar"><p class="title"><b>Resources</b></p><p>
						Once you have learned the basics of the IoC container (this chapter),
						it will also be useful to learn about Spring's
						<code class="interfacename">Resource</code> abstraction, as described in
						<a href="#resources" title="Chapter&nbsp;4.&nbsp;Resources">Chapter&nbsp;4, <i>Resources</i></a>.
					</p><p>
						The location path or paths supplied to
						an <code class="interfacename">ApplicationContext</code> constructor are
						actually resource strings that allow the container to load
						configuration metadata from a variety of external resources such
						as the local file system, from the Java <code class="literal">CLASSPATH</code>, etc.
					</p></div><p>Please be advised that in the vast majority of application scenarios,
				explicit user code is not required to instantiate one or more instances
				of a Spring IoC container. For example, in a web application scenario, a simple
				eight (or so) lines of absolutely boilerplate J2EE web descriptor XML in the
				<code class="literal">web.xml</code> file of the application will typically suffice
				(see <a href="#context-create" title="3.8.4.&nbsp;Convenient ApplicationContext instantiation for web applications">Section&nbsp;3.8.4, &#8220;Convenient <code class="interfacename">ApplicationContext</code> instantiation for web applications&#8221;</a>).</p></div><p>Spring configuration consists of at least one bean definition that the
			container must manage, but typically there will be more than one bean definition.
			When using XML-based configuration metadata, these beans are configured as
			<code class="literal">&lt;bean/&gt;</code> elements inside a top-level <code class="literal">&lt;beans/&gt;</code>
			element.</p><p>These bean definitions correspond to the actual objects that make up your
			application. Typically you will have bean definitions for your service layer
			objects, your data access objects (DAOs), presentation objects such as Struts
			<code class="interfacename">Action</code> instances, infrastructure objects such as
			Hibernate <code class="interfacename">SessionFactory</code> instances, JMS
			<code class="interfacename">Queue</code> references, etc. (the possibilities are of
			course endless, and are limited only by the scope and complexity of your application).
			(Typically one does not configure fine-grained domain objects in the container.)</p><p>Find below an example of the basic structure of XML-based configuration metadata.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd"&gt;

  &lt;bean id="..." class="..."&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- collaborators and configuration for this bean go here --&gt;</span></em>
  &lt;/bean&gt;

  &lt;bean id="..." class="..."&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- collaborators and configuration for this bean go here --&gt;</span></em>
  &lt;/bean&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!-- more bean definitions go here... --&gt;</span></em>

&lt;/beans&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-instantiation"></a>3.2.2.&nbsp;Instantiating a container</h3></div></div></div><p>Instantiating a Spring IoC container is easy; find below some examples of how
				to do just that:</p><pre class="programlisting">Resource resource = new FileSystemResource("beans.xml");
BeanFactory factory = new XmlBeanFactory(resource);</pre><p>... or...</p><pre class="programlisting">ClassPathResource resource = new ClassPathResource("beans.xml");
BeanFactory factory = new XmlBeanFactory(resource);</pre><p>... or...</p><pre class="programlisting">ApplicationContext context = new ClassPathXmlApplicationContext(
        new String[] {"applicationContext.xml", "applicationContext-part2.xml"});

<em class="lineannotation"><span class="lineannotation">// of course, an <code class="interfacename">ApplicationContext</code> is just a <code class="interfacename">BeanFactory</code></span></em>
BeanFactory factory = context;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-xml-import"></a>3.2.2.1.&nbsp;Composing XML-based configuration metadata</h4></div></div></div><p>It can often be useful to split up container definitions into multiple
			        XML files. One way to then load an application context which is configured
			        from all these XML fragments is to use the application context constructor
			        which takes multiple <code class="interfacename">Resource</code> locations. With
			        a bean factory, a bean definition reader can be used multiple times to read
			        definitions from each file in turn.</p><p>Generally, the Spring team prefers the above approach, since it
			        keeps container configuration files unaware of the fact that they are
			        being combined with others. An alternate approach is to use one or more
			        occurrences of the <code class="literal">&lt;import/&gt;</code> element to load bean definitions
			        from another file (or files). Let's look at a sample:</p><pre class="programlisting">&lt;beans&gt;

    &lt;import resource="services.xml"/&gt;
    &lt;import resource="resources/messageSource.xml"/&gt;
    &lt;import resource="/resources/themeSource.xml"/&gt;

    &lt;bean id="bean1" class="..."/&gt;
    &lt;bean id="bean2" class="..."/&gt;

&lt;/beans&gt;</pre><p>In this example, external bean definitions are being loaded from 3
			    files, <code class="literal">services.xml</code>,
			    <code class="literal">messageSource.xml</code>, and
			    <code class="literal">themeSource.xml</code>. All location paths are considered
			    relative to the definition file doing the importing, so
			    <code class="literal">services.xml</code> in this case must be in the same directory
			    or classpath location as the file doing the importing, while
			    <code class="literal">messageSource.xml</code> and
			    <code class="literal">themeSource.xml</code> must be in a
			    <code class="literal">resources</code> location below the location of the importing
			    file. As you can see, a leading slash is actually ignored, but given that
			    these are considered relative paths, it is probably better form not to use
			    the slash at all.</p><p>The contents of the files being imported must be fully valid XML
			    bean definition files according to the Schema or DTD, including the
			    top level <code class="literal">&lt;beans/&gt;</code> element.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-definition"></a>3.2.3.&nbsp;The beans</h3></div></div></div><p>As mentioned previously, a Spring IoC container manages one or more
            <span class="emphasis"><em>beans</em></span>. These beans are created using the instructions
            defined in the configuration metadata that has been supplied to the container
            (typically in the form of XML <code class="literal">&lt;bean/&gt;</code> definitions).</p><p>Within the container itself, these bean definitions are represented as
            <code class="interfacename">BeanDefinition</code> objects, which contain (among other
            information) the following metadata:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>a package-qualified class name:</em></span> this is
					normally the actual implementation class of the bean being defined.
					However, if the bean is to be instantiated by invoking a
					<code class="literal">static</code> <span class="emphasis"><em>factory</em></span> method
					instead of using a normal constructor, this will actually be the
					class name of the factory class.</p></li><li><p>bean behavioral configuration elements, which state how the
					bean should behave in the container (prototype or singleton,
					autowiring mode, initialization and destruction callbacks, and so forth).</p></li><li><p>constructor arguments and property values to set in the
					newly created bean. An example would be the number of connections
					to use in a bean that manages a connection pool (either specified
					as a property or as a constructor argument), or the pool size
					limit.</p></li><li><p>other beans which are needed for the bean to do its work, that is
                    <span class="emphasis"><em>collaborators</em></span> (also called dependencies).</p></li></ul></div><p>The concepts listed above directly translate to a set of properties
			that each bean definition consists of. Some of these properties are listed
			below, along with a link to further documentation about each of them.</p><div class="table"><a name="beans-factory-bean-definition-tbl"></a><p class="title"><b>Table&nbsp;3.1.&nbsp;The bean definition</b></p><div class="table-contents"><table summary="The bean definition" border="1"><colgroup><col><col></colgroup><thead><tr><th>Feature</th><th>Explained in...</th></tr></thead><tbody><tr><td>class</td><td>
                                <p><a href="#beans-factory-class" title="3.2.3.2.&nbsp;Instantiating beans">Section&nbsp;3.2.3.2, &#8220;Instantiating beans&#8221;</a></p>
                            </td></tr><tr><td>name</td><td>
                                <p><a href="#beans-beanname" title="3.2.3.1.&nbsp;Naming beans">Section&nbsp;3.2.3.1, &#8220;Naming beans&#8221;</a></p>
                            </td></tr><tr><td>scope</td><td>
                                <p><a href="#beans-factory-scopes" title="3.4.&nbsp;Bean scopes">Section&nbsp;3.4, &#8220;Bean scopes&#8221;</a></p>
                            </td></tr><tr><td>constructor arguments</td><td>
                                <p><a href="#beans-factory-collaborators" title="3.3.1.&nbsp;Injecting dependencies">Section&nbsp;3.3.1, &#8220;Injecting dependencies&#8221;</a></p>
                            </td></tr><tr><td>properties</td><td>
                                <p><a href="#beans-factory-collaborators" title="3.3.1.&nbsp;Injecting dependencies">Section&nbsp;3.3.1, &#8220;Injecting dependencies&#8221;</a></p>
                            </td></tr><tr><td>autowiring mode</td><td>
                                <p><a href="#beans-factory-autowire" title="3.3.6.&nbsp;Autowiring collaborators">Section&nbsp;3.3.6, &#8220;Autowiring collaborators&#8221;</a></p>
                            </td></tr><tr><td>dependency checking mode</td><td>
                                <p><a href="#beans-factory-dependencies" title="3.3.7.&nbsp;Checking for dependencies">Section&nbsp;3.3.7, &#8220;Checking for dependencies&#8221;</a></p>
                            </td></tr><tr><td>lazy-initialization mode</td><td>
                                <p><a href="#beans-factory-lazy-init" title="3.3.5.&nbsp;Lazily-instantiated beans">Section&nbsp;3.3.5, &#8220;Lazily-instantiated beans&#8221;</a></p>
                            </td></tr><tr><td>initialization method</td><td>
                                <p><a href="#beans-factory-lifecycle" title="3.5.1.&nbsp;Lifecycle interfaces">Section&nbsp;3.5.1, &#8220;Lifecycle interfaces&#8221;</a></p>
                            </td></tr><tr><td>destruction method</td><td>
                                <p><a href="#beans-factory-lifecycle" title="3.5.1.&nbsp;Lifecycle interfaces">Section&nbsp;3.5.1, &#8220;Lifecycle interfaces&#8221;</a></p>
                            </td></tr></tbody></table></div></div><br class="table-break"><p>Besides bean definitions which contain information on how to
			create a specific bean, certain <code class="interfacename">BeanFactory</code>
			implementations also permit the registration of existing objects that have
			been created outside the factory (by user code). The
			<code class="classname">DefaultListableBeanFactory</code> class supports this
			through the <code class="methodname">registerSingleton(..)</code> method. Typical applications
			solely work with beans defined through metadata bean definitions, though.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-beanname"></a>3.2.3.1.&nbsp;Naming beans</h4></div></div></div><div class="sidebar"><p class="title"><b>Bean naming conventions</b></p><p>The convention (at least amongst the Spring development team) is to use
				    the standard Java convention for instance field names when naming beans.
				    That is, bean names start with a lowercase letter, and are camel-cased
				    from then on. Examples of such names would be (without quotes)
				    <code class="literal">'accountManager'</code>, <code class="literal">'accountService'</code>,
				    <code class="literal">'userDao'</code>, <code class="literal">'loginController'</code>, etc.</p><p>Adopting a consistent way of naming your beans will go a long way towards
				    making your configuration easier to read and understand; adopting such
				    naming standards is not hard to do, and if you are using Spring AOP it
				    can pay off handsomely when it comes to applying advice to a set of
				    beans related by name.</p></div><p>Every bean has one or more ids (also called identifiers, or names;
				these terms refer to the same thing). These ids must be unique within
				the container the bean is hosted in. A bean will almost always have only one
				id, but if a bean has more than one id, the extra ones can essentially be
				considered aliases.</p><p>When using XML-based configuration metadata, you use the <code class="literal">'id'</code>
				or <code class="literal">'name'</code> attributes to specify the bean identifier(s). The
				<code class="literal">'id'</code> attribute allows you to specify exactly one id, and as
				it is a real XML element ID attribute, the XML parser is able to do
				some extra validation when other elements reference the id; as such, it is the
				preferred way to specify a bean id. However, the XML specification does limit
				the characters which are legal in XML IDs. This is usually not a constraint, but
				if you have a need to use one of these special XML characters, or want to introduce
				other aliases to the bean, you may also or instead specify one or more bean ids,
				separated by a comma (<code class="literal">,</code>), semicolon (<code class="literal">;</code>), or
				whitespace in the <code class="literal">'name'</code> attribute.</p><p>Please note that you are not required to supply a name for a bean. If
				no name is supplied explicitly, the container will generate a (unique) name
				for that bean. The motivations for not supplying a name for a bean will be
				discussed later (one use case is <a href="#beans-inner-beans" title="3.3.3.3.&nbsp;Inner beans">inner beans</a>).</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-beanname-alias"></a>3.2.3.1.1.&nbsp;Aliasing beans</h5></div></div></div><p>In a bean definition itself, you may supply more than one name for
                    the bean, by using a combination of up to one name specified via the
                    <code class="literal">id</code> attribute, and any number of other names via the
                    <code class="literal">name</code> attribute. All these names can be considered
                    equivalent aliases to the same bean, and are useful for some situations,
                    such as allowing each component used in an application to refer to a
                    common dependency using a bean name that is specific to that component
                    itself.</p><p>Having to specify all aliases when the bean is actually defined is not
                    always adequate however. It is sometimes desirable to introduce an alias
                    for a bean which is defined elsewhere. In XML-based configuration metadata
                    this may be accomplished via the use of the standalone
                    <code class="literal">&lt;alias/&gt;</code> element. For example:</p><pre class="programlisting">&lt;alias name="fromName" alias="toName"/&gt;</pre><p>In this case, a bean in the same container which is named
                    <code class="literal">'fromName'</code>, may also after the use of this alias
                    definition, be referred to as <code class="literal">'toName'</code>.</p><p>As a concrete example, consider the case where component A defines a
                    DataSource bean called componentA-dataSource, in its XML fragment.
                    Component B would however like to refer to the DataSource as
                    componentB-dataSource in its XML fragment. And the main application,
                    MyApp, defines its own XML fragment and assembles the final application
                    context from all three fragments, and would like to refer to the
                    DataSource as myApp-dataSource. This scenario can be easily handled by
                    adding to the MyApp XML fragment the following standalone aliases:</p><pre class="programlisting">&lt;alias name="componentA-dataSource" alias="componentB-dataSource"/&gt;
&lt;alias name="componentA-dataSource" alias="myApp-dataSource" /&gt;</pre><p>Now each component and the main app can refer to the dataSource via
                    a name that is unique and guaranteed not to clash with any other
                    definition (effectively there is a namespace), yet they refer to the same
                    bean.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-class"></a>3.2.3.2.&nbsp;Instantiating beans</h4></div></div></div><div class="sidebar"><p class="title"><b>Inner class names</b></p><p>If for whatever reason you want to configure a bean definition
                    for a <code class="literal">static</code> inner class, you have to use the
                    <span class="emphasis"><em>binary</em></span> name of the inner class.</p><p>For example, if you have a class called <code class="classname">Foo</code>
                    in the <code class="literal">com.example</code> package, and this <code class="classname">Foo</code>
                    class has a <code class="literal">static</code> inner class called <code class="classname">Bar</code>,
                    the value of the <code class="literal">'class'</code> attribute on a bean definition would
                    be...</p><p><code class="classname">com.example.Foo$Bar</code></p><p>Notice the use of the <code class="literal">$</code> character in the name to
                    separate the inner class name from the outer class name.</p></div><p>A bean definition can be seen as a recipe for creating one or more
				actual objects. The container looks at the recipe for a named bean when
				asked, and uses the configuration metadata encapsulated by that bean
				definition to create (or acquire) an actual object.</p><p>If you are using XML-based configuration metadata, you can specify
                the type (or class) of object that is to be instantiated using the
                <code class="literal">'class'</code> attribute of the <code class="literal">&lt;bean/&gt;</code>
                element. This <code class="literal">'class'</code> attribute (which internally
                eventually boils down to being a <code class="classname">Class</code> property on a
                <code class="interfacename">BeanDefinition</code> instance) is normally
                mandatory (see <a href="#beans-factory-class-instance-factory-method" title="3.2.3.2.3.&nbsp;Instantiation using an instance factory method">Section&nbsp;3.2.3.2.3, &#8220;Instantiation using an instance factory method&#8221;</a> and
			    <a href="#beans-child-bean-definitions" title="3.6.&nbsp;Bean definition inheritance">Section&nbsp;3.6, &#8220;Bean definition inheritance&#8221;</a> for the two exceptions)
			    and is used for one of two purposes. The class property specifies the
			    class of the bean to be constructed in the much more common case where the
			    container itself directly creates the bean by calling its constructor
			    reflectively (somewhat equivalent to Java code using the
			    <span class="emphasis"><em>'new'</em></span> operator). In the less common case where the
			    container invokes a <code class="literal">static</code>, <span class="emphasis"><em>factory</em></span>
			    method on a class to create the bean, the class property specifies the actual
			    class containing the <code class="literal">static</code> factory method that is to
			    be invoked to create the object (the type of the object returned from the
			    invocation of the <code class="literal">static</code> factory method may be the same
			    class or another class entirely, it doesn't	matter).</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-factory-class-ctor"></a>3.2.3.2.1.&nbsp;Instantiation using a constructor</h5></div></div></div><p>When creating a bean using the constructor approach, all normal
				    classes are usable by and compatible with Spring. That is, the
				    class being created does not need to implement any specific interfaces
				    or be coded in a specific fashion. Just specifying the bean class
				    should be enough. However, depending on what type of IoC you are going
				    to use for that specific bean, you may need a default (empty)
				    constructor.</p><p>Additionally, the Spring IoC container isn't limited to just managing
				    true JavaBeans, it is also able to manage virtually <span class="emphasis"><em>any</em></span>
				    class you want it to manage. Most people using Spring prefer to
				    have actual JavaBeans (having just a default (no-argument) constructor
				    and appropriate setters and getters modeled after the properties)
				    in the container, but it is also possible to have more exotic
				    non-bean-style classes in your container. If, for example, you
				    need to use a legacy connection pool that absolutely does not adhere
				    to the JavaBean specification, Spring can manage it as well.</p><p>When using XML-based configuration metadata you can specify your bean
				    class like so:</p><pre class="programlisting">&lt;bean id="exampleBean" class="examples.ExampleBean"/&gt;

&lt;bean name="anotherExample" class="examples.ExampleBeanTwo"/&gt;</pre><p>The mechanism for supplying arguments to the constructor (if required),
				    or setting properties of the object instance after it has been constructed,
				    will be described shortly.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-factory-class-static-factory-method"></a>3.2.3.2.2.&nbsp;Instantiation using a <code class="literal">static</code> factory method</h5></div></div></div><p>
					    When defining a bean which is to be created using a static
					    factory method, along with the <code class="literal">class</code> attribute
					    which specifies the class containing the <code class="literal">static</code> factory method,
					    another attribute named <code class="literal">factory-method</code> is needed to
					    specify the name of the factory method itself. Spring expects to be
					    able to call this method (with an optional list of arguments as
					    described later) and get back a live object, which from that point on
					    is treated as if it had been created normally via a constructor. One
					    use for such a bean definition is to call <code class="literal">static</code>
					    factories in legacy code.
				    </p><p>
					    The following example shows a bean definition which specifies
					    that the bean is to be created by calling a factory-method. Note that
					    the definition does not specify the type (class) of the returned
					    object, only the class containing the factory method. In this example,
					    the <code class="methodname">createInstance()</code> method must be a
					    <span class="emphasis"><em>static</em></span> method.
				    </p><pre class="programlisting">&lt;bean id="exampleBean"
      class="examples.ExampleBean2"
      factory-method="createInstance"/&gt;</pre><p>The mechanism for supplying (optional) arguments to the factory
				    method, or setting properties of the object instance after it has been
				    returned from the factory, will be described shortly.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-factory-class-instance-factory-method"></a>3.2.3.2.3.&nbsp;Instantiation using an instance factory method</h5></div></div></div><p>In a fashion similar to instantiation via a
                    <a href="#beans-factory-class-static-factory-method" title="3.2.3.2.2.&nbsp;Instantiation using a static factory method">static factory method</a>,
                    instantiation using an instance factory method is where the factory method of an
                    existing bean from the container is invoked to create the new bean.</p><p>To use this mechanism, the <code class="literal">'class'</code> attribute
				    must be left empty, and the <code class="literal">'factory-bean'</code> attribute
				    must specify the name of a bean in the current (or parent/ancestor) container
				    that contains the factory method. The factory method itself must still be set
				    via the <code class="literal">'factory-method'</code> attribute (as seen in the example
				    below).</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- the factory bean, which contains a method called <code class="methodname">createInstance()</code> --&gt;</span></em>
&lt;bean id="myFactoryBean" class="..."&gt;
  ...
&lt;/bean&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- the bean to be created via the factory bean --&gt;</span></em>
&lt;bean id="exampleBean"
      factory-bean="myFactoryBean"
      factory-method="createInstance"/&gt;</pre><p>Although the mechanisms for setting bean properties are still to
				    be discussed, one implication of this approach is that the factory
				    bean itself can be managed and configured via DI.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-client"></a>3.2.4.&nbsp;Using the container</h3></div></div></div><p>A <code class="interfacename">BeanFactory</code> is essentially nothing more
            than the interface for an advanced factory capable of maintaining a registry
            of different beans and their dependencies. The <code class="interfacename">BeanFactory</code>
            enables you to read bean definitions and access them using the bean factory.
            When using just the <code class="interfacename">BeanFactory</code> you would create
            one and read in some bean definitions in the XML format as follows:</p><pre class="programlisting">InputStream is = new FileInputStream("beans.xml");
BeanFactory factory = new XmlBeanFactory(is);</pre><p>Basically that's all there is to it. Using <code class="methodname">getBean(String)</code>
            you can retrieve instances of your beans; the client-side view of the
            <code class="interfacename">BeanFactory</code> is surprisingly simple. The
            <code class="interfacename">BeanFactory</code> interface has only six methods for
            client code to call:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="methodname">boolean containsBean(String)</code>: returns true
                    if the <code class="interfacename">BeanFactory</code> contains a bean
                    definition or bean instance that matches the given name</p></li><li><p><code class="methodname">Object getBean(String)</code>: returns an instance
                    of the bean registered under the given name. Depending on how the
                    bean was configured by the <code class="interfacename">BeanFactory</code> configuration, either a
                    singleton and thus shared instance or a newly created bean will be
                    returned. A <code class="exceptionname">BeansException</code> will be thrown when
                    either the bean could not be found (in which case it'll be a
                    <code class="exceptionname">NoSuchBeanDefinitionException</code>), or an exception
                    occurred while instantiating and preparing the bean</p></li><li><p><code class="methodname">Object getBean(String, Class)</code>: returns a
                    bean, registered under the given name. The bean returned will be
                    cast to the given Class. If the bean could not be cast,
                    corresponding exceptions will be thrown
                    (<code class="exceptionname">BeanNotOfRequiredTypeException</code>). Furthermore,
                    all rules of the <code class="methodname">getBean(String)</code> method apply (see above)</p></li><li><p><code class="methodname">Class getType(String name)</code>: returns the
                    <code class="classname">Class</code> of the bean with the given name. If no bean
                    corresponding to the given name could be found, a
                    <code class="exceptionname">NoSuchBeanDefinitionException</code> will be thrown</p></li><li><p><code class="methodname">boolean isSingleton(String)</code>: determines
                    whether or not the bean definition or bean instance registered under
                    the given name is a singleton (bean scopes such as singleton are explained
                    <a href="#beans-factory-scopes" title="3.4.&nbsp;Bean scopes">later</a>). If no bean corresponding
                    to the given name could be found, a
                    <code class="exceptionname">NoSuchBeanDefinitionException</code> will be thrown</p></li><li><p><code class="methodname">String[] getAliases(String)</code>: Return the
                    aliases for the given bean name, if any were defined in the bean
                    definition</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-dependencies"></a>3.3.&nbsp;Dependencies</h2></div></div></div><p>Your typical enterprise application is not made up of a single object (or
        bean in the Spring parlance). Even the simplest of applications will no doubt
        have at least a handful of objects that work together to present what the
        end-user sees as a coherent application. This next section explains how you go
        from defining a number of bean definitions that stand-alone, each to themselves,
        to a fully realized application where objects work (or collaborate) together
        to achieve some goal (usually an application that does what the end-user wants).</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-collaborators"></a>3.3.1.&nbsp;Injecting dependencies</h3></div></div></div><p>
				The basic principle behind <span class="emphasis"><em>Dependency Injection</em></span> (DI)
				is that objects define their dependencies (that is to say the other
				objects they work with) only through constructor arguments, arguments
				to a factory method, or properties which are set on the object instance
				after it has been constructed or returned from a factory method. Then, it
				is the job of the container to actually <span class="emphasis"><em>inject</em></span> those
				dependencies when it creates the bean. This is fundamentally the inverse,
				hence the name <span class="emphasis"><em>Inversion of Control</em></span> (IoC), of the bean
				itself being in control of instantiating or locating its dependencies on its
				own using direct construction of classes, or something like the
				<span class="emphasis"><em>Service Locator</em></span> pattern.
			</p><p>
				It becomes evident upon usage that code gets much cleaner when the DI
				principle is applied, and reaching a higher grade of decoupling is much
				easier when beans do not look up their dependencies, but are provided
				with them (and additionally do not even know where the dependencies are
				located and of what actual class they are).
			</p><p>
				As touched on in the previous paragraph, DI exists in two major variants,
				namely <a href="#beans-setter-injection" title="3.3.1.1.&nbsp;Setter Injection">Setter Injection</a>, and
				<a href="#beans-constructor-injection" title="3.3.1.2.&nbsp;Constructor Injection">Constructor Injection</a>.
			</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-setter-injection"></a>3.3.1.1.&nbsp;Setter Injection</h4></div></div></div><p>
					<span class="emphasis"><em>Setter-based</em></span> DI is realized by calling setter methods
					on your beans after invoking a no-argument constructor or no-argument
					<code class="literal">static</code> factory method to instantiate your bean.
				</p><p>
					Find below an example of a class that can only be dependency injected
					using pure setter injection. Note that there is nothing
					<span class="emphasis"><em>special</em></span> about this class... it is plain old Java.
				</p><pre class="programlisting">public class SimpleMovieLister {

    <em class="lineannotation"><span class="lineannotation">// the <code class="classname">SimpleMovieLister</code> has a dependency on the <code class="interfacename">MovieFinder</code></span></em>
    private MovieFinder movieFinder;

    <em class="lineannotation"><span class="lineannotation">// a setter method so that the Spring container can 'inject' a <code class="interfacename">MovieFinder</code></span></em>
    public void setMovieFinder(MovieFinder movieFinder) {
        this.movieFinder = movieFinder;
    }
    
    <em class="lineannotation"><span class="lineannotation">// business logic that actually 'uses' the injected <code class="interfacename">MovieFinder</code> is omitted...</span></em>
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-constructor-injection"></a>3.3.1.2.&nbsp;Constructor Injection</h4></div></div></div><p>
					<span class="emphasis"><em>Constructor-based</em></span> DI
					is realized by invoking a constructor with a number of arguments,
					each representing a collaborator. Additionally,
					calling a <code class="literal">static</code> factory method with specific
					arguments to construct the bean, can be considered almost equivalent,
					and the rest of this text will consider arguments to a constructor and
					arguments to a <code class="literal">static</code> factory method similarly.
				</p><p>
					Find below an example of a class that could only be dependency injected
					using constructor injection. Again, note that there is nothing
					<span class="emphasis"><em>special</em></span> about this class.
				</p><pre class="programlisting">public class SimpleMovieLister {

    <em class="lineannotation"><span class="lineannotation">// the <code class="classname">SimpleMovieLister</code> has a dependency on the <code class="interfacename">MovieFinder</code></span></em>
    private MovieFinder movieFinder;

    <em class="lineannotation"><span class="lineannotation">// a constructor so that the Spring container can 'inject' a <code class="interfacename">MovieFinder</code></span></em>
    public SimpleMovieLister(MovieFinder movieFinder) {
        this.movieFinder = movieFinder;
    }
    
    <em class="lineannotation"><span class="lineannotation">// business logic that actually 'uses' the injected <code class="interfacename">MovieFinder</code> is omitted...</span></em>
}</pre></div><div class="sidebar"><p class="title"><b>Constructor- or Setter-based DI?</b></p><p>
					The Spring team generally advocates the usage of setter injection,
					since a large number of constructor arguments can get unwieldy,
					especially when some properties are optional. The presence of
					setter methods also makes objects of that class amenable to being
					re-configured (or re-injected) at some later time (for management
					via <a href="#jmx" title="Chapter&nbsp;20.&nbsp;JMX">JMX MBeans</a> is a particularly
					compelling use case).
				</p><p>
					Constructor-injection is favored by some purists though (and with
					good reason). Supplying all of an object's dependencies means that
					that object is never returned to client (calling) code in a less than
					totally initialized state. The flipside is that the object becomes
					less amenable to re-configuration (or re-injection).
				</p><p>
					There is no hard and fast rule here. Use whatever type of DI makes
					the most sense for a particular class; sometimes, when dealing with
					third party classes to which you do not have the source, the choice
					will already have been made for you - a legacy class may not expose
					any setter methods, and so constructor injection will be the only type
					of DI available to you.
				</p></div><p>
				The <code class="interfacename">BeanFactory</code> supports both of these
				variants for injecting dependencies into beans it manages. (It in fact
				also supports injecting setter-based dependencies after some
				dependencies have already been supplied via the constructor approach.)
				The configuration for the dependencies comes in the form of a
				<code class="interfacename">BeanDefinition</code>, which is used together with
				<code class="interfacename">PropertyEditor</code> instances to know how to
				convert properties from one format to another. However, most users of
				Spring will not be dealing with these classes directly
				(that is programmatically), but rather with an XML definition file which
				will be converted internally into instances of these classes, and used
				to load an entire Spring IoC container instance.
			</p><p>
				Bean dependency resolution generally happens as follows:
			</p><div class="orderedlist"><ol type="1"><li><p>
						The <code class="interfacename">BeanFactory</code> is created
						and initialized with a configuration which describes all
						the beans. (Most Spring users use a
						<code class="interfacename">BeanFactory</code> or
						<code class="interfacename">ApplicationContext</code> implementation
						that supports XML format configuration files.)
					</p></li><li><p>
						Each bean has dependencies expressed in the form of
						properties, constructor arguments, or arguments to the
						static-factory method when that is used instead of a normal
						constructor. These dependencies will be provided to the bean,
						<span class="emphasis"><em>when the bean is actually created</em></span>.
					</p></li><li><p>
						Each property or constructor argument is either an actual
						definition of the value to set, or a reference to another bean in
						the container.
					</p></li><li><p>
						<a name="beans-factory-collaborators-propertyeditor"></a>
						Each property or constructor argument which is a value must
						be able to be converted from whatever format it was specified
						in, to the actual type of that property or constructor argument.
						By default Spring can convert a value supplied in string format
						to all built-in types, such as <code class="literal">int</code>,
						<code class="literal">long</code>, <code class="literal">String</code>,
						<code class="literal">boolean</code>, etc.
					</p></li></ol></div><p>
				The Spring container validates the configuration of each bean as the container
				is created, including the validation that properties which are bean references
				are actually referring to valid beans. However, the bean properties themselves
				are not set until the bean <span class="emphasis"><em>is actually created</em></span>. For those
				beans that are singleton-scoped and set to be pre-instantiated (such as
				singleton beans in an <code class="interfacename">ApplicationContext</code>),
				creation happens at the time that the container is created, but otherwise this is
				only when the bean is requested. When a bean actually has to be created, this will
				potentially cause a graph of other beans to be created, as its dependencies and its
				dependencies' dependencies (and so on) are created and assigned.
			</p><div class="sidebar"><p class="title"><b>Circular dependencies</b></p><p>If you are using predominantly constructor injection it is
			    possible to write and configure your classes and beans such that
			    an unresolvable circular dependency scenario is created.</p><p>Consider the scenario where you have class A, which requires
			    an instance of class B to be provided via constructor injection,
			    and class B, which requires an instance of class A to be provided
			    via constructor injection. If you configure beans for classes A and B
			    to be injected into each other, the Spring IoC container will detect
			    this circular reference at runtime, and throw a
			    <code class="classname">BeanCurrentlyInCreationException</code>.</p><p>One possible solution to this issue is to edit the source code of
			    some of your classes to be configured via setters instead of via
			    constructors. Another solution is not to use constructor injection
			    and stick to setter injection only.</p></div><p>
				You can generally trust Spring to do the right thing. It will detect
				mis-configuration issues, such as references to non-existent beans and
				circular dependencies, at container load-time. It will actually set
				properties and resolve dependencies as late as possible, which is when
				the bean is actually created. This means that
				a Spring container which has loaded correctly can later generate an
				exception when you request a bean if there is a problem creating that
				bean or one of its dependencies. This could happen if the bean throws
				an exception as a result of a missing or invalid property, for example.
				This potentially delayed visibility of some configuration issues is why
				<code class="interfacename">ApplicationContext</code> implementations by default
				pre-instantiate singleton beans. At the cost of some upfront time
				and memory to create these beans before they are actually needed,
				you find out about configuration issues when the
				<code class="interfacename">ApplicationContext</code> is created, not later.
				If you wish, you can still override this default behavior and set any of these
				singleton beans to lazy-initialize (that is not be pre-instantiated).
			</p><p>
				Finally, if it is not immediately apparent, it is worth mentioning that when
				one or more collaborating beans are being injected into a dependent bean, each
				collaborating bean is <span class="emphasis"><em>totally</em></span> configured prior to being
				passed (via one of the DI flavors) to the dependent bean.
				This means that if bean A has a dependency on bean B, the Spring IoC container
				will <span class="emphasis"><em>totally</em></span> configure bean B prior to invoking the setter method
				on bean A; you can read '<span class="emphasis"><em>totally configure</em></span>'
				to mean that the bean will be instantiated (if not a pre-instantiated singleton),
				all of its dependencies will be set, and the relevant lifecycle methods (such as
				a <a href="#beans-factory-lifecycle-initializingbean" title="3.5.1.1.&nbsp;Initialization callbacks">configured init method</a>
				or the
				<a href="#beans-factory-lifecycle-initializingbean" title="3.5.1.1.&nbsp;Initialization callbacks">IntializingBean callback method</a>)
				will all be invoked.
			</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-some-examples"></a>3.3.1.3.&nbsp;Some examples</h4></div></div></div><p>First, an example of using XML-based configuration metadata for setter-based DI.
			Find below a small part of a Spring XML configuration file specifying some bean
			definitions.</p><pre class="programlisting">&lt;bean id="exampleBean" class="examples.ExampleBean"&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!-- setter injection using the nested <code class="literal">&lt;ref/&gt;</code> element --&gt;</span></em>
  &lt;property name="beanOne"&gt;&lt;ref bean="anotherExampleBean"/&gt;&lt;/property&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!-- setter injection using the neater 'ref' attribute --&gt;</span></em>
  &lt;property name="beanTwo" ref="yetAnotherBean"/&gt;
  &lt;property name="integerProperty" value="1"/&gt;
&lt;/bean&gt;

&lt;bean id="anotherExampleBean" class="examples.AnotherBean"/&gt;
&lt;bean id="yetAnotherBean" class="examples.YetAnotherBean"/&gt;</pre><pre class="programlisting">public class ExampleBean {

    private AnotherBean beanOne;
    private YetAnotherBean beanTwo;
    private int i;

    public void setBeanOne(AnotherBean beanOne) {
        this.beanOne = beanOne;
    }

    public void setBeanTwo(YetAnotherBean beanTwo) {
        this.beanTwo = beanTwo;
    }

    public void setIntegerProperty(int i) {
        this.i = i;
    }    
}</pre><p>As you can see, setters have been declared to match against the properties
			specified in the XML file.</p><p>Now, an example of using constructor-based DI. Find below a snippet from an XML
            configuration that specifies constructor arguments, and the corresponding Java class.</p><pre class="programlisting">&lt;bean id="exampleBean" class="examples.ExampleBean"&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!-- constructor injection using the nested <code class="literal">&lt;ref/&gt;</code> element --&gt;</span></em>
  &lt;constructor-arg&gt;&lt;ref bean="anotherExampleBean"/&gt;&lt;/constructor-arg&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- constructor injection using the neater 'ref' attribute --&gt;</span></em>
  &lt;constructor-arg ref="yetAnotherBean"/&gt;
  
  &lt;constructor-arg type="int" value="1"/&gt;
&lt;/bean&gt;

&lt;bean id="anotherExampleBean" class="examples.AnotherBean"/&gt;
&lt;bean id="yetAnotherBean" class="examples.YetAnotherBean"/&gt;</pre><pre class="programlisting">public class ExampleBean {

    private AnotherBean beanOne;
    private YetAnotherBean beanTwo;
    private int i;
    
    public ExampleBean(
        AnotherBean anotherBean, YetAnotherBean yetAnotherBean, int i) {
        this.beanOne = anotherBean;
        this.beanTwo = yetAnotherBean;
        this.i = i;
    }
}</pre><p>
				As you can see, the constructor arguments specified in the
				bean definition will be used to pass in as arguments to the constructor
				of the <code class="classname">ExampleBean</code>.
			</p><p>
				Now consider a variant of this where instead of using a
				constructor, Spring is told to call a <code class="literal">static</code> factory
				method to return an instance of the object:
			</p><pre class="programlisting">&lt;bean id="exampleBean" class="examples.ExampleBean"
      factory-method="createInstance"&gt;
  &lt;constructor-arg ref="anotherExampleBean"/&gt;
  &lt;constructor-arg ref="yetAnotherBean"/&gt;
  &lt;constructor-arg value="1"/&gt; 
&lt;/bean&gt;

&lt;bean id="anotherExampleBean" class="examples.AnotherBean"/&gt;
&lt;bean id="yetAnotherBean" class="examples.YetAnotherBean"/&gt;</pre><pre class="programlisting">public class ExampleBean {

    <em class="lineannotation"><span class="lineannotation">// a private constructor</span></em>
    private ExampleBean(...) {
      ...
    }
    <em class="lineannotation"><span class="lineannotation">
    // a static factory method; the arguments to this method can be
    // considered the dependencies of the bean that is returned,
    // regardless of how those arguments are actually used.</span></em>
    public static ExampleBean createInstance (
            AnotherBean anotherBean, YetAnotherBean yetAnotherBean, int i) {

        ExampleBean eb = new ExampleBean (...);
        <em class="lineannotation"><span class="lineannotation">// some other operations...</span></em>
        return eb;
    }
}</pre><p>
				Note that arguments to the <code class="literal">static</code> factory method
				are supplied via <code class="literal">constructor-arg</code> elements, exactly
				the same as if a constructor had actually been used. Also, it is
				important to realize that the type of the class being returned by
				the factory method does not have to be of the same type as the class
				which contains the <code class="literal">static</code> factory method, although
				in this example it is. An instance (non-static) factory method would
				be used in an essentially identical fashion (aside from the use of the
				<code class="literal">factory-bean</code> attribute instead of the
				<code class="literal">class</code> attribute), so details will not be discussed here.
			</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-ctor-arguments-resolution"></a>3.3.2.&nbsp;Constructor Argument Resolution</h3></div></div></div><p>
				Constructor argument resolution matching occurs using the
				argument's type. If there is no potential for ambiguity in
				the constructor arguments of a bean definition, then the order
				in which the constructor arguments are defined in a bean definition
				is the order in which those arguments will be supplied to the
				appropriate constructor when it is being instantiated. Consider the
				following class:
			</p><pre class="programlisting">package x.y;

public class Foo {

    public Foo(Bar bar, Baz baz) {
        <em class="lineannotation"><span class="lineannotation">// ...</span></em>
    }
}</pre><p>
				There is no potential for ambiguity here (assuming of course that <code class="classname">Bar</code>
				and <code class="classname">Baz</code> classes are not related in an inheritance hierarchy).
				Thus the following configuration will work just fine, and you do not need to
				specify the constructor argument indexes and / or types explicitly.
			</p><pre class="programlisting">&lt;beans&gt;
    &lt;bean name="foo" class="x.y.Foo"&gt;
        &lt;constructor-arg&gt;
            &lt;bean class="x.y.Bar"/&gt;
        &lt;/constructor-arg&gt;
        &lt;constructor-arg&gt;
            &lt;bean class="x.y.Baz"/&gt;
        &lt;/constructor-arg&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</pre><p>
				When another bean is referenced, the type is known, and
				matching can occur (as was the case with the preceding example).
				When a simple type is used, such as
				<code class="literal">&lt;value&gt;true&lt;value&gt;</code>, Spring cannot
				determine the type of the value, and so cannot match by type without
				help. Consider the following class:
			</p><pre class="programlisting">package examples;

public class ExampleBean {

    <em class="lineannotation"><span class="lineannotation">// No. of years to the calculate the Ultimate Answer</span></em>
    private int years;
    
    <em class="lineannotation"><span class="lineannotation">// The Answer to Life, the Universe, and Everything</span></em>
    private String ultimateAnswer;

    public ExampleBean(int years, String ultimateAnswer) {
        this.years = years;
        this.ultimateAnswer = ultimateAnswer;
    }
}</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-ctor-arguments-type"></a>3.3.2.1.&nbsp;Constructor Argument Type Matching</h4></div></div></div><p>The above scenario <span class="emphasis"><em>can</em></span> use type matching
				with simple types by explicitly specifying the type of the constructor
				argument using the <code class="literal">'type'</code> attribute. For example:</p><pre class="programlisting">&lt;bean id="exampleBean" class="examples.ExampleBean"&gt;
  &lt;constructor-arg type="int" value="7500000"/&gt;
  &lt;constructor-arg type="java.lang.String" value="42"/&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-ctor-arguments-index"></a>3.3.2.2.&nbsp;Constructor Argument Index</h4></div></div></div><p>Constructor arguments can have their index specified explicitly by use of
                the <code class="literal">index</code> attribute. For example:</p><pre class="programlisting">&lt;bean id="exampleBean" class="examples.ExampleBean"&gt;
  &lt;constructor-arg index="0" value="7500000"/&gt;
  &lt;constructor-arg index="1" value="42"/&gt;
&lt;/bean&gt;</pre><p>As well as solving the ambiguity problem of multiple simple values, specifying
				an index also solves the problem of	ambiguity where a constructor may have two
				arguments of the same type.	Note that the <span class="emphasis"><em>index is 0 based</em></span>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-properties-detailed"></a>3.3.3.&nbsp;Bean properties and constructor arguments detailed</h3></div></div></div><p>As mentioned in the previous section, bean properties and
            constructor arguments can be defined as either references to other
            managed beans (collaborators), or values defined inline. Spring's XML-based
            configuration metadata supports a number of sub-element types
            within its <code class="literal">&lt;property/&gt;</code> and
            <code class="literal">&lt;constructor-arg/&gt;</code> elements for just this purpose.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-value-element"></a>3.3.3.1.&nbsp;Straight values (primitives, <code class="literal">Strings</code>, etc.)</h4></div></div></div><p>The <code class="literal">&lt;value/&gt;</code> element specifies a property or
				constructor argument as a human-readable string representation.
				<a href="#beans-factory-collaborators-propertyeditor">As mentioned previously</a>,
				JavaBeans <code class="literal">PropertyEditors</code> are used to convert these
				string values from a <code class="classname">String</code> to the actual type of the
				property or argument.</p><pre class="programlisting">&lt;bean id="myDataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- results in a <code class="methodname">setDriverClassName(String)</code> call --&gt;</span></em>
  &lt;property name="driverClassName"&gt;
    &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
  &lt;/property&gt;
  &lt;property name="url"&gt;
    &lt;value&gt;jdbc:mysql://localhost:3306/mydb&lt;/value&gt;
  &lt;/property&gt;
  &lt;property name="username"&gt;
    &lt;value&gt;root&lt;/value&gt;
  &lt;/property&gt;
  &lt;property name="password"&gt;
    &lt;value&gt;masterkaoli&lt;/value&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>The <code class="literal">&lt;property/&gt;</code> and <code class="literal">&lt;constructor-arg/&gt;</code>
            elements also support the use of the <code class="literal">'value'</code> attribute, which can lead
            to much more succinct configuration. When using the <code class="literal">'value'</code> attribute,
            the above bean definition reads like so:</p><pre class="programlisting">&lt;bean id="myDataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- results in a <code class="methodname">setDriverClassName(String)</code> call --&gt;</span></em>
  &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt;
  &lt;property name="url" value="jdbc:mysql://localhost:3306/mydb"/&gt;
  &lt;property name="username" value="root"/&gt;
  &lt;property name="password" value="masterkaoli"/&gt;
&lt;/bean&gt;</pre><p>The Spring team generally prefer the attribute style over the use of nested
            <code class="literal">&lt;value/&gt;</code> elements. If you are reading this reference manual
            straight through from top to bottom (wow!) then we are getting slightly ahead of ourselves here,
            but you can also configure a <code class="classname">java.util.Properties</code> instance like so:</p><pre class="programlisting">&lt;bean id="mappings" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt;
            
   <em class="lineannotation"><span class="lineannotation">&lt;!-- typed as a <code class="classname">java.util.Properties</code> --&gt;</span></em>
   &lt;property name="properties"&gt;
      &lt;value&gt;
         jdbc.driver.className=com.mysql.jdbc.Driver
         jdbc.url=jdbc:mysql://localhost:3306/mydb
      &lt;/value&gt;
   &lt;/property&gt;
&lt;/bean&gt;</pre><p>Can you see what is happening? The Spring container is converting the text inside
                the <code class="literal">&lt;value/&gt;</code> element into a <code class="classname">java.util.Properties</code>
                instance using the JavaBeans <code class="interfacename">PropertEditor</code> mechanism.
                This is a nice shortcut, and is one of a few places where the Spring team do favor the
                use of the nested <code class="literal">&lt;value/&gt;</code> element over the <code class="literal">'value'</code>
                attribute style.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-idref-element"></a>3.3.3.1.1.&nbsp;The <code class="literal">idref</code> element</h5></div></div></div><p>The <code class="literal">idref</code> element is simply an error-proof way to
                pass the <span class="emphasis"><em>id</em></span> of another bean in the container (to
                a <code class="literal">&lt;constructor-arg/&gt;</code> or <code class="literal">&lt;property/&gt;</code>
                element).</p><pre class="programlisting">&lt;bean id="theTargetBean" class="..."/&gt;

&lt;bean id="theClientBean" class="..."&gt;
    &lt;property name="targetName"&gt;
        &lt;idref bean="theTargetBean" /&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>The above bean definition snippet is <span class="emphasis"><em>exactly</em></span> equivalent
        (at runtime) to the following snippet:</p><pre class="programlisting">&lt;bean id="theTargetBean" class="..."/&gt;

&lt;bean id="client" class="..."&gt;
    &lt;property name="targetName"&gt;
        &lt;value&gt;theTargetBean&lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>The main reason the first form is preferable to
                the second is that using the <code class="literal">idref</code> tag allows the
                container to validate <span class="emphasis"><em>at deployment time</em></span> that the
                referenced, named bean actually exists. In the second variation,
                no validation is performed on the value that is passed to the
                <code class="literal">'targetName'</code> property of the <code class="literal">'client'</code>
                bean. Any typo will only be discovered (with most likely fatal results)
                when the <code class="literal">'client'</code> bean is actually instantiated.
                If the <code class="literal">'client'</code> bean is a
                <a href="#beans-factory-scopes" title="3.4.&nbsp;Bean scopes">prototype</a> bean, this typo
                (and the resulting exception) may only be discovered long after the
                container is actually deployed.</p><p>Additionally, if the bean being referred to is in the same XML unit, and
                the bean name is the bean <span class="emphasis"><em>id</em></span>, the <code class="literal">'local'</code>
                attribute may be used, which allows the XML parser itself to validate the bean
                id even earlier, at XML document parse time.</p><pre class="programlisting">&lt;property name="targetName"&gt;
   <em class="lineannotation"><span class="lineannotation">&lt;!-- a bean with an id of '<code class="literal">theTargetBean</code>' must exist,
                otherwise an XML exception will be thrown --&gt;</span></em>
   &lt;idref local="theTargetBean"/&gt;
&lt;/property&gt;</pre><p>By way of an example, one common place (at least in pre-Spring 2.0
                configuration) where the &lt;idref/&gt; element brings value is in the
                configuration of <a href="#aop-pfb-1" title="7.5.1.&nbsp;Basics">AOP interceptors</a> in a
                <code class="classname">ProxyFactoryBean</code> bean definition. If you use
                &lt;idref/&gt; elements when specifying the interceptor names, there is
                no chance of inadvertently misspelling an interceptor id.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-ref-element"></a>3.3.3.2.&nbsp;References to other beans (collaborators)</h4></div></div></div><p>The <code class="literal">ref</code> element is the final element allowed
                inside a <code class="literal">&lt;constructor-arg/&gt;</code> or
                <code class="literal">&lt;property/&gt;</code> definition element. It is used to
                set the value of the specified property to be a reference to another
                bean managed by the container (a collaborator). As
                mentioned in a previous section, the referred-to bean is considered to
                be a dependency of the bean who's property is being set, and will be
                initialized on demand as needed (if it is a singleton bean it may have
                already been initialized by the container) before the property is set.
                All references are ultimately just a reference to another object, but
                there are 3 variations on how the id/name of the other object may be
                specified, which determines how scoping and validation is handled.</p><p>Specifying the target bean by using the <code class="literal">bean</code>
                attribute of the <code class="literal">&lt;ref/&gt;</code> tag is the most general form,
                and will allow creating a reference to any bean in the same
                container (whether or not in the same XML file), or parent container.
                The value of the <code class="literal">'bean'</code> attribute may be the same as either the
                <code class="literal">'id'</code> attribute of the target bean, or one of the
                values in the <code class="literal">'name'</code> attribute of the target bean.</p><pre class="programlisting">&lt;ref bean="someBean"/&gt;</pre><p>Specifying the target bean by using the <code class="literal">local</code>
                attribute leverages the ability of the XML parser to validate XML id
                references within the same file. The value of the
                <code class="literal">local</code> attribute must be the same as the
                <code class="literal">id</code> attribute of the target bean. The XML parser
                will issue an error if no matching element is found in the same file.
                As such, using the local variant is the best choice (in order to know
                about errors as early as possible) if the target bean is in the same
                XML file.</p><pre class="programlisting">&lt;ref local="someBean"/&gt;</pre><p>Specifying the target bean by using the <code class="literal">'parent'</code>
                attribute allows a reference to be created to a bean which is in a
                parent container of the current container. The value of the
                <code class="literal">'parent'</code> attribute may be the same as either the
                <code class="literal">'id'</code> attribute of the target bean, or one of the
                values in the <code class="literal">'name'</code> attribute of the target bean,
                and the target bean must be in a parent container to the current one.
                The main use of this bean reference variant is when you have a hierarchy
                of containers and you want to wrap an existing bean in a parent container
                with some sort of proxy which will have the same name as the parent bean.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- in the parent context --&gt;</span></em>
&lt;bean id="accountService" class="com.foo.SimpleAccountService"&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- insert dependencies as required as here --&gt;</span></em>
&lt;/bean&gt;</pre><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- in the child (descendant) context --&gt;</span></em>
&lt;bean id="accountService"  <em class="lineannotation"><span class="lineannotation">&lt;-- notice that the name of this bean is the <span class="bold"><strong>same</strong></span> as the name of the <code class="literal">'parent'</code> bean</span></em>
      class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
      &lt;property name="target"&gt;
          &lt;ref parent="accountService"/&gt;  <em class="lineannotation"><span class="lineannotation">&lt;-- notice how we refer to the <span class="bold"><strong>parent</strong></span> bean</span></em>
      &lt;/property&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- insert other configuration and dependencies as required as here --&gt;</span></em>
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-inner-beans"></a>3.3.3.3.&nbsp;Inner beans</h4></div></div></div><p>A <code class="literal">&lt;bean/&gt;</code> element inside the
                <code class="literal">&lt;property/&gt;</code> or <code class="literal">&lt;constructor-arg/&gt;</code>
                elements is used to define a so-called <em class="firstterm">inner bean</em>. An
                inner bean definition does not need to have any id or name defined, and it is
                best not to even specify any id or name value because the id or name value
                simply will be ignored by the container.</p><pre class="programlisting">&lt;bean id="outer" class="..."&gt;
  <em class="lineannotation"><span class="lineannotation">&lt;!-- instead of using a reference to a target bean, simply define the target bean inline --&gt;</span></em>
  &lt;property name="target"&gt;
    &lt;bean class="com.mycompany.Person"&gt; <em class="lineannotation"><span class="lineannotation">&lt;!-- this is the inner bean --&gt;</span></em>
      &lt;property name="name" value="Fiona Apple"/&gt;
      &lt;property name="age" value="25"/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>Note that in the specific case of inner beans, the <code class="literal">'scope'</code>
                flag and any <code class="literal">'id'</code> or <code class="literal">'name'</code> attribute are
                effectively ignored. Inner beans are <span class="emphasis"><em>always</em></span> anonymous and they
                are <span class="emphasis"><em>always</em></span> scoped as
                <a href="#beans-factory-scopes-prototype" title="3.4.2.&nbsp;The prototype scope">prototypes</a>. Please also note
                that it is <span class="emphasis"><em>not</em></span> possible to inject inner beans into
                collaborating beans other than the enclosing bean.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-collection-elements"></a>3.3.3.4.&nbsp;Collections</h4></div></div></div><p>The <code class="literal">&lt;list/&gt;</code>, <code class="literal">&lt;set/&gt;</code>,
                <code class="literal">&lt;map/&gt;</code>, and <code class="literal">&lt;props/&gt;</code> elements
                allow properties and arguments of the Java <code class="interfacename">Collection</code>
                type <code class="interfacename">List</code>, <code class="interfacename">Set</code>,
                <code class="interfacename">Map</code>, and <code class="interfacename">Properties</code>,
                respectively, to be defined and set.</p><pre class="programlisting">&lt;bean id="moreComplexObject" class="example.ComplexObject"&gt;
  <em class="lineannotation"><span class="lineannotation">&lt;!-- results in a setAdminEmails(<code class="classname">java.util.Properties</code>) call --&gt;</span></em>
  &lt;property name="adminEmails"&gt;
    &lt;props&gt;
        &lt;prop key="administrator"&gt;administrator@somecompany.org&lt;/prop&gt;
        &lt;prop key="support"&gt;support@somecompany.org&lt;/prop&gt;
        &lt;prop key="development"&gt;development@somecompany.org&lt;/prop&gt;
    &lt;/props&gt;
  &lt;/property&gt;
  <em class="lineannotation"><span class="lineannotation">&lt;!-- results in a setSomeList(<code class="interfacename">java.util.List</code>) call --&gt;</span></em>
  &lt;property name="someList"&gt;
    &lt;list&gt;
        &lt;value&gt;a list element followed by a reference&lt;/value&gt;
        &lt;ref bean="myDataSource" /&gt;
    &lt;/list&gt;
  &lt;/property&gt;
  <em class="lineannotation"><span class="lineannotation">&lt;!-- results in a setSomeMap(<code class="interfacename">java.util.Map</code>) call --&gt;</span></em>
  &lt;property name="someMap"&gt;
    &lt;map&gt;
        &lt;entry&gt;
            &lt;key&gt;
                &lt;value&gt;yup an entry&lt;/value&gt;
            &lt;/key&gt;
            &lt;value&gt;just some string&lt;/value&gt;
        &lt;/entry&gt;
        &lt;entry&gt;
            &lt;key&gt;
                &lt;value&gt;yup a ref&lt;/value&gt;
            &lt;/key&gt;
            &lt;ref bean="myDataSource" /&gt;
        &lt;/entry&gt;
    &lt;/map&gt;
  &lt;/property&gt;
  <em class="lineannotation"><span class="lineannotation">&lt;!-- results in a setSomeSet(java.util.Set) call --&gt;</span></em>
  &lt;property name="someSet"&gt;
    &lt;set&gt;
        &lt;value&gt;just some string&lt;/value&gt;
        &lt;ref bean="myDataSource" /&gt;
    &lt;/set&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p><span class="emphasis"><em>Note that the value of a map key or value, or a set value,
                can also again be any of the following elements:</em></span></p><pre class="programlisting">bean | ref | idref | list | set | map | props | value | null</pre><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-collection-elements-merging"></a>3.3.3.4.1.&nbsp;Collection merging</h5></div></div></div><p>As of Spring 2.0, the container also supports the <span class="emphasis"><em>merging</em></span>
                    of collections. This allows an application developer to define a parent-style
                    <code class="literal">&lt;list/&gt;</code>, <code class="literal">&lt;map/&gt;</code>,
                    <code class="literal">&lt;set/&gt;</code> or <code class="literal">&lt;props/&gt;</code> element, and
                    have child-style <code class="literal">&lt;list/&gt;</code>, <code class="literal">&lt;map/&gt;</code>,
                    <code class="literal">&lt;set/&gt;</code> or <code class="literal">&lt;props/&gt;</code> elements
                    inherit and override values from the parent collection; that is to say the child collection's
                    values will be the result obtained from the merging of the elements of the parent
                    and child collections, with the child's collection elements overriding values
                    specified in the parent collection.</p><p><span class="emphasis"><em>Please note that this section on merging makes use of the
                    parent-child bean mechanism. This concept has not yet been introduced, so
                    readers unfamiliar with the concept of parent and child bean definitions
                    may wish to read the <a href="#beans-child-bean-definitions" title="3.6.&nbsp;Bean definition inheritance">relevant section</a>
					before continuing.</em></span></p><p>Find below an example of the collection merging feature:</p><pre class="programlisting">&lt;beans&gt;
&lt;bean id="parent" abstract="true" class="example.ComplexObject"&gt;
    &lt;property name="adminEmails"&gt;
        &lt;props&gt;
            &lt;prop key="administrator"&gt;administrator@somecompany.com&lt;/prop&gt;
            &lt;prop key="support"&gt;support@somecompany.com&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;
&lt;bean id="child" parent="parent"&gt;
    &lt;property name="adminEmails"&gt;
        <em class="lineannotation"><span class="lineannotation">&lt;!-- the merge is specified on the *child* collection definition --&gt;</span></em>
        &lt;props merge="true"&gt;
            &lt;prop key="sales"&gt;sales@somecompany.com&lt;/prop&gt;
            &lt;prop key="support"&gt;support@somecompany.co.uk&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;
&lt;beans&gt;</pre><p>Notice the use of the <code class="literal">merge=true</code> attribute on the
                    <code class="literal">&lt;props/&gt;</code> element of the
                    <code class="literal">adminEmails</code> property of the <code class="literal">child</code>
                    bean definition. When the <code class="literal">child</code> bean is actually resolved
                    and instantiated by the container, the resulting instance will have an
                    <code class="literal">adminEmails</code> <code class="classname">Properties</code> collection
                    that contains the result of the merging of the child's
                    <code class="literal">adminEmails</code> collection with the parent's
                    <code class="literal">adminEmails</code> collection.</p><pre class="programlisting">administrator=administrator@somecompany.com
sales=sales@somecompany.com
support=support@somecompany.co.uk</pre><p>Notice how the child <code class="classname">Properties</code> collection's
                    value set will have inherited all the property elements from the parent
                    <code class="literal">&lt;props/&gt;</code>. Notice also how the child's value for
                    the <code class="literal">support</code> value overrides the value in the parent collection.</p><p>This merging behavior applies similarly to the <code class="literal">&lt;list/&gt;</code>,
                    <code class="literal">&lt;map/&gt;</code>, and <code class="literal">&lt;set/&gt;</code> collection
                    types. In the specific case of the <code class="literal">&lt;list/&gt;</code> element, the
                    semantics associated with the <code class="classname">List</code> collection type, that is the
                    notion of an <code class="literal">ordered</code> collection of values, is maintained;
                    the parent's values will precede all of the child list's values. In the
                    case of the <code class="interfacename">Map</code>, <code class="interfacename">Set</code>,
                    and <code class="interfacename">Properties</code> collection types, there is no notion
                    of ordering and hence no ordering semantics are in effect for the collection types that
                    underlie the associated <code class="interfacename">Map</code>,
                    <code class="interfacename">Set</code> and <code class="interfacename">Properties</code>
                    implementation types used internally by the container.</p><p>Finally, some minor notes about the merging support are in order; you
                    cannot merge different collection types (e.g. a <code class="interfacename">Map</code> and
                    a <code class="interfacename">List</code>), and if you do attempt to do so an appropriate
                    <code class="classname">Exception</code> will be thrown; and in case it is not
                    immediately obvious, the <code class="literal">'merge'</code> attribute must be specified
                    on the lower level, inherited, child definition; specifying the
                    <code class="literal">'merge'</code> attribute on a parent collection definition is
                    redundant and will not result in the desired merging; and (lastly), please
                    note that this merging feature is only available in Spring 2.0 (and later
                    versions).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-collection-elements-strongly-typed"></a>3.3.3.4.2.&nbsp;Strongly-typed collection (Java 5+ only)</h5></div></div></div><p>If you are using Java 5 or Java 6, you will be aware that it is possible to
                    have strongly typed collections (using generic types). That is, it is possible to
                    declare a <code class="interfacename">Collection</code> type such that it can only
                    contain <code class="classname">String</code> elements (for example).
                    If you are using Spring to dependency inject a strongly-typed
                    <code class="interfacename">Collection</code> into a bean, you can take advantage
                    of Spring's type-conversion support such that the elements of your strongly-typed
                    <code class="interfacename">Collection</code> instances will be converted to the
                    appropriate type prior to being added to the <code class="interfacename">Collection</code>.</p><pre class="programlisting">public class Foo {
                
    private Map&lt;String, Float&gt; accounts;
    
    public void setAccounts(Map&lt;String, Float&gt; accounts) {
        this.accounts = accounts;
    }
}</pre><pre class="programlisting">&lt;beans&gt;
    &lt;bean id="foo" class="x.y.Foo"&gt;
        &lt;property name="accounts"&gt;
            &lt;map&gt;
                &lt;entry key="one" value="9.99"/&gt;
                &lt;entry key="two" value="2.75"/&gt;
                &lt;entry key="six" value="3.99"/&gt;
            &lt;/map&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</pre><p>When the <code class="literal">'accounts'</code> property of the <code class="literal">'foo'</code>
                    bean is being prepared for injection, the generics information about the element
                    type of the strongly-typed <code class="classname">Map&lt;String, Float&gt;</code> is
                    actually available via reflection, and so Spring's type conversion infrastructure
                    will actually recognize the various value elements as being of type
                    <code class="classname">Float</code> and so the string values <code class="literal">'9.99', '2.75'</code>,
                    and <code class="literal">'3.99'</code> will be converted into an actual <code class="classname">Float</code>
                    type.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-null-element"></a>3.3.3.5.&nbsp;<code class="literal">Nulls</code></h4></div></div></div><p>The <code class="literal">&lt;null/&gt;</code> element is used to handle
                <code class="literal">null</code> values. Spring treats empty arguments for
                properties and the like as empty <code class="literal">Strings</code>. The following
                XML-based configuration metadata snippet  results in the email property
                being set to the empty <code class="classname">String</code> value ("")</p><pre class="programlisting">&lt;bean class="ExampleBean"&gt;
  &lt;property name="email"&gt;&lt;value/&gt;&lt;/property&gt;
&lt;/bean&gt;</pre><p>This is equivalent to the following Java code:
                <code class="methodname">exampleBean.setEmail("")</code>. The special
                <code class="literal">&lt;null&gt;</code> element may be used to indicate a
                <code class="literal">null</code> value. For example:</p><pre class="programlisting">&lt;bean class="ExampleBean"&gt;
  &lt;property name="email"&gt;&lt;null/&gt;&lt;/property&gt;
&lt;/bean&gt;</pre><p>The above configuration is equivalent to the following Java code:
                <code class="methodname">exampleBean.setEmail(null)</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xml-config-shortcuts"></a>3.3.3.6.&nbsp;Shortcuts and other convenience options for XML-based configuration metadata</h4></div></div></div><p>
            		The configuration metadata shown so far is a tad verbose. That is why there
            		are several options available for you to limit the amount of XML you have to write to configure your
            		components. The first is a shortcut to define values and references to other beans
            		as part of a <code class="literal">&lt;property/&gt;</code> definition. The second is slightly different format
					of specifying properties alltogether.
            	</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-value-ref-shortcuts"></a>3.3.3.6.1.&nbsp;XML-based configuration metadata shortcuts</h5></div></div></div><p>The <code class="literal">&lt;property/&gt;</code>, <code class="literal">&lt;constructor-arg/&gt;</code>, and
	                <code class="literal">&lt;entry/&gt;</code> elements all support a <code class="literal">'value'</code>
	                attribute which may be used instead of embedding a full <code class="literal">&lt;value/&gt;</code>
	                element. Therefore, the following:</p><pre class="programlisting">&lt;property name="myProperty"&gt;
  &lt;value&gt;hello&lt;/value&gt;
&lt;/property&gt;</pre><pre class="programlisting">&lt;constructor-arg&gt;
  &lt;value&gt;hello&lt;/value&gt;
&lt;/constructor-arg&gt;</pre><pre class="programlisting">&lt;entry key="myKey"&gt;
  &lt;value&gt;hello&lt;/value&gt;
&lt;/entry&gt;</pre><p>are equivalent to:</p><pre class="programlisting">&lt;property name="myProperty" value="hello"/&gt;</pre><pre class="programlisting">&lt;constructor-arg value="hello"/&gt;</pre><pre class="programlisting">&lt;entry key="myKey" value="hello"/&gt;</pre><p>The <code class="literal">&lt;property/&gt;</code> and
	                <code class="literal">&lt;constructor-arg/&gt;</code> elements support a similar
	                shortcut <code class="literal">'ref'</code> attribute which may be used instead
	                of a full nested <code class="literal">&lt;ref/&gt;</code> element. Therefore,
	                the following:</p><pre class="programlisting">&lt;property name="myProperty"&gt;
  &lt;ref bean="myBean"&gt;
&lt;/property&gt;</pre><pre class="programlisting">&lt;constructor-arg&gt;
  &lt;ref bean="myBean"&gt;
&lt;/constructor-arg&gt;</pre><p>... are equivalent to:</p><pre class="programlisting">&lt;property name="myProperty" ref="myBean"/&gt;</pre><pre class="programlisting">&lt;constructor-arg ref="myBean"/&gt;</pre><p>Note however that the shortcut form is equivalent to a
	                <code class="literal">&lt;ref bean="xxx"&gt;</code> element; there is no
	                shortcut for <code class="literal">&lt;ref local="xxx"</code>&gt;. To enforce a
	                strict local reference, you must use the long form.</p><p>Finally, the entry element allows a shortcut form to specify the
	                key and/or value of the map, in the form of the <code class="literal">'key'</code>
	                / <code class="literal">'key-ref'</code> and <code class="literal">'value'</code> /
	                <code class="literal">'value-ref'</code> attributes. Therefore, the following:</p><pre class="programlisting">&lt;entry&gt;
  &lt;key&gt;
    &lt;ref bean="myKeyBean" /&gt;
  &lt;/key&gt;
  &lt;ref bean="myValueBean" /&gt;
&lt;/entry&gt;</pre><p>is equivalent to:</p><pre class="programlisting">&lt;entry key-ref="myKeyBean" value-ref="myValueBean"/&gt;</pre><p>Again, the shortcut form is equivalent to a
	                <code class="literal">&lt;ref bean="xxx"&gt;</code> element; there is no shortcut for
	                <code class="literal">&lt;ref local="xxx"</code>&gt;.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-p-namespace"></a>3.3.3.6.2.&nbsp;The p-namespace and how to use it to configure properties</h5></div></div></div><p>
	            		The second option you have to limit the amount of XML you have to write to configure your components
	            		is to use the special "p-namespace". Spring 2.0 and later features support for extensible configuration
	            		formats <a href="#xsd-config" title="Appendix&nbsp;A.&nbsp;XML Schema-based configuration">using namespaces</a>. Those namespaces are
	            		all based on an XML Schema definition. In fact, the <code class="literal">beans</code> configuration format that you've been
	            		reading about is defined in an XML Schema document.</p><p>
	            		One special namespace is not defined in an XSD file, and only exists in the core of Spring itself. The so-called
	            		p-namespace doesn't need a schema definition and is an alternative way of configuring your properties differently
	            		than the way you have seen so far. Instead of using <span class="bold"><strong>nested</strong></span> <code class="literal">property</code>
	            		elements, using the p-namespace you can use attributes as part of the <code class="literal">bean</code> element that
	            		describe your property values. The values of the attributes will be taken as the values for your properties.
	            	</p><p>
	            		The following two XML snippets boil down to the same thing in the end: the first is using the format
						you're familiar with (the <code class="literal">property</code> elements) whereas the second example is using the p-namespace</p><pre class="programlisting">&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:p="http://www.springframework.org/schema/p"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-2.0.xsd"&gt;
    
    &lt;bean name="classic" class="com.mycompany.ExampleBean"&gt;
        &lt;property name="email" value="foo@bar.com/&gt;
    &lt;/bean&gt;
    
    &lt;bean name="p-namespace" 
        class="com.mycompany.ExampleBean"
        p:email="foo@bar.com"/&gt;
&lt;/beans&gt;</pre><p>
						As you can see, we are including an attribute from the p-namespace called email in the bean definition. This is telling
						Spring that it should include a property declaration. As previously mentioned, the p-namespace doesn't have a schema
						definition, so the name of the attribute can be set to whatever name your property has.
					</p><p>
						This next example includes two more bean definitions that both have a reference to another bean:
					</p><pre class="programlisting">&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:p="http://www.springframework.org/schema/p"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-2.0.xsd"&gt;
    
    &lt;bean name="john-classic" class="com.mycompany.Person"&gt;
        &lt;property name="name" value="John Doe"/&gt;
        &lt;property name="spouse" ref="jane"/&gt;
    &lt;/bean&gt;

    &lt;bean name="john-modern" 
        class="com.mycompany.Person"
        p:name="John Doe"
        p:spouse-ref="jane"/&gt;

    &lt;bean name="jane" class="com.mycompany.Person"&gt;
        &lt;property name="name" value="Jane Doe"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</pre><p>
						As you can see, this example doesn't only include a property value using the p-namespace, but also uses a special
						format to declare property references. Whereas the first bean definition uses <code class="literal">&lt;property name="spouse" ref="jane"/&gt;</code>
						to create a reference from bean john to bean jane, the second bean definition uses
						<code class="literal">p:spouse-ref="jane"</code> as an attribute to do the exact same thing. In this case <span class="bold"><strong>spouse</strong></span>
						is the property name whereas the <code class="literal">-ref</code> part tells Spring this is not a value but a bean reference.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Note that we recommend you to choose carefully which approach you are going to use in your project.
						You should also communicate this to your team members so you won't end up with XML documents using all
						three approaches at the same time. This will prevent people from not understanding
						the application because of different ways of configuring it, and will add to the
						consistency of your codebase. Also note that this functionality is only available as of Spring 2.0.
						</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-compound-property-names"></a>3.3.3.7.&nbsp;Compound property names</h4></div></div></div><p>Compound or nested property names are perfectly legal
                when setting bean properties, as long as all components of the path
                except the final property name are not null. For example, in this bean
                definition:</p><pre class="programlisting">&lt;bean id="foo" class="foo.Bar"&gt;
  &lt;property name="fred.bob.sammy" value="123" /&gt;
&lt;/bean&gt;</pre><p>The <code class="literal">foo</code> bean has a <code class="literal">fred</code> property
                which has a <code class="literal">bob</code> property, which has a 
                <code class="literal">sammy</code> property, and that final <code class="literal">sammy</code>
                property is being set to the value <code class="literal">123</code>. In order
                for this to work, the <code class="literal">fred</code> property of <code class="literal">foo</code>,
                and the <code class="literal">bob</code> property of <code class="literal">fred</code> must both
                be non-null after the bean is constructed, or a
                <code class="exceptionname">NullPointerException</code> will be thrown.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-dependson"></a>3.3.4.&nbsp;Using <code class="literal">depends-on</code></h3></div></div></div><p>For most situations, the fact that a bean is a dependency of another is 
            expressed by the fact that one bean is set as a property of another.
            This is typically accomplished with the <a href="#beans-ref-element" title="3.3.3.2.&nbsp;References to other beans (collaborators)"><code class="literal">&lt;ref/&gt;</code> element</a>
            in XML-based configuration metadata. For the relatively infrequent situations
			where dependencies between beans are less direct (for example, when a static
			initializer in a class needs to be triggered, such as database driver registration),
			the <code class="literal">'depends-on'</code> attribute may be used to explicitly
			force one or more beans to be initialized before the bean using this
			element is initialized. Find below an example of using the
			<code class="literal">'depends-on'</code> attribute to express a dependency on a single bean.</p><pre class="programlisting">&lt;bean id="beanOne" class="ExampleBean" depends-on="<span class="bold"><strong>manager</strong></span>"/&gt;

&lt;bean id="<span class="bold"><strong>manager</strong></span>" class="ManagerBean" /&gt;</pre><p>If you need to express a dependency on multiple beans, you can supply a
            list of bean names as the value of the <code class="literal">'depends-on'</code>
            attribute, with commas, whitespace and semi-colons all valid delimiters, like so:</p><pre class="programlisting">&lt;bean id="beanOne" class="ExampleBean" depends-on="manager,accountDao"&gt;
  &lt;property name="manager" ref="manager" /&gt;
&lt;/bean&gt;

&lt;bean id="manager" class="ManagerBean" /&gt;
&lt;bean id="accountDao" class="x.y.jdbc.JdbcAccountDao" /&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The '<code class="literal">depends-on</code>' attribute and property is used not only to
				specify an initialization time dependency, but also to specify
				the corresponding destroy time dependency (in the case of
				<a href="#beans-factory-scopes-singleton" title="3.4.1.&nbsp;The singleton scope">singleton</a> beans only). Dependant beans that are defined in the
				'<code class="literal">depends-on</code>' attribute will be destroyed
				first prior to the relevant bean itself being destroyed. This thus
				allows you to control shutdown order too.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-lazy-init"></a>3.3.5.&nbsp;Lazily-instantiated beans</h3></div></div></div><p>The default behavior for <code class="interfacename">ApplicationContext</code>
            implementations is to eagerly pre-instantiate all <code class="literal">singleton</code> beans
            at startup. Pre-instantiation means that an <code class="interfacename">ApplicationContext</code>
            will eagerly create and configure all of its <a href="#beans-factory-scopes-singleton" title="3.4.1.&nbsp;The singleton scope">singleton</a>
			beans as part of its initialization process. Generally this is <span class="emphasis"><em>a good thing</em></span>,
            because it means that any errors in the configuration or in the surrounding environment
            will be discovered immediately (as opposed to possibly hours or even days down the line).</p><p>However, there are times when this behavior is <span class="emphasis"><em>not</em></span> what is wanted.
            If you do not want a singleton bean to be pre-instantiated when using
            an <code class="interfacename">ApplicationContext</code>, you can selectively
			control this by marking a bean definition as lazy-initialized. A lazily-initialized
			bean indicates to the IoC container whether or not a bean instance should be
			created at startup or when it is first requested.</p><p>When configuring beans via XML, this lazy loading is controlled by the
            <code class="literal">'lazy-init'</code> attribute on the <code class="literal">&lt;bean/&gt;</code>
            element; for example:</p><pre class="programlisting">&lt;bean id="lazy" class="com.foo.ExpensiveToCreateBean" <span class="bold"><strong>lazy-init="true"</strong></span>/&gt;

&lt;bean name="not.lazy" class="com.foo.AnotherBean"/&gt;</pre><p>When the above configuration is consumed by an
            <code class="interfacename">ApplicationContext</code>, the bean named
            <code class="literal">'lazy'</code> will <span class="emphasis"><em>not</em></span> be eagerly pre-instantiated
            when the <code class="interfacename">ApplicationContext</code> is starting up, whereas
            the <code class="literal">'not.lazy'</code> bean will be eagerly pre-instantiated.</p><p>One thing to understand about lazy-initialization is that even though a bean
            definition may be marked up as being lazy-initialized, if the lazy-initialized bean
            is the dependency of a singleton bean that is not lazy-initialized, when the
            <code class="interfacename">ApplicationContext</code> is eagerly pre-instantiating the
            singleton, it will have to satisfy all of the singletons dependencies,
            one of which will be the lazy-initialized bean! So don't be confused if the IoC
            container creates one of the beans that you have explicitly configured as
            lazy-initialized at startup; all that means is that the lazy-initialized bean
            is being injected into a non-lazy-initialized singleton bean elsewhere.</p><p>It is also possible to control lazy-initialization at the container level by using
            the <code class="literal">'default-lazy-init'</code> attribute on the <code class="literal">&lt;beans/&gt;</code>
            element; for example:</p><pre class="programlisting">&lt;beans default-lazy-init="true"&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- no beans will be pre-instantiated... --&gt;</span></em>
&lt;/beans&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-autowire"></a>3.3.6.&nbsp;Autowiring collaborators</h3></div></div></div><p>The Spring container is able to <span class="emphasis"><em>autowire</em></span>
            relationships between collaborating beans. This means that it is possible to
            automatically let Spring resolve collaborators (other beans) for your
            bean by inspecting the contents of the <code class="interfacename">BeanFactory</code>.
            The autowiring functionality has five modes. Autowiring is specified
            <span class="emphasis"><em>per</em></span> bean and can thus be enabled for some beans,
            while other beans will not be autowired. Using autowiring, it is possible
            to reduce or eliminate the need to specify properties or constructor
            arguments, thus saving a significant amount of typing.
            <sup>[<a name="d0e2886" href="#ftn.d0e2886">2</a>]</sup>
            When using XML-based configuration metadata, the autowire mode for a bean definition
            is specified by using the <code class="literal">autowire</code> attribute of the
            <code class="literal">&lt;bean/&gt;</code> element. The following values are allowed:</p><div class="table"><a name="beans-factory-autowiring-modes-tbl"></a><p class="title"><b>Table&nbsp;3.2.&nbsp;Autowiring modes</b></p><div class="table-contents"><table summary="Autowiring modes" border="1"><colgroup><col><col></colgroup><thead><tr><th>Mode</th><th>Explanation</th></tr></thead><tbody><tr><td>no</td><td>
                                <p>No autowiring at all. Bean references must be defined
                                via a <code class="literal">ref</code> element. This is the default, and
                                changing this is discouraged for larger deployments, since
                                explicitly specifying collaborators gives greater control and
                                clarity. To some extent, it is a form of documentation about
                                the structure of a system.</p>
                            </td></tr><tr><td>byName</td><td>
                                <p>Autowiring by property name. This option will inspect
                                the container and look for a bean named exactly the same as
                                the property which needs to be autowired. For example, if you
                                have a bean definition which is set to autowire by name, and
                                it contains a <span class="emphasis"><em>master</em></span> property (that is,
                                it has a <span class="emphasis"><em>setMaster(..)</em></span> method), Spring
                                will look for a bean definition named <code class="literal">master</code>,
                                and use it to set the property.</p>
                            </td></tr><tr><td>byType</td><td>
                                <p>Allows a property to be autowired if there is exactly
                                one bean of the property type in the container. If there is
                                more than one, a fatal exception is thrown, and this indicates
                                that you may not use <span class="emphasis"><em>byType</em></span> autowiring
                                for that bean. If there are no matching beans, nothing
                                happens; the property is not set. If this is not desirable,
                                setting the <code class="literal">dependency-check="objects"</code>
                                attribute value specifies that an error should be thrown in
                                this case.</p>
                            </td></tr><tr><td>constructor</td><td>
                                <p>This is analogous to <span class="emphasis"><em>byType</em></span>, but
                                applies to constructor arguments. If there isn't exactly one
                                bean of the constructor argument type in the container, a
                                fatal error is raised.</p>
                            </td></tr><tr><td>autodetect</td><td>
                                <p>Chooses <span class="emphasis"><em>constructor</em></span> or
                                <span class="emphasis"><em>byType</em></span> through introspection of the bean
                                class. If a default constructor is found, the
                                <span class="emphasis"><em>byType</em></span> mode will be applied.</p>
                            </td></tr></tbody></table></div></div><br class="table-break"><p>Note that explicit dependencies in <code class="literal">property</code> and
            <code class="literal">constructor-arg</code> settings <code class="interfacename">always</code>
            override autowiring. Please also note that it is not currently possible to autowire
            so-called <span class="emphasis"><em>simple</em></span> properties such as primitives,
            <code class="classname">Strings</code>, and <code class="classname">Classes</code> (and arrays of such
            simple properties).(This is by-design and should be considered a <span class="emphasis"><em>feature</em></span>.)
            Autowire behavior can be combined with dependency checking, which will
            be performed after all autowiring has been completed.</p><p>It is important to understand the various advantages and disadvantages of autowiring.
            Some advantages of autowiring include:</p><div class="itemizedlist"><ul type="disc"><li><p>Autowiring can significantly reduce the volume of configuration
                    required. However, mechanisms such as the use of a bean template
                    (<a href="#beans-child-bean-definitions" title="3.6.&nbsp;Bean definition inheritance">discussed elsewhere in this chapter</a>)
                    are also valuable in this regard.</p></li><li><p>Autowiring can cause configuration to keep itself up to date
                    as your objects evolve. For example, if you need to add an additional
                    dependency to a class, that dependency can be satisfied
                    automatically without the need to modify configuration. Thus there
                    may be a strong case for autowiring during development, without
                    ruling out the option of switching to explicit wiring when the code
                    base becomes more stable.</p></li></ul></div><p>Some disadvantages of autowiring:</p><div class="itemizedlist"><ul type="disc"><li><p>Autowiring is more magical than explicit wiring. Although,
                    as noted in the above table, Spring is careful to avoid guessing
                    in case of ambiguity which might have unexpected results, the
                    relationships between your Spring-managed objects are no longer
                    documented explicitly.</p></li><li><p>Wiring information may not be available to tools that may
                    generate documentation from a Spring container.</p></li><li><p>Autowiring by type will only work when there is a single bean
                    definition of the type specified by the setter method or constructor
                    argument. You need to use explicit wiring if there is any potential
                    ambiguity.</p></li></ul></div><p>There is no wrong or right answer in all cases. A degree of
            consistency across a project is best though; for example, if autowiring is
            not used in general, it might be confusing to developers to use it just
            to wire one or two bean definitions.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-autowire-candidate"></a>3.3.6.1.&nbsp;Excluding a bean from being available for autowiring</h4></div></div></div><p>You can also (on a per-bean basis) totally exclude a bean from being an
                autowire candidate. When configuring beans using Spring's XML format, the
                <code class="literal">'autowire-candidate'</code> attribute of the
                <code class="literal">&lt;bean/&gt;</code> element can be set to
                <code class="literal">'false'</code>; this has the effect of making the container
                totally exclude that specific bean definition from being available
                to the autowiring infrastructure.</p><p>This can be useful when you have a bean that you absolutely never ever
                want to have injected into other beans via autowiring. It does not
                mean that the excluded bean cannot itself be configured using autowiring...
                it can, it is rather that it itself will not be considered as a candidate
                for autowiring other beans.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-dependencies"></a>3.3.7.&nbsp;Checking for dependencies</h3></div></div></div><p>The Spring IoC container also has the ability to check for the
			existence of unresolved dependencies of a bean deployed into the container.
			These are JavaBeans properties of the bean, which do not have actual values
			set for them in the bean definition, or alternately provided
			automatically by the autowiring feature.</p><p>This feature is sometimes useful when you want to ensure that all
			properties (or all properties of a certain type) are set on a bean. Of
			course, in many cases a bean class will have default values for many
			properties, or some properties do not apply to all usage scenarios, so
			this feature is of limited use. Dependency checking can also be enabled
			and disabled per bean, just as with the autowiring functionality. The
			default is to <span class="emphasis"><em>not</em></span> check dependencies. Dependency
			checking can be handled in several different modes. When using
			XML-based configuration metadata, this is specified via the
			<code class="literal">'dependency-check'</code> attribute in a bean definition,
			which may have the following values.</p><div class="table"><a name="beans-factory-dependency-check-modes-tbl"></a><p class="title"><b>Table&nbsp;3.3.&nbsp;Dependency checking modes</b></p><div class="table-contents"><table summary="Dependency checking modes" border="1"><colgroup><col><col></colgroup><thead><tr><th>Mode</th><th>Explanation</th></tr></thead><tbody><tr><td>none</td><td>
                                <p>No dependency checking. Properties of the bean which
                                have no value specified for them are simply not set.</p>
                            </td></tr><tr><td>simple</td><td>
                                <p>Dependency checking is performed for primitive types
                                and collections (everything except collaborators).</p>
                            </td></tr><tr><td>object</td><td>
                                <p>Dependency checking is performed for collaborators only.</p>
                            </td></tr><tr><td>all</td><td>
                                <p>Dependency checking is done for collaborators, primitive types
                                and collections.</p>
                            </td></tr></tbody></table></div></div><br class="table-break"><p>If you are using Java 5 and thus have access to source-level annotations,
			you may find the section entitled <a href="#metadata-annotations-required" title="25.3.1.&nbsp;@Required">Section&nbsp;25.3.1, &#8220;@<code class="interfacename">Required</code>&#8221;</a>
			to be of interest.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-method-injection"></a>3.3.8.&nbsp;Method Injection</h3></div></div></div><p>For most application scenarios, the majority of the beans in the
            container will be <a href="#beans-factory-scopes-singleton" title="3.4.1.&nbsp;The singleton scope">singletons</a>.
			When a singleton bean needs to collaborate with another singleton bean, or a
			non-singleton bean needs to collaborate with another non-singleton bean, the
			typical and common approach of handling this dependency by defining one bean
			to be a property of the other is quite adequate. There is a problem when the bean
            lifecycles are different. Consider a singleton bean A which needs to use
            a non-singleton (prototype) bean B, perhaps on each method invocation on
            A. The container will only create the singleton bean A once, and thus
            only get the opportunity to set the properties once. There is no
            opportunity for the container to provide bean A with a new instance of
            bean B every time one is needed.</p><p>One solution to this issue is to forgo some inversion of
            control. Bean A can be
            <a href="#beans-factory-aware-beanfactoryaware" title="3.5.2.1.&nbsp;&#xA;                    BeanFactoryAware&#xA;                ">made aware of the container</a>
            by implementing the <code class="interfacename">BeanFactoryAware</code> interface, and
            <a href="#beans-factory-client" title="3.2.4.&nbsp;Using the container">use programmatic means</a> to
            ask the container via a <code class="methodname">getBean("B")</code> call for
            (a typically new) bean B instance every time it needs it. Find below an
            admittedly somewhat contrived example of this approach:</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// a class that uses a stateful Command-style class to perform some processing</span></em>
package fiona.apple;

<em class="lineannotation"><span class="lineannotation">// lots of Spring-API imports</span></em>
import org.springframework.beans.BeansException;
import org.springframework.beans.factory.BeanFactory;
import org.springframework.beans.factory.BeanFactoryAware;

public class CommandManager implements BeanFactoryAware {

   private BeanFactory beanFactory;

   public Object process(Map commandState) {
      <em class="lineannotation"><span class="lineannotation">// grab a new instance of the appropriate <code class="interfacename">Command</code></span></em>
      Command command = createCommand();
      <em class="lineannotation"><span class="lineannotation">// set the state on the (hopefully brand new) <code class="interfacename">Command</code> instance</span></em>
      command.setState(commandState);
      return command.execute();
   }

   <em class="lineannotation"><span class="lineannotation">// the <code class="interfacename">Command</code> returned here could be an implementation that executes asynchronously, or whatever</span></em>
   protected Command createCommand() {
      return (Command) this.beanFactory.getBean("command"); <em class="lineannotation"><span class="lineannotation">// notice the Spring API dependency</span></em>
   }

   public void setBeanFactory(BeanFactory beanFactory) throws BeansException {
      this.beanFactory = beanFactory;
   }
}</pre><p>The above example is generally not a desirable solution since the
            business code is then aware of and coupled to the Spring Framework. Method Injection,
            a somewhat advanced feature of the Spring IoC container, allows this use case to be
            handled in a clean fashion.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lookup-method-injection"></a>3.3.8.1.&nbsp;Lookup method injection</h4></div></div></div><div class="sidebar"><p class="title"><b>Isn't this Method Injection...</b></p><p>... somewhat like Tapestry 4.0's pages, where folks wrote
                    <code class="literal">abstract</code> properties that Tapestry would override at
                    runtime with implementations that did stuff? It sure is (well, kinda).</p><p>You can read more about the motivation for Method Injection in
                    <a href="http://blog.springframework.com/rod/?p=1" target="_top">this blog entry</a>.</p></div><p>Lookup method injection refers to the ability of the container
                to override methods on <span class="emphasis"><em>container managed beans</em></span>, to
                return the result of looking up another named bean in the container.
                The lookup will typically be of a prototype bean as in the scenario
                described above. The Spring Framework implements this method injection
				by dynamically generating a subclass overriding the method, using bytecode
				generation via the CGLIB library.</p><p>So if you look at the code from previous code snippet (the
                <code class="classname">CommandManager</code> class), the Spring container
                is going to dynamically override the implementation of the
                <code class="methodname">createCommand()</code> method. Your
                <code class="classname">CommandManager</code> class is not going to have any
                Spring dependencies, as can be seen in this reworked example below:</p><pre class="programlisting">package fiona.apple;

<em class="lineannotation"><span class="lineannotation">// no more Spring imports! </span></em>

public abstract class CommandManager {

   public Object process(Object commandState) {
      <em class="lineannotation"><span class="lineannotation">// grab a new instance of the appropriate <code class="interfacename">Command</code> interface</span></em>
      Command command = createCommand();
      <em class="lineannotation"><span class="lineannotation">// set the state on the (hopefully brand new) <code class="interfacename">Command</code> instance</span></em>
      command.setState(commandState);
      return command.execute();
   }

    <em class="lineannotation"><span class="lineannotation">// okay... but where is the implementation of this method?</span></em>
   protected abstract Command createCommand();
}</pre><p>In the client class containing the method to be injected (the
                <code class="classname">CommandManager</code> in this case), the method that
                is to be 'injected' must have a signature of the following form:</p><pre class="programlisting">&lt;public|protected&gt; [abstract] &lt;return-type&gt; theMethodName(<em class="lineannotation"><span class="lineannotation">no-arguments</span></em>);</pre><p>If the method is <code class="literal">abstract</code>, the dynamically-generated
                subclass will implement the method. Otherwise, the dynamically-generated subclass
                will override the concrete method defined in the original class. Let's look at an
                example:</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- a stateful bean deployed as a prototype (non-singleton) --&gt;</span></em>
&lt;bean id="command" class="fiona.apple.AsyncCommand" scope="prototype"&gt;
  <em class="lineannotation"><span class="lineannotation">&lt;!-- inject dependencies here as required --&gt;</span></em>
&lt;/bean&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- <code class="literal">commandProcessor</code> uses <code class="literal">statefulCommandHelper</code> --&gt;</span></em>
&lt;bean id="commandManager" class="fiona.apple.CommandManager"&gt;
  &lt;lookup-method name="createCommand" bean="command"/&gt;
&lt;/bean&gt;</pre><p>The bean identified as <span class="emphasis"><em>commandManager</em></span> will call its
                own method <code class="methodname">createCommand()</code> whenever it needs
                a new instance of the <span class="emphasis"><em>command</em></span> bean. It
                is important to note that the person deploying the beans must be
                careful to deploy the <code class="literal">command</code> bean as a
                prototype (if that is actually what is needed). If it is deployed
                as a <a href="#beans-factory-scopes-singleton" title="3.4.1.&nbsp;The singleton scope">singleton</a>, the same instance of
                the <code class="literal">command</code> bean will be returned each time!</p><p>Please be aware that in order for this dynamic subclassing to work,
                you will need to have the CGLIB jar(s) on your classpath. Additionally, the
                class that the Spring container is going to subclass cannot be
                <code class="literal">final</code>, and the method that is being overridden cannot be
                <code class="literal">final</code> either. Also, testing a class that has an
                <code class="literal">abstract</code> method can be somewhat odd in that you will have
                to subclass the class yourself and supply a stub implementation of the
                <code class="literal">abstract</code> method. Finally, objects that have been the target
                of method injection cannot be serialized.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The interested reader may also find the <code class="classname">ServiceLocatorFactoryBean</code>
                    (in the <code class="literal">org.springframework.beans.factory.config</code> package) to be
                    of use; the approach is similar to that of the
                    <code class="classname">ObjectFactoryCreatingFactoryBean</code>, but it allows you
                    to specify your own lookup interface as opposed to having to use a Spring-specific
                    lookup interface such as the <code class="interfacename">ObjectFactory</code>.
                    Consult the (copious) Javadocs for the <code class="classname">ServiceLocatorFactoryBean</code>
                    for a full treatment of this alternative approach (that <span class="emphasis"><em>does</em></span>
                    reduce the coupling to Spring).</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-arbitrary-method-replacement"></a>3.3.8.2.&nbsp;Arbitrary method replacement</h4></div></div></div><p>A less commonly useful form of method injection than Lookup
                Method Injection is the ability to replace arbitrary methods in a
                managed bean with another method implementation. Users may safely skip
                the rest of this section (which describes this somewhat advanced
                feature), until this functionality is actually needed.</p><p>When using XML-based configuration metadata, the <code class="literal">replaced-method</code>
                element may be used to replace an existing method implementation with
                another, for a deployed bean. Consider the following class, with a
                method computeValue, which we want to override:</p><pre class="programlisting">public class MyValueCalculator {

  public String computeValue(String input) {
    <em class="lineannotation"><span class="lineannotation">// some real code...</span></em>
  }

  <em class="lineannotation"><span class="lineannotation">// some other methods...</span></em>

}</pre><p>A class implementing the
                <code class="interfacename">org.springframework.beans.factory.support.MethodReplacer</code>
                interface provides the new method definition.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">/** meant to be used to override the existing <code class="methodname">computeValue(String)</code>
    implementation in <code class="classname">MyValueCalculator</code>
  */</span></em>
public class ReplacementComputeValue implements MethodReplacer {

    public Object reimplement(Object o, Method m, Object[] args) throws Throwable {
        <em class="lineannotation"><span class="lineannotation">// get the input value, work with it, and return a computed result</span></em>
        String input = (String) args[0];
        ... 
        return ...;
    }
}</pre><p>The bean definition to deploy the original class and specify the
                method override would look like this:</p><pre class="programlisting">&lt;bean id="myValueCalculator class="x.y.z.MyValueCalculator"&gt;
  <em class="lineannotation"><span class="lineannotation">&lt;!-- arbitrary method replacement --&gt;</span></em>
  &lt;replaced-method name="computeValue" replacer="replacementComputeValue"&gt;
    &lt;arg-type&gt;String&lt;/arg-type&gt;
  &lt;/replaced-method&gt;
&lt;/bean&gt;

&lt;bean id="replacementComputeValue" class="a.b.c.ReplacementComputeValue"/&gt;</pre><p>One or more contained <code class="literal">&lt;arg-type/&gt;</code> elements
                within the <code class="literal">&lt;replaced-method/&gt;</code> element may be used to
                indicate the method signature of the method being overridden. Note
                that the signature for the arguments is actually only needed in the
                case that the method is actually overloaded and there are multiple
                variants within the class. For convenience, the type string for an
                argument may be a substring of the fully qualified type name. For
                example, all the following would match <code class="classname">java.lang.String</code>.</p><pre class="programlisting">    java.lang.String
    String
    Str</pre><p>Since the number of arguments is often enough to distinguish between
                each possible choice, this shortcut can save a lot of typing, by allowing
                you to type just the shortest string that will match an argument type.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-factory-scopes"></a>3.4.&nbsp;Bean scopes</h2></div></div></div><p>When you create a bean definition what you are actually creating is a
		<span class="emphasis"><em>recipe</em></span> for creating actual instances of the class
		defined by that bean definition. The idea that a bean definition is a recipe
		is important, because it means that, just like a class, you can potentially
		have many object instances created from a single recipe.</p><p>You can control not only the various dependencies and
        configuration values that are to be plugged into an object that is created
        from a particular bean definition, but also the <em class="firstterm">scope</em>
        of the objects created from a particular bean definition. This approach is very
        powerful and gives you the flexibility to <span class="emphasis"><em>choose</em></span> the scope
        of the objects you create through configuration instead of having to 'bake in' 
        the scope of an object at the Java class level. Beans can be defined to be 
        deployed in one of a number of scopes: out of the box, the Spring Framework
		supports exactly five scopes (of which three are available only if you are using
		a web-aware <code class="interfacename">ApplicationContext</code>).</p><p>The scopes supported out of the box are listed below:</p><div class="table"><a name="beans-factory-scopes-tbl"></a><p class="title"><b>Table&nbsp;3.4.&nbsp;Bean scopes</b></p><div class="table-contents"><table summary="Bean scopes" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Scope</th><th align="center">Description</th></tr></thead><tbody><tr><td>
							<p><a href="#beans-factory-scopes-singleton" title="3.4.1.&nbsp;The singleton scope">singleton</a></p>
						</td><td>
							<p>Scopes a single bean definition to a single object instance per Spring IoC container.</p>
						</td></tr><tr><td>
							<p><a href="#beans-factory-scopes-prototype" title="3.4.2.&nbsp;The prototype scope">prototype</a></p>
						</td><td>
							<p>Scopes a single bean definition to any number of object instances.</p>
						</td></tr><tr><td>
							<p><a href="#beans-factory-scopes-request" title="3.4.4.2.&nbsp;The request scope">request</a></p>
						</td><td>
							<p>Scopes a single bean definition to the lifecycle of
							a single HTTP request; that is each and every HTTP request will
							have its own instance of a bean created off the back of a
							single bean definition. Only valid in the context of a
							web-aware Spring <code class="interfacename">ApplicationContext</code>.</p>
						</td></tr><tr><td>
							<p><a href="#beans-factory-scopes-global-session" title="3.4.4.4.&nbsp;The global session scope">session</a></p>
						</td><td>
							<p>Scopes a single bean definition to the lifecycle of
							a HTTP <code class="interfacename">Session</code>. Only valid in
							the context of a web-aware Spring
							<code class="interfacename">ApplicationContext</code>.</p>
						</td></tr><tr><td>
							<p><a href="#beans-factory-scopes-global-session" title="3.4.4.4.&nbsp;The global session scope">global session</a></p>
						</td><td>
							<p>Scopes a single bean definition to the lifecycle of a
							global HTTP <code class="interfacename">Session</code>. Typically
							only valid when used in a portlet context. Only valid in the
							context of a web-aware Spring
							<code class="interfacename">ApplicationContext</code>.</p>
						</td></tr></tbody></table></div></div><br class="table-break"><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-singleton"></a>3.4.1.&nbsp;The singleton scope</h3></div></div></div><p>When a bean is a singleton, only one <span class="emphasis"><em>shared</em></span>
		    instance of the bean will be managed, and all requests for beans with
		    an id or ids matching that bean definition will result in that one
		    specific bean instance being returned by the Spring container.</p><p>To put it another way, when you define a bean definition and it
		    is scoped as a singleton, then the Spring IoC container will create
		    <span class="emphasis"><em>exactly one</em></span> instance of the object defined by
		    that bean definition. This single instance will be
		    stored in a cache of such singleton beans, and <span class="emphasis"><em>all subsequent
			requests and references</em></span> for that named bean will result in
			the cached object being returned.</p><p>
			    </p><div class="mediaobject" align="center"><img src="images/singleton.png" align="middle"></div><p>
		    </p><p>Please be aware that Spring's concept of a singleton bean is quite
			different from the Singleton pattern as defined in the seminal Gang of
			Four (GoF) patterns book. The GoF Singleton hardcodes the scope of
			an object such that one <span class="emphasis"><em>and only one</em></span> instance of a
			particular class will ever be created<span class="emphasis"><em> per
			<code class="classname">ClassLoader</code></em></span>. The scope of the Spring singleton
			is best described as <span class="emphasis"><em>per container and per bean</em></span>.
			This means that if you define one bean for a particular class in a single
			Spring container, then the Spring container will create one
			<span class="emphasis"><em>and only one</em></span> instance of the class defined by that
			bean definition. <span class="emphasis"><em>The singleton scope is the default scope in Spring</em></span>.
		    To define a bean as a singleton in XML, you would write configuration like so:</p><pre class="programlisting">&lt;bean id="accountService" class="com.foo.DefaultAccountService"/&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- the following is equivalent, though redundant (singleton scope is the default); using <code class="literal">spring-beans-2.0.dtd</code> --&gt;</span></em>
&lt;bean id="accountService" class="com.foo.DefaultAccountService" scope="singleton"/&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- the following is equivalent and preserved for backward compatibility in <code class="literal">spring-beans.dtd</code> --&gt;</span></em>
&lt;bean id="accountService" class="com.foo.DefaultAccountService" singleton="true"/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-prototype"></a>3.4.2.&nbsp;The prototype scope</h3></div></div></div><p>The non-singleton, prototype scope of bean deployment results in
			the <span class="emphasis"><em>creation of a new bean instance</em></span> every time a
			request for that specific bean is made (that is, it is injected into another
			bean or it is requested via a programmatic <code class="literal">getBean()</code>
			method call on the container). As a rule of thumb, you should
            use the prototype scope for all beans that are stateful, while the
            singleton scope should be used for stateless beans.</p><p>The following diagram illustrates the Spring prototype scope.
		    <span class="emphasis"><em>Please note that a DAO would not typically be configured as a
		    prototype, since a typical DAO would not hold any conversational state;
		    it was just easier for this author to reuse the core of the singleton
		    diagram.</em></span></p><p>
			    </p><div class="mediaobject" align="center"><img src="images/prototype.png" align="middle"></div><p>
		    </p><p>To define a bean as a prototype in XML, you would write configuration like so:</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- using <code class="literal">spring-beans-2.0.dtd</code> --&gt;</span></em>
&lt;bean id="accountService" class="com.foo.DefaultAccountService" scope="prototype"/&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- the following is equivalent and preserved for backward compatibility in <code class="literal">spring-beans.dtd</code> --&gt;</span></em>
&lt;bean id="accountService" class="com.foo.DefaultAccountService" singleton="false"/&gt;</pre><p>There is one quite important thing to be aware of when deploying a bean
			in the prototype scope, in that the lifecycle of the bean changes slightly.
			Spring does not manage the complete lifecycle of a prototype bean: the
			container instantiates, configures, decorates and otherwise assembles a
			prototype object, hands it to the client and then has no further knowledge
			of that prototype instance. This means that while <span class="emphasis"><em>initialization</em></span>
			lifecycle callback methods will be called on all objects regardless of scope,
			in the case of prototypes, any configured <span class="emphasis"><em>destruction</em></span>
			lifecycle callbacks will <span class="emphasis"><em>not</em></span> be called. It is the
			responsibility of the client code to clean up
			prototype scoped objects and release any expensive resources that the prototype
			bean(s) are holding onto. (One possible way to get the Spring container
			to release resources used by prototype-scoped beans is through the use
			of a custom <a href="#beans-factory-extension-bpp" title="3.7.1.&nbsp;Customizing beans using BeanPostProcessors">bean post-processor</a>
			which would hold a reference to the beans that need to be cleaned up.)</p><p>In some respects, you can think of the Spring containers role when talking
			about a prototype-scoped bean as somewhat of a replacement for the Java
			<code class="literal">'new'</code> operator. All lifecycle aspects past that point
			have to be handled by the client. (The lifecycle of a bean in the Spring
			container is further described in the section entitled
			<a href="#beans-factory-lifecycle" title="3.5.1.&nbsp;Lifecycle interfaces">Section&nbsp;3.5.1, &#8220;Lifecycle interfaces&#8221;</a>.)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-sing-prot-interaction"></a>3.4.3.&nbsp;Singleton beans with prototype-bean dependencies</h3></div></div></div><p>When using singleton-scoped beans that have dependencies on
			beans that are scoped as prototypes, please be aware that
			<span class="emphasis"><em>dependencies are resolved at instantiation time</em></span>.
			This means that if you dependency inject a prototype-scoped
			bean into a singleton-scoped bean, a brand new prototype bean
			will be instantiated and then dependency injected into the singleton
			bean... <span class="emphasis"><em>but that is all</em></span>. That exact same
			prototype instance will be the sole instance that is ever supplied
			to the singleton-scoped bean, which is fine if that is what you want.</p><p>However, sometimes what you actually want is for the
			singleton-scoped bean to be able to acquire a brand new instance of
			the prototype-scoped bean again and again and again at runtime.
			In that case it is no use just dependency injecting a prototype-scoped
			bean into your singleton bean, because as explained above, that
			only happens <span class="emphasis"><em>once</em></span> when the Spring container
			is instantiating the singleton bean and resolving and injecting
			its dependencies. If you are in the scenario where you need to get
			a brand new instance of a (prototype) bean again and again and again
			at runtime, you are referred to the section entitled
			<a href="#beans-factory-method-injection" title="3.3.8.&nbsp;Method Injection">Section&nbsp;3.3.8, &#8220;Method Injection&#8221;</a></p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Backwards compatibility note: specifying the lifecycle scope in XML"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Backwards compatibility note: specifying the lifecycle scope in XML</th></tr><tr><td align="left" valign="top"><p>If you are referencing the <code class="filename">'spring-beans.dtd'</code> DTD in
            a bean definition file(s), and you are being explicit about the lifecycle scope
            of your beans you must use the "<code class="literal">singleton</code>" attribute to
            express the lifecycle scope (remembering that the
            <a href="#beans-factory-scopes-singleton" title="3.4.1.&nbsp;The singleton scope">singleton lifecycle scope</a> is
            the default). If you are referencing the <code class="filename">'spring-beans-2.0.dtd'</code>
            DTD or the Spring 2.0 XSD schema, then you will need to use the "<code class="literal">scope</code>"
            attribute (because the "<code class="literal">singleton</code>" attribute was removed from the
            definition of the new DTD and XSD files in favour of the "<code class="literal">scope</code>"
            attribute).</p><p>To be totally clear about this, this means that if you use the
            "<code class="literal">singleton</code>" attribute in an XML bean definition then you
            <span class="emphasis"><em>must</em></span> be referencing the <code class="filename">'spring-beans.dtd'</code>
            DTD <span class="emphasis"><em>in that file</em></span>. If you are using the "<code class="literal">scope</code>"
            attribute then you <span class="emphasis"><em>must</em></span> be referencing either the
            <code class="filename">'spring-beans-2.0.dtd'</code> DTD or the
            <code class="filename">'spring-beans-2.0.xsd'</code> XSD <span class="emphasis"><em>in that file</em></span>.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-other"></a>3.4.4.&nbsp;The other scopes</h3></div></div></div><p>The other scopes, namely <code class="literal">request</code>, <code class="literal">session</code>,
			and <code class="literal">global session</code> are for use only in web-based applications
			(and can be used irrespective of which particular web application framework you are
			using, if indeed any). In the interest of keeping related concepts together in
			one place in the reference documentation, these scopes are described here.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The scopes that are described in the following paragraphs are
			    <span class="emphasis"><em>only</em></span> available if you are using a web-aware
			    Spring <code class="interfacename">ApplicationContext</code> implementation
			    (such as <code class="classname">XmlWebApplicationContext</code>).
			    If you try using these next scopes with regular Spring IoC containers such as
			    the <code class="classname">XmlBeanFactory</code> or
			    <code class="classname">ClassPathXmlApplicationContext</code>, you <span class="emphasis"><em>will</em></span>
			    get an <code class="classname">IllegalStateException</code> complaining about
			    an unknown bean scope.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-other-web-configuration"></a>3.4.4.1.&nbsp;Initial web configuration</h4></div></div></div><p>In order to support the scoping of beans at the <code class="literal">request</code>,
                <code class="literal">session</code>, and <code class="literal">global session</code> levels
                (web-scoped beans), some minor initial configuration is required
                before you can set about defining your bean definitions. Please note that
                this extra setup is <span class="emphasis"><em>not</em></span> required if you just want to
                use the 'standard' scopes (namely singleton and prototype).</p><p>Now as things stand, there are a couple of ways to effect this
                initial setup depending on your particular Servlet environment...</p><p>If you are accessing scoped beans within Spring Web MVC, i.e.
                within a request that is processed by the Spring <code class="classname">DispatcherServlet</code>,
                or <code class="classname">DispatcherPortlet</code>, then no special setup is necessary:
                <code class="classname">DispatcherServlet</code> and <code class="classname">DispatcherPortlet</code>
                already expose all relevant state.</p><p>When using a Servlet 2.4+ web container, with requests processed
                outside of Spring's DispatcherServlet (e.g. when using JSF or Struts),
                you need to add the following <code class="interfacename">javax.servlet.ServletRequestListener</code>
                to the declarations in your web application's <code class="literal">'web.xml'</code> file.</p><pre class="programlisting">&lt;web-app&gt;
  ...
  &lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.context.request.RequestContextListener&lt;/listener-class&gt;
  &lt;/listener&gt;
  ...
&lt;/web-app&gt;</pre><p>If you are using an older web container (Servlet 2.3), you will need to use
                the provided <code class="interfacename">javax.servlet.Filter</code> implementation.
                Find below a snippet of XML configuration that has to be included
                in the <code class="literal">'web.xml'</code> file of your web application if you
                want to have access to web-scoped beans in requests outside of Spring's
                DispatcherServlet on a Servlet 2.3 container. (The filter mapping depends on
                the surrounding web application configuration and so you will have to change
                it as appropriate.)</p><pre class="programlisting">&lt;web-app&gt;
  ..
  &lt;filter&gt; 
    &lt;filter-name&gt;requestContextFilter&lt;/filter-name&gt; 
    &lt;filter-class&gt;org.springframework.web.filter.RequestContextFilter&lt;/filter-class&gt;
  &lt;/filter&gt; 
  &lt;filter-mapping&gt; 
    &lt;filter-name&gt;requestContextFilter&lt;/filter-name&gt; 
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
  ...
&lt;/web-app&gt;</pre><p>That's it. <code class="classname">DispatcherServlet</code>,
                <code class="classname">RequestContextListener</code> and
                <code class="classname">RequestContextFilter</code> all do exactly the
                same thing, namely bind the HTTP request object to the
                <code class="classname">Thread</code> that is servicing that request. This makes
                beans that are request- and session-scoped available further down the
                call chain.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-request"></a>3.4.4.2.&nbsp;The request scope</h4></div></div></div><p>Consider the following bean definition:</p><pre class="programlisting">&lt;bean id="loginAction" class="com.foo.LoginAction" scope="request"/&gt;</pre><p>With the above bean definition in place, the Spring container will create
                a brand new instance of the <code class="classname">LoginAction</code> bean
                using the <code class="literal">'loginAction'</code> bean definition for each and
                every HTTP request. That is, the <code class="literal">'loginAction'</code> bean will be
                effectively scoped at the HTTP request level. You can change or dirty
                the internal state of the instance that is created as much as you want,
                safe in the knowledge that other requests that are also using instances created
                off the back of the same <code class="literal">'loginAction'</code> bean definition
                will not be seeing these changes in state since they are particular to an individual
                request. When the request is finished processing, the bean that is scoped
                to the request will be discarded.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-session"></a>3.4.4.3.&nbsp;The session scope</h4></div></div></div><p>Consider the following bean definition:</p><pre class="programlisting">&lt;bean id="userPreferences" class="com.foo.UserPreferences" scope="session"/&gt;</pre><p>With the above bean definition in place, the Spring container will create
                a brand new instance of the <code class="classname">UserPreferences</code> bean
                using the <code class="literal">'userPreferences'</code> bean definition for the
                lifetime of a single HTTP <code class="interfacename">Session</code>.
                In other words, the <code class="literal">'userPreferences'</code> bean will be
                effectively scoped at the HTTP <code class="interfacename">Session</code> level.
                Just like <code class="literal">request-scoped</code> beans, you can change the internal
                state of the instance that is created as much as you want, safe in the
                knowledge that other HTTP <code class="interfacename">Session</code> instances
                that are also using instances created off the back of the same
                <code class="literal">'userPreferences'</code> bean definition
                will not be seeing these changes in state since they are particular to an individual
                HTTP <code class="interfacename">Session</code>. When the HTTP
                <code class="interfacename">Session</code> is eventually discarded, the bean
                that is scoped to that particular HTTP <code class="interfacename">Session</code>
                will also be discarded.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-global-session"></a>3.4.4.4.&nbsp;The global session scope</h4></div></div></div><p>Consider the following bean definition:</p><pre class="programlisting">&lt;bean id="userPreferences" class="com.foo.UserPreferences" scope="globalSession"/&gt;</pre><p>The <code class="literal">global session</code> scope is similar to the
                standard HTTP <code class="interfacename">Session</code> scope
                (<a href="#beans-factory-scopes-session" title="3.4.4.3.&nbsp;The session scope">described immediately above</a>),
                and really only makes sense in the context of portlet-based web applications.
                The portlet specification defines the notion of a global
                <code class="interfacename">Session</code> that is shared amongst all
                of the various portlets that make up a single portlet web application.
                Beans defined at the <code class="literal">global session</code> scope are scoped
                (or bound) to the lifetime of the global portlet
                <code class="interfacename">Session</code>.</p><p>Please note that if you are writing a standard Servlet-based
                web application and you define one or more beans as having
                <code class="literal">global session</code> scope, the standard HTTP
                <code class="interfacename">Session</code> scope will be used, and no
                error will be raised.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-other-injection"></a>3.4.4.5.&nbsp;Scoped beans as dependencies</h4></div></div></div><p>Being able to define a bean scoped to a HTTP request or
			    <code class="interfacename">Session</code> (or indeed
			    <a href="#beans-factory-scopes-custom" title="3.4.5.&nbsp;Custom scopes">a custom scope</a>  of
			    your own devising) is all very well, but one of the
			    main value-adds of the Spring IoC container is that it manages
                not only the instantiation of your objects (beans), but also
			    the wiring up of collaborators (or dependencies). If you want to inject
			    a (for example) HTTP request scoped bean into another bean, you will need
				to inject an AOP proxy in place of the scoped bean. That is, you need to
				inject a proxy object that exposes the same public interface as the scoped
				object, but that is smart enough to be able to retrieve the real, target
				object from the relevant scope (for example a HTTP request) and delegate
			    method calls onto the real object.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You <span class="emphasis"><em>do not</em></span> need to use the
			        <code class="literal">&lt;aop:scoped-proxy/&gt;</code> in conjunction with
			        beans that are scoped as <code class="literal">singletons</code> or
			        <code class="literal">prototypes</code>. It is an error to try to create a
			        scoped proxy for a singleton bean (and the resulting
			        <code class="exceptionname">BeanCreationException</code> will certainly set
			        you straight in this regard).</p></td></tr></table></div><p>Let's look at the configuration that is required to effect this;
                the configuration is not hugely complex (it takes just one line), but it
                is important to understand the &#8220;<span class="quote">why</span>&#8221; as well as the
                &#8220;<span class="quote">how</span>&#8221; behind it.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- a HTTP <code class="interfacename">Session</code>-scoped bean exposed as a proxy --&gt;</span></em>
    &lt;bean id="userPreferences" class="com.foo.UserPreferences" <span class="bold"><strong>scope="session"</strong></span>&gt;
          
          <em class="lineannotation"><span class="lineannotation">&lt;!-- this next element effects the proxying of the surrounding bean --&gt;</span></em>
          <span class="bold"><strong>&lt;aop:scoped-proxy/&gt;</strong></span>
    &lt;/bean&gt;
    
    <em class="lineannotation"><span class="lineannotation">&lt;!-- a singleton-scoped bean <span class="bold"><strong>injected with a proxy to the above bean</strong></span> --&gt;</span></em>
    &lt;bean id="userService" class="com.foo.SimpleUserService"&gt;
    
        <em class="lineannotation"><span class="lineannotation">&lt;!-- a reference to the <span class="bold"><strong>proxied</strong></span> <code class="literal">'userPreferences'</code> bean --&gt;</span></em>
        &lt;property name="userPreferences" ref="userPreferences"/&gt;

    &lt;/bean&gt;
&lt;/beans&gt;
</pre><p>To create such a proxy, you need only to insert a child
				<code class="literal">&lt;aop:scoped-proxy/&gt;</code> element into a scoped bean definition
				(you may also need the CGLIB library on your classpath so that the container can
				effect class-based proxying; you will also need to be using <a href="#xsd-config" title="Appendix&nbsp;A.&nbsp;XML Schema-based configuration">Appendix&nbsp;A, <i>XML Schema-based configuration</i></a>).
				So, just why do you need this <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element in the
                definition of beans scoped at the <code class="literal">request</code>,
                <code class="literal">session</code>, <code class="literal">globalSession</code> and
				'<span class="emphasis"><em>insert your custom scope here</em></span>' level? The reason is best explained
				by picking apart the following bean definition (please note that the following
				<code class="literal">'userPreferences'</code> bean definition as it stands is
				<span class="emphasis"><em>incomplete</em></span>):</p><pre class="programlisting">&lt;bean id="userPreferences" class="com.foo.UserPreferences" scope="session"/&gt;

&lt;bean id="userManager" class="com.foo.UserManager"&gt;
    &lt;property name="userPreferences" ref="userPreferences"/&gt;
&lt;/bean&gt;</pre><p>From the above configuration it is evident that the singleton bean
                <code class="literal">'userManager'</code> is being injected with a reference to the HTTP
                <code class="interfacename">Session</code>-scoped bean <code class="literal">'userPreferences'</code>.
                The salient point here is that the <code class="literal">'userManager'</code> bean is a
                singleton... it will be instantiated <span class="emphasis"><em>exactly once</em></span> per container,
                and its dependencies (in this case only one, the <code class="literal">'userPreferences'</code>
                bean) will also only be injected (once!). This means that the
                <code class="literal">'userManager'</code> will (conceptually) only ever operate on the exact
                same <code class="literal">'userPreferences'</code> object, that is the one that it was originally
                injected with. This is <span class="emphasis"><em>not</em></span> what you want when you inject a HTTP
                <code class="interfacename">Session</code>-scoped bean as a dependency into a
                collaborating object (typically). Rather, what we <span class="emphasis"><em>do</em></span> want is a
				single <code class="literal">'userManager'</code> object, and then, for the lifetime of a HTTP
				<code class="interfacename">Session</code>, we want to see and use a
				<code class="literal">'userPreferences'</code> object that is specific to said HTTP
				<code class="interfacename">Session</code>.</p><p>Rather what you need then is to inject some sort of object that exposes the
                exact same public interface as the <code class="classname">UserPreferences</code> class (ideally
                an object that <span class="emphasis"><em>is a</em></span> <code class="classname">UserPreferences</code> instance)
                and that is smart enough to be able to go off and fetch the
                <code class="interfacename">real</code> <code class="classname">UserPreferences</code> object from
                whatever underlying scoping mechanism we have chosen (HTTP request,
                <code class="interfacename">Session</code>, etc.). We can then safely inject this proxy
                object into the <code class="literal">'userManager'</code> bean, which will be blissfully unaware
                that the <code class="classname">UserPreferences</code> reference that it is holding onto is a
                proxy. In the case of this example, when a <code class="interfacename">UserManager</code>
                instance invokes a method on the dependency-injected <code class="classname">UserPreferences</code>
                object, it is really invoking a method on the proxy... the proxy will then go off and
                fetch the real <code class="classname">UserPreferences</code> object from (in this case) the HTTP
                <code class="interfacename">Session</code>, and delegate the method invocation onto the
                retrieved real <code class="classname">UserPreferences</code> object.</p><p>That is why you need the following, correct and complete, configuration
                when injecting <code class="literal">request-</code>, <code class="literal">session-</code>, and
                <code class="literal">globalSession-scoped</code> beans into collaborating objects:</p><pre class="programlisting">&lt;bean id="userPreferences" class="com.foo.UserPreferences" scope="session"&gt;
    <span class="bold"><strong><code class="literal">&lt;aop:scoped-proxy/&gt;</code></strong></span>
&lt;/bean&gt;

&lt;bean id="userManager" class="com.foo.UserManager"&gt;
    &lt;property name="userPreferences" ref="userPreferences"/&gt;
&lt;/bean&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-factory-scopes-other-injection-proxies"></a>3.4.4.5.1.&nbsp;Choosing the type of proxy created</h5></div></div></div><p>By default, when the Spring container is creating a proxy for a bean
					that is marked up with the <code class="literal">&lt;aop:scoped-proxy/&gt;</code>
					element, <span class="emphasis"><em>a CGLIB-based class proxy will be created</em></span>.
					This means that you need to have the CGLIB library on the classpath
					of your application.
					</p><p><span class="emphasis"><em>Note: CGLIB proxies will only intercept public method
          calls!</em></span> Do not call non-public methods on such a proxy;
          they will not be delegated to the scoped target object.</p><p>You can choose to have the Spring container create 'standard'
					JDK interface-based proxies for such scoped beans by specifying
					'<code class="literal">false</code>' for the value of the '<code class="literal">proxy-target-class</code>'
					attribute of the <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element.
					Using JDK interface-based proxies does mean that you don't need any additional
					libraries on your application's classpath to effect such proxying, but it
					does mean that the class of the scoped bean must implement at least one
					interface, and <span class="emphasis"><em>all</em></span> of the collaborators into which
					the scoped bean is injected must be referencing the bean via one of its
					interfaces.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- <code class="classname">DefaultUserPreferences</code> implements the <code class="interfacename">UserPreferences</code> interface --&gt;</span></em>
&lt;bean id="userPreferences" class="com.foo.DefaultUserPreferences" scope="session"&gt;
    &lt;aop:scoped-proxy <span class="bold"><strong>proxy-target-class="false"<code class="literal"></code></strong></span>/&gt;
&lt;/bean&gt;

&lt;bean id="userManager" class="com.foo.UserManager"&gt;
    &lt;property name="userPreferences" ref="userPreferences"/&gt;
&lt;/bean&gt;</pre><p>The section entitled <a href="#aop-proxying" title="6.6.&nbsp;Proxying mechanisms">Section&nbsp;6.6, &#8220;Proxying mechanisms&#8221;</a>
					may also be of some interest with regard to understanding the nuances
					of choosing whether class-based or interface-based proxying is right
					for you.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-custom"></a>3.4.5.&nbsp;Custom scopes</h3></div></div></div><p>As of Spring 2.0, the bean scoping mechanism in Spring is extensible. This means
			that you are not limited to just the bean scopes that Spring provides out of the box;
			you can define your own scopes, or even redefine the existing scopes (although that last
			one would probably be considered bad practice - please note that you
			<span class="emphasis"><em>cannot</em></span> override the built-in <code class="literal">singleton</code> and
			<code class="literal">prototype</code> scopes).</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-custom-creating"></a>3.4.5.1.&nbsp;Creating your own custom scope</h4></div></div></div><p>Scopes are defined by the
			    <code class="interfacename">org.springframework.beans.factory.config.Scope</code>
			    interface. This is the interface that you will need to implement in order
			    to integrate your own custom scope(s) into the Spring container, and is described
			    in detail below. You may wish to look at the <code class="interfacename">Scope</code>
			    implementations that are supplied with the Spring Framework itself for an idea of
				how to go about implementing your own. The <a href="http://www.springframework.org/docs/api/org/springframework/beans/factory/config/Scope.html" target="_top">Scope JavaDoc</a>
			    explains the main class to implement when you need your own scope in more detail too.</p><p>The <code class="literal">Scope</code> interface has four methods dealing with getting objects
			    from the scope, removing them from the scope and allowing them to be 'destroyed' if needed.</p><p>The first method should return the object from the underlying scope. The session scope
			    implementation for example will return the session-scoped bean (and if it does not exist, return a 
			    new instance of the bean, after having bound it to the session for future reference).</p><pre class="programlisting">Object get(String name, ObjectFactory objectFactory)</pre><p>The second method should remove the object from the underlying scope. The session scope implementation
			    for example, removes the session-scoped bean from the underlying session. The object should be returned
			    (you are allowed to return null if the object with the specified name wasn't found)</p><pre class="programlisting">Object remove(String name)</pre><p>The third method is used to register callbacks the scope should execute when it is destroyed or
			    when the specified object in the scope is destroyed. Please refer to the JavaDoc or a Spring scope
			    implementation for more information on destruction callbacks.</p><pre class="programlisting">void registerDestructionCallback(String name, Runnable destructionCallback)</pre><p>The last method deals with obtaining the conversation identifier for the underlying scope. This identifier is
			    different for each scope. For a session for example, this can be the session identifier.</p><pre class="programlisting">String getConversationId()</pre><p><a href="http://opensource.atlassian.com/projects/spring/browse/SPR-2600" target="_top">SPR-2600 - TODO</a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-custom-using"></a>3.4.5.2.&nbsp;Using a custom scope</h4></div></div></div><p>After you have written and tested one or more custom <code class="interfacename">Scope</code>
			    implementations, you then need to make the Spring container aware of your new scope(s).
			    The central method to register a new <code class="interfacename">Scope</code> with the
			    Spring container is declared on the <code class="interfacename">ConfigurableBeanFactory</code>
			    interface (implemented by most of the concrete <code class="interfacename">BeanFactory</code>
			    implementations that ship with Spring); this central method is displayed below:</p><pre class="programlisting">void registerScope(String scopeName, Scope scope);</pre><p>The first argument to the <code class="methodname">registerScope(..)</code> method is the
			    unique name associated with a scope; examples of such names in the Spring container
			    itself are <code class="literal">'singleton'</code> and <code class="literal">'prototype'</code>.
			    The second argument to the <code class="methodname">registerScope(..)</code> method is an
			    actual instance of the custom <code class="interfacename">Scope</code> implementation
			    that you wish to register and use.</p><p>Let's assume that you have written your own custom
			    <code class="interfacename">Scope</code> implementation, and you have registered it
			    like so:</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// note: the <code class="classname">ThreadScope</code> class does <span class="bold"><strong>not</strong></span> ship with the Spring Framework</span></em>
Scope customScope = new ThreadScope();
beanFactory.registerScope("<span class="bold"><strong>thread</strong></span>", scope);</pre><p>You can then create bean definitions that adhere to the scoping rules of your
                custom <code class="interfacename">Scope</code> like so:</p><pre class="programlisting">&lt;bean id="..." class="..." <span class="bold"><strong>scope="thread"</strong></span>/&gt;</pre><p>If you have your own custom <code class="interfacename">Scope</code> implementation(s),
                you are not just limited to only programmatic registration of the custom scope(s).
                You can also do the <code class="interfacename">Scope</code> registration declaratively,
                using the <code class="classname">CustomScopeConfigurer</code> class.</p><p>The declarative registration of custom <code class="interfacename">Scope</code>
                implementations using the <code class="classname">CustomScopeConfigurer</code> class is
                shown below:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;

    &lt;bean class="org.springframework.beans.factory.config.CustomScopeConfigurer"&gt;
        &lt;property name="scopes"&gt;
            &lt;map&gt;<span class="bold"><strong>
                &lt;entry key="thread"&gt;
                    &lt;bean class="com.foo.ThreadScope"/&gt;
                &lt;/entry&gt;</strong></span>
            &lt;/map&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="bar" class="x.y.Bar" <span class="bold"><strong>scope="thread"</strong></span>&gt;
        &lt;property name="name" value="Rick"/&gt;
        &lt;aop:scoped-proxy/&gt;
    &lt;/bean&gt;

    &lt;bean id="foo" class="x.y.Foo"&gt;
        &lt;property name="bar" ref="bar"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-factory-nature"></a>3.5.&nbsp;Customizing the nature of a bean</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-lifecycle"></a>3.5.1.&nbsp;Lifecycle interfaces</h3></div></div></div><p>The Spring Framework provides several marker interfaces to change the behavior
            of your bean in the container; they include
            <code class="interfacename">InitializingBean</code> and
            <code class="interfacename">DisposableBean</code>. Implementing these interfaces will
            result in the container calling
            <code class="methodname">afterPropertiesSet()</code> for the former and
            <code class="methodname">destroy()</code> for the latter to allow the bean to perform
            certain actions upon initialization and destruction.</p><p>Internally, the Spring Framework uses
            <code class="interfacename">BeanPostProcessor</code> implementations to
            process any marker interfaces it can find and call the appropriate
            methods. If you need custom features or other lifecycle behavior Spring
            doesn't offer out-of-the-box, you can implement a
            <code class="interfacename">BeanPostProcessor</code> yourself. More information about
            this can be found in the section entitled <a href="#beans-factory-extension" title="3.7.&nbsp;Container extension points">Section&nbsp;3.7, &#8220;Container extension points&#8221;</a>.</p><p>All the different lifecycle marker interfaces are described below.
            In one of the appendices, you can find diagram that show how Spring
            manages beans and how those lifecycle features change the nature of your
            beans and how they are managed.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lifecycle-initializingbean"></a>3.5.1.1.&nbsp;Initialization callbacks</h4></div></div></div><p>Implementing the
                <code class="interfacename">org.springframework.beans.factory.InitializingBean</code>
                interface allows a bean to perform initialization work after all necessary
                properties on the bean are set by the container. The
                <code class="interfacename">InitializingBean</code> interface specifies exactly one
                method:</p><pre class="programlisting">void afterPropertiesSet() throws Exception;</pre><p>Generally, the use of the <code class="interfacename">InitializingBean</code>
                interface can be avoided (and is discouraged since it unnecessarily couples
                the code to Spring). A bean definition provides support for a generic
                initialization method to be specified. In the case of XML-based configuration
                metadata, this is done using the <code class="literal">'init-method'</code> attribute.
                For example, the following definition:</p><pre class="programlisting">&lt;bean id="exampleInitBean" class="examples.ExampleBean" init-method="init"/&gt;</pre><pre class="programlisting">public class ExampleBean {
    
    public void init() {
        <em class="lineannotation"><span class="lineannotation">// do some initialization work</span></em>
    }
}</pre><p>Is exactly the same as...</p><pre class="programlisting">&lt;bean id="exampleInitBean" class="examples.AnotherExampleBean"/&gt;</pre><pre class="programlisting">public class AnotherExampleBean implements InitializingBean {
    
    public void afterPropertiesSet() {
        <em class="lineannotation"><span class="lineannotation">// do some initialization work</span></em>
    }
}</pre><p>... but does not couple the code to Spring.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lifecycle-disposablebean"></a>3.5.1.2.&nbsp;Destruction callbacks</h4></div></div></div><p>Implementing the
                <code class="interfacename">org.springframework.beans.factory.DisposableBean</code>
                interface allows a bean to get a callback when the container
                containing it is destroyed. The <code class="interfacename">DisposableBean</code> interface specifies one
                method:</p><pre class="programlisting">void destroy() throws Exception;</pre><p>Generally, the use of the
                <code class="interfacename">DisposableBean</code> marker interface can be avoided (and
                is discouraged since it unnecessarily couples the code to Spring). A
                bean definition provides support for a generic destroy method to be
                specified. When using XML-based configuration metadata this is done via the
                <code class="literal">'destroy-method'</code> attribute on the <code class="literal">&lt;bean/&gt;</code>.
                For example, the following definition: </p><pre class="programlisting">&lt;bean id="exampleInitBean" class="examples.ExampleBean" destroy-method="cleanup"/&gt;</pre><pre class="programlisting">public class ExampleBean {

    public void cleanup() {
        <em class="lineannotation"><span class="lineannotation">// do some destruction work (like releasing pooled connections)</span></em>
    }
}</pre><p>Is exactly the same as...</p><pre class="programlisting">&lt;bean id="exampleInitBean" class="examples.AnotherExampleBean"/&gt;</pre><pre class="programlisting">public class AnotherExampleBean implements DisposableBean {

    public void destroy() {
        <em class="lineannotation"><span class="lineannotation">// do some destruction work (like releasing pooled connections)</span></em>
    }
}</pre><p>... but does not couple the code to Spring.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-factory-lifecycle-default-init-destroy-methods"></a>3.5.1.2.1.&nbsp;Default initialization &amp; destroy methods</h5></div></div></div><p>
                        When you are writing initialization and destroy method callbacks that do not
                        use the Spring-specific <code class="interfacename">InitializingBean</code>
                        and <code class="interfacename">DisposableBean</code> callback interfaces,
                        one (in the experience of this author) typically finds oneself writing
                        methods with names such as <code class="literal">init()</code>,
                        <code class="literal">initialize()</code>, <code class="literal">dispose()</code>, etc. The
                        names of such lifecycle callback methods are (hopefully!) standardized
                        across a project so that developers on a team all use the same method
                        names and thus ensure some level of consistency.
                    </p><p>
                        The Spring container can now be configured to <code class="literal">'look'</code>
                        for named initialization and destroy callback method names on
                        <span class="emphasis"><em>every</em></span> bean. This means that you as an application developer
                        can simply write your application classes, use a convention of having an
                        initialization callback called <code class="literal">init()</code>, and then
                        (without having to configure each and every bean with, in the case of XML-based
                        configuration, an <code class="literal">'init-method="init"'</code> attribute)
                        be safe in the knowledge that the Spring IoC container <span class="emphasis"><em>will</em></span>
                        call that method when the bean is being created (and in accordance with the
                        standard lifecycle callback contract described previously).
                    </p><p>
                        Let's look at an example to make the use of this feature completely clear.
                        For the sake of the example, let us say that one of the coding conventions on a
                        project is that all initialization callback methods are to be named
                        <code class="literal">init()</code> and that destroy callback methods are to be called
                        <code class="literal">destroy()</code>. This leads to classes like so...
                    </p><pre class="programlisting">public class DefaultBlogService implements BlogService {

    private BlogDao blogDao;

    public void setBlogDao(BlogDao blogDao) {
        this.blogDao = blogDao;
    }

    <em class="lineannotation"><span class="lineannotation">// this is (unsurprisingly) the initialization callback method</span></em>
    public void init() {
        if (this.blogDao == null) {
            throw new IllegalStateException("The [blogDao] property must be set.");
        }
    }
}</pre><pre class="programlisting">&lt;beans <span class="bold"><strong>default-init-method="init"</strong></span>&gt;

    &lt;bean id="blogService" class="com.foo.DefaultBlogService"&gt;
        &lt;property name="blogDao" ref="blogDao" /&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre><p>
                        Notice the use of the <code class="literal">'default-init-method'</code> attribute on the
                        top-level <code class="literal">&lt;beans/&gt;</code> element. The presence of this
                        attribute means that the Spring IoC container will recognize a method called
                        <code class="literal">'init'</code> on beans as being the initialization method callback,
                        and when a bean is being created and assembled, if the bean's class has such
                        a method, it will be invoked at the appropriate time.
                    </p><p>
                        Destroy method callbacks are configured similarly (in XML that is) using the
                        <code class="literal">'default-destroy-method'</code> attribute on the top-level
                        <code class="literal">&lt;beans/&gt;</code> element.
                    </p><p>
                        The use of this feature can save you the (small) housekeeping chore of specifying
                        an initialization and destroy method callback on each and every bean, and it is
                        great for enforcing a consistent naming convention for initialization and destroy
                        method callbacks (and consistency is something that should always be aimed for).
                    </p><p>
                        Consider the case where you have some existing beans where the
                        underlying classes already have initialization callback methods that
                        are named at variance with the convention. You can
                        <span class="emphasis"><em>always</em></span> override the default by specifying (in XML that is)
                        the method name using the <code class="literal">'init-method'</code> and
                        <code class="literal">'destroy-method'</code> attributes on the <code class="literal">&lt;bean/&gt;</code>
                        element itself.
                    </p><p>Finally, please be aware that the Spring container guarantees that
                    a configured initialization callback is called immediately after a bean
                    has been supplied with all of it's dependencies. This means that the
                    initialization callback will be called on the raw bean reference, which
                    means that any AOP interceptors or suchlike that will ultimately
                    be applied to the bean will not yet be in place. A target bean is fully
                    created <span class="emphasis"><em>first</em></span>, <span class="emphasis"><em>then</em></span>
                    an AOP proxy (for example) with its interceptor chain is applied. Note that,
                    if the target bean and the proxy are defined separately, your code can even
                    interact to the raw target bean, bypassing the proxy. Hence, it would be very
                    inconsistent to apply the interceptors to the init method, since that would couple
                    the lifecycle of the target bean with its proxy/interceptors, and leave strange
                    semantics when talking to the raw target bean directly.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-factory-shutdown"></a>3.5.1.2.2.&nbsp;Shutting down the Spring IoC container gracefully in non-web applications</h5></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>This next section does not apply to web applications (in case the title of this section
                        did not make that abundantly clear). Spring's web-based <code class="interfacename">ApplicationContext</code>
                        implementations already have code in place to handle shutting down the Spring
                        IoC container gracefully when the relevant web application is being shutdown.</p></td></tr></table></div><p>If you are using Spring's IoC container in a non-web application environment, for
                    example in a rich client desktop environment, and you want the container to shutdown
                    gracefully and call the relevant destroy callbacks on your singleton beans, you will
                    need to register a shutdown hook with the JVM. This is quite easy to do (see below),
                    and will ensure that your Spring IoC container shuts down gracefully and that all
                    resources held by your singletons are released (of course it is still up to you to both
                    configure the destroy callbacks for your singletons and implement such
                    destroy callbacks correctly).</p><p>So to register a shutdown hook that enables the graceful shutdown of the relevant
                    Spring IoC container, you simply need to call the
                    <code class="methodname">registerShutdownHook()</code> method that is declared on the
                    <code class="classname">AbstractApplicationContext</code> class. To wit...</p><pre class="programlisting">import org.springframework.context.support.AbstractApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public final class Boot {

    public static void main(final String[] args) throws Exception {
        AbstractApplicationContext ctx
            = new ClassPathXmlApplicationContext(new String []{"beans.xml"});

        <em class="lineannotation"><span class="lineannotation">// add a shutdown hook for the above context... </span></em>
        ctx.registerShutdownHook();

        <em class="lineannotation"><span class="lineannotation">// app runs here...</span></em>

        <em class="lineannotation"><span class="lineannotation">// main method exits, hook is called prior to the app shutting down...</span></em>
    }
}</pre></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-aware"></a>3.5.2.&nbsp;Knowing who you are</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-aware-beanfactoryaware"></a>3.5.2.1.&nbsp;
                    <code class="interfacename">BeanFactoryAware</code>
                </h4></div></div></div><p>A class which implements the
        <code class="interfacename">org.springframework.beans.factory.BeanFactoryAware</code>
        interface is provided with a reference to the <code class="interfacename">BeanFactory</code> that created
        it, when it is created by that <code class="interfacename">BeanFactory</code>.
        </p><pre class="programlisting">public interface BeanFactoryAware {

    void setBeanFactory(BeanFactory beanFactory) throws BeansException;
}</pre><p>
            This allows beans to manipulate the <code class="interfacename">BeanFactory</code>
            that created them programmatically, through the <code class="interfacename">BeanFactory</code>
            interface, or by casting the reference to a known subclass of this
            which exposes additional functionality. Primarily this would consist
            of programmatic retrieval of other beans. While there are cases when
            this capability is useful, it should generally be avoided, since it
            couples the code to Spring, and does not follow the Inversion of
            Control style, where collaborators are provided to beans as properties.
        </p><p>An alternative option that is equivalent in effect to the
                <code class="interfacename">BeanFactoryAware</code>-based approach is to use the
                <code class="classname">org.springframework.beans.factory.config.ObjectFactoryCreatingFactoryBean</code>.
                (It should be noted that this approach still does not reduce the coupling to Spring,
                but it does not violate the central principle of IoC as much as the
                <code class="interfacename">BeanFactoryAware</code>-based approach.)</p><p>The <code class="classname">ObjectFactoryCreatingFactoryBean</code> is a
                <a href="#beans-factory-extension-factorybean" title="3.7.3.&nbsp;Customizing instantiation logic using FactoryBeans"><code class="interfacename">FactoryBean</code></a>
                implementation that returns a reference to an object (factory) that can in turn be used to
                effect a bean lookup. The <code class="classname">ObjectFactoryCreatingFactoryBean</code> class
                does itself implement the <code class="interfacename">BeanFactoryAware</code> interface;
                what client beans are actually injected with is an instance of the
                <code class="interfacename">ObjectFactory</code> interface. This is a Spring-specific
                interface (and hence there is still no total decoupling from Spring), but clients
                can then use the <code class="interfacename">ObjectFactory</code>'s
                <code class="methodname">getObject()</code> method to effect the bean lookup (under the hood the
                <code class="interfacename">ObjectFactory</code> implementation instance that is returned
                simply delegates down to a <code class="interfacename">BeanFactory</code> to actually
                lookup a bean by name). All that you need to do is supply
                the <code class="classname">ObjectFactoryCreatingFactoryBean</code> with the name of the
                bean that is to be looked up. Let's look at an example:</p><pre class="programlisting">package x.y;

public class NewsFeed {
    
    private String news;

    public void setNews(String news) {
        this.news = news;
    }

    public String getNews() {
        return this.toString() + ": '" + news + "'";
    }
}</pre><pre class="programlisting">package x.y;

import org.springframework.beans.factory.ObjectFactory;

public class NewsFeedManager {

    private ObjectFactory factory;

    public void setFactory(ObjectFactory factory) {
        this.factory = factory;
    }

    public void printNews() {
        // here is where the lookup is performed; note that there is no
        // need to hardcode the name of the bean that is being looked up...
        NewsFeed news = (NewsFeed) factory.getObject();
        System.out.println(news.getNews());
    }
}</pre><p>
            Find below the XML configuration to wire together the above classes
            using the <code class="classname">ObjectFactoryCreatingFactoryBean</code> approach.
        </p><pre class="programlisting">&lt;beans&gt;
    &lt;bean id="newsFeedManager" class="x.y.NewsFeedManager"&gt;
        &lt;property name="factory"&gt;
            &lt;bean
class="org.springframework.beans.factory.config.ObjectFactoryCreatingFactoryBean"&gt;
                &lt;property name="targetBeanName"&gt;
                    &lt;idref local="newsFeed" /&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
    &lt;bean id="newsFeed" class="x.y.NewsFeed" scope="prototype"&gt;
        &lt;property name="news" value="... that's fit to print!" /&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</pre><p>
            And here is a small driver program to test the fact that new (prototype)
            instances of the <code class="literal">newsFeed</code> bean are actually being returned for
            each call to the injected <code class="interfacename">ObjectFactory</code> inside the
            <code class="classname">NewsFeedManager</code>'s <code class="methodname">printNews()</code> method.
        </p><pre class="programlisting">import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import x.y.NewsFeedManager;

public class Main {

    public static void main(String[] args) throws Exception {

        ApplicationContext ctx = new ClassPathXmlApplicationContext("beans.xml");
        NewsFeedManager manager = (NewsFeedManager) ctx.getBean("newsFeedManager");
        manager.printNews();
        manager.printNews();
    }
}</pre><p>
            The output from running the above program will look like so (results will of course vary
            on your machine).
        </p><pre class="programlisting">x.y.NewsFeed@1292d26: '... that's fit to print!'
x.y.NewsFeed@5329c5: '... that's fit to print!'</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-aware-beannameaware"></a>3.5.2.2.&nbsp;<code class="interfacename">BeanNameAware</code></h4></div></div></div><p>If a bean implements the
                <code class="interfacename">org.springframework.beans.factory.BeanNameAware</code>
                interface and is deployed in a <code class="interfacename">BeanFactory</code>, the
                <code class="interfacename">BeanFactory</code> will call the bean through this
                interface to inform the bean of the <span class="emphasis"><em>id</em></span> it was deployed
                under. The callback will be invoked after population of normal bean properties
                but before an initialization callback like <code class="interfacename">InitializingBean</code>'s
                <span class="emphasis"><em>afterPropertiesSet</em></span> or a custom init-method.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-child-bean-definitions"></a>3.6.&nbsp;Bean definition inheritance</h2></div></div></div><p>A bean definition potentially contains a large amount of
        configuration information, including container specific information (for example
        initialization method, static factory method name, and so forth) and constructor
        arguments and property values. A child bean definition is a bean
        definition that inherits configuration data from a parent definition. It
        is then able to override some values, or add others, as needed. Using
        parent and child bean definitions can potentially save a lot of typing.
        Effectively, this is a form of templating.</p><p>When working with a <code class="interfacename">BeanFactory</code> programmatically, child bean
        definitions are represented by the <code class="classname">ChildBeanDefinition</code>
        class. Most users will never work with them on this level, instead
        configuring bean definitions declaratively in something like the
        <code class="classname">XmlBeanFactory</code>. When using XML-based configuration metadata a child bean
        definition is indicated simply by using the <code class="literal">'parent'</code>
        attribute, specifying the parent bean as the value of this attribute.</p><pre class="programlisting">&lt;bean id="inheritedTestBean" abstract="true"
    class="org.springframework.beans.TestBean"&gt;
  &lt;property name="name" value="parent"/&gt;
  &lt;property name="age" value="1"/&gt;
&lt;/bean&gt;

&lt;bean id="inheritsWithDifferentClass"
      class="org.springframework.beans.DerivedTestBean"
      <span class="bold"><strong>parent="inheritedTestBean"</strong></span> init-method="initialize"&gt;
    
  &lt;property name="name" value="override"/&gt;
  <em class="lineannotation"><span class="lineannotation">&lt;!-- the age property value of 1 will be inherited from  parent --&gt;</span></em>

&lt;/bean&gt;</pre><p>A child bean definition will use the bean class from the parent
        definition if none is specified, but can also override it. In the latter
        case, the child bean class must be compatible with the parent, that is it
        must accept the parent's property values.</p><p>A child bean definition will inherit constructor argument values,
        property values and method overrides from the parent, with the option to
        add new values. If any init-method, destroy-method and/or <code class="literal">static</code>
        factory method settings are specified, they will override the corresponding parent
        settings.</p><p>The remaining settings will <span class="emphasis"><em>always</em></span> be taken
        from the child definition: <span class="emphasis"><em>depends on</em></span>,
        <span class="emphasis"><em>autowire mode</em></span>, <span class="emphasis"><em>dependency check</em></span>,
        <span class="emphasis"><em>singleton</em></span>, <span class="emphasis"><em>scope</em></span>,
		<span class="emphasis"><em>lazy init</em></span>.</p><p>Note that in the example above, we have explicitly marked the parent
        bean definition as abstract by using the <code class="literal">abstract</code>
        attribute. In the case that the parent definition does not specify a
        class, and so explicitly marking the parent bean definition as
        <code class="literal">abstract</code> is required:</p><pre class="programlisting">&lt;bean id="inheritedTestBeanWithoutClass" abstract="true"&gt;
    &lt;property name="name" value="parent"/&gt;
    &lt;property name="age" value="1"/&gt;
&lt;/bean&gt;

&lt;bean id="inheritsWithClass" class="org.springframework.beans.DerivedTestBean"
    parent="inheritedTestBeanWithoutClass" init-method="initialize"&gt;
  &lt;property name="name" value="override"/&gt;
  <em class="lineannotation"><span class="lineannotation">&lt;!-- age will inherit the value of <code class="literal">1</code> from the parent bean definition--&gt;</span></em>
&lt;/bean&gt;</pre><p>The parent bean cannot get instantiated on its own since it is
        incomplete, and it is also explicitly marked as <code class="literal">abstract</code>.
        When a definition is defined to be <code class="literal">abstract</code> like this,
        it is usable only as a pure template bean definition that will serve as a
        parent definition for child definitions. Trying to use such an
        <code class="literal">abstract</code> parent bean on its own (by referring to it as
        a ref property of another bean, or doing an explicit
        <code class="methodname">getBean()</code> call with the parent bean id), will
        result in an error. Similarly, the container's internal
        <code class="methodname">preInstantiateSingletons()</code> method will completely
        ignore bean definitions which are defined as abstract.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">ApplicationContexts</code> (but <span class="emphasis"><em>not</em></span>
            <code class="literal">BeanFactories</code>) will by default pre-instantiate
            all singletons. Therefore it is important (at least for singleton beans)
            that if you have a (parent) bean definition which you intend to use only
            as a template, and this definition specifies a class, you must make sure
            to set the <span class="emphasis"><em>'abstract'</em></span> attribute to <span class="emphasis"><em>'true'</em></span>,
            otherwise the application context will actually (attempt to) pre-instantiate
            the <code class="literal">abstract</code> bean.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-factory-extension"></a>3.7.&nbsp;Container extension points</h2></div></div></div><p>The IoC component of the Spring Framework has been designed for extension.
        There is typically no need for an application developer to subclass any of the various
        <code class="interfacename">BeanFactory</code> or <code class="interfacename">ApplicationContext</code>
        implementation classes. The Spring IoC container can be infinitely extended by
        plugging in implementations of special integration interfaces. The next few sections are
        devoted to detailing all of these various integration interfaces.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-extension-bpp"></a>3.7.1.&nbsp;Customizing beans using <code class="literal">BeanPostProcessors</code></h3></div></div></div><p>The first extension point that we will look at is the
            <code class="interfacename">BeanPostProcessor</code> interface. This interface defines
            a number of <em class="firstterm">callback methods</em> that you as an application
            developer can implement in order to provide your own (or override the containers default)
            instantiation logic, dependency-resolution logic, and so forth. If you want to do
            some custom logic after the Spring container has finished instantiating, configuring
            and otherwise initializing a bean, you can plug in one or more
            <code class="interfacename">BeanPostProcessor</code> implementations.</p><p>You can configure multiple <code class="literal">BeanPostProcessors</code> if you wish.
            You can control the order in which these <code class="literal">BeanPostProcessors</code>
            execute by setting the <code class="literal">'order'</code> property (you can only set this property 
            if the <code class="interfacename">BeanPostProcessor</code>
            implements the <code class="interfacename">Ordered</code> interface; if you write your own
            <code class="interfacename">BeanPostProcessor</code> you should consider implementing the
            <code class="interfacename">Ordered</code> interface too); consult the Javadocs for the
            <code class="interfacename">BeanPostProcessor</code> and <code class="interfacename">Ordered</code>
            interfaces for more details.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">BeanPostProcessors</code> operate on bean (or object)
                <span class="emphasis"><em>instances</em></span>; that is to say, the Spring IoC container will
                have instantiated a bean instance for you, and <span class="emphasis"><em>then</em></span>
                <code class="literal">BeanPostProcessors</code> get a chance to do their stuff.</p><p>If you want to change the actual bean definition (that is the recipe that
                defines the bean), then you rather need to use a
                <code class="interfacename">BeanFactoryPostProcessor</code> (described below in the
                section entitled <a href="#beans-factory-extension-factory-postprocessors" title="3.7.2.&nbsp;Customizing configuration metadata with BeanFactoryPostProcessors">Section&nbsp;3.7.2, &#8220;Customizing configuration metadata with <code class="literal">BeanFactoryPostProcessors</code>&#8221;</a>.</p><p>Also, <code class="literal">BeanPostProcessors</code> are scoped <span class="emphasis"><em>per-container</em></span>.
                This is only relevant if you are using container hierarchies. If you define a
                <code class="interfacename">BeanPostProcessor</code> in one container, it will
                <span class="emphasis"><em>only</em></span> do its stuff on the beans in that container. Beans that
                are defined in another container will not be post-processed by
                <code class="literal">BeanPostProcessors</code> in another container, even if both containers
                are part of the same hierarchy.</p></td></tr></table></div><p>The <code class="interfacename">org.springframework.beans.factory.config.BeanPostProcessor</code>
            interface consists of exactly two callback methods. When such a class is
            registered as a post-processor with the container (see below for how this registration
            is effected), for each bean instance that is created by the container, the post-processor
            will get a callback from the container both <span class="emphasis"><em>before</em></span> any container
            initialization methods (such as <span class="emphasis"><em>afterPropertiesSet</em></span> and any declared
            init method) are called, and also afterwards. The post-processor is free to do what it
            wishes with the bean instance, including ignoring the callback completely. A bean
            post-processor will typically check for marker interfaces, or do something such as wrap
            a bean with a proxy; some of the Spring AOP infrastructure classes are implemented as bean
            post-processors and they do this proxy-wrapping logic.</p><p>It is important to know that a <code class="interfacename">BeanFactory</code> treats bean
            post-processors slightly differently than an <code class="interfacename">ApplicationContext</code>.
            An <code class="interfacename">ApplicationContext</code> will <span class="emphasis"><em>automatically detect</em></span>
            any beans which are defined in the configuration metadata which is supplied to it that
            implement the <code class="interfacename">BeanPostProcessor</code> interface, and register them
            as post-processors, to be then called appropriately by the container on bean creation. Nothing
            else needs to be done other than deploying the post-processors in a similar fashion to any
            other bean. On the other hand, when using a <code class="interfacename">BeanFactory</code>
            implementation, bean post-processors explicitly have to be registered, with code like this:</p><pre class="programlisting">ConfigurableBeanFactory factory = new XmlBeanFactory(...);
            
<em class="lineannotation"><span class="lineannotation">// now register any needed <code class="interfacename">BeanPostProcessor</code> instances</span></em>
MyBeanPostProcessor postProcessor = new MyBeanPostProcessor();
factory.addBeanPostProcessor(postProcessor);

<em class="lineannotation"><span class="lineannotation">// now start using the factory</span></em></pre><p>This explicit registration step is not convenient, and this is one of the
            reasons why the various <code class="interfacename">ApplicationContext</code>
            implementations are preferred above plain <code class="interfacename">BeanFactory</code>
            implementations in the vast majority of Spring-backed applications, especially
            when using <code class="literal">BeanPostProcessors</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: BeanPostProcessors and AOP auto-proxying"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left"><code class="interfacename">BeanPostProcessors</code> and AOP auto-proxying</th></tr><tr><td align="left" valign="top"><p>Classes that implement the <code class="interfacename">BeanPostProcessor</code>
				interface are <span class="emphasis"><em>special</em></span>, and so they are treated differently
				by the container. All <code class="interfacename">BeanPostProcessors</code>
				<span class="emphasis"><em>and their directly referenced beans</em></span> will be instantiated
				on startup, as part of the special startup phase of the
				<code class="interfacename">ApplicationContext</code>, <span class="emphasis"><em>then</em></span>
				all those <code class="interfacename">BeanPostProcessors</code> will be registered
				in a sorted fashion - and applied to all further beans. Since AOP
				auto-proxying is implemented as a <code class="interfacename">BeanPostProcessor</code>
				itself, no <code class="interfacename">BeanPostProcessors</code> or directly
				referenced beans are eligible for auto-proxying (and thus will not have
				aspects 'woven' into them.</p><p>For any such bean, you should see an info log message:
				&#8220;<span class="quote"><span class="emphasis"><em>Bean 'foo' is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)</em></span></span>&#8221;.</p></td></tr></table></div><p>Find below some examples of how to write, register, and use
            <code class="literal">BeanPostProcessors</code> in the context of an
            <code class="interfacename">ApplicationContext</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-extension-bpp-examples-hw"></a>3.7.1.1.&nbsp;Example: Hello World, <code class="interfacename">BeanPostProcessor</code>-style</h4></div></div></div><p>This first example is hardly compelling, but serves to illustrate basic
                usage. All we are going to do is code a custom <code class="interfacename">BeanPostProcessor</code>
                implementation that simply invokes the <code class="methodname">toString()</code>
                method of each bean as it is created by the container and prints the resulting
                string to the system console. Yes, it is not hugely useful, but serves to get
                the basic concepts across before we move into the second example which
                <span class="emphasis"><em>is</em></span> actually useful.</p><p>Find below the custom <code class="interfacename">BeanPostProcessor</code>
                implementation class definition:</p><pre class="programlisting">package scripting;

import org.springframework.beans.factory.config.BeanPostProcessor;
import org.springframework.beans.BeansException;

public class InstantiationTracingBeanPostProcessor implements BeanPostProcessor {

    <em class="lineannotation"><span class="lineannotation">// simply return the instantiated bean as-is</span></em>
    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        return bean; <em class="lineannotation"><span class="lineannotation">// we could potentially return <span class="emphasis"><em>any</em></span> object reference here...</span></em>
    }

    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("Bean '" + beanName + "' created : " + bean.toString());
        return bean;
    }
}</pre><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:lang="http://www.springframework.org/schema/lang"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang-2.0.xsd"&gt;

    &lt;lang:groovy id="messenger"
          script-source="classpath:org/springframework/scripting/groovy/Messenger.groovy"&gt;
        &lt;lang:property name="message" value="Fiona Apple Is Just So Dreamy."/&gt; 
    &lt;/lang:groovy&gt;
    
    <em class="lineannotation"><span class="lineannotation">&lt;!-- 
        when the above bean ('messenger') is instantiated, this custom
        <code class="interfacename">BeanPostProcessor</code> implementation will output the fact to the system console
     --&gt;</span></em>
    &lt;bean class="scripting.InstantiationTracingBeanPostProcessor"/&gt;

&lt;/beans&gt;</pre><p>Notice how the <code class="classname">InstantiationTracingBeanPostProcessor</code> is
                simply defined; it doesn't even have a name, and because it is a bean it can be
                dependency injected just like any other bean. (The above configuration also just so
                happens to define a bean that is backed by a Groovy script. The Spring 2.0 dynamic
                language support is detailed in the chapter entitled
                <a href="#dynamic-language" title="Chapter&nbsp;24.&nbsp;Dynamic language support">Chapter&nbsp;24, <i>Dynamic language support</i></a>.)</p><p>Find below a small driver script to exercise the above code and
                configuration;</p><pre class="programlisting">import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.scripting.Messenger;

public final class Boot {

    public static void main(final String[] args) throws Exception {
        ApplicationContext ctx = new ClassPathXmlApplicationContext("scripting/beans.xml");
        Messenger messenger = (Messenger) ctx.getBean("messenger");
        System.out.println(messenger);
    }
}</pre><p>The output of executing the above program will be (something like) this:</p><pre class="programlisting">Bean 'messenger' created : org.springframework.scripting.groovy.GroovyMessenger@272961
org.springframework.scripting.groovy.GroovyMessenger@272961</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-extension-bpp-examples-rabpp"></a>3.7.1.2.&nbsp;Example: The <code class="classname">RequiredAnnotationBeanPostProcessor</code></h4></div></div></div><p>Using marker interfaces or annotations in conjunction with a custom
                <code class="interfacename">BeanPostProcessor</code> implementation is a common
                means of extending the Spring IoC container. This next example is a bit of
                a cop-out, in that you are directed to the section entitled
                <a href="#metadata-annotations-required" title="25.3.1.&nbsp;@Required">Section&nbsp;25.3.1, &#8220;@<code class="interfacename">Required</code>&#8221;</a> which demonstrates the usage of a
                custom <code class="interfacename">BeanPostProcessor</code> implementation that
                ships with the Spring distribution which ensures that JavaBean properties on
                beans that are marked with an (arbitrary) annotation are actually (configured to
                be) dependency-injected with a value.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-extension-factory-postprocessors"></a>3.7.2.&nbsp;Customizing configuration metadata with <code class="literal">BeanFactoryPostProcessors</code></h3></div></div></div><p>The next extension point that we will look at is the
            <code class="interfacename">org.springframework.beans.factory.config.BeanFactoryPostProcessor</code>.
            The semantics of this interface are similar to the <code class="interfacename">BeanPostProcessor</code>,
            with one major difference: <code class="literal">BeanFactoryPostProcessors</code> operate on the
            <span class="emphasis"><em>bean configuration metadata</em></span>; that is, the Spring IoC container will
            allow <code class="literal">BeanFactoryPostProcessors</code> to read the configuration metadata
            and potentially change it <span class="emphasis"><em>before</em></span> the container has actually
            instantiated any other beans.</p><p>You can configure multiple <code class="literal">BeanFactoryPostProcessors</code> if you wish.
            You can control the order in which these <code class="literal">BeanFactoryPostProcessors</code>
            execute by setting the <code class="literal">'order'</code> property (you can only set this property 
            if the <code class="interfacename">BeanFactoryPostProcessor</code>
            implements the <code class="interfacename">Ordered</code> interface; if you write your own
            <code class="interfacename">BeanFactoryPostProcessor</code> you should consider
            implementing the <code class="interfacename">Ordered</code> interface too); consult
            the Javadocs for the <code class="interfacename">BeanFactoryPostProcessor</code>
            and <code class="interfacename">Ordered</code> interfaces for more details.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you want to change the actual bean <span class="emphasis"><em>instances</em></span>
                (the objects that are created from the configuration metadata), then
                you rather need to use a <code class="interfacename">BeanPostProcessor</code>
                (described above in the section entitled
                <a href="#beans-factory-extension-bpp" title="3.7.1.&nbsp;Customizing beans using BeanPostProcessors">Section&nbsp;3.7.1, &#8220;Customizing beans using <code class="literal">BeanPostProcessors</code>&#8221;</a>.</p><p>Also, <code class="literal">BeanFactoryPostProcessors</code> are scoped
                <span class="emphasis"><em>per-container</em></span>. This is only relevant if you are
                using container hierarchies. If you define a
                <code class="interfacename">BeanFactoryPostProcessor</code> in one container,
                it will <span class="emphasis"><em>only</em></span> do its stuff on the bean definitions in
                that container. Bean definitions in another container will not be
                post-processed by <code class="literal">BeanFactoryPostProcessors</code> in another
                container, even if both containers are part of the same hierarchy.</p></td></tr></table></div><p>A bean factory post-processor is executed manually (in the case of a
            <code class="interfacename">BeanFactory</code>) or automatically (in the case of an
            <code class="interfacename">ApplicationContext</code>) to apply changes of
            some sort to the configuration metadata that defines a container. Spring
            includes a number of pre-existing bean factory post-processors, such as
            <code class="classname">PropertyResourceConfigurer</code> and
            <code class="classname">PropertyPlaceholderConfigurer</code>, both described below,
            and <code class="classname">BeanNameAutoProxyCreator</code>, which is very useful for wrapping
            other beans transactionally or with any other kind of proxy, as described
            later in this manual. The <code class="interfacename">BeanFactoryPostProcessor</code>
            can be used to add custom property editors.</p><p>In a <code class="interfacename">BeanFactory</code>, the process of applying a
            <code class="interfacename">BeanFactoryPostProcessor</code> is manual, and will be
            similar to this:</p><pre class="programlisting">XmlBeanFactory factory = new XmlBeanFactory(new FileSystemResource("beans.xml"));

<em class="lineannotation"><span class="lineannotation">// bring in some property values from a <code class="classname">Properties</code> file</span></em>
PropertyPlaceholderConfigurer cfg = new PropertyPlaceholderConfigurer();
cfg.setLocation(new FileSystemResource("jdbc.properties"));

<em class="lineannotation"><span class="lineannotation">// now actually do the replacement</span></em>
cfg.postProcessBeanFactory(factory);</pre><p>This explicit registration step is not convenient, and this is one of the
            reasons why the various <code class="interfacename">ApplicationContext</code>
            implementations are preferred above plain <code class="interfacename">BeanFactory</code>
            implementations in the vast majority of Spring-backed applications, especially
            when using <code class="literal">BeanFactoryPostProcessors</code>.</p><a name="beans-factory-autodetect-beanfactorypostprocessors"></a><p>An <code class="interfacename">ApplicationContext</code> will detect any beans which
            are deployed into it which implement the <code class="interfacename">BeanFactoryPostProcessor</code>
            interface, and automatically use them as bean factory post-processors, at the appropriate
            time. Nothing else needs to be done other than deploying these post-processor in a similar
            fashion to any other bean.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Just as in the case of <code class="literal">BeanPostProcessors</code>, you typically
                don't want to have <code class="literal">BeanFactoryPostProcessors</code>
                marked as being lazily-initialized. If they are marked as such, then the Spring
                container will never instantiate them, and thus they won't get a chance
                to apply their custom logic. If you are using the
                <code class="literal">'default-lazy-init'</code> attribute on the declaration of your
                <code class="literal">&lt;beans/&gt;</code> element, be sure to mark your various
                <code class="interfacename">BeanFactoryPostProcessor</code> bean definitions with
                <code class="literal">'lazy-init="false"'</code>.
                </p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-placeholderconfigurer"></a>3.7.2.1.&nbsp;Example: the <code class="interfacename">PropertyPlaceholderConfigurer</code></h4></div></div></div><p>The <code class="interfacename">PropertyPlaceholderConfigurer</code>
				is used to externalize property values from a
				<code class="interfacename">BeanFactory</code> definition, into another
                separate file in the standard Java <code class="classname">Properties</code> format.
                This is useful to allow the person deploying an application to customize
				enviroment-specific properties (for example database URLs, usernames and passwords), without the
                complexity or risk of modifying the main XML definition file or files for the
                container.</p><p>Consider the following XML-based configuration metadata fragment, where a
                <code class="interfacename">DataSource</code> with placeholder values is defined. We
                will configure some properties from an external <code class="classname">Properties</code>
                file, and at runtime, we will apply a
                <code class="classname">PropertyPlaceholderConfigurer</code> to the metadata which will
                replace some properties of the datasource:</p><pre class="programlisting">&lt;bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt;
    &lt;property name="locations"&gt;
        &lt;value&gt;classpath:com/foo/jdbc.properties&lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="dataSource" destroy-method="close"
      class="org.apache.commons.dbcp.BasicDataSource"&gt;
    &lt;property name="driverClassName" value="<span class="bold"><strong>${jdbc.driverClassName}</strong></span>"/&gt;
    &lt;property name="url" value="<span class="bold"><strong>${jdbc.url}</strong></span>"/&gt;
    &lt;property name="username" value="<span class="bold"><strong>${jdbc.username}</strong></span>"/&gt;
    &lt;property name="password" value="<span class="bold"><strong>${jdbc.password}</strong></span>"/&gt;
&lt;/bean&gt;</pre><p>The actual values come from another file in the standard Java
                <code class="classname">Properties</code> format:</p><pre class="programlisting">jdbc.driverClassName=org.hsqldb.jdbcDriver
jdbc.url=jdbc:hsqldb:hsql://production:9002
jdbc.username=sa
jdbc.password=root</pre><p>The <code class="classname">PropertyPlaceholderConfigurer</code> doesn't only
				look for properties in the <code class="classname">Properties</code> file you
				specify, but also checks against the Java <code class="classname">System</code>
				properties if it cannot find a property you are trying to use. This
				behavior can be customized by setting the <code class="literal">systemPropertiesMode</code>
				property of the configurer. It has three values, one to tell the configurer
				to always override, one to let it <span class="emphasis"><em>never</em></span> override and
				one to let it override only if the property cannot be found in the
				properties file specified. Please consult the Javadoc for the
				<code class="classname">PropertyPlaceholderConfigurer</code> for more information.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Class name substitution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Class name substitution</th></tr><tr><td align="left" valign="top"><p>The <code class="classname">PropertyPlaceholderConfigurer</code>
					can be used to substitute class names, which is sometimes useful
					when you have to pick a particular implementation class at runtime.
					For example:</p><pre class="programlisting">&lt;bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt;
    &lt;property name="locations"&gt;
        &lt;value&gt;classpath:com/foo/strategy.properties&lt;/value&gt;
    &lt;/property&gt;
    &lt;property name="properties"&gt;
        &lt;value&gt;custom.strategy.class=com.foo.DefaultStrategy&lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="serviceStrategy" class="${custom.strategy.class}"/&gt;</pre><p>If the class is unable to be resolved at runtime to a valid class,
					resolution of the bean will fail once it is about to be created
					(which is during the <code class="methodname">preInstantiateSingletons()</code>
					phase of an <code class="interfacename">ApplicationContext</code> for a
					non-lazy-init bean.)</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-overrideconfigurer"></a>3.7.2.2.&nbsp;Example: the <code class="classname">PropertyOverrideConfigurer</code></h4></div></div></div><p>The <code class="classname">PropertyOverrideConfigurer</code>, another bean
                factory post-processor, is similar to the
                <code class="interfacename">PropertyPlaceholderConfigurer</code>, but in contrast to the
                latter, the original definitions can have default values or no values at
                all for bean properties. If an overriding <code class="classname">Properties</code> file
                does not have an entry for a certain bean property, the default context definition
                is used.</p><p>Note that the bean factory definition is <span class="emphasis"><em>not</em></span>
                aware of being overridden, so it is not immediately obvious when looking
                at the XML definition file that the override configurer is being used.
                In case that there are multiple <code class="classname">PropertyOverrideConfigurer</code>
                instances that define different values for the same bean property, the last one
                will win (due to the overriding mechanism).</p><p>Properties file configuration lines are expected to be in the format:</p><pre class="programlisting">beanName.property=value</pre><p>An example properties file might look like this:</p><pre class="programlisting">dataSource.driverClassName=com.mysql.jdbc.Driver
dataSource.url=jdbc:mysql:mydb</pre><p>This example file would be usable against a container definition
                which contains a bean called <span class="emphasis"><em>dataSource</em></span>,
                which has <span class="emphasis"><em>driver</em></span> and <span class="emphasis"><em>url</em></span>
                properties.</p><p>Note that compound property names are also supported, as long as
                every component of the path except the final property being overridden is
                already non-null (presumably initialized by the constructors). In this
                example...</p><pre class="programlisting">foo.fred.bob.sammy=123</pre><p>... the <code class="literal">sammy</code> property of the <code class="literal">bob</code> property
                of the <code class="literal">fred</code> property of the <code class="literal">foo</code>
                bean is being set to the scalar value <code class="literal">123</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-extension-factorybean"></a>3.7.3.&nbsp;Customizing instantiation logic using <code class="literal">FactoryBeans</code></h3></div></div></div><p>The <code class="interfacename">org.springframework.beans.factory.FactoryBean</code>
            interface is to be implemented by objects that <span class="emphasis"><em>are themselves
            factories</em></span>.</p><p>The <code class="interfacename">FactoryBean</code> interface is a point of pluggability
            into the Spring IoC containers instantiation logic. If you have some complex
            initialization code that is better expressed in Java as opposed to a (potentially)
            verbose amount of XML, you can create your own <code class="interfacename">FactoryBean</code>,
            write the complex initialization inside that class, and then plug your custom
            <code class="interfacename">FactoryBean</code> into the container.</p><p>The <code class="interfacename">FactoryBean</code> interface provides three methods:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="methodname">Object getObject()</code>: has to return an
                    instance of the object this factory creates. The instance can
                    possibly be shared (depending on whether this factory returns
                    singletons or prototypes).</p></li><li><p><code class="methodname">boolean isSingleton()</code>: has to return
                    <code class="literal">true</code> if this <code class="interfacename">FactoryBean</code>
                    returns singletons, <code class="literal">false</code> otherwise</p></li><li><p><code class="methodname">Class getObjectType()</code>: has to return
                    either the object type returned by the
                    <code class="methodname">getObject()</code> method or <code class="literal">null</code>
                    if the type isn't known in advance</p></li></ul></div><p>The <code class="interfacename">FactoryBean</code> concept and interface
            is used in a number of places within the Spring Framework; at the time of writing
            there are over 50 implementations of the <code class="interfacename">FactoryBean</code>
            interface that ship with Spring itself.</p><p>Finally, there is sometimes a need to ask a container for an actual
            <code class="interfacename">FactoryBean</code> instance itself, not the bean it produces.
            This may be achieved by prepending the bean id with <code class="literal">'&amp;'</code>
            (sans quotes) when calling the <code class="methodname">getBean</code> method of
            the <code class="interfacename">BeanFactory</code> (including
            <code class="interfacename">ApplicationContext</code>). So for a given
            <code class="interfacename">FactoryBean</code> with an id of <code class="literal">myBean</code>,
            invoking <code class="literal">getBean("myBean")</code> on the container will return the
            product of the <code class="interfacename">FactoryBean</code>, but invoking
            <code class="literal">getBean("&amp;myBean")</code> will return the
            <code class="interfacename">FactoryBean</code> instance itself.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="context-introduction"></a>3.8.&nbsp;The <code class="interfacename">ApplicationContext</code></h2></div></div></div><p>While the <code class="literal">beans</code> package provides basic
        functionality for managing and manipulating beans, often in a programmatic
        way, the <code class="literal">context</code> package adds
        <code class="literal"><a href="http://www.springframework.org/docs/api/org/springframework/context/ApplicationContext.html" target="_top">ApplicationContext</a></code>,
        which enhances <code class="interfacename">BeanFactory</code> functionality in a more
        <span class="emphasis"><em>framework-oriented style</em></span>. Many users will use
        <code class="interfacename">ApplicationContext</code> in a completely declarative fashion,
        not even having to create it manually, but instead relying on support classes such as
        <code class="classname">ContextLoader</code> to automatically start an <code class="interfacename">ApplicationContext</code> as part of the
        normal startup process of a J2EE web-app. Of course, it is still possible
        to programmatically create an ApplicationContext.</p><p>The basis for the context package is the
        <code class="interfacename">ApplicationContext</code> interface, located in the
        <code class="literal">org.springframework.context</code> package. Deriving from the
        <code class="interfacename">BeanFactory</code> interface, it provides all the functionality of
        <code class="interfacename">BeanFactory</code>. To allow working in a more framework-oriented
        fashion, using layering and hierarchical contexts, the context package also provides the
        following functionality:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="interfacename">MessageSource</code>, providing access to
                    messages in i18n-style</p></li><li><p><span class="emphasis"><em>Access to resources</em></span>, such as URLs and files</p></li><li><p><span class="emphasis"><em>Event propagation</em></span> to beans implementing
                    the <code class="interfacename">ApplicationListener</code> interface</p></li><li><p><span class="emphasis"><em>Loading of multiple (hierarchical)
                    contexts</em></span>, allowing each to be focused on one particular
                    layer, for example the web layer of an application</p></li></ul></div><p>As the <code class="interfacename">ApplicationContext</code> includes all functionality of the
        <code class="interfacename">BeanFactory</code>, it is generally recommended that it be used over the
        <code class="interfacename">BeanFactory</code>, except for a few limited situations such as perhaps in an
        <code class="classname">Applet</code>, where memory consumption might be critical, and a few extra
        kilobytes might make a difference. The following sections describe
        functionality that <code class="interfacename">ApplicationContext</code> adds to basic <code class="interfacename">BeanFactory</code>
        capabilities.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="context-functionality-messagesource"></a>3.8.1.&nbsp;Internationalization using <code class="literal">MessageSources</code></h3></div></div></div><p>The <code class="interfacename">ApplicationContext</code> interface extends an interface called
            <code class="interfacename">MessageSource</code>, and therefore provides messaging (i18n
            or internationalization) functionality. Together with the
            <code class="classname">HierarchicalMessageSource</code>, capable of resolving
            hierarchical messages, these are the basic interfaces Spring provides to
            do message resolution. Let's quickly review the methods defined there:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">String getMessage(String code, Object[] args,
                        String default, Locale loc)</code>: the basic method used to
                        retrieve a message from the <code class="interfacename">MessageSource</code>. When no message is
                        found for the specified locale, the default message is used. Any
                        arguments passed in are used as replacement values, using the
                        <code class="literal">MessageFormat</code> functionality provided by the
                        standard library.</p></li><li><p><code class="literal">String getMessage(String code, Object[] args,
                        Locale loc)</code>: essentially the same as the previous
                        method, but with one difference: no default message can be
                        specified; if the message cannot be found, a
                        <code class="classname">NoSuchMessageException</code> is thrown.</p></li><li><p><code class="literal">String getMessage(MessageSourceResolvable
						resolvable, Locale locale)</code>: all properties used in the
						methods above are also wrapped in a class named
						<code class="interfacename">MessageSourceResolvable</code>, which you can use via
						this method.</p></li></ul></div><p>
				When an <code class="interfacename">ApplicationContext</code> gets loaded, it automatically searches
				for a <code class="interfacename">MessageSource</code> bean defined in the context. The bean has to have
				the name <code class="literal">'messageSource'</code>. If such a bean is found, all calls to the methods
				described above will be delegated to the message source that was found. If no message source was
				found, the <code class="interfacename">ApplicationContext</code> attempts to see if it has a parent
				containing a bean with the same name. If so, it uses that bean as the
				<code class="interfacename">MessageSource</code>. If it can't find any source for messages, an empty
				<code class="classname">StaticMessageSource</code> will be instantiated in order to be able to accept calls
				to the methods defined above.
			</p><p>
				Spring currently provides two <code class="interfacename">MessageSource</code>
				implementations. These are the <code class="classname">ResourceBundleMessageSource</code> and the
				<code class="classname">StaticMessageSource</code>. Both implement
				<code class="interfacename">HierarchicalMessageSource</code> in order to do nested messaging.
				The <code class="classname">StaticMessageSource</code> is hardly ever used but provides programmatic
				ways to add messages to the source. The <code class="classname">ResourceBundleMessageSource</code> is
				more interesting and is the one we will provide an example for:
      		</p><pre class="programlisting">&lt;beans&gt;
  &lt;bean id="messageSource"
        class="org.springframework.context.support.ResourceBundleMessageSource"&gt;
    &lt;property name="basenames"&gt;
      &lt;list&gt;
        &lt;value&gt;format&lt;/value&gt;
        &lt;value&gt;exceptions&lt;/value&gt;
        &lt;value&gt;windows&lt;/value&gt;
      &lt;/list&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
&lt;/beans&gt;</pre><p>This assumes you have three resource bundles defined on your
      classpath called <code class="literal">format</code>,
      <code class="literal">exceptions</code> and <code class="literal">windows</code>. Using the
      JDK standard way of resolving messages through ResourceBundles, any
      request to resolve a message will be handled. For the purposes of the example,
      lets assume the contents of two of the above resource bundle files are...</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation"># in 'format.properties'</span></em>
message=Alligators rock!</pre><pre class="programlisting"><em class="lineannotation"><span class="lineannotation"># in 'exceptions.properties'</span></em>
argument.required=The '{0}' argument is required.</pre><p>Some (admittedly trivial) driver code to exercise the
        <code class="classname">MessageSource</code> functionality can be found below. Remember
        that all <code class="classname">ApplicationContext</code> implementations are also
        <code class="classname">MessageSource</code> implementations and so can be cast to the
        <code class="classname">MessageSource</code> interface.</p><pre class="programlisting">public static void main(String[] args) {
    MessageSource resources = new ClassPathXmlApplicationContext("beans.xml");
    String message = resources.getMessage("message", null, "Default", null);
    System.out.println(message);
}</pre><p>The resulting output from the above program will be...</p><pre class="programlisting">Alligators rock!</pre><p>So to summarize, the <code class="classname">MessageSource</code> is defined in a file
        called <code class="literal">'beans.xml'</code> (this file exists at the root of your classpath).
        The <code class="literal">'messageSource'</code> bean definition refers to a number
        of resource bundles via it's <code class="literal">basenames</code> property; the three files
        that are passed in the list to the <code class="literal">basenames</code> property exist as files
        at the root of your classpath (and are called
        <code class="literal">format.properties</code>, <code class="literal">exceptions.properties</code>,
        and <code class="literal">windows.properties</code> respectively).</p><p>Lets look at another example, and this time we will look at passing arguments
        to the message lookup; these arguments will be converted into strings and inserted
        into placeholders in the lookup message. This is perhaps best explained with an
        example:</p><pre class="programlisting">&lt;beans&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- this <code class="interfacename">MessageSource</code> is being used in a web application --&gt;</span></em>
    &lt;bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource"&gt;
        &lt;property name="baseName" value="WEB-INF/test-messages"/&gt;
    &lt;/bean&gt;
    
    <em class="lineannotation"><span class="lineannotation">&lt;!-- let's inject the above <code class="interfacename">MessageSource</code> into this POJO --&gt;</span></em>
    &lt;bean id="example" class="com.foo.Example"&gt;
        &lt;property name="messages" ref="messageSource"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre><pre class="programlisting">public class Example {

    private MessageSource messages;

    public void setMessages(MessageSource messages) {
        this.messages = messages;
    }

    public void execute() {
        String message = this.messages.getMessage("argument.required",
            new Object [] {"userDao"}, "Required", null);
        System.out.println(message);
    }

}</pre><p>The resulting output from the invocation of the <code class="methodname">execute()</code>
            method will be...</p><pre class="programlisting">The 'userDao' argument is required.</pre><p>With regard to internationalization (i18n), Spring's various
        <code class="classname">MessageResource</code> implementations follow the same locale resolution
        and fallback rules as the standard JDK <code class="classname">ResourceBundle</code>. In short, and continuing with
        the example <code class="literal">'messageSource'</code> defined previously, if you want to resolve
        messages against the British (en-GB) locale, you would create files called
        <code class="literal">format_en_GB.properties</code>, <code class="literal">exceptions_en_GB.properties</code>,
        and <code class="literal">windows_en_GB.properties</code> respectively.</p><p>Locale resolution is typically going to be managed by the surrounding environment
        of the application. For the purpose of this example though, we'll just manually
        specify the locale that we want to resolve our (British) messages against.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation"># in 'exceptions_en_GB.properties'</span></em>
argument.required=Ebagum lad, the '{0}' argument is required, I say, required.</pre><pre class="programlisting">public static void main(final String[] args) {
    MessageSource resources = new ClassPathXmlApplicationContext("beans.xml");
    String message = resources.getMessage("argument.required",
        new Object [] {"userDao"}, "Required", Locale.UK);
    System.out.println(message);
}</pre><p>The resulting output from the running of the above program will be...</p><pre class="programlisting">Ebagum lad, the 'userDao' argument is required, I say, required.</pre><p>The <code class="classname">MessageSourceAware</code> interface can also be used to acquire
            a reference to any <code class="classname">MessageSource</code> that has been defined. Any bean
            that is defined in an <code class="classname">ApplicationContext</code> that implements the
            <code class="classname">MessageSourceAware</code> interface will be injected with the
            application context's <code class="classname">MessageSource</code> when it (the bean) is being
            created and configured.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="context-functionality-events"></a>3.8.2.&nbsp;Events</h3></div></div></div><p>Event handling in the <code class="interfacename">ApplicationContext</code> is provided
			through the <code class="classname">ApplicationEvent</code> class and
			<code class="interfacename">ApplicationListener</code> interface. If a bean which
			implements the <code class="interfacename">ApplicationListener</code> interface is
			deployed into the context, every time an <code class="classname">ApplicationEvent</code>
			gets published to the <code class="interfacename">ApplicationContext</code>, that
			bean will be notified. Essentially, this is the standard <span class="emphasis"><em>Observer</em></span>
			design pattern. Spring provides	three standard events:</p><div class="table"><a name="beans-ctx-events-tbl"></a><p class="title"><b>Table&nbsp;3.5.&nbsp;Built-in Events</b></p><div class="table-contents"><table summary="Built-in Events" border="1"><colgroup><col><col></colgroup><thead><tr><th>Event</th><th>Explanation</th></tr></thead><tbody><tr><td>
                                <code class="classname">ContextRefreshedEvent</code>
                            </td><td>
                                <p>Published when the
                                <code class="interfacename">ApplicationContext</code> is
                                initialized or refreshed. Initialized here means that all
                                beans are loaded, singletons are pre-instantiated and the
                                <code class="interfacename">ApplicationContext</code> is ready
                                for use.</p>
                            </td></tr><tr><td>
                                <code class="classname">ContextClosedEvent</code>
                            </td><td>
                                <p>Published when the <code class="interfacename">ApplicationContext</code> is closed,
                                using the <code class="methodname">close()</code> method on the
                                <code class="interfacename">ApplicationContext</code>. Closed here means
                                that singleton beans (only!) are destroyed.</p>
                            </td></tr><tr><td>
                                <code class="classname">RequestHandledEvent</code>
                            </td><td>
                                <p>A web-specific event telling all beans that a HTTP
                                request has been serviced (this will be published
                                <span class="emphasis"><em>after</em></span> the request has been finished).
                                Note that this event is only applicable for web applications
                                using Spring's <code class="classname">DispatcherServlet</code>.</p>
                            </td></tr></tbody></table></div></div><br class="table-break"><p>Implementing custom events can be done as well. Simply call the
			<code class="methodname">publishEvent()</code> method on the <code class="interfacename">ApplicationContext</code>,
			specifying a parameter which is an instance of your custom event class
			implementing <code class="classname">ApplicationEvent</code>. Event listeners receive events
			synchronously. This means the <code class="methodname">publishEvent()</code> method blocks until all
			listeners have finished processing the event (it is possible to supply
			an alternate event publishing strategy via a
			<code class="interfacename">ApplicationEventMulticaster</code> implementation).
			Furthermore, when a listener receives an event it operates inside the transaction context of
			the publisher, if a transaction context is available.</p><p>Let's look at an example. First, the <code class="interfacename">ApplicationContext</code>:</p><pre class="programlisting">&lt;bean id="emailer" class="example.EmailBean"&gt;
  &lt;property name="blackList"&gt;
    &lt;list&gt;
      &lt;value&gt;black@list.org&lt;/value&gt;
      &lt;value&gt;white@list.org&lt;/value&gt;
      &lt;value&gt;john@doe.org&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="blackListListener" class="example.BlackListNotifier"&gt;
  &lt;property name="notificationAddress" value="spam@list.org"/&gt;
&lt;/bean&gt;</pre><p>Now, let's look at the actual classes:</p><pre class="programlisting">public class EmailBean implements ApplicationContextAware {

    private List blackList;
	private ApplicationContext ctx;

    public void setBlackList(List blackList) {
        this.blackList = blackList;
    }

    public void setApplicationContext(ApplicationContext ctx) {
        this.ctx = ctx;
    }

    public void sendEmail(String address, String text) {
        if (blackList.contains(address)) {
            BlackListEvent evt = new BlackListEvent(address, text);
            ctx.publishEvent(evt);
            return;
        }
        <em class="lineannotation"><span class="lineannotation">// send email...</span></em>
    }
}</pre><pre class="programlisting">public class BlackListNotifier implements ApplicationListener {

    private String notificationAddress;
    
    public void setNotificationAddress(String notificationAddress) {
        this.notificationAddress = notificationAddress;
    }

    public void onApplicationEvent(ApplicationEvent evt) {
        if (evt instanceof BlackListEvent) {
            <em class="lineannotation"><span class="lineannotation">// notify appropriate person...</span></em>
        }
    }
}</pre><p>Of course, this particular example could probably be
			implemented in better ways (perhaps by using AOP features), but it
			should be sufficient to illustrate the basic event mechanism.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="context-functionality-resources"></a>3.8.3.&nbsp;Convenient access to low-level resources</h3></div></div></div><p>For optimal usage and understanding of application contexts, users
			should generally familiarize themselves with Spring's
			<code class="interfacename">Resource</code> abstraction, as described
			in the chapter entitled <a href="#resources" title="Chapter&nbsp;4.&nbsp;Resources">Chapter&nbsp;4, <i>Resources</i></a>.</p><p>
				An application context is a <code class="interfacename">ResourceLoader</code>,
				able to be used to load <code class="interfacename">Resource</code>s. A
				<code class="interfacename">Resource</code> is essentially a
				<code class="literal">java.net.URL</code> on steroids (in fact, it just wraps and
				uses a URL where appropriate), which can be used to obtain low-level
				resources from almost any location in a transparent fashion, including
				from the classpath, a filesystem location, anywhere describable with a
				standard URL, and some other variations. If the resource location string
				is a simple path without any special prefixes, where those resources
				come from is specific and appropriate to the actual application context
				type.
			</p><p>A bean deployed into the application context may implement the
			special marker interface, <code class="interfacename">ResourceLoaderAware</code>, to be
			automatically called back at initialization time with the application
			context itself passed in as the <code class="interfacename">ResourceLoader</code>.
			A bean may also expose properties of type
			<code class="interfacename">Resource</code>, to be used to access static resources, and
			expect that they will be injected into it like any other properties. The
			person deploying the bean may specify those <code class="interfacename">Resource</code>
			properties as simple String paths, and rely on a special JavaBean
			<code class="interfacename">PropertyEditor</code> that is automatically registered
			by the context, to convert those text strings to actual <code class="interfacename">Resource</code>
			objects.</p><p>The location path or paths supplied to an <code class="interfacename">ApplicationContext</code>
			constructor are actually resource strings, and in simple form are
			treated appropriately to the specific context implementation (
			<code class="classname">ClassPathXmlApplicationContext</code> treats a simple location path as a
			classpath location), but may also be used with special prefixes to force
			loading of definitions from the classpath or a URL, regardless of the
			actual context type.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="context-create"></a>3.8.4.&nbsp;Convenient <code class="interfacename">ApplicationContext</code> instantiation for web applications</h3></div></div></div><p>As opposed to the <code class="interfacename">BeanFactory</code>, which will
			often be created programmatically, <code class="interfacename">ApplicationContext</code>
			instances can be created declaratively using for example a
			<code class="classname">ContextLoader</code>. Of course you can also create
			<code class="interfacename">ApplicationContext</code> instances programmatically
			using one of the <code class="interfacename">ApplicationContext</code> implementations.
			First, let's examine the <code class="classname">ContextLoader</code> mechanism
			and its implementations.</p><p>The <code class="classname">ContextLoader</code> mechanism comes in two
            flavors: the <code class="classname">ContextLoaderListener</code> and the
			<code class="classname">ContextLoaderServlet</code>. They both have the same
			functionality but differ in that the listener version cannot be reliably used in
			Servlet 2.3 containers. Since the Servlet 2.4 specification, servlet context
			listeners are required to execute immediately after the servlet context for the
			web application has been created and is available to service the first request
			(and also when the servlet context is about to be shut down): as such a 
			servlet context listener is an ideal place to initialize the Spring
			<code class="interfacename">ApplicationContext</code>. It is up to you
			as to which one you use, but all things being equal you should probably
			prefer <code class="classname">ContextLoaderListener</code>; for more information on
			compatibility, have a look at the Javadoc for the
			<code class="classname">ContextLoaderServlet</code>.</p><p>You can register an <code class="interfacename">ApplicationContext</code> using the
			<code class="classname">ContextLoaderListener</code> as follows:</p><pre class="programlisting">&lt;context-param&gt;
  &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
  &lt;param-value&gt;/WEB-INF/daoContext.xml /WEB-INF/applicationContext.xml&lt;/param-value&gt;
&lt;/context-param&gt;

&lt;listener&gt;
  &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
&lt;/listener&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- or use the <code class="classname">ContextLoaderServlet</code> instead of the above listener</span></em><span class="emphasis"><em>
&lt;servlet&gt;
  &lt;servlet-name&gt;context&lt;/servlet-name&gt;
  &lt;servlet-class&gt;org.springframework.web.context.ContextLoaderServlet&lt;/servlet-class&gt;
  &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
--</em></span>&gt;</pre><p>The listener inspects the
			<code class="literal">'contextConfigLocation'</code> parameter. If the parameter does not exist,
			the listener will use <code class="literal">/WEB-INF/applicationContext.xml</code> as a default.
			When it <span class="emphasis"><em>does</em></span> exist, it will separate the String using
			predefined delimiters (comma, semi-colon and whitespace) and use the values as
			locations where application contexts will be searched for. Ant-style path patterns
			are supported as well: e.g. <code class="literal">/WEB-INF/*Context.xml</code>
			(for all files whose name ends with "Context.xml", residing in the "WEB-INF" directory)
			or <code class="literal">/WEB-INF/**/*Context.xml</code> (for all such files in any subdirectory
			of "WEB-INF").</p><p>The <code class="classname">ContextLoaderServlet</code> can be used instead of
			the <code class="classname">ContextLoaderListener</code>. The servlet will use the
			<code class="literal">'contextConfigLocation'</code> parameter just as the listener does.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-glue-code-and-singletons"></a>3.9.&nbsp;Glue code and the evil singleton</h2></div></div></div><p>The majority of the code inside an application is best written in a
		DI style, where that code is served out of a Spring IoC container, has its own
		dependencies supplied by the container when it is created, and is
		completely unaware of the container. However, for the small glue layers of
		code that are sometimes needed to tie other code together, there is
		sometimes a need for singleton (or quasi-singleton) style access to a
		Spring IoC container. For example,
		third party code may try to construct new objects directly (<code class="literal">Class.forName()</code>
		style), without the ability to force it to get these objects out of a
		Spring IoC container. If the object constructed by the
		third party code is just a small stub or proxy, which then uses a singleton style access to a
		Spring IoC container to get a real object to delegate to, then inversion of control has
		still been achieved for the majority of the code (the object coming out of the
		container); thus most code is still	unaware of the container or how it is accessed, and
		remains uncoupled from other code, with all ensuing benefits. EJBs may also use this stub/proxy
		approach to delegate to a plain Java implementation object, coming out of
		a Spring IoC container. While the Spring IoC container itself ideally does not have to be a
		singleton, it may be unrealistic in terms of memory usage or initialization times (when
		using beans in the Spring IoC container such as a Hibernate
		<code class="interfacename">SessionFactory</code>) for each bean to use its own, non-singleton
		Spring IoC container.</p><p>As another example, in complex J2EE apps with multiple layers
        (various JAR files, EJBs, and WAR files packaged as an EAR),
        with each layer having its own Spring IoC container definition
        (effectively forming a hierarchy), the preferred approach when
        there is only one web-app (WAR) in the top hierarchy is to simply
        create one composite Spring IoC container from the multiple XML definition
        files from each layer. All of the various Spring IoC container implementations
        may be constructed from multiple definition files in this fashion.
        However, if there are multiple sibling web-applications at the root
        of the hierarchy, it is problematic to create a
        Spring IoC container for each web-application
        which consists of mostly identical bean definitions from lower layers,
        as there may be issues due to increased memory usage, issues with
        creating multiple copies of beans which take a long time to initialize
        (for example a Hibernate <code class="interfacename">SessionFactory</code>), and
        possible issues due to side-effects. As an alternative, classes such as
        <code class="literal"><a href="http://www.springframework.org/docs/api/org/springframework/context/access/ContextSingletonBeanFactoryLocator.html" target="_top">ContextSingletonBeanFactoryLocator</a></code>
        or
        <code class="literal"><a href="http://www.springframework.org/docs/api/org/springframework/beans/factory/access/SingletonBeanFactoryLocator.html" target="_top">SingletonBeanFactoryLocator</a></code>
        may be used to demand-load multiple hierarchical (that is one container is the parent of
        another) Spring IoC container instances in a singleton fashion,
        which may then be used as the parents of the web-application Spring IoC
        container instances. The result is that bean definitions for lower layers are
        loaded only as needed, and loaded only once.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-singleton-helper"></a>3.9.1.&nbsp;Using the Singleton-helper classes</h3></div></div></div><p>You can see a detailed example of their usage in
            <a href="http://www.springframework.org/docs/api/org/springframework/beans/factory/access/SingletonBeanFactoryLocator.html" target="_top">SingletonBeanFactoryLocator</a>
            and
            <a href="http://www.springframework.org/docs/api/org/springframework/context/access/ContextSingletonBeanFactoryLocator.html" target="_top">ContextSingletonBeanFactoryLocator</a>
            by viewing their respective Javadocs.</p><p>As mentioned in the <a href="#ejb" title="Chapter&nbsp;18.&nbsp;Enterprise Java Bean (EJB) integration">chapter on EJBs</a>, the
            Spring convenience base classes for EJBs normally use a non-singleton
            <code class="interfacename">BeanFactoryLocator</code> implementation, which is
            easily replaced by the use of <code class="classname">SingletonBeanFactoryLocator</code>
            and <code class="classname">ContextSingletonBeanFactoryLocator</code> if there is
            a need.</p></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d0e806" href="#d0e806">1</a>] </sup>See the section entitled <a href="#background-ioc" title="Background">Background</a></p></div><div class="footnote"><p><sup>[<a name="ftn.d0e2886" href="#d0e2886">2</a>] </sup>See the section entitled <a href="#beans-factory-collaborators" title="3.3.1.&nbsp;Injecting dependencies">Section&nbsp;3.3.1, &#8220;Injecting dependencies&#8221;</a></p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="resources"></a>Chapter&nbsp;4.&nbsp;Resources</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-introduction"></a>4.1.&nbsp;Introduction</h2></div></div></div><p>Java's standard <code class="classname">java.net.URL</code> class and
    standard handlers for various URL prefixes unfortunately are not quite
    adequate enough for all access to low-level resources. For example,
	there is no standardized <code class="classname">URL</code> implementation
	that may be used to access a resource that needs to be obtained from
	the classpath, or relative to a
	<code class="interfacename">ServletContext</code>. While it is possible
    to register new handlers for specialized <code class="classname">URL</code>
	prefixes (similar to existing handlers for prefixes such as
	<code class="literal">http:</code>), this is generally quite complicated, and the
	<code class="classname">URL</code> interface still lacks some desirable
    functionality, such as a method to check for the existence of the
	resource being pointed to.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-resource"></a>4.2.&nbsp;The <code class="interfacename">Resource</code> interface</h2></div></div></div><p>Spring's <code class="interfacename">Resource</code> interface is meant
    to be a more capable interface for abstracting access to low-level
    resources.</p><pre class="programlisting">public interface Resource extends InputStreamSource {

    boolean exists();

    boolean isOpen();

    URL getURL() throws IOException;

    File getFile() throws IOException;

    Resource createRelative(String relativePath) throws IOException;

    String getFilename();

    String getDescription();
}</pre><pre class="programlisting">public interface InputStreamSource {

    InputStream getInputStream() throws IOException;
}</pre><p>Some of the most important methods from the
    <code class="interfacename">Resource</code> interface are:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="methodname">getInputStream()</code>: locates and opens the
        resource, returning an <code class="classname">InputStream</code> for reading
        from the resource. It is expected that each invocation returns a
        fresh <code class="classname">InputStream</code>. It is the responsibility of
        the caller to close the stream.</p></li><li><p><code class="methodname">exists()</code>: returns a
        <code class="literal">boolean</code> indicating whether this resource actually
        exists in physical form.</p></li><li><p><code class="methodname">isOpen()</code>: returns a
        <code class="literal">boolean</code> indicating whether this resource represents
        a handle with an open stream. If <code class="literal">true</code>, the
        <code class="classname">InputStream</code> cannot be read multiple times, and
        must be read once only and then closed to avoid resource leaks. Will
        be <code class="literal">false</code> for all usual resource implementations,
        with the exception of
        <code class="classname">InputStreamResource</code>.</p></li><li><p><code class="methodname">getDescription()</code>: returns a description
        for this resource, to be used for error output when working with the
        resource. This is often the fully qualified file name or the actual
        URL of the resource.</p></li></ul></div><p>Other methods allow you to obtain an actual
    <code class="classname">URL</code> or <code class="classname">File</code> object
    representing the resource (if the underlying implementation is compatible,
    and supports that functionality).</p><p>The <code class="interfacename">Resource</code> abstraction is used
    extensively in Spring itself, as an argument type in many method
    signatures when a resource is needed. Other methods in some Spring APIs
    (such as the constructors to various
    <code class="interfacename">ApplicationContext</code> implementations), take a
    <code class="classname">String</code> which in unadorned or simple form is used to
    create a <code class="interfacename">Resource</code> appropriate to that
    context implementation, or via special prefixes on the
    <code class="classname">String</code> path, allow the caller to specify that a
    specific <code class="interfacename">Resource</code> implementation must be
    created and used.</p><p>While the <code class="interfacename">Resource</code> interface is used
    a lot with Spring and by Spring, it's actually very useful to use as a
    general utility class by itself in your own code, for access to resources,
    even when your code doesn't know or care about any other parts of Spring.
    While this couples your code to Spring, it really only couples it to this
    small set of utility classes, which are serving as a more capable
    replacement for <code class="classname">URL</code>, and can be considered
    equivalent to any other library you would use for this purpose.</p><p>It is important to note that the
    <code class="interfacename">Resource</code> abstraction does not replace
    functionality: it wraps it where possible. For example, a
    <code class="classname">UrlResource</code> wraps a URL, and uses the wrapped
    <code class="classname">URL</code> to do it's work.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-implementations"></a>4.3.&nbsp;Built-in <code class="interfacename">Resource</code> implementations</h2></div></div></div><p>There are a number of <code class="interfacename">Resource</code>
    implementations that come supplied straight out of the box in
    Spring:</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-urlresource"></a>4.3.1.&nbsp;<code class="classname">UrlResource</code></h3></div></div></div><p>The <code class="classname">UrlResource</code> wraps a
      <code class="classname">java.net.URL</code>, and may be used to access any
      object that is normally accessible via a URL, such as files, an HTTP
      target, an FTP target, etc. All URLs have a standardized
      <code class="classname">String</code> representation, such that appropriate
      standardized prefixes are used to indicate one URL type from another.
      This includes <code class="literal">file:</code> for accessing filesystem paths,
      <code class="literal">http:</code> for accessing resources via the HTTP protocol,
      <code class="literal">ftp:</code> for accessing resources via FTP, etc.</p><p>A <code class="classname">UrlResource</code> is created by Java code
      explicitly using the <code class="classname">UrlResource</code> constructor, but
      will often be created implicitly when you call an API method which takes
      a <code class="classname">String</code> argument which is meant to represent a
      path. For the latter case, a JavaBeans
      <code class="interfacename">PropertyEditor</code> will ultimately decide
      which type of <code class="interfacename">Resource</code> to create. If the
      path string contains a few well-known (to it, that is) prefixes such as
      <code class="literal">classpath:</code>, it will create an appropriate specialized
      <code class="interfacename">Resource</code> for that prefix. However, if it
      doesn't recognize the prefix, it will assume the this is just a standard
      URL string, and will create a <code class="classname">UrlResource</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-classpathresource"></a>4.3.2.&nbsp;<code class="classname">ClassPathResource</code></h3></div></div></div><p>This class represents a resource which should be obtained from the
      classpath. This uses either the thread context class loader, a given
      class loader, or a given class for loading resources.</p><p>This <code class="interfacename">Resource</code> implementation
      supports resolution as <code class="classname">java.io.File</code> if the class
      path resource resides in the file system, but not for classpath
      resources which reside in a jar and have not been expanded (by the
      servlet engine, or whatever the environment is) to the filesystem. To
      address this the various <code class="interfacename">Resource</code>
      implementations always support resolution as a
      <code class="classname">java.net.URL</code>.</p><p>A <code class="classname">ClassPathResource</code> is created by Java code
      explicitly using the <code class="classname">ClassPathResource</code>
      constructor, but will often be created implicitly when you call an API
      method which takes a <code class="classname">String</code> argument which is
      meant to represent a path. For the latter case, a JavaBeans
      <code class="interfacename">PropertyEditor</code> will recognize the special
      prefix <code class="literal">classpath:</code>on the string path, and create a
      <code class="classname">ClassPathResource</code> in that case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-filesystemresource"></a>4.3.3.&nbsp;<code class="classname">FileSystemResource</code></h3></div></div></div><p>This is a <code class="interfacename">Resource</code> implementation
      for <code class="classname">java.io.File</code> handles. It obviously supports
      resolution as a <code class="classname">File</code>, and as a
      <code class="classname">URL</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-servletcontextresource"></a>4.3.4.&nbsp;<code class="classname">ServletContextResource</code></h3></div></div></div><p>This is a <code class="interfacename">Resource</code> implementation
      for <code class="interfacename">ServletContext</code> resources,
      interpreting relative paths within the relevant web application's root
      directory.</p><p>This always supports stream access and URL access, but only allows
      <code class="classname">java.io.File</code> access when the web application
      archive is expanded and the resource is physically on the filesystem.
      Whether or not it's expanded and on the filesystem like this, or
      accessed directly from the JAR or somewhere else like a DB (it's
      conceivable) is actually dependent on the Servlet container.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-inputstreamresource"></a>4.3.5.&nbsp;<code class="classname">InputStreamResource</code></h3></div></div></div><p>A <code class="interfacename">Resource</code> implementation for a
      given <code class="interfacename">InputStream</code>. This should only be
      used if no specific <code class="interfacename">Resource</code>
      implementation is applicable. In particular, prefer
      <code class="classname">ByteArrayResource</code> or any of the file-based
      <code class="interfacename">Resource</code> implementations where
      possible.</p><p>In contrast to other <code class="interfacename">Resource</code>
      implementations, this is a descriptor for an
      <span class="emphasis"><em>already</em></span> opened resource - therefore returning
      <code class="literal">true</code> from <code class="methodname">isOpen()</code>. Do not
      use it if you need to keep the resource descriptor somewhere, or if you
      need to read a stream multiple times.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-bytearrayresource"></a>4.3.6.&nbsp;<code class="classname">ByteArrayResource</code></h3></div></div></div><p>This is a <code class="interfacename">Resource</code> implementation
      for a given byte array. It creates a
      <code class="classname">ByteArrayInputStream</code> for the given byte
      array.</p><p>It's useful for loading content from any given byte array, without
      having to resort to a single-use
      <code class="classname">InputStreamResource</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-resourceloader"></a>4.4.&nbsp;The <code class="interfacename">ResourceLoader</code></h2></div></div></div><p>The <code class="interfacename">ResourceLoader</code> interface is meant
    to be implemented by objects that can return (i.e. load)
    <code class="interfacename">Resource</code> instances.</p><pre class="programlisting">public interface ResourceLoader {
    Resource getResource(String location);
}</pre><p>All application contexts implement the
    <code class="interfacename">ResourceLoader</code> interface, and therefore all
    application contexts may be used to obtain
    <code class="interfacename">Resource</code> instances.</p><p>When you call <code class="methodname">getResource()</code> on a specific
    application context, and the location path specified doesn't have a
    specific prefix, you will get back a
    <code class="interfacename">Resource</code> type that is appropriate to that
    particular application context. For example, assume the following snippet
    of code was executed against a
    <code class="classname">ClassPathXmlApplicationContext</code> instance:</p><pre class="programlisting">Resource template = ctx.getResource("some/resource/path/myTemplate.txt);</pre><p>What would be returned would be a
    <code class="classname">ClassPathResource</code>; if the same method was executed
    against a <code class="classname">FileSystemXmlApplicationContext</code> instance,
    you'd get back a <code class="classname">FileSystemResource</code>. For a
    <code class="classname">WebApplicationContext</code>, you'd get back a
    <code class="classname">ServletContextResource</code>, and so on.</p><p>As such, you can load resources in a fashion appropriate to the
    particular application context.</p><p>On the other hand, you may also force
    <code class="classname">ClassPathResource</code> to be used, regardless of the
    application context type, by specifying the special
    <code class="literal">classpath:</code> prefix:</p><pre class="programlisting">Resource template = ctx.getResource("classpath:some/resource/path/myTemplate.txt);</pre><p>Similarly, one can force a <code class="classname">UrlResource</code> to be
    used by specifying any of the standard <code class="classname">java.net.URL</code>
    prefixes:</p><pre class="programlisting">Resource template = ctx.getResource("file:/some/resource/path/myTemplate.txt);</pre><pre class="programlisting">Resource template = ctx.getResource("http://myhost.com/resource/path/myTemplate.txt);</pre><p>The following table summarizes the strategy for converting
    <code class="classname">String</code>s to
    <code class="interfacename">Resource</code>s:</p><div class="table"><a name="resources-resource-strings"></a><p class="title"><b>Table&nbsp;4.1.&nbsp;Resource strings</b></p><div class="table-contents"><table summary="Resource strings" width="100%" border="1"><colgroup><col align="left"><col><col></colgroup><thead><tr><th align="center">Prefix</th><th align="center">Example</th><th align="center">Explanation</th></tr></thead><tbody><tr><td align="left"><p>classpath:</p></td><td><p> <code class="literal">classpath:com/myapp/config.xml</code>
            </p></td><td><p>Loaded from the classpath.</p></td></tr><tr><td align="left"><p>file:</p></td><td><p> <code class="literal">file:/data/config.xml</code>
            </p></td><td><p> Loaded as a <code class="classname">URL</code>, from the
            filesystem. <sup>[<a name="d0e6499" href="#ftn.d0e6499">a</a>]</sup> </p></td></tr><tr><td align="left"><p>http:</p></td><td><p> <code class="literal">http://myserver/logo.png</code>
            </p></td><td><p>Loaded as a
            <code class="classname">URL</code>.</p></td></tr><tr><td align="left"><p>(none)</p></td><td><p> <code class="literal">/data/config.xml</code> </p></td><td><p> Depends on the underlying
            <code class="interfacename">ApplicationContext</code>. </p></td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a name="ftn.d0e6499" href="#d0e6499">a</a>] </sup>But see also the section entitled <a href="#resources-filesystemresource-caveats" title="4.7.3.&nbsp;FileSystemResource caveats">Section&nbsp;4.7.3, &#8220;<code class="classname">FileSystemResource</code> caveats&#8221;</a>.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-resourceloaderaware"></a>4.5.&nbsp;The <code class="interfacename">ResourceLoaderAware</code> interface</h2></div></div></div><p>The <code class="interfacename">ResourceLoaderAware</code> interface is
    a special marker interface, identifying objects that expect to be provided
    with a <code class="interfacename">ResourceLoader</code> reference.</p><pre class="programlisting">public interface ResourceLoaderAware {

   void setResourceLoader(ResourceLoader resourceLoader);
}</pre><p>When a class implements
    <code class="interfacename">ResourceLoaderAware</code> and is deployed into an
    application context (as a Spring-managed bean), it is recognized as
    <code class="interfacename">ResourceLoaderAware</code> by the application
    context. The application context will then invoke the
    <code class="methodname">setResourceLoader(ResourceLoader)</code>, supplying
    itself as the argument (remember, all application contexts in Spring
    implement the <code class="interfacename">ResourceLoader</code>
    interface).</p><p>Of course, since an
    <code class="interfacename">ApplicationContext</code> is a
    <code class="interfacename">ResourceLoader</code>, the bean could also
    implement the <code class="interfacename">ApplicationContextAware</code>
    interface and use the supplied application context directly to load
    resources, but in general, it's better to use the specialized
    <code class="interfacename">ResourceLoader</code> interface if that's all
    that's needed. The code would just be coupled to the resource loading
    interface, which can be considered a utility interface, and not the whole
    Spring <code class="interfacename">ApplicationContext</code> interface.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-as-dependencies"></a>4.6.&nbsp;<code class="literal">Resources</code> as dependencies</h2></div></div></div><p>If the bean itself is going to determine and supply the resource
    path through some sort of dynamic process, it probably makes sense for the
    bean to use the <code class="interfacename">ResourceLoader</code> interface to
    load resources. Consider as an example the loading of a template of some
    sort, where the specific resource that is needed depends on the role of
    the user. If the resources are static, it makes sense to eliminate the use
    of the <code class="interfacename">ResourceLoader</code> interface completely,
    and just have the bean expose the <code class="interfacename">Resource</code>
    properties it needs, and expect that they will be injected into it.</p><p>What makes it trivial to then inject these properties, is that all
    application contexts register and use a special JavaBeans
    <code class="interfacename">PropertyEditor</code> which can convert
    <code class="classname">String</code> paths to
    <code class="interfacename">Resource</code> objects. So if
    <code class="literal">myBean</code> has a template property of type
    <code class="interfacename">Resource</code>, it can be configured with a
    simple string for that resource, as follows:</p><pre class="programlisting">&lt;bean id="myBean" class="..."&gt;
  &lt;property name="template" value="some/resource/path/myTemplate.txt"/&gt;
&lt;/bean&gt;</pre><p>Note that the resource path has no prefix, so because the
    application context itself is going to be used as the
    <code class="interfacename">ResourceLoader</code>, the resource itself will be
    loaded via a <code class="classname">ClassPathResource</code>,
    <code class="literal">FileSystemResource</code>, or
    <code class="classname">ServletContextResource</code> (as appropriate)
    depending on the exact type of the context.</p><p>If there is a need to force a specific
    <code class="interfacename">Resource</code> type to be used, then a prefix may
    be used. The following two examples show how to force a
    <code class="classname">ClassPathResource</code> and a
    <code class="classname">UrlResource</code> (the latter being used to access a
    filesystem file).</p><pre class="programlisting">&lt;property name="template" value="classpath:some/resource/path/myTemplate.txt"&gt;</pre><pre class="programlisting">&lt;property name="template" value="file:/some/resource/path/myTemplate.txt"/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-app-ctx"></a>4.7.&nbsp;Application contexts and <code class="interfacename">Resource</code> paths</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-app-ctx-construction"></a>4.7.1.&nbsp;Constructing application contexts</h3></div></div></div><p>An application context constructor (for a specific application
      context type) generally takes a string or array of strings as the
      location path(s) of the resource(s) such as XML files that make up the
      definition of the context.</p><p>When such a location path doesn't have a prefix, the specific
      <code class="interfacename">Resource</code> type built from that path and
      used to load the bean definitions, depends on and is appropriate to the
      specific application context. For example, if you create a
      <code class="classname">ClassPathXmlApplicationContext</code> as follows:</p><pre class="programlisting">ApplicationContext ctx = new ClassPathXmlApplicationContext("conf/appContext.xml");</pre><p>The bean definitions will be loaded from the classpath, as a
      <code class="classname"></code><code class="classname">ClassPathResource</code> will be
      used. But if you create a
      <code class="classname">FileSystemXmlApplicationContext</code> as
      follows:</p><pre class="programlisting">ApplicationContext ctx =
    new FileSystemXmlApplicationContext("conf/appContext.xml");</pre><p>The bean definition will be loaded from a filesystem location, in
      this case relative to the current working directory.</p><p>Note that the use of the special classpath prefix or a standard
      URL prefix on the location path will override the default type of
      <code class="interfacename">Resource</code> created to load the definition.
      So this <code class="classname">FileSystemXmlApplicationContext</code>...</p><pre class="programlisting">ApplicationContext ctx =
    new FileSystemXmlApplicationContext("classpath:conf/appContext.xml");</pre><p>... will actually load it's bean definitions from the classpath.
      However, it is still a <code class="classname">FileSystemXmlApplicationContext</code>. If it is
      subsequently used as a <code class="interfacename">ResourceLoader</code>,
      any unprefixed paths will still be treated as filesystem paths.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="resources-app-ctx-classpathxml"></a>4.7.1.1.&nbsp;Constructing <code class="classname">ClassPathXmlApplicationContext</code> instances - shortcuts</h4></div></div></div><p>The <code class="classname">ClassPathXmlApplicationContext</code>
        exposes a number of constructors to enable convenient instantiation.
        The basic idea is that one supplies merely a string array containing
        just the filenames of the XML files themselves (without the leading
        path information), and one <span class="emphasis"><em>also</em></span> supplies a
        <code class="classname">Class</code>; the
        <code class="classname">ClassPathXmlApplicationContext</code> will derive the
        path information from the supplied class.</p><p>An example will hopefully make this clear. Consider a directory
        layout that looks like this:</p><pre class="programlisting">com/
  foo/
    services.xml
    daos.xml
    MessengerService.class</pre><p>A <code class="classname">ClassPathXmlApplicationContext</code> instance
        composed of the beans defined in the <code class="literal">'services.xml'</code>
        and <code class="literal">'daos.xml'</code> could be instantiated like
        so...</p><pre class="programlisting">ApplicationContext ctx = new ClassPathXmlApplicationContext(
    new String[] {"services.xml", "daos.xml"}, MessengerService.class);</pre><p>Please do consult the Javadocs for the
        <code class="classname">ClassPathXmlApplicationContext</code> class for
        details of the various constructors.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-app-ctx-wildcards-in-resource-paths"></a>4.7.2.&nbsp;Wildcards in application context constructor resource paths</h3></div></div></div><p>The resource paths in application context constructor values may
      be a simple path (as shown above) which has a one-to-one mapping to a
      target Resource, or alternately may contain the special "classpath*:"
      prefix and/or internal Ant-style regular expressions (matched using
      Spring's <code class="classname">PathMatcher</code> utility). Both of the latter
      are effectively wildcards</p><p>One use for this mechanism is when doing component-style
      application assembly. All components can 'publish' context definition
      fragments to a well-known location path, and when the final application
      context is created using the same path prefixed via
      <code class="literal">classpath*:</code>, all component fragments will be picked
      up automatically.</p><p>Note that this wildcarding is specific to use of resource paths in
      application context constructors (or when using the
      <code class="classname">PathMatcher</code> utility class hierarchy directly),
      and is resolved at construction time. It has nothing to do with the
      <code class="interfacename">Resource</code> type itself. It's not possible
      to use the <code class="literal">classpath*:</code> prefix to construct an actual
      <code class="interfacename">Resource</code>, as a resource points to just
      one resource at a time.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="resources-app-ctx-ant-patterns-in-paths"></a>4.7.2.1.&nbsp;Ant-style Patterns</h4></div></div></div><p>When the path location contains an Ant-style pattern, for example:</p><pre class="programlisting">     /WEB-INF/*-context.xml
     com/mycompany/**/applicationContext.xml
     file:C:/some/path/*-context.xml
     classpath:com/mycompany/**/applicationContext.xml</pre><p>... the resolver follows a more complex but defined procedure to
        try to resolve the wildcard. It produces a Resource for the path up to
        the last non-wildcard segment and obtains a URL from it. If this URL
        is not a "jar:" URL or container-specific variant (e.g.
        "<code class="literal">zip:</code>" in WebLogic, "<code class="literal">wsjar</code>" in
        WebSphere, etc.), then a <code class="methodname">java.io.File</code> is
        obtained from it, and used to resolve the wildcard by walking the
        filesystem. In the case of a jar URL, the resolver either gets a
        <code class="classname">java.net.JarURLConnection</code> from it, or manually
        parse the jar URL, and then traverse the contents of the jar file, to
        resolve the wildcards.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="resources-app-ctx-portability"></a>4.7.2.1.1.&nbsp;Implications on portability</h5></div></div></div><p>If the specified path is already a file URL (either
          explicitly, or implicitly because the base
		  <code class="interfacename">ResourceLoader</code> is a
          filesystem one, then wildcarding is guaranteed to work in a
          completely portable fashion.</p><p>If the specified path is a classpath location, then the
          resolver must obtain the last non-wildcard path segment URL via a
          <code class="methodname">Classloader.getResource()</code> call. Since this
          is just a node of the path (not the file at the end) it is actually
          undefined (in the <code class="classname">ClassLoader</code> Javadocs)
          exactly what sort of a URL is returned in this case. In practice, it
          is always a <code class="classname">java.io.File</code> representing the
          directory, where the classpath resource resolves to a filesystem
          location, or a jar URL of some sort, where the classpath resource
          resolves to a jar location. Still, there is a portability concern on
          this operation.</p><p>If a jar URL is obtained for the last non-wildcard segment,
          the resolver must be able to get a
          <code class="classname">java.net.JarURLConnection</code> from it, or
          manually parse the jar URL, to be able to walk the contents of the
          jar, and resolve the wildcard. This will work in most environments,
          but will fail in others, and it is strongly recommended that the
          wildcard resolution of resources coming from jars be thoroughly
          tested in your specific environment before you rely on it.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="resources-classpath-wildcards"></a>4.7.2.2.&nbsp;The <code class="literal">classpath*:</code> prefix</h4></div></div></div><p>When constructing an XML-based application context, a location
        string may use the special <code class="literal">classpath*:</code>
        prefix:</p><pre class="programlisting">ApplicationContext ctx =
    new ClassPathXmlApplicationContext("classpath*:conf/appContext.xml");</pre><p>This special prefix specifies that all classpath resources that
        match the given name must be obtained (internally, this essentially
        happens via a <code class="methodname">ClassLoader.getResources(...)</code>
        call), and then merged to form the final application context
        definition.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Classpath*: portability"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Classpath*: portability</th></tr><tr><td align="left" valign="top"><p>The wildcard classpath relies on the <code class="literal">getResources()</code> method of the
          underlying classloader. As most application servers nowadays supply
          their own classloader implementation, the behavior might differ
          especially when dealing with jar files. A simple test to check if
          <code class="literal">classpath*</code> works is to use the classloader to load a file from
          within a jar on the classpath:
          <code class="literal">getClass().getClassLoader().getResources("&lt;someFileInsideTheJar&gt;")</code>.
          Try this test with files that have the same name but are placed
          inside two different locations. In case an inappropriate result is
          returned, check the application server documentation for settings
          that might affect the classloader behavior.</p></td></tr></table></div><p>The "<code class="literal">classpath*:</code>" prefix can also be combined
        with a <code class="literal">PathMatcher</code> pattern in the rest of the location path, for
        example "<code class="literal">classpath*:META-INF/*-beans.xml</code>". In this
        case, the resolution strategy is fairly simple: a
        ClassLoader.getResources() call is used on the last non-wildcard path
        segment to get all the matching resources in the class loader
        hierarchy, and then off each resource the same PathMatcher resoltion
        strategy described above is used for the wildcard subpath.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="resources-wildcards-in-path-other-stuff"></a>4.7.2.3.&nbsp;Other notes relating to wildcards</h4></div></div></div><p>Please note that "<code class="literal">classpath*:</code>" when
        combined with Ant-style patterns will only work reliably with at least
        one root directory before the pattern starts, unless the actual target
        files reside in the file system. This means that a pattern like
        "<code class="literal">classpath*:*.xml</code>" will not retrieve files from the
        root of jar files but rather only from the root of expanded
        directories. This originates from a limitation in the JDK's
        <code class="methodname">ClassLoader.getResources()</code> method which only
        returns file system locations for a passed-in empty string (indicating
        potential roots to search).</p><p>Ant-style patterns with "<code class="literal">classpath:</code>"
		resources are not guaranteed to find matching resources if the root
		package to search is available in multiple class path locations. This
		is because a resource such as</p><pre class="programlisting">    com/mycompany/package1/service-context.xml</pre><p>may be in only one location, but when a path such as</p><pre class="programlisting">    classpath:com/mycompany/**/service-context.xml</pre><p>is used to try to resolve it, the resolver will work off the (first) URL
        returned by <code class="methodname">getResource("com/mycompany")</code>;. If
        this base package node exists in multiple classloader locations, the
        actual end resource may not be underneath. Therefore, preferably, use
        "<code class="literal">classpath*:</code>" with the same Ant-style pattern in
        such a case, which will search all class path locations that contain
        the root package.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-filesystemresource-caveats"></a>4.7.3.&nbsp;<code class="classname">FileSystemResource</code> caveats</h3></div></div></div><p>A <code class="classname">FileSystemResource</code> that is not attached
      to a <code class="classname">FileSystemApplicationContext</code> (that is, a
      <code class="classname">FileSystemApplicationContext</code> is not the actual
      <code class="interfacename">ResourceLoader</code>) will treat absolute vs.
      relative paths as you would expect. Relative paths are relative to the
      current working directory, while absolute paths are relative to the root
      of the filesystem.</p><p>For backwards compatibility (historical) reasons however, this
      changes when the <code class="classname">FileSystemApplicationContext</code> is
      the <code class="literal">ResourceLoader</code>. The
      <code class="classname">FileSystemApplicationContext</code> simply forces all
      attached <code class="classname">FileSystemResource</code> instances to treat
      all location paths as relative, whether they start with a leading slash
      or not. In practice, this means the following are equivalent:</p><pre class="programlisting">ApplicationContext ctx =
    new FileSystemXmlApplicationContext("conf/context.xml");</pre><pre class="programlisting">ApplicationContext ctx =
    new FileSystemXmlApplicationContext("/conf/context.xml");</pre><p>As are the following: (Even though it would make sense for them to
      be different, as one case is relative and the other absolute.)</p><pre class="programlisting">FileSystemXmlApplicationContext ctx = ...;
ctx.getResource("some/resource/path/myTemplate.txt");</pre><pre class="programlisting">FileSystemXmlApplicationContext ctx = ...;
ctx.getResource("/some/resource/path/myTemplate.txt");</pre><p>In practice, if true absolute filesystem paths are needed, it is
      better to forgo the use of absolute paths with
      <code class="classname">FileSystemResource</code> /
      <code class="classname">FileSystemXmlApplicationContext</code>, and just force
      the use of a <code class="classname">UrlResource</code>, by using the
      <code class="literal">file:</code> URL prefix.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// actual context type doesn't matter, the <code class="interfacename">Resource</code> will always be <code class="classname">UrlResource</code></span></em>
ctx.getResource("file:/some/resource/path/myTemplate.txt");</pre><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// force this FileSystemXmlApplicationContext to load it's definition via a <code class="classname">UrlResource</code></span></em>
ApplicationContext ctx =
    new FileSystemXmlApplicationContext("file:/conf/context.xml");</pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="validation"></a>Chapter&nbsp;5.&nbsp;Validation, Data-binding, the <code class="interfacename">BeanWrapper</code>, and <code class="literal">PropertyEditors</code></h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-introduction"></a>5.1.&nbsp;Introduction</h2></div></div></div><p>There are pros and cons for considering validation as business logic,
    and Spring offers a design for validation (and data binding) that
    does not exclude either one of them. Specifically validation should not be
    tied to the web tier, should be easy to localize and it should be
    possible to plug in any validator available. Considering the above, Spring
    has come up with a <code class="interfacename">Validator</code> interface that
    is both basic and eminently usable in every layer of an application.</p><p>Data binding is useful for allowing user input to be dynamically
    bound to the domain model of an application (or whatever objects you use
    to process user input). Spring provides the so-called
    <code class="interfacename">DataBinder</code> to do exactly that. The
    <code class="interfacename">Validator</code> and the
    <code class="interfacename">DataBinder</code> make up the <code class="literal">validation</code> package,
    which is primarily used in but not limited to the MVC framework.</p><p>The <code class="interfacename">BeanWrapper</code> is a fundamental concept in the
    Spring Framework and is used in a lot of places. However, you probably
    will not ever have the need to use the <code class="interfacename">BeanWrapper</code> directly. Because this
    is reference documentation however, we felt that some explanation might be
    in order. We're explaining the <code class="interfacename">BeanWrapper</code> in this chapter since if you were
    going to use it at all, you would probably do so when trying to bind
    data to objects, which is strongly related to the <code class="interfacename">BeanWrapper</code>.</p><p>Spring uses PropertyEditors all over the place. The concept of a
    <code class="interfacename">PropertyEditor</code> is part of the JavaBeans specification. Just as the
    <code class="interfacename">BeanWrapper</code>, it's best to explain the use of PropertyEditors in this
    chapter as well, since it's closely related to the <code class="interfacename">BeanWrapper</code> and the
    <code class="interfacename">DataBinder</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validator"></a>5.2.&nbsp;Validation using Spring's <code class="interfacename">Validator</code> interface</h2></div></div></div><p>Spring's features a <code class="interfacename">Validator</code> interface that you can
        use to validate objects. The <code class="interfacename">Validator</code> interface works using
        an <code class="interfacename">Errors</code> object so that while validating, validators can report
        validation failures to the <code class="interfacename">Errors</code> object.</p><p>Let's consider a small data object:</p><pre class="programlisting">
public class Person {

  private String name;
  private int age;

  <em class="lineannotation"><span class="lineannotation">// the usual getters and setters...</span></em>
}</pre><p>We're going to provide validation behavior for the <code class="classname">Person</code>
			class by implementing the following two methods of the
			<code class="interfacename">org.springframework.validation.Validator</code> interface:
			</p><div class="itemizedlist"><ul type="disc" compact><li><p><code class="methodname">supports(Class)</code> - Can this
					<code class="interfacename">Validator</code> validate instances of the supplied
					<code class="classname">Class</code>?</p></li><li><p><code class="methodname">validate(Object, org.springframework.validation.Errors)</code> - 
					validates the given object and in case of validation errors, registers
					those with the given <code class="interfacename">Errors</code> object</p></li></ul></div><p>
		</p><p>
		Implementing a <code class="interfacename">Validator</code> is fairly straightforward,
		especially when you know of the <code class="classname">ValidationUtils</code> helper class
		that the Spring Framework also provides.</p><pre class="programlisting">public class PersonValidator implements Validator {
    
    <em class="lineannotation"><span class="lineannotation">/**
    * This <code class="interfacename">Validator</code> validates <span class="bold"><strong>just</strong></span> <code class="classname">Person</code> instances
    */</span></em>
    public boolean supports(Class clazz) {
        return Person.class.equals(clazz);
    }
    
    public void validate(Object obj, Errors e) {
        ValidationUtils.rejectIfEmpty(e, "name", "name.empty");
        Person p = (Person) obj;
        if (p.getAge() &lt; 0) {
            e.rejectValue("age", "negativevalue");
        } else if (p.getAge() &gt; 110) {
            e.rejectValue("age", "too.darn.old");
        }
    }
}</pre><p>As you can see, the <code class="literal">static</code> <code class="methodname">rejectIfEmpty(..)</code>
		method on the <code class="classname">ValidationUtils</code> class is used to reject the
		<code class="literal">'name'</code> property if it is <code class="literal">null</code> or the empty string.
		Have a look at the Javadoc for the <code class="classname">ValidationUtils</code> class to see
		what functionality it provides besides the example shown previously.</p><p>While it is certainly possible to implement a single
		<code class="interfacename">Validator</code> class to validate each of the nested objects
		in a rich object, it may be better to encapsulate the validation logic for each nested
		class of object in its own <code class="interfacename">Validator</code> implementation. A
		simple example of a <span class="emphasis"><em>'rich'</em></span> object would be a
		<code class="classname">Customer</code> that is composed of two <code class="classname">String</code>
		properties (a first and second name) and a complex <code class="classname">Address</code> object.
        <code class="classname">Address</code> objects may be used independently of
        <code class="classname">Customer</code> objects, and so a distinct
        <code class="classname">AddressValidator</code> has been implemented. If you want your
        <code class="classname">CustomerValidator</code> to reuse the logic contained within the
        <code class="classname">AddressValidator</code> class without recourse to copy-n-paste you can
        dependency-inject or instantiate an <code class="classname">AddressValidator</code> within your
        <code class="classname">CustomerValidator</code>, and use it like so:</p><pre class="programlisting">public class CustomerValidator implements Validator {

   private final Validator addressValidator;

   public CustomerValidator(Validator addressValidator) {
      if (addressValidator == null) {
          throw new IllegalArgumentException("The supplied [Validator] is required and must not be null.");
      }
      if (!addressValidator.supports(Address.class)) {
          throw new IllegalArgumentException(
            "The supplied [Validator] must support the validation of [Address] instances.");
      }
      this.addressValidator = addressValidator;
   }

    <em class="lineannotation"><span class="lineannotation">/**
    * This <code class="interfacename">Validator</code> validates <code class="classname">Customer</code> instances, and any subclasses of <code class="classname">Customer</code> too
    */</span></em>
   public boolean supports(Class clazz) {
      return Customer.class.isAssignableFrom(clazz);
   }

   public void validate(Object target, Errors errors) {
      ValidationUtils.rejectIfEmptyOrWhitespace(errors, "firstName", "field.required");
      ValidationUtils.rejectIfEmptyOrWhitespace(errors, "surname", "field.required");
      Customer customer = (Customer) target;
      try {
          errors.pushNestedPath("address");
          ValidationUtils.invokeValidator(this.addressValidator, customer.getAddress(), errors);
      } finally {
          errors.popNestedPath();
      }
   }
}</pre><p>Validation errors are reported to the <code class="interfacename">Errors</code>
		object passed to the validator. In case of Spring Web MVC you can use
		<code class="literal">&lt;spring:bind/&gt;</code> tag to inspect the error messages, but
		of course you can also inspect the errors object yourself. More information about
		the methods it offers can be found from the Javadoc.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-conversion"></a>5.3.&nbsp;Resolving codes to error messages</h2></div></div></div><p>We've talked about databinding and validation. Outputting messages corresponding to 
		validation errors is the last thing we need to discuss. In the example we've shown
		above, we rejected the <code class="literal">name</code> and the <code class="literal">age</code> field.
		If we're going to output the error messages by using a <code class="interfacename">MessageSource</code>,
		we will do so using the error code we've given when rejecting the field ('name' and 'age'
		in this case). When you call (either directly, or indirectly, using for example the 
		<code class="classname">ValidationUtils</code> class) <code class="literal">rejectValue</code> or one of
		the other <code class="literal">reject</code> methods from the <code class="interfacename">Errors</code>
		interface, the underlying implementation will not only register the code you've
		passed in, but also a number of additional error codes. What error codes it registers
		is determined by the <code class="interfacename">MessageCodesResolver</code> that is used.
		By default, the <code class="classname">DefaultMessageCodesResolver</code> is used, which for example
		not only registers a message with the code you gave, but also messages that include the 
		field name you passed to the reject method. So in case you reject a field using
		<code class="literal">rejectValue("age", "too.darn.old")</code>, apart from the
		<code class="literal">too.darn.old</code> code, Spring will also register
		<code class="literal">too.darn.old.age</code> and <code class="literal">too.darn.old.age.int</code>
		(so the first will include the field name and the second will include the type of the
		field); this is done as a convenience to aid developers in targeting error
		messages and suchlike.</p><p>More information on the <code class="interfacename">MessageCodesResolver</code> and the default
		strategy can be found online with the Javadocs for
		<a href="http://www.springframework.org/docs/api/org/springframework/validation/MessageCodesResolver.html" target="_top">MessageCodesResolver</a>
		and
		<a href="http://www.springframework.org/docs/api/org/springframework/validation/DefaultMessageCodesResolver.html" target="_top">DefaultMessageCodesResolver</a>
		respectively.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-beans"></a>5.4.&nbsp;Bean manipulation and the <code class="interfacename">BeanWrapper</code></h2></div></div></div><p>The <code class="literal">org.springframework.beans</code> package adheres to
    the JavaBeans standard provided by Sun. A JavaBean is simply a class with
    a default no-argument constructor, which follows a naming conventions
    where a property named <code class="literal">bingoMadness</code> has a setter
    <code class="methodname">setBingoMadness(..)</code> and a getter <code class="methodname">getBingoMadness()</code>.
    For more information about JavaBeans and the specification, please refer
    to Sun's website
    (<a href="http://java.sun.com/products/javabeans/" target="_top">java.sun.com/products/javabeans</a>).</p><p>One quite important concept of the beans package is the
    <code class="interfacename">BeanWrapper</code> interface and its corresponding
    implementation (<code class="classname">BeanWrapperImpl</code>). As quoted from the
    Javadoc, the <code class="interfacename">BeanWrapper</code> offers functionality to set and get property
    values (individually or in bulk), get property descriptors, and to query
    properties to determine if they are readable or writable. Also, the
    <code class="interfacename">BeanWrapper</code> offers support for nested properties, enabling the setting of
    properties on sub-properties to an unlimited depth. Then, the <code class="interfacename">BeanWrapper</code>
    supports the ability to add standard JavaBeans
    <code class="interfacename">PropertyChangeListeners</code> and
    <code class="interfacename">VetoableChangeListeners</code>, without the need for
    supporting code in the target class. Last but not least, the <code class="interfacename">BeanWrapper</code>
    provides support for the setting of indexed properties. The <code class="interfacename">BeanWrapper</code>
    usually isn't used by application code directly, but by the
    <code class="interfacename">DataBinder</code> and the
    <code class="interfacename">BeanFactory</code>.</p><p>The way the <code class="interfacename">BeanWrapper</code> works is partly indicated by its name:
    <span class="emphasis"><em>it wraps a bean</em></span> to perform actions on that bean, like
    setting and retrieving properties.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-beans-conventions"></a>5.4.1.&nbsp;Setting and getting basic and nested properties</h3></div></div></div><p>Setting and getting properties is done using the
      <code class="literal">setPropertyValue(s)</code> and
      <code class="literal">getPropertyValue(s)</code> methods that both come with a
      couple of overloaded variants. They're all described in more detail in
      the Javadoc Spring comes with. What's important to know is that there
      are a couple of conventions for indicating properties of an object. A
      couple of examples:</p><div class="table"><a name="beans-beans-conventions-properties-tbl"></a><p class="title"><b>Table&nbsp;5.1.&nbsp;Examples of properties</b></p><div class="table-contents"><table summary="Examples of properties" border="1"><colgroup><col><col></colgroup><thead><tr><th>Expression</th><th>Explanation</th></tr></thead><tbody><tr><td><code class="literal">name</code></td><td>Indicates the property <code class="literal">name</code>
                corresponding to the methods <code class="methodname">getName()</code> or
                <code class="methodname">isName()</code> and
                <code class="methodname">setName(..)</code></td></tr><tr><td><code class="literal">account.name</code></td><td>Indicates the nested property <code class="literal">name</code>
                of the property <code class="literal">account</code> corresponding e.g.
                to the methods <code class="literal">getAccount().setName()</code> or
                <code class="literal">getAccount().getName()</code></td></tr><tr><td><code class="literal">account[2]</code></td><td>Indicates the <span class="emphasis"><em>third</em></span> element of the
                indexed property <code class="literal">account</code>. Indexed
                properties can be of type <code class="literal">array</code>,
                <code class="literal">list</code> or other <span class="emphasis"><em>naturally
                ordered</em></span> collection</td></tr><tr><td><code class="literal">account[COMPANYNAME]</code></td><td>Indicates the value of the map entry indexed by the key
                <span class="emphasis"><em>COMPANYNAME</em></span> of the Map property
                <code class="literal">account</code></td></tr></tbody></table></div></div><br class="table-break"><p>Below you'll find some examples of working with the <code class="interfacename">BeanWrapper</code> to
      get and set properties.</p><p><span class="emphasis"><em>(This next section is not vitally important to you if you're not
      planning to work with the <code class="interfacename">BeanWrapper</code> directly. If you're
      just using the <code class="interfacename">DataBinder</code> and the
      <code class="interfacename">BeanFactory</code> and their out-of-the-box implementation, you
      should skip ahead to the section about
      <code class="interfacename">PropertyEditors</code>.)</em></span></p><p>Consider the following two classes:</p><pre class="programlisting">public class Company {
    private String name;
    private Employee managingDirector;

    public String getName()	{ 
        return this.name; 
    }
    public void setName(String name) { 
        this.name = name; 
    } 
    public Employee getManagingDirector() { 
        return this.managingDirector; 
    }
    public void setManagingDirector(Employee managingDirector) {
        this.managingDirector = managingDirector;
    }
}</pre><pre class="programlisting">public class Employee {
    private String name;
    private float salary;

    public String getName()	{
        return this.name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public float getSalary() {
        return salary;
    }
    public void setSalary(float salary) {
        this.salary = salary;
    }
}</pre><p>The following code snippets show some examples of how to retrieve
      and manipulate some of the properties of instantiated
      <code class="literal">Companies</code> and <code class="literal">Employees</code>:</p><pre class="programlisting">BeanWrapper company = BeanWrapperImpl(new Company());
<em class="lineannotation"><span class="lineannotation">// setting the company name..</span></em>
company.setPropertyValue("name", "Some Company Inc.");
<em class="lineannotation"><span class="lineannotation">// ... can also be done like this:</span></em>
PropertyValue value = new PropertyValue("name", "Some Company Inc.");
company.setPropertyValue(value);

<em class="lineannotation"><span class="lineannotation">// ok, let's create the director and tie it to the company:</span></em>
BeanWrapper jim = BeanWrapperImpl(new Employee());
jim.setPropertyValue("name", "Jim Stravinsky");
company.setPropertyValue("managingDirector", jim.getWrappedInstance());

<em class="lineannotation"><span class="lineannotation">// retrieving the salary of the managingDirector through the company</span></em>
Float salary = (Float) company.getPropertyValue("managingDirector.salary");</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-beans-conversion"></a>5.4.2.&nbsp;Built-in <span class="interface">PropertyEditor</span> implementations</h3></div></div></div><p>Spring heavily uses the concept of
      <code class="literal">PropertyEditors</code>. Sometimes it might be handy to be
      able to represent properties in a different way than the object itself.
      For example, a date can be represented in a human readable way, while
      we're still able to convert the human readable form back to the original
      date (or even better: convert any date entered in a human readable form,
      back to <code class="classname">Date</code> objects). This behavior can be achieved by
      <span class="emphasis"><em>registering custom editors</em></span>, of type
      <code class="interfacename">java.beans.PropertyEditor</code>. Registering custom editors
      on a <code class="interfacename">BeanWrapper</code> or alternately in a specific IoC container as
      mentioned in the previous chapter, gives it the knowledge of how to
      convert properties to the desired type. Read more about PropertyEditors
      in the Javadoc of the <code class="literal">java.beans</code> package provided by
      Sun.</p><p>A couple of examples where property editing is used in Spring
      </p><div class="itemizedlist"><ul type="disc" compact><li><p><span class="emphasis"><em>setting properties on beans</em></span> is done
            using <code class="literal">PropertyEditors</code>. When mentioning
            <code class="literal">java.lang.String</code> as the value of a property of
            some bean you're declaring in XML file, Spring will (if the setter
            of the corresponding property has a <code class="classname">Class</code>-parameter) use the
            <code class="classname">ClassEditor</code> to try to resolve the parameter to
            a <code class="classname">Class</code> object</p></li><li><p><span class="emphasis"><em>parsing HTTP request parameters</em></span> in
            Spring's MVC framework is done using all kinds of <code class="literal">PropertyEditors</code>
            that you can manually bind in all subclasses of the
            <code class="classname">CommandController</code></p></li></ul></div><p>Spring has a number of built-in <code class="literal">PropertyEditors</code> to make life easy.
      Each of those is listed below and they are all located in the
      <code class="literal">org.springframework.beans.propertyeditors</code> package.
      Most, but not all (as indicated below), are registered by default by
      <code class="classname">BeanWrapperImpl</code>. Where the property editor is configurable in some
      fashion, you can of course still register your own variant to override
      the default one:</p><div class="table"><a name="beans-beans-property-editors-tbl"></a><p class="title"><b>Table&nbsp;5.2.&nbsp;Built-in <code class="literal">PropertyEditors</code></b></p><div class="table-contents"><table summary="Built-in PropertyEditors" border="1"><colgroup><col><col></colgroup><thead><tr><th>Class</th><th>Explanation</th></tr></thead><tbody><tr><td><code class="classname">ByteArrayPropertyEditor</code></td><td>Editor for byte arrays. Strings will simply be
                converted to their corresponding byte representations.
                Registered by default by <code class="classname">BeanWrapperImpl</code>.</td></tr><tr><td><code class="classname">ClassEditor</code></td><td>Parses Strings representing classes to actual classes
                and the other way around. When a class is not found, an
                <code class="classname">IllegalArgumentException</code> is thrown. Registered by default by
                <code class="classname">BeanWrapperImpl</code>.</td></tr><tr><td><code class="classname">CustomBooleanEditor</code></td><td>Customizable property editor for <code class="classname">Boolean</code> properties.
                Registered by default by <code class="classname">BeanWrapperImpl</code>, but, can be
                overridden by registering custom instance of it as custom
                editor.</td></tr><tr><td><code class="classname">CustomCollectionEditor</code></td><td>Property editor for Collections, converting any source
                <code class="interfacename">Collection</code> to a given target <code class="interfacename">Collection</code> type.</td></tr><tr><td><code class="classname">CustomDateEditor</code></td><td>Customizable property editor for java.util.Date,
                supporting a custom DateFormat. NOT registered by default. Must
                be user registered as needed with appropriate format.</td></tr><tr><td><code class="classname">CustomNumberEditor</code></td><td>Customizable property editor for any Number subclass
                like <code class="classname">Integer</code>, <code class="classname">Long</code>,
                <code class="classname">Float</code>, <code class="classname">Double</code>. Registered
                by default by <code class="classname">BeanWrapperImpl</code>, but can be
                overridden by registering custom instance of it as a custom editor.</td></tr><tr><td><code class="classname">FileEditor</code></td><td>Capable of resolving Strings to
                <code class="classname">java.io.File</code> objects. Registered by default by
                <code class="classname">BeanWrapperImpl</code>. </td></tr><tr><td><code class="classname">InputStreamEditor</code></td><td>One-way property editor, capable of taking a text
                string and producing (via an intermediate <code class="classname">ResourceEditor</code> and
                <code class="interfacename">Resource</code>) an
                <code class="interfacename">InputStream</code>, so <code class="interfacename">InputStream</code>
                properties may be directly set as Strings. Note that the default usage
                will not close the <code class="interfacename">InputStream</code> for
                you! Registered by default by <code class="classname">BeanWrapperImpl</code>.</td></tr><tr><td><code class="classname">LocaleEditor</code></td><td>Capable of resolving Strings to
                <code class="classname">Locale</code> objects and vice versa (the String
                format is [language]_[country]_[variant], which is the same
                thing the toString() method of Locale provides). Registered by
                default by <code class="classname">BeanWrapperImpl</code>.</td></tr><tr><td><code class="classname">PatternEditor</code></td><td>Capable of resolving Strings to JDK 1.5
                <code class="classname">Pattern</code> objects and vice versa.</td></tr><tr><td><code class="classname">PropertiesEditor</code></td><td>Capable of converting Strings (formatted using the
                format as defined in the Javadoc for the java.lang.Properties
                class) to <code class="classname">Properties</code> objects. Registered by
                default by <code class="classname">BeanWrapperImpl</code>.</td></tr><tr><td><code class="classname">StringTrimmerEditor</code></td><td>Property editor that trims Strings. Optionally allows
                transforming an empty string into a <code class="literal">null</code> value. NOT
                registered by default; must be user registered as needed.</td></tr><tr><td><code class="classname">URLEditor</code></td><td>Capable of resolving a String representation of a URL
                to an actual <code class="classname">URL</code> object. Registered by
                default by <code class="classname">BeanWrapperImpl</code>.</td></tr></tbody></table></div></div><br class="table-break"><p>
		Spring uses the <code class="interfacename">java.beans.PropertyEditorManager</code> to set
		the search path for property editors that might be needed. The search path also includes
		<code class="literal">sun.bean.editors</code>, which includes
		<code class="interfacename">PropertyEditor</code> implementations for types such as
		<code class="classname">Font</code>, <code class="classname">Color</code>, and most of the primitive types.
		Note also that the standard JavaBeans infrastructure will automatically discover
		<code class="interfacename">PropertyEditor</code> classes (without you having to register them
		explicitly) if they are in the same package as the class they handle, and have the same name
		as that class, with <code class="literal">'Editor'</code> appended; for example, one could have the
		following class and package structure, which would be sufficient for the
		<code class="classname">FooEditor</code> class to be recognized and used as the
		<code class="interfacename">PropertyEditor</code> for <code class="classname">Foo</code>-typed
		properties.
	  </p><pre class="programlisting">com
  chank
    pop
      Foo
      FooEditor   <em class="lineannotation"><span class="lineannotation">// the <code class="interfacename">PropertyEditor</code> for the <code class="classname">Foo</code> class</span></em></pre><p>Note that you can also use the standard <code class="interfacename">BeanInfo</code> JavaBeans
		mechanism here as well (described
		<a href="http://java.sun.com/docs/books/tutorial/javabeans/customization/index.html" target="_top">in not-amazing-detail here</a>).
		Find below an example of using the <code class="interfacename">BeanInfo</code> mechanism for
		explicitly registering one or more <code class="interfacename">PropertyEditor</code> instances
		with the properties of an associated class.</p><pre class="programlisting">com
  chank
    pop
      Foo
      FooBeanInfo   <em class="lineannotation"><span class="lineannotation">// the <code class="interfacename">BeanInfo</code> for the <code class="classname">Foo</code> class</span></em></pre><p>
		Here is the Java source code for the referenced <code class="classname">FooBeanInfo</code> class. This
		would associate a <code class="classname">CustomNumberEditor</code> with the <code class="literal">age</code>
		property of the <code class="classname">Foo</code> class.
	  </p><pre class="programlisting">public class FooBeanInfo extends SimpleBeanInfo {
      
    public PropertyDescriptor[] getPropertyDescriptors() {
        try {
            final PropertyEditor numberPE = new CustomNumberEditor(Integer.class, true);
            PropertyDescriptor ageDescriptor = new PropertyDescriptor("age", Foo.class) {
                public PropertyEditor createPropertyEditor(Object bean) {
                    return numberPE;
                };
            };
            return new PropertyDescriptor[] { ageDescriptor };
        }
        catch (IntrospectionException ex) {
            throw new Error(ex.toString());
        }
    }
}</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-beans-conversion-customeditor-registration"></a>5.4.2.1.&nbsp;Registering additional custom <code class="literal">PropertyEditors</code></h4></div></div></div><p>When setting bean properties as a string value, a Spring IoC container
            ultimately uses standard JavaBeans <code class="literal">PropertyEditors</code> to convert these
            Strings to the complex type of the property. Spring pre-registers a number
            of custom <code class="literal">PropertyEditors</code> (for example, to convert a classname expressed
            as a string into a real <code class="classname">Class</code> object). Additionally, Java's standard
            JavaBeans <code class="interfacename">PropertyEditor</code> lookup mechanism allows a
            <code class="classname">PropertyEditor</code> for a class simply to be named appropriately and
            placed in the same package as the class it provides support for, to be found automatically.</p><p>If there is a need to register other custom <code class="literal">PropertyEditors</code>, there
            are several mechanisms available. The most manual approach, which is not normally convenient or
            recommended, is to simply use the <code class="methodname">registerCustomEditor()</code> method of the
            <code class="interfacename">ConfigurableBeanFactory</code> interface, assuming you have a
            <code class="interfacename">BeanFactory</code> reference. The more convenient mechanism is to use
            a special bean factory post-processor called <code class="classname">CustomEditorConfigurer</code>.
            Although bean factory post-processors can be used semi-manually with
            <code class="interfacename">BeanFactory</code> implementations, this one has a nested property
            setup, so it is strongly recommended that it is used
            with the <code class="interfacename">ApplicationContext</code>, where it may be deployed in similar fashion
            to any other bean, and automatically detected and applied.</p><p>Note that all bean factories and application contexts automatically
            use a number of built-in property editors, through their use of something
            called a <code class="interfacename">BeanWrapper</code> to handle property conversions.
            The standard property editors that the <code class="interfacename">BeanWrapper</code> registers
            are listed in <a href="#beans-beans-conversion" title="5.4.2.&nbsp;Built-in PropertyEditor implementations">the previous section</a>. Additionally,
            <code class="literal">ApplicationContexts</code> also override or add an additional number of editors
            to handle resource lookups in a manner appropriate to the specific application context type.</p><p>
			Standard JavaBeans <code class="interfacename">PropertyEditor</code>
			instances are used to convert property values expressed as strings to
			the actual complex type of the property.
			<code class="classname">CustomEditorConfigurer</code>, a bean factory post-processor,
			may be used to conveniently add support for additional
			<code class="interfacename">PropertyEditor</code> instances to an
			<code class="interfacename">ApplicationContext</code>.
		</p><p>
			Consider a user class <code class="classname">ExoticType</code>, and another
			class <code class="classname">DependsOnExoticType</code> which needs
			<code class="classname">ExoticType</code> set as a property:
		</p><pre class="programlisting">package example;
		
public class ExoticType {

    private String name;

    public ExoticType(String name) {
        this.name = name;
    }
}

public class DependsOnExoticType { 
   
    private ExoticType type;

    public void setType(ExoticType type) {
        this.type = type;
    }
}</pre><p>When things are properly set up, we want to be able to assign the type property
		as a string, which a <code class="interfacename">PropertyEditor</code> will behind the scenes
		convert into a real <code class="classname">ExoticType</code> object:</p><pre class="programlisting">&lt;bean id="sample" class="example.DependsOnExoticType"&gt;
    &lt;property name="type" value="aNameForExoticType"/&gt;
&lt;/bean&gt;</pre><p>The <code class="interfacename">PropertyEditor</code> implementation could look similar to this:</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// converts string representation to <code class="classname">ExoticType</code> object</span></em>
package example;

public class ExoticTypeEditor extends PropertyEditorSupport {

    private String format;

    public void setFormat(String format) {
        this.format = format;
    }
    
    public void setAsText(String text) {
        if (format != null &amp;&amp; format.equals("upperCase")) {
            text = text.toUpperCase();
        }
        ExoticType type = new ExoticType(text);
        setValue(type);
    }
}</pre><p>Finally, we use <code class="classname">CustomEditorConfigurer</code> to
		register the new <code class="interfacename">PropertyEditor</code>
		with the <code class="interfacename">ApplicationContext</code>, which will
		then be able to use it as needed:</p><pre class="programlisting">&lt;bean id="customEditorConfigurer" 
    class="org.springframework.beans.factory.config.CustomEditorConfigurer"&gt;
  &lt;property name="customEditors"&gt;
    &lt;map&gt;
      &lt;entry key="example.ExoticType"&gt;
        &lt;bean class="example.ExoticTypeEditor"&gt;
          &lt;property name="format" value="upperCase"/&gt;
        &lt;/bean&gt;
      &lt;/entry&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-beans-conversion-customeditor-registration-per"></a>5.4.2.1.1.&nbsp;Using <code class="interfacename">PropertyEditorRegistrars</code></h5></div></div></div><p>Another mechanism for registering property editors with the Spring container is to create and use
			a <code class="interfacename">PropertyEditorRegistrar</code>. This interface is particularly useful when you
			need to use the same set of property editors in several different situations: write a corresponding
			registrar and reuse that in each case. <code class="literal">PropertyEditorRegistrars</code> work in conjunction
			with an interface called <code class="interfacename">PropertyEditorRegistry</code>, an interface
			that is implemented by the Spring <code class="interfacename">BeanWrapper</code> (and
			<code class="interfacename">DataBinder</code>). <code class="literal">PropertyEditorRegistrars</code> are particularly
			convenient when used in conjunction with the <code class="classname">CustomEditorConfigurer</code>
			(introduced <a href="#beans-beans-conversion-customeditor-registration" title="5.4.2.1.&nbsp;Registering additional custom PropertyEditors">here</a>), which exposes a
			property called <code class="methodname">setPropertyEditorRegistrars(..)</code>:
			<code class="literal">PropertyEditorRegistrars</code> added to a <code class="classname">CustomEditorConfigurer</code> in this
			fashion can easily be shared with <code class="interfacename">DataBinder</code> and Spring MVC
			<code class="interfacename">Controllers</code>. Furthermore, it avoids the need for synchronization on custom
			editors: a <code class="interfacename">PropertyEditorRegistrar</code> is expected to create fresh
			<code class="interfacename">PropertyEditor</code> instances for each bean creation attempt.</p><p>Using a <code class="interfacename">PropertyEditorRegistrar</code> is perhaps best illustrated with an
			example. First off, you need to create your own <code class="interfacename">PropertyEditorRegistrar</code>
			implementation:</p><pre class="programlisting">package com.foo.editors.spring;

public final class CustomPropertyEditorRegistrar implements PropertyEditorRegistrar {

    public void registerCustomEditors(PropertyEditorRegistry registry) {

        <em class="lineannotation"><span class="lineannotation">// it is expected that new <code class="interfacename">PropertyEditor</code> instances are created</span></em>
        registry.registerCustomEditor(ExoticType.class, new ExoticTypeEditor());

        <em class="lineannotation"><span class="lineannotation">// you could register as many custom property editors as are required here...</span></em>
    }
}</pre><p>See also the <code class="classname">org.springframework.beans.support.ResourceEditorRegistrar</code> for an
			example <code class="interfacename">PropertyEditorRegistrar</code> implementation. Notice how in its
			implementation of the <code class="methodname">registerCustomEditors(..)</code> method it creates new instances
			of each property editor.</p><p>Next we configure a <code class="classname">CustomEditorConfigurer</code> and inject an
			instance of our <code class="classname">CustomPropertyEditorRegistrar</code> into it:</p><pre class="programlisting">&lt;bean class="org.springframework.beans.factory.config.CustomEditorConfigurer"&gt;
    &lt;property name="propertyEditorRegistrars"&gt;
        &lt;list&gt;
            &lt;ref bean="customPropertyEditorRegistrar"/&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="customPropertyEditorRegistrar" class="com.foo.editors.spring.CustomPropertyEditorRegistrar"/&gt;</pre><p>Finally, and in a bit of a departure from the focus of this chapter, for those of you using
			<a href="#mvc" title="Chapter&nbsp;13.&nbsp;Web MVC framework">Spring's MVC web framework</a>, using <code class="interfacename">PropertyEditorRegistrars</code>
			in conjunction with data-binding <code class="interfacename">Controllers</code> (such as
			<code class="classname">SimpleFormController</code>) can be very convenient. Find below an example of using a
			<code class="interfacename">PropertyEditorRegistrar</code> in the implementation of an <code class="methodname">initBinder(..)</code>
			method:</p><pre class="programlisting">public final class RegisterUserController extends SimpleFormController {

    private final PropertyEditorRegistrar customPropertyEditorRegistrar;

    public RegisterUserController(PropertyEditorRegistrar propertyEditorRegistrar) {
        this.customPropertyEditorRegistrar = propertyEditorRegistrar;
    }

    protected void initBinder(HttpServletRequest request, ServletRequestDataBinder binder) throws Exception {
        <span class="bold"><strong>this.customPropertyEditorRegistrar.registerCustomEditors(binder);</strong></span>
    }

    <em class="lineannotation"><span class="lineannotation">// other methods to do with registering a <code class="classname">User</code></span></em>
}</pre><p>This style of <code class="interfacename">PropertyEditor</code> registration can lead to concise code (the
			implementation of <code class="methodname">initBinder(..)</code> is just one line long!), and allows common
			<code class="interfacename">PropertyEditor</code> registration code to be encapsulated in a class and then
			shared amongst as many <code class="interfacename">Controllers</code> as needed.</p></div></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="aop"></a>Chapter&nbsp;6.&nbsp;Aspect Oriented Programming with Spring</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-introduction"></a>6.1.&nbsp;Introduction</h2></div></div></div><p><span class="emphasis"><em>Aspect-Oriented Programming</em></span>
    (<span class="emphasis"><em>AOP</em></span>) complements Object-Oriented Programming (OOP)
    by providing another way of thinking about program structure. In addition
    to classes, AOP gives you <span class="emphasis"><em>aspects</em></span>. Aspects
    enable modularization of concerns such as transaction management that
    cut across multiple types and objects. (Such concerns are often
    termed <span class="emphasis"><em>crosscutting</em></span> concerns.)</p><p>One of the key components of Spring is the <span class="emphasis"><em>AOP
    framework</em></span>. While the Spring IoC container does not depend on AOP,
    meaning you don't need to use AOP if you don't want to, AOP complements
    Spring IoC to provide a very capable middleware solution.</p><div class="sidebar"><p class="title"><b>Spring 2.0 AOP</b></p><p>Spring 2.0 introduces a simpler and more powerful
        way of writing custom aspects using either a schema-based approach
        or the @AspectJ annotation style. Both of these styles offer fully
        typed advice and use of the AspectJ pointcut language, while still using
        Spring AOP for weaving.</p><p>The Spring 2.0 schema and @AspectJ based AOP support is discussed in
		this chapter. Spring 2.0 AOP remains fully backwards compatible with
		Spring 1.2 AOP, and the lower-level AOP support offered by the Spring 1.2 APIs
		is discussed in	<a href="#aop-api" title="Chapter&nbsp;7.&nbsp;Spring AOP APIs">the following chapter</a>.</p></div><p>AOP is used in the Spring Framework:</p><div class="itemizedlist"><ul type="disc"><li><p>To provide declarative enterprise services, especially as a
        replacement for EJB declarative services. The most important such
        service is
        <a href="#transaction-declarative" title="9.5.&nbsp;Declarative transaction management"><span class="emphasis"><em>declarative transaction management</em></span></a>,
        which builds on the Spring Framework's transaction abstraction.</p></li><li><p>To allow users to implement custom aspects, complementing their
        use of OOP with AOP.</p></li></ul></div><p class="remark"><i><span class="remark">If you are interested only in generic declarative services or
    other pre-packaged declarative middleware services such as pooling, you
    don't need to work directly with Spring AOP, and can skip most of this
    chapter.</span></i></p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-introduction-defn"></a>6.1.1.&nbsp;AOP concepts</h3></div></div></div><p>Let us begin by defining some central AOP concepts. These terms
      are not Spring-specific. Unfortunately, AOP terminology is not
      particularly intuitive; however, it would be even more confusing if
      Spring used its own terminology.</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>Aspect</em></span>: A modularization of a concern 
          that cuts across multiple objects. Transaction management is a good example 
		  of a crosscutting concern in J2EE applications. In Spring AOP, aspects are 
		  implemented using regular classes (the schema-based approach) or regular
		  classes annotated with the <code class="interfacename">@Aspect</code> annotation
		  (<code class="interfacename">@AspectJ</code> style).</p></li><li><p><span class="emphasis"><em>Join point</em></span>: A point during the execution of
          a program, such as the execution of a method or the handling of 
          an exception. In Spring AOP, a join point <span class="emphasis"><em>always</em></span> represents
          a method execution. Join point information is available in advice
          bodies by declaring a parameter of type <code class="interfacename">org.aspectj.lang.JoinPoint</code>.
          </p></li><li><p><span class="emphasis"><em>Advice</em></span>: Action taken by an aspect
          at a particular join point. Different types of advice include
          "around," "before" and "after" advice. Advice types are discussed
          below. Many AOP frameworks, including Spring, model an advice as an
          <span class="emphasis"><em>interceptor</em></span>, maintaining a chain of
          interceptors "around" the join point.</p></li><li><p><span class="emphasis"><em>Pointcut</em></span>: A predicate that matches join points.
          Advice is associated with a pointcut expression and runs at any join
          point matched by the pointcut (for example, the execution of a method with
          a certain name). The concept of join points as matched by pointcut
		  expressions is central to AOP: Spring uses the AspectJ pointcut language by default.</p></li><li><p><span class="emphasis"><em>Introduction</em></span>: (Also known as an 
          inter-type declaration). Declaring additional methods or fields on
          behalf of a type. Spring AOP allows you to introduce new interfaces
		  (and a corresponding implementation) to
          any proxied object. For example, you could use an introduction to
          make a bean implement an <code class="literal">IsModified</code>
          interface, to simplify caching.</p></li><li><p><span class="emphasis"><em>Target object</em></span>: Object being advised
          by one or more aspects. Also referred to as the <span class="emphasis"><em>advised</em></span>
		  object. Since Spring AOP is implemented using runtime proxies, this object
		  will always be a <span class="emphasis"><em>proxied</em></span> object.</p></li><li><p><span class="emphasis"><em>AOP proxy</em></span>: An object created by the AOP
          framework in order to implement the aspect contracts (advise method
          executions and so on). In the Spring Framework, an AOP proxy will be a JDK
          dynamic proxy or a CGLIB proxy. <span class="emphasis"><em>Proxy creation is
		  transparent to users of the schema-based and @AspectJ styles of
		  aspect declaration introduced in Spring 2.0.</em></span></p></li><li><p><span class="emphasis"><em>Weaving</em></span>: Linking aspects with other
          application types or objects to create an advised object. This can be
		  done at compile time (using the AspectJ compiler, for example), load time,
		  or at runtime. Spring AOP, like other pure Java AOP frameworks, performs
		  weaving at runtime.</p></li></ul></div><p>Types of advice:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>Before advice</em></span>: Advice that executes
          before a join point, but which does not have the ability to prevent
          execution flow proceeding to the join point (unless it throws an
          exception).</p></li><li><p><span class="emphasis"><em>After returning advice</em></span>: Advice to be
          executed after a join point completes normally: for example, if a
          method returns without throwing an exception.</p></li><li><p><span class="emphasis"><em>After throwing advice</em></span>: Advice to be executed if a
          method exits by throwing an exception.</p></li><li><p><span class="emphasis"><em>After (finally) advice</em></span>: Advice to be executed regardless
          of the means by which a join point exits (normal or exceptional return).</p></li><li><p><span class="emphasis"><em>Around advice</em></span>: Advice that surrounds a
          join point such as a method invocation. This is the most powerful
          kind of advice. Around advice can perform custom behavior before
          and after the method invocation. It is also responsible for choosing
          whether to proceed to the join point or to shortcut the advised method
		  execution by returning its own return value or throwing an exception.</p></li></ul></div><p>Around advice is the most general kind of advice. Since Spring AOP,
		like AspectJ, provides a full range of advice types, we recommend that you
		use the least powerful advice type that can implement the required behavior.
		For example, if you need only to update a cache with the return value of a
		method, you are better off implementing an after returning advice than an
		around advice, although an around advice can accomplish the same thing. Using
		the most specific advice type provides a simpler programming model with less
		potential for errors. For example, you  do not need to invoke the
		<code class="methodname">proceed()</code> method on the <code class="interfacename">JoinPoint</code>
		used for around advice, and hence cannot fail to invoke it.</p><p>In Spring 2.0, all advice parameters are statically typed, so that you
	  work with advice parameters of the appropriate type (the type of the return
	  value from a method execution for example) rather than
	  <code class="classname">Object</code> arrays.</p><p>The concept of join points, matched by pointcuts, is the key to AOP
	  which distinguishes it from older technologies offering only interception. 
	  Pointcuts enable advice to be targeted independently of the Object-Oriented hierarchy.
	  For example, an around advice providing declarative transaction management can
	  be applied to a set of methods spanning multiple objects (such as all business
	  operations in the service layer).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-introduction-spring-defn"></a>6.1.2.&nbsp;Spring AOP capabilities and goals</h3></div></div></div><p>Spring AOP is implemented in pure Java. There is no need for a
      special compilation process. Spring AOP does not need to control the
      class loader hierarchy, and is thus suitable for use in a J2EE web
      container or application server.</p><p>Spring AOP currently supports only method execution join points 
      (advising the execution of methods on Spring beans). Field interception
	  is not implemented, although support for field interception could be added
	  without breaking the core Spring AOP APIs. If you need to advise field
      access and update join points, consider a language such as AspectJ.</p><p>Spring AOP's approach to AOP differs from that of most other AOP
      frameworks. The aim is not to provide the most complete AOP
      implementation (although Spring AOP is quite capable); it is rather to
      provide a close integration between AOP implementation and Spring IoC to
      help solve common problems in enterprise applications.</p><p>Thus, for example, the Spring Framework's AOP functionality is normally
	  used in conjunction with the Spring IoC container. Aspects are configured
	  using normal bean definition syntax (although this allows powerful
      "autoproxying" capabilities): this is a crucial difference from other AOP
      implementations. There are some things you cannot do easily or
      efficiently with Spring AOP, such as advise very fine-grained objects:
      AspectJ is the best choice in such cases. However, our experience is that
	  Spring AOP provides an excellent solution to most problems in J2EE applications
	  that are amenable to AOP.</p><p>Spring AOP will never strive to compete with AspectJ to provide 
	  a comprehensive AOP solution. We believe that both proxy-based frameworks like
	  Spring AOP and full-blown frameworks such as AspectJ are valuable, and that they
	  are complementary, rather than in competition. Spring 2.0 seamlessly integrates
	  Spring AOP and IoC with AspectJ, to enable all uses of AOP to be catered for within
	  a consistent Spring-based application architecture. This integration does not
	  affect the Spring AOP API or the AOP Alliance API: Spring AOP remains
	  backward-compatible. See <a href="#aop-api" title="Chapter&nbsp;7.&nbsp;Spring AOP APIs">the following chapter</a> for a
	  discussion of the Spring AOP APIs.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>One of the central tenets of the Spring Framework is that of
		  <span class="emphasis"><em>non-invasiveness</em></span>; this is the idea that you should not be forced to
		  introduce framework-specific classes and interfaces into your business/domain
		  model. However, in some places the Spring Framework does give you the option
		  to introduce Spring Framework-specific dependencies into your codebase: the
		  rationale in giving you such options is because in certain scenarios it
		  might be just plain easier to read or code some specific piece of functionality
		  in such a way. The Spring Framework (almost) always offers you the choice
		  though: you have the freedom to make an informed decision as to which option
		  best suits your particular use case or scenario.</p><p>One such choice that is relevant to this chapter is that of which AOP
		  framework (and which AOP style) to choose. You have the choice of AspectJ and/or
		  Spring AOP, and you also have the choice of either the @AspectJ annotation-style
		  approach or the Spring XML configuration-style approach. The fact that this chapter
		  chooses to introduce the @AspectJ-style approach first should not be taken as
		  an indication that the Spring team favors the @AspectJ annotation-style approach
		  over the Spring XML configuration-style.</p><p>See the section entitled <a href="#aop-choosing" title="6.4.&nbsp;Choosing which AOP declaration style to use">Section&nbsp;6.4, &#8220;Choosing which AOP declaration style to use&#8221;</a> for a fuller discussion
		  of the whys and wherefores of each style.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-introduction-proxies"></a>6.1.3.&nbsp;AOP Proxies</h3></div></div></div><p>Spring AOP defaults to using standard J2SE <span class="emphasis"><em>dynamic proxies</em></span>
      for AOP proxies. This enables any interface (or set of interfaces) to be
      proxied.</p><p>Spring AOP can also use CGLIB proxies. This is necessary to proxy
      classes, rather than interfaces. CGLIB is used by default if a business
      object does not implement an interface. As it is good practice to
      program to interfaces rather than classes, business classes normally will
	  implement one or more business interfaces. It is possible to
	  <a href="#aop-autoproxy-force-CGLIB">force the use of CGLIB</a>,
      in those (hopefully rare) cases where you need to advise a method that
      is not declared on an interface, or where you need to pass a proxied object
      to a method as a concrete type.</p><p>It is important to grasp the fact that Spring AOP is
		<span class="emphasis"><em>proxy-based</em></span>. See the section entitled
		<a href="#aop-understanding-aop-proxies" title="6.6.1.&nbsp;Understanding AOP proxies">Section&nbsp;6.6.1, &#8220;Understanding AOP proxies&#8221;</a> for a thorough examination
		of exactly what this implementation detail actually means.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-ataspectj"></a>6.2.&nbsp;@AspectJ support</h2></div></div></div><p>@AspectJ refers to a style of declaring aspects as regular Java classes annotated with
    Java 5 annotations. The @AspectJ style was introduced by the 
    <a href="http://www.eclipse.org/aspectj" target="_top">AspectJ project</a> as part of
    the AspectJ 5 release. Spring 2.0 interprets the same annotations as AspectJ 5,
    using a library supplied by AspectJ for pointcut parsing and matching. The AOP runtime
    is still pure Spring AOP though, and there is no dependency on the AspectJ compiler
    or weaver.</p><p class="remark"><i><span class="remark">
	    <p>Using the AspectJ compiler and weaver enables use of the full AspectJ language,
		and is discussed in <a href="#aop-using-aspectj" title="6.8.&nbsp;Using AspectJ with Spring applications">Section&nbsp;6.8, &#8220;Using AspectJ with Spring applications&#8221;</a>.</p>
	</span></i></p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-aspectj-support"></a>6.2.1.&nbsp;Enabling @AspectJ Support</h3></div></div></div><p>To use @AspectJ aspects in a Spring configuration you need to enable Spring
        support for configuring Spring AOP based on @AspectJ aspects, and 
        <span class="emphasis"><em>autoproxying</em></span> beans based on whether or not they are advised by
        those aspects. By autoproxying we mean that if Spring determines that a bean is advised
        by one or more aspects, it will automatically generate a proxy for that bean to intercept
        method invocations and ensure that advice is executed as needed. 
        </p><p>The @AspectJ support is enabled by including the following element inside
        your spring configuration:</p><pre class="programlisting">&lt;aop:aspectj-autoproxy/&gt;</pre><p>This assumes that you are using schema support as described in
        <a href="#xsd-config" title="Appendix&nbsp;A.&nbsp;XML Schema-based configuration">Appendix&nbsp;A, <i>XML Schema-based configuration</i></a>. See <a href="#xsd-config-body-schemas-aop" title="A.2.6.&nbsp;The aop schema">Section&nbsp;A.2.6, &#8220;The <code class="literal">aop</code> schema&#8221;</a> 
        for how to import the tags in the aop namespace.</p><p>If you are using the DTD, it is still possible to enable @AspectJ support by
        adding the following definition to your application context:</p><pre class="programlisting">&lt;bean class="org.springframework.aop.aspectj.annotation.AnnotationAwareAspectJAutoProxyCreator" /&gt;</pre><p>You will also need two AspectJ libraries on the classpath of your application:
        <code class="filename">aspectjweaver.jar</code> and
        <code class="filename">aspectjrt.jar</code>. These libraries
        are available in the <code class="filename">'lib'</code> directory of an AspectJ installation (version
        1.5.1 or later required), or in the <code class="filename">'lib/aspectj'</code> directory of the
        Spring-with-dependencies distribution.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-at-aspectj"></a>6.2.2.&nbsp;Declaring an aspect</h3></div></div></div><p>With the @AspectJ support enabled, any bean defined in your application context
      with a class that is an @AspectJ aspect (has the <code class="interfacename">@Aspect</code>
      annotation) will be automatically detected by Spring and used to configure Spring AOP.
      The following example shows the minimal definition required for a not-very-useful
      aspect:</p><p>A regular bean definition in the application context, pointing to a bean class
      that has the <code class="interfacename">@Aspect</code> annotation:</p><pre class="programlisting">&lt;bean id="myAspect" class="org.xyz.NotVeryUsefulAspect"&gt;
   <em class="lineannotation"><span class="lineannotation">&lt;!-- configure properties of aspect here as normal --&gt;</span></em>
&lt;/bean&gt;
</pre><p>And the <code class="classname">NotVeryUsefulAspect</code> class definition, annotated with
	  <code class="interfacename">org.aspectj.lang.annotation.Aspect</code> annotation;</p><pre class="programlisting">package org.xyz;
import org.aspectj.lang.annotation.Aspect;

@Aspect
public class NotVeryUsefulAspect {

}</pre><p>Aspects (classes annotated with <code class="interfacename">@Aspect</code>) may have
		methods and fields just like any other class. They may also contain pointcut, advice,
		and introduction (inter-type) declarations.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Advising aspects"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Advising aspects</th></tr><tr><td align="left" valign="top"><p>In Spring AOP, it is <span class="emphasis"><em>not</em></span> possible to
			have aspects themselves be the target of advice from other aspects.
			The <span class="emphasis"><em>@Aspect</em></span> annotation on a class marks it as an
			aspect, and hence excludes it from auto-proxying.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-pointcuts"></a>6.2.3.&nbsp;Declaring a pointcut</h3></div></div></div><p>Recall that pointcuts determine join points of interest, and thus enable us
	  to control when advice executes. <span class="emphasis"><em>Spring AOP only supports method execution
	  join points for Spring beans</em></span>, so you can think of a pointcut as matching
	  the execution of methods on Spring beans. A pointcut declaration has two parts: a
	  signature comprising a name and any parameters, and a pointcut expression
	  that determines <span class="emphasis"><em>exactly</em></span> which method executions we are interested in.
	  In the @AspectJ annotation-style of AOP, a pointcut signature is provided by a regular method
	  definition, and the pointcut expression is indicated using the
	  <code class="interfacename">@Pointcut</code> annotation (the method serving as the pointcut
	  signature <span class="emphasis"><em>must</em></span> have a <code class="literal">void</code> return
	  type).</p><p>An example will help make this distinction between a pointcut signature and a
	  pointcut expression clear. The following example defines a pointcut named
	  <code class="literal">'anyOldTransfer'</code> that will match the execution of any method named
	  <code class="literal">'transfer'</code>:</p><pre class="programlisting">@Pointcut("execution(* transfer(..))")<em class="lineannotation"><span class="lineannotation">// the pointcut expression</span></em>
private void anyOldTransfer() {}<em class="lineannotation"><span class="lineannotation">// the pointcut signature</span></em></pre><p>The pointcut expression that forms the value of the <code class="interfacename">@Pointcut</code>
	  annotation is a regular AspectJ 5 pointcut expression. For a full discussion of AspectJ's
	  pointcut language, see the 
	  <a href="http://www.eclipse.org/aspectj/doc/released/progguide/index.html" target="_top">AspectJ Programming Guide</a>
	  (and for Java 5 based extensions, the 
	  <a href="http://www.eclipse.org/aspectj/doc/released/adk15notebook/index.html" target="_top">AspectJ 5 Developers Notebook</a>)
	  or one of the books on AspectJ such as &#8220;<span class="quote">Eclipse AspectJ</span>&#8221; by Colyer et. al.
	  or &#8220;<span class="quote">AspectJ in Action</span>&#8221; by Ramnivas Laddad.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-pointcuts-designators"></a>6.2.3.1.&nbsp;Supported Pointcut Designators</h4></div></div></div><p>Spring AOP supports the following AspectJ pointcut designators for use in pointcut
	  expressions:</p><div class="sidebar"><p class="title"><b>Other pointcut types</b></p><p>The full AspectJ pointcut language supports additional pointcut designators
	      that are not supported in Spring. These are: <code class="literal">call, initialization,
	      preinitialization, staticinitialization, get, set, handler, adviceexecution,
	      withincode, cflow, cflowbelow, if, @this</code>, and <code class="literal">@withincode</code>.
	      Use of these pointcut designators in pointcut expressions interpreted by Spring AOP
	      will result in an <code class="classname">IllegalArgumentException</code> being thrown.</p><p>The set of pointcut designators supported by Spring AOP may be extended in
 	      future releases both to support more of the AspectJ pointcut designators (e.g. "if"),
	      and potentially to support Spring specific designators such as "bean" (matching on
	      bean name).</p></div><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>execution</em></span> - for matching method execution join points,
	      this is the primary pointcut designator you will use when working with Spring AOP</p></li><li><p><span class="emphasis"><em>within</em></span> - limits matching to join points within certain
	      types (simply the execution of a method declared within a matching type when using
	      Spring AOP)</p></li><li><p><span class="emphasis"><em>this</em></span> - limits matching to 
		  join points (the execution of methods when using Spring AOP) where the bean
	      reference (Spring AOP proxy) is an instance of the given type</p></li><li><p><span class="emphasis"><em>target</em></span> - limits matching to join points (the execution
	      of methods when using Spring AOP) where the target object (application object
	      being proxied) is an instance of the given type</p></li><li><p><span class="emphasis"><em>args</em></span> - limits matching to 
		  join points (the execution of methods when using Spring AOP) where the 
	      arguments are instances of the given types</p></li><li><p><span class="emphasis"><em><code class="interfacename">@target</code></em></span> - limits matching
	      to join points (the execution of methods when using Spring AOP) where the
	      class of the executing object has an annotation of the given type</p></li><li><p><span class="emphasis"><em><code class="interfacename">@args</code></em></span> - limits matching to 
		  join points (the execution of methods when using Spring AOP) where the
	      runtime type of the actual arguments passed have annotations of the given type(s)</p></li><li><p><span class="emphasis"><em><code class="interfacename">@within</code></em></span> - limits matching
	      to join points within types that have the given annotation (the execution of methods
	      declared in types with the given annotation when using Spring AOP)  
		  </p></li><li><p><span class="emphasis"><em>@annotation</em></span> - limits matching to join points where the
	      subject of the join point (method being executed in Spring AOP) has the given
	      annotation</p></li></ul></div><p class="remark"><i><span class="remark">Because Spring AOP limits matching to only method execution join points, the
	    discussion of the pointcut designators above gives a narrower definition than you will
	    find in the AspectJ programming guide. In addition, AspectJ itself has type-based
	    semantics and at an execution join point both 'this' and 'target' refer to the same
	    object - the object executing the method. Spring AOP is a proxy based system and
	    differentiates between the proxy object itself (bound to 'this') and the target
	    object behind the proxy (bound to 'target').</span></i></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-pointcuts-combining"></a>6.2.3.2.&nbsp;Combining pointcut expressions</h4></div></div></div><p>Pointcut expressions can be combined using '&amp;&amp;', '||' and '!'. It is also possible
	  to refer to pointcut expressions by name. The following example shows three pointcut 
	  expressions: <code class="literal">anyPublicOperation</code> (which matches if a method execution
	  join point represents the execution of any public method); <code class="literal">inTrading</code> (which matches
	  if a method execution is in the trading module), and <code class="literal">tradingOperation</code>
	  (which matches if a method execution represents any public method in the trading module).</p><pre class="programlisting">    @Pointcut("execution(public * *(..))")
    private void anyPublicOperation() {}
    
    @Pointcut("within(com.xyz.someapp.trading..*")
    private void inTrading() {}
    
    @Pointcut("anyPublicOperation() &amp;&amp; inTrading()")
    private void tradingOperation() {}</pre><p>It is a best practice to build more complex pointcut expressions out of smaller 
	  named components as shown above. When referring to pointcuts by name, normal Java
	  visibility rules apply (you can see private pointcuts in the same type, protected
	  pointcuts in the hierarchy, public pointcuts anywhere and so on). Visibility does not
	  affect pointcut <span class="emphasis"><em>matching</em></span>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-common-pointcuts"></a>6.2.3.3.&nbsp;Sharing common pointcut definitions</h4></div></div></div><p>When working with enterprise applications, you often want to refer to modules of the 
        application and particular sets of operations from within several aspects. We recommend 
        defining a "SystemArchitecture" aspect that captures common pointcut expressions
        for this purpose. A typical such aspect would look as follows:</p><pre class="programlisting">package com.xyz.someapp;

import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Pointcut;

@Aspect
public class SystemArchitecture {

  <em class="lineannotation"><span class="lineannotation">/**
   * A join point is in the web layer if the method is defined
   * in a type in the com.xyz.someapp.web package or any sub-package
   * under that.
   */</span></em>
  @Pointcut("within(com.xyz.someapp.web..*)")
  public void inWebLayer() {}

  <em class="lineannotation"><span class="lineannotation">/**
   * A join point is in the service layer if the method is defined
   * in a type in the com.xyz.someapp.service package or any sub-package
   * under that.
   */</span></em>
  @Pointcut("within(com.xyz.someapp.service..*)")
  public void inServiceLayer() {}

  <em class="lineannotation"><span class="lineannotation">/**
   * A join point is in the data access layer if the method is defined
   * in a type in the com.xyz.someapp.dao package or any sub-package
   * under that.
   */</span></em>
  @Pointcut("within(com.xyz.someapp.dao..*)")
  public void inDataAccessLayer() {}

  <em class="lineannotation"><span class="lineannotation">/**
   * A business service is the execution of any method defined on a service
   * interface. This definition assumes that interfaces are placed in the
   * "service" package, and that implementation types are in sub-packages.
   * 
   * If you group service interfaces by functional area (for example, 
   * in packages com.xyz.someapp.abc.service and com.xyz.def.service) then
   * the pointcut expression "execution(* com.xyz.someapp..service.*.*(..))"
   * could be used instead.
   */</span></em>
  @Pointcut("execution(* com.xyz.someapp.service.*.*(..))")
  public void businessService() {}
  
  <em class="lineannotation"><span class="lineannotation">/**
   * A data access operation is the execution of any method defined on a 
   * dao interface. This definition assumes that interfaces are placed in the
   * "dao" package, and that implementation types are in sub-packages.
   */</span></em>
  @Pointcut("execution(* com.xyz.someapp.dao.*.*(..))")
  public void dataAccessOperation() {}

}</pre><p>The pointcuts defined in such an aspect can be referred to anywhere that you
        need a pointcut expression. For example, to make the service layer transactional, you
        could write:</p><pre class="programlisting">&lt;aop:config&gt;
  &lt;aop:advisor 
      pointcut="com.xyz.someapp.SystemArchitecture.businessService()"
      advice-ref="tx-advice"/&gt;
&lt;/aop:config&gt;

&lt;tx:advice id="tx-advice"&gt;
&lt;tx:attributes&gt;
    &lt;tx:method name="*" propagation="REQUIRED"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</pre><p>The <code class="literal">&lt;aop:config&gt;</code> and <code class="literal">&lt;aop:advisor&gt;</code>
        tags are discussed in the section entitled <a href="#aop-schema" title="6.3.&nbsp;Schema-based AOP support">Section&nbsp;6.3, &#8220;Schema-based AOP support&#8221;</a>. The transaction
        tags are discussed in the chapter entitled <a href="#transaction" title="Chapter&nbsp;9.&nbsp;Transaction management">Chapter&nbsp;9, <i>Transaction management</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-pointcuts-examples"></a>6.2.3.4.&nbsp;Examples</h4></div></div></div><p>Spring AOP users are likely to use the <code class="literal">execution</code> pointcut
     designator the most often. The format of an execution expression is:</p><pre class="programlisting">execution(modifiers-pattern? ret-type-pattern declaring-type-pattern? name-pattern(param-pattern)
          throws-pattern?)</pre><p>
     All parts except the returning type pattern (ret-type-pattern in the snippet above),
	 name pattern, and parameters pattern are optional.
     The returning type pattern determines what the return type of the method must be in order
     for a join point to be matched. Most frequently you will use <code class="literal">*</code> as the
     returning type pattern, which matches any return type. A fully-qualified type name will
     match only when the method returns the given type. The name pattern matches the method name.
     You can use the <code class="literal">*</code> wildcard as all or part of a name pattern. The
     parameters pattern is slightly more complex: <code class="literal">()</code> matches a method that takes
     no parameters, whereas <code class="literal">(..)</code> matches any number of parameters (zero or more).
     The pattern <code class="literal">(*)</code> matches a method taking one parameter of any type,
     <code class="literal">(*,String)</code> matches a method taking two parameters, the first can be of
     any type, the second must be a String. Consult the 
     <a href="http://www.eclipse.org/aspectj/doc/released/progguide/semantics-pointcuts.html" target="_top">
     Language Semantics</a> section of the AspectJ Programming Guide for more
     information.
     </p><p>Some examples of common pointcut expressions are given below.</p><div class="itemizedlist"><ul type="disc"><li><p>the execution of any public method:</p><pre class="programlisting">execution(public * *(..))</pre></li><li><p>the execution of any method with a name beginning with "set":</p><pre class="programlisting">execution(* set*(..))</pre></li><li><p>the execution of any method defined by the <code class="interfacename">AccountService</code> interface:</p><pre class="programlisting">execution(* com.xyz.service.AccountService.*(..))</pre></li><li><p>the execution of any method defined in the service package:</p><pre class="programlisting">execution(* com.xyz.service.*.*(..))</pre></li><li><p>the execution of any method defined in the service package or a sub-package:</p><pre class="programlisting">execution(* com.xyz.service..*.*(..))</pre></li><li><p>any join point (method execution only in Spring AOP) within the service package:</p><pre class="programlisting">within(com.xyz.service.*)</pre></li><li><p>any join point (method execution only in Spring AOP) within the service package or a sub-package:</p><pre class="programlisting">within(com.xyz.service..*)</pre></li><li><p>any join point (method execution only in Spring AOP) where the proxy implements the <code class="interfacename">AccountService</code> interface:</p><pre class="programlisting">this(com.xyz.service.AccountService)</pre><p class="remark"><i><span class="remark">'this' is more commonly used in a binding form :- see the following section
     on advice for how to make the proxy object available in the advice body.</span></i></p></li><li><p>any join point (method execution only in Spring AOP) where the target object implements the <code class="interfacename">AccountService</code> interface:</p><pre class="programlisting">target(com.xyz.service.AccountService)</pre><p class="remark"><i><span class="remark">'target' is more commonly used in a binding form :- see the following section
     on advice for how to make the target object available in the advice body.</span></i></p></li><li><p>any join point (method execution only in Spring AOP) which takes a single parameter, and where the argument passed at runtime is <code class="interfacename">Serializable</code>:</p><pre class="programlisting">args(java.io.Serializable)</pre><p class="remark"><i><span class="remark">'args' is more commonly used in a binding form :- see the following section
     on advice for how to make the method arguments available in the advice body.</span></i></p><p>Note that the pointcut given in this example is different to 
     <code class="literal">execution(* *(java.io.Serializable))</code>: the args version matches if 
     the argument passed at runtime is Serializable, the execution version matches if the
     method signature declares a single parameter of type <code class="interfacename">Serializable</code>.</p></li><li><p>any join point (method execution only in Spring AOP) where the target object has an <code class="interfacename">@Transactional</code> annotation:</p><pre class="programlisting">@target(org.springframework.transaction.annotation.Transactional)</pre><p class="remark"><i><span class="remark">'@target' can also be used in a binding form :- see the following section
     on advice for how to make the annotation object available in the advice body.</span></i></p></li><li><p>any join point (method execution only in Spring AOP) where the declared type of the target object has an <code class="interfacename">@Transactional</code> annotation:</p><pre class="programlisting">@within(org.springframework.transaction.annotation.Transactional)</pre><p class="remark"><i><span class="remark">'@within' can also be used in a binding form :- see the following section
     on advice for how to make the annotation object available in the advice body.</span></i></p></li><li><p>any join point (method execution only in Spring AOP) where the executing method has an <code class="interfacename">@Transactional</code> annotation:</p><pre class="programlisting">@annotation(org.springframework.transaction.annotation.Transactional)</pre><p class="remark"><i><span class="remark">'@annotation' can also be used in a binding form :- see the following section
     on advice for how to make the annotation object available in the advice body.</span></i></p></li><li><p>any join point (method execution only in Spring AOP) which takes a single parameter, and where the
     runtime type of the argument passed has the <code class="interfacename">@Classified</code> annotation:</p><pre class="programlisting">@args(com.xyz.security.Classified)</pre><p class="remark"><i><span class="remark">'@args' can also be used in a binding form :- see the following section
     on advice for how to make the annotation object(s) available in the advice body.</span></i></p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-advice"></a>6.2.4.&nbsp;Declaring advice</h3></div></div></div><p>Advice is associated with a pointcut expression, and runs before, after, or
	   around method executions matched by the pointcut. The pointcut expression may be
	   either a simple reference to a named pointcut, or a pointcut expression declared
	   in place.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-advice-before"></a>6.2.4.1.&nbsp;Before advice</h4></div></div></div><p>Before advice is declared in an aspect using the <code class="interfacename">@Before</code> annotation:</p><pre class="programlisting">import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;

@Aspect
public class BeforeExample {

  @Before("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")
  public void doAccessCheck() {
    <em class="lineannotation"><span class="lineannotation">// ...</span></em>
  }

}</pre><p>If using an in-place pointcut expression we could rewrite the above example as:</p><pre class="programlisting">import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;

@Aspect
public class BeforeExample {

  @Before("execution(* com.xyz.myapp.dao.*.*(..))")
  public void doAccessCheck() {
    <em class="lineannotation"><span class="lineannotation">// ...</span></em>
  }

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-advice-after-returning"></a>6.2.4.2.&nbsp;After returning advice</h4></div></div></div><p>After returning advice runs when a matched method execution returns
	   normally. It is declared using the <code class="interfacename">@AfterReturning</code> annotation:</p><pre class="programlisting">import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.AfterReturning;

@Aspect
public class AfterReturningExample {

  @AfterReturning("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")
  public void doAccessCheck() {
    <em class="lineannotation"><span class="lineannotation">// ...</span></em>
  }

}</pre><p class="remark"><i><span class="remark">Note: it is of course possible to have multiple advice declarations, and other
	members as well, all inside the same aspect. We're just showing a single advice declaration
	in these examples to focus on the issue under discussion at the time.
	</span></i></p><p>
	Sometimes you need access in the advice body to the actual value that was returned. You
	can use the form of <code class="interfacename">@AfterReturning</code> that binds the return
	value for this: 
	</p><pre class="programlisting">import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.AfterReturning;

@Aspect
public class AfterReturningExample {

  @AfterReturning(
    pointcut="com.xyz.myapp.SystemArchitecture.dataAccessOperation()",
    returning="retVal")
  public void doAccessCheck(Object retVal) {
    <em class="lineannotation"><span class="lineannotation">// ...</span></em>
  }
  
}</pre><p>The name used in the <code class="literal">returning</code> attribute must correspond to
	the name of a parameter in the advice method. When a method execution returns, the
	return value will be passed to the advice method as the corresponding argument value.
	A <code class="literal">returning</code> clause also restricts matching to only those method 
	executions that return a value of the specified type (<code class="classname">Object</code>
	in this case, which will match any return value).
	</p><p>Please note that it is <span class="emphasis"><em>not</em></span> possible to
		   return a totally different reference when using after-returning advice.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-advice-after-throwing"></a>6.2.4.3.&nbsp;After throwing advice</h4></div></div></div><p>After throwing advice runs when a matched method execution exits by throwing
	an exception. It is declared using the <code class="interfacename">@AfterThrowing</code> annotation:</p><pre class="programlisting">import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.AfterThrowing;

@Aspect
public class AfterThrowingExample {

  @AfterThrowing("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")
  public void doRecoveryActions() {
    <em class="lineannotation"><span class="lineannotation">// ...</span></em>
  }

}</pre><p>Often you want the advice to run only when exceptions of a given type are
	thrown, and you also often need access to the thrown exception in the advice
	body. Use the <code class="literal">throwing</code> attribute to both restrict matching
	(if desired, use <code class="interfacename">Throwable</code> as the exception type
	otherwise) and bind the thrown exception to an advice parameter.
	</p><pre class="programlisting">import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.AfterThrowing;

@Aspect
public class AfterThrowingExample {

  @AfterThrowing(
    pointcut="com.xyz.myapp.SystemArchitecture.dataAccessOperation()",
    throwing="ex")
  public void doRecoveryActions(DataAccessException ex) {
    <em class="lineannotation"><span class="lineannotation">// ...</span></em>
  }

}</pre><p>The name used in the <code class="literal">throwing</code> attribute must correspond to
	the name of a parameter in the advice method. When a method execution exits by
	throwing an exception, the
	exception will be passed to the advice method as the corresponding argument value.
	A <code class="literal">throwing</code> clause also restricts matching to only those method 
	executions that throw an exception of the specified type
	(<code class="classname">DataAccessException</code> in this case).
	</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-advice-after-finally"></a>6.2.4.4.&nbsp;After (finally) advice</h4></div></div></div><p>After (finally) advice runs however a matched method execution exits.
	It is declared using the <code class="interfacename">@After</code> annotation. After
	advice must be prepared to handle both normal and exception return conditions.
	It is typically used for releasing resources, etc.</p><pre class="programlisting">import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.After;

@Aspect
public class AfterFinallyExample {

  @After("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")
  public void doReleaseLock() {
    <em class="lineannotation"><span class="lineannotation">// ...</span></em>
  }

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-ataspectj-around-advice"></a>6.2.4.5.&nbsp;Around advice</h4></div></div></div><p>The final kind of advice is around advice. Around advice runs "around" a
	matched method execution. It has the opportunity to do work both before and 
	after the method executes, and to determine when, how, and even if, the method
	actually gets to execute at all. Around advice is often used if you need to 
	share state before and after a method execution in a thread-safe manner (starting
	and stopping a timer for example). Always use the least powerful form of 
	advice that meets your requirements (i.e. don't use around advice if simple
	before advice would do).
	</p><p>Around advice is declared using the <code class="interfacename">@Around</code> annotation. The first parameter
	of the advice method must be of type <code class="interfacename">ProceedingJoinPoint</code>. Within the body of the
	advice, calling <code class="literal">proceed()</code> on the <code class="interfacename">ProceedingJoinPoint</code> causes the
	underlying method to execute. The <code class="literal">proceed</code> method may also be
	called passing in an <code class="classname">Object[]</code> - the values in the array will be used as the arguments
	to the method execution when it proceeds.
	</p><p class="remark"><i><span class="remark">The behavior of proceed when called with an <code class="classname">Object[]</code> is a little different
	than the behavior of proceed for around advice compiled by the AspectJ compiler. For
	around advice written using the traditional AspectJ language, the number of arguments 
	passed to proceed must match the number of arguments passed to the around advice (not the 
	number of arguments taken by the underlying join point), and the value passed to proceed
	in a given argument position supplants the original value at the join point for the entity
	the value was bound to. (Don't worry if this doesn't make sense right now!) The 
	approach taken by Spring is simpler and a better match to its proxy-based, execution only
	semantics. You only need to be aware of this difference if you compiling @AspectJ aspects
	written for Spring and using proceed with arguments with the AspectJ compiler and weaver.
	There is a way to write such aspects that is 100% compatible across both Spring AOP and 
	AspectJ, and this is discussed in the following section on advice parameters. 
	</span></i></p><pre class="programlisting">import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.ProceedingJoinPoint;

@Aspect
public class AroundExample {

  @Around("com.xyz.myapp.SystemArchitecture.businessService()")
  public Object doBasicProfiling(ProceedingJoinPoint pjp) throws Throwable {
    // start stopwatch
    Object retVal = pjp.proceed();
    // stop stopwatch
    return retVal;
  }

}</pre><p>
	The value returned by the around advice will be the return value seen by the caller
	of the method. A simple caching aspect for example could return a value from a cache
	if it has one, and invoke proceed() if it does not. Note that proceed may be invoked
	once, many times, or not at all within the body of the around advice, all of these
	are quite legal.
	</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-ataspectj-advice-params"></a>6.2.4.6.&nbsp;Advice parameters</h4></div></div></div><p>Spring 2.0 offers fully typed advice - meaning that you declare the parameters
	   	you need in the advice signature (as we saw for the returning and throwing examples
	   	above) rather than work with <code class="classname">Object[]</code> arrays all the time.
	   	We'll see how to make argument	and other contextual values available to the advice
	   	body in a moment. First let's take a look at how to write generic advice that can find
	   	out about the method the advice is currently advising.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-params-the-joinpoint"></a>6.2.4.6.1.&nbsp;Access to the current <code class="interfacename">JoinPoint</code></h5></div></div></div><p>
	   	    Any advice method may declare as its first parameter, a parameter of 
	   	    type <code class="interfacename">org.aspectj.lang.JoinPoint</code> (please note that
	   	    around advice is <span class="emphasis"><em>required</em></span> to declare a first parameter of type
	   	    <code class="interfacename">ProceedingJoinPoint</code>, which is a subclass of
	   	    <code class="interfacename">JoinPoint</code>. The <code class="interfacename">JoinPoint</code>
	   	    interface provides a number of useful methods such as <code class="literal">getArgs()</code>
	   	    (returns the method arguments), <code class="methodname">getThis()</code> (returns the proxy
	   	    object), <code class="methodname">getTarget()</code> (returns the target object),
	   	    <code class="methodname">getSignature()</code> (returns a description of the method that is
	   	    being advised) and <code class="methodname">toString()</code> (prints a useful description of
	   	    the method being advised). Please do consult the Javadocs for full details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-params-passing"></a>6.2.4.6.2.&nbsp;Passing parameters to advice</h5></div></div></div><p>We've already seen how to bind the returned value or exception value (using
	   	    after returning and after throwing advice). To make argument values available to
	   	    the advice body, you can use the binding form of <code class="literal">args</code>. If
	   	    a parameter name is used in place of a type name in an args expression, then the
	   	    value of the corresponding argument will be passed as the parameter value when the 
	   	    advice is invoked. An example should make this clearer. Suppose you want to advise
	   	    the execution of dao operations that take an Account object as the first parameter,
	   	    and you need access to the account in the advice body. You could write the following:</p><pre class="programlisting">@Before("com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp;" + 
        "args(account,..)")
public void validateAccount(Account account) {
  <em class="lineannotation"><span class="lineannotation">// ...</span></em>
}</pre><p>The <code class="literal">args(account,..)</code> part of the pointcut expression serves
	   	two purposes: firstly, it restricts matching to only those method executions where
	   	the method takes at least one parameter, and the argument passed to that parameter
	   	is an instance of <code class="classname">Account</code>; secondly, it makes the actual
	   	<code class="classname">Account</code> object available to the advice via the
	   	<code class="literal">account</code> parameter.</p><p>Another way of writing this is to declare a pointcut that "provides" the
	   	<code class="classname">Account</code> object value when it matches a join point, and then
	   	just refer to the named pointcut from the advice. This would look as follows:</p><pre class="programlisting">@Pointcut("com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp;" + 
          "args(account,..)")
private void accountDataAccessOperation(Account account) {}

@Before("accountDataAccessOperation(account)")
public void validateAccount(Account account) {
  <em class="lineannotation"><span class="lineannotation">// ...</span></em>
}</pre><p>The interested reader is once more referred to the AspectJ programming guide for
	    more details.</p><p>The proxy object (<code class="literal">this</code>), target object (<code class="literal">target</code>),
	   	and annotations (<code class="literal">@within, @target, @annotation, @args</code>) can all 
	   	be bound in a similar fashion. The following example shows how you could match
	   	the execution of methods annotated with an <code class="interfacename">@Auditable</code>
	   	annotation, and extract the audit code.
	   	</p><p>First the definition of the <code class="interfacename">@Auditable</code> annotation:</p><pre class="programlisting">@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Auditable {
	AuditCode value();
}</pre><p>And then the advice that matches the execution of <code class="interfacename">@Auditable</code> methods:</p><pre class="programlisting">@Before("com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; " + 
        "@annotation(auditable)")
public void audit(Auditable auditable) {
  AuditCode code = auditable.value();
  <em class="lineannotation"><span class="lineannotation">// ...</span></em>
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-params-names"></a>6.2.4.6.3.&nbsp;Determining argument names</h5></div></div></div><p>The parameter binding in advice invocations relies on matching names used
		in pointcut expressions to declared parameter names in (advice and pointcut) method
		signatures. Parameter names are <span class="emphasis"><em>not</em></span> available through Java
		reflection, so Spring AOP uses the following strategies to determine parameter
		names:</p><div class="orderedlist"><ol type="1"><li><p>If the parameter names have been specified by the user explicitly,
		    then the specified parameter names are used: both the advice and the pointcut
		    annotations have an optional "argNames" attribute which can be used to specify
		    the argument names of the annotated method - these argument names <span class="emphasis"><em>are</em></span>
		    available at runtime. For example:</p><pre class="programlisting">@Before(
   value="com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; @annotation(auditable)",
   argNames="auditable")
public void audit(Auditable auditable) {
  AuditCode code = auditable.value();
  <em class="lineannotation"><span class="lineannotation">// ...</span></em>
}</pre><p class="remark"><i><span class="remark">If an @AspectJ aspect has been compiled by the AspectJ compiler (ajc) then
		    there is no need to add the <code class="literal">argNames</code> attribute as the compiler will do this
		    automatically.</span></i></p></li><li><p>Using the <code class="literal">'argNames'</code> attribute is a little clumsy, so if the
		        <code class="literal">'argNames'</code> attribute has
		        not been specified, then Spring AOP will look at the debug information for the
		        class and try to determine the parameter names from the local variable table. This 
		        information will be present as long as the classes have been compiled with debug
		        information (<code class="literal">'-g:vars'</code> at a minimum). The consequences of
		        compiling with this flag on are: (1) your code will be slightly easier to understand
		        (reverse engineer), (2) the class file sizes will be very slightly bigger (typically
		        inconsequential), (3) the optimization to remove unused local variables will not be
		        applied by your compiler. In other words, you should encounter no difficulties building
		        with this flag on.</p></li><li><p>If the code has been compiled without the necessary debug information, then Spring AOP
		        will attempt to deduce the pairing of binding variables to parameters (for example,
		        if only one variable is bound in the pointcut expression, and the advice method only
		        takes one parameter, the pairing is obvious!). If the binding of variables is ambiguous
		        given the available information, then an <code class="exceptionname">AmbiguousBindingException</code>
		        will be thrown.</p></li><li><p>If all of the above strategies fail then an
		        <code class="exceptionname">IllegalArgumentException</code> will be thrown.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-proceeding-with-the-call"></a>6.2.4.6.4.&nbsp;Proceeding with arguments</h5></div></div></div><p>We remarked earlier that we would describe how to write a proceed call
            <span class="emphasis"><em>with arguments</em></span> that works consistently across Spring AOP 
            and AspectJ. The solution is simply to ensure that the advice signature binds
            each of the method parameters in order. For example:</p><pre class="programlisting">@Around("execution(List&lt;Account&gt; find*(..)) &amp;&amp;" +
        "com.xyz.myapp.SystemArchitecture.inDataAccessLayer() &amp;&amp; " +
        "args(accountHolderNamePattern)")		
public Object preProcessQueryPattern(ProceedingJoinPoint pjp, String accountHolderNamePattern)
throws Throwable {
  String newPattern = preProcess(accountHolderNamePattern);
  return pjp.proceed(new Object[] {newPattern});
}        
</pre><p>In many cases you will be doing this binding anyway (as in the example above).</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-ataspectj-advice-ordering"></a>6.2.4.7.&nbsp;Advice ordering</h4></div></div></div><p>What happens when multiple pieces of advice all want to run at the same
	   	join point? Spring AOP follows the same precedence rules as AspectJ to determine
	   	the order of advice execution. The highest precedence advice runs first "on the way in"
	   	(so given two pieces of before advice, the one with highest precedence runs
	   	first). "On the way out" from a join point, the highest precedence advice runs last
	   	(so given two pieces of after advice, the one with the highest precedence will run
	   	second).</p><p>When two pieces of advice defined in <span class="emphasis"><em>different</em></span> aspects both need
	    to run at the same join point, unless you specify otherwise the order of execution is
	    undefined. You can control the order of execution by specifying precedence. This is done in
	    the normal Spring way by either implementing the <code class="interfacename">org.springframework.core.Ordered</code>
	    interface in the aspect class or annotating it with the <code class="interfacename">Order</code> annotation.
	    Given two aspects, the aspect returning the lower value from
	    <code class="literal">Ordered.getValue()</code> (or the annotation value) has the higher precedence.</p><p>When two pieces of advice defined in <span class="emphasis"><em>the same</em></span> aspect both need
	    to run at the same join point, the ordering is undefined (since there is no way to retrieve
	    the declaration order via reflection for javac-compiled classes). Consider collapsing
	    such advice methods into one advice method per joinpoint in each aspect class, or refactor
	    the pieces of advice into separate aspect classes - which can be ordered at the aspect level.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-introductions"></a>6.2.5.&nbsp;Introductions</h3></div></div></div><p>Introductions (known as inter-type declarations in AspectJ) enable an aspect
	to declare that advised objects implement a given interface, and to provide an implementation
	of that interface on behalf of those objects.</p><p>An introduction is made using the <code class="interfacename">@DeclareParents</code> annotation. This annotation is
	used to declare that matching types have a new parent (hence the name). For example, given
	an interface <code class="interfacename">UsageTracked</code>, and an implementation of that interface
	<code class="classname">DefaultUsageTracked</code>, the following
	aspect declares that all implementors of service interfaces also implement the
	<code class="interfacename">UsageTracked</code> interface.
	(In order to expose statistics via JMX for example.)
	</p><pre class="programlisting">@Aspect
public class UsageTracking {

  @DeclareParents(value="com.xzy.myapp.service.*+",
                  defaultImpl=DefaultUsageTracked.class)
  public static UsageTracked mixin;
  
  @Before("com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp;" +
          "this(usageTracked)")
  public void recordUsage(UsageTracked usageTracked) {
    usageTracked.incrementUseCount();
  }
  
}</pre><p>
	The interface to be implemented is determined by the type of the annotated field. The 
	<code class="literal">value</code> attribute of the <code class="interfacename">@DeclareParents</code> annotation
	is an AspectJ type pattern :- any bean of a matching type will implement the UsageTracked
	interface. Note that in the before advice of the above example, service
	beans can be directly used as implementations of the <code class="interfacename">UsageTracked</code> interface. If accessing
	a bean programmatically you would write the following:
	</p><pre class="programlisting">UsageTracked usageTracked = (UsageTracked) context.getBean("myService");</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-instantiation-models"></a>6.2.6.&nbsp;Aspect instantiation models</h3></div></div></div><p class="remark"><i><span class="remark">(This is an advanced topic, so if you are just starting out with AOP you can safely skip it
     until later.)</span></i></p><p>By default there will be a single instance of each aspect within the application
	context. AspectJ calls this the singleton instantiation model. It is possible to define
	aspects with alternate lifecycles :- Spring supports AspectJ's <code class="literal">perthis</code>
	and <code class="literal">pertarget</code> instantiation models (<code class="literal">percflow, percflowbelow,</code>
	and <code class="literal">pertypewithin</code> are not currently supported).
	</p><p>A "perthis" aspect is declared by specifying a <code class="literal">perthis</code> clause
	in the <code class="interfacename">@Aspect</code> annotation. Let's look at an example, and then
	we'll explain how it works.
	</p><pre class="programlisting">@Aspect("perthis(com.xyz.myapp.SystemArchitecture.businessService())")
public class MyAspect {

  private int someState;
	
  @Before(com.xyz.myapp.SystemArchitecture.businessService())
  public void recordServiceUsage() {
    <em class="lineannotation"><span class="lineannotation">// ...</span></em>
  }
  	
}</pre><p>The effect of the <code class="literal">'perthis'</code> clause is that one aspect
	instance will be created for each unique service object executing a business
	service (each unique object	bound to 'this' at join points matched by the pointcut expression).
	The aspect instance is created
	the first time that a method is invoked on the service object. The aspect goes out
	of scope when the service object goes out of scope. Before the aspect instance is created,
	none of the advice within it executes. As soon as the aspect instance has been created,
	the advice declared within it will execute at matched join points, but only when the service
	object is the one this aspect is associated with. See the AspectJ programming guide for
	more information on per-clauses. 
	</p><p>The <code class="literal">'pertarget'</code> instantiation model works in exactly the same way as perthis, but
	creates one aspect instance for each unique target object at matched join points.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ataspectj-example"></a>6.2.7.&nbsp;Example</h3></div></div></div><p>
      Now that you have seen how all the constituent parts work, let's put them together
      to do something useful!</p><p>The execution of business services can sometimes fail
      due to concurrency issues (for example, deadlock loser).
      If the operation is retried, it is quite likely to succeed next time round. For
      business services where it is appropriate to retry in such conditions (idempotent
      operations that don't need to go back to the user for conflict resolution), we'd like
      to transparently retry the operation to avoid the client seeing a 
      <code class="classname">PessimisticLockingFailureException</code>. This is a requirement that clearly cuts across
      multiple services in the service layer, and hence is ideal for implementing via an aspect.
      </p><p>Because we want to retry the operation, we will need to use around advice so
      that we can call proceed multiple times. Here's how the basic aspect implementation
      looks:
      </p><pre class="programlisting">@Aspect
public class ConcurrentOperationExecutor implements Ordered {
   
   private static final int DEFAULT_MAX_RETRIES = 2;

   private int maxRetries = DEFAULT_MAX_RETRIES;
   private int order = 1;

   public void setMaxRetries(int maxRetries) {
      this.maxRetries = maxRetries;
   }
   
   public int getOrder() {
      return this.order;
   }
   
   public void setOrder(int order) {
      this.order = order;
   }
   
   @Around("com.xyz.myapp.SystemArchitecture.businessService()")
   public Object doConcurrentOperation(ProceedingJoinPoint pjp) throws Throwable { 
      int numAttempts = 0;
      PessimisticLockingFailureException lockFailureException;
      do {
         numAttempts++;
         try { 
            return pjp.proceed();
         }
         catch(PessimisticLockingFailureException ex) {
            lockFailureException = ex;
         }
      }
      while(numAttempts &lt;= this.maxRetries);
      throw lockFailureException;
   }

}</pre><p>Note that the aspect implements the <code class="interfacename">Ordered</code> interface so we can set the precedence
      of the aspect higher than the transaction advice (we want a fresh transaction
      each time we retry). The <code class="literal">maxRetries</code> and <code class="literal">order</code>
      properties will both be configured by Spring. The main action happens in the
      <code class="literal">doConcurrentOperation</code> around advice. Notice that for the moment
      we're applying the retry logic to all <code class="literal">businessService()s</code>. We
      try to proceed, and if we fail with an <code class="classname">PessimisticLockingFailureException</code>
      we simply try again unless we have exhausted all of our retry attempts.
      </p><p>The corresponding Spring configuration is:</p><pre class="programlisting">&lt;aop:aspectj-autoproxy/&gt;

&lt;bean id="concurrentOperationExecutor"
  class="com.xyz.myapp.service.impl.ConcurrentOperationExecutor"&gt;
     &lt;property name="maxRetries" value="3"/&gt;
     &lt;property name="order" value="100"/&gt;  
&lt;/bean&gt;</pre><p>To refine the aspect so that it only retries idempotent operations, we might
       define an <code class="interfacename">Idempotent</code> annotation:</p><pre class="programlisting">@Retention(RetentionPolicy.RUNTIME)
public @interface Idempotent {
  <em class="lineannotation"><span class="lineannotation">// marker annotation</span></em>
}</pre><p>and use the annotation to annotate the implementation of service operations.
       The change to the aspect to only retry idempotent operations simply involves
       refining the pointcut expression so that only <code class="interfacename">@Idempotent</code> operations match:</p><pre class="programlisting">@Around("com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp; " + 
        "@annotation(com.xyz.myapp.service.Idempotent)")
public Object doConcurrentOperation(ProceedingJoinPoint pjp) throws Throwable { 
  ...	
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-schema"></a>6.3.&nbsp;Schema-based AOP support</h2></div></div></div><p>If you are unable to use Java 5, or simply prefer an XML-based format, then
    Spring 2.0 also offers support for defining aspects using the new "aop" namespace
    tags. The exact same pointcut expressions and advice kinds are supported as when
    using the @AspectJ style, hence in this section we will focus on the new
    <span class="emphasis"><em>syntax</em></span> and refer the reader to the discussion in the previous
    section (<a href="#aop-ataspectj" title="6.2.&nbsp;@AspectJ support">Section&nbsp;6.2, &#8220;@AspectJ support&#8221;</a>) for an understanding of writing pointcut
    expressions and the binding of advice parameters.</p><p>To use the aop namespace tags described in this section, you need to import
    the spring-aop schema as described in
	<a href="#xsd-config" title="Appendix&nbsp;A.&nbsp;XML Schema-based configuration">Appendix&nbsp;A, <i>XML Schema-based configuration</i></a>. See <a href="#xsd-config-body-schemas-aop" title="A.2.6.&nbsp;The aop schema">Section&nbsp;A.2.6, &#8220;The <code class="literal">aop</code> schema&#8221;</a> 
	for how to import the tags in the aop namespace.</p><p>Within your Spring configurations, all aspect and advisor elements must be
    placed within an <code class="literal">&lt;aop:config&gt;</code> element (you can have more
    than one <code class="literal">&lt;aop:config&gt;</code> element in an application context 
    configuration). An <code class="literal">&lt;aop:config&gt;</code> element can contain
    pointcut, advisor, and aspect elements (note these must be declared in that order).</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="../images/admons/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">&lt;aop:config&gt;</code> style of configuration makes
        heavy use of Spring's <a href="#aop-autoproxy" title="7.9.&nbsp;Using the &#34;autoproxy&#34; facility">auto-proxying</a>
        mechanism. This can cause issues (such as advice not being woven) if you are
        already using explicit auto-proxying via the use of
        <code class="classname">BeanNameAutoProxyCreator</code> or suchlike. The recommended
        usage pattern is to use either just the <code class="literal">&lt;aop:config&gt;</code>
        style, or just the <code class="interfacename">AutoProxyCreator</code> style.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-declaring-an-aspect"></a>6.3.1.&nbsp;Declaring an aspect</h3></div></div></div><p>Using the schema support, an aspect is simply a regular Java object 
        defined as a bean in your Spring application context. The state and behavior is
        captured in the fields and methods of the object, and the pointcut and advice 
        information is captured in the XML.</p><p>An aspect is declared using the &lt;aop:aspect&gt; element, and the backing bean
        is referenced using the <code class="literal">ref</code> attribute:</p><pre class="programlisting">&lt;aop:config&gt;
  &lt;aop:aspect id="myAspect" ref="aBean"&gt;
    ...
  &lt;/aop:aspect&gt;
&lt;/aop:config&gt;

&lt;bean id="aBean" class="..."&gt;
  ...
&lt;/bean&gt;</pre><p>
 	    The bean backing the aspect ("<code class="literal">aBean</code>" in this case) can of course be
 	    configured and dependency injected just like any other Spring bean.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-pointcuts"></a>6.3.2.&nbsp;Declaring a pointcut</h3></div></div></div><p>A named pointcut can be declared inside an &lt;aop:config&gt; element,
	enabling the pointcut definition to be shared across several aspects and
	advisors.</p><p>A pointcut representing the execution of any business service in the service
	layer could be defined as follows:</p><pre class="programlisting">&lt;aop:config&gt;

  &lt;aop:pointcut id="businessService" 
        expression="execution(* com.xyz.myapp.service.*.*(..))"/&gt;

&lt;/aop:config&gt;</pre><p>Note that the pointcut expression itself is using the same AspectJ pointcut
	expression language as described in <a href="#aop-ataspectj" title="6.2.&nbsp;@AspectJ support">Section&nbsp;6.2, &#8220;@AspectJ support&#8221;</a>. If you are
	using the schema based declaration style with Java 5, you can refer to named
	pointcuts defined in types (@Aspects) within the pointcut expression, but this
	feature is not available on JDK 1.4 and below (it relies on the Java 5 specific
	AspectJ reflection APIs). On JDK 1.5 therefore, another way of defining the above
	pointcut would be:</p><pre class="programlisting">&lt;aop:config&gt;

  &lt;aop:pointcut id="businessService" 
        expression="com.xyz.myapp.SystemArchitecture.businessService()"/&gt;

&lt;/aop:config&gt;</pre><p>Assuming you have a <code class="literal">SystemArchitecture</code> aspect as described in
	<a href="#aop-common-pointcuts" title="6.2.3.3.&nbsp;Sharing common pointcut definitions">Section&nbsp;6.2.3.3, &#8220;Sharing common pointcut definitions&#8221;</a>.</p><p>Declaring a pointcut inside an aspect is very similar to declaring a top-level pointcut:</p><pre class="programlisting">&lt;aop:config&gt;

  &lt;aop:aspect id="myAspect" ref="aBean"&gt;

    &lt;aop:pointcut id="businessService" 
          expression="execution(* com.xyz.myapp.service.*.*(..))"/&gt;
          
    ...
    
  &lt;/aop:aspect&gt;

&lt;/aop:config&gt;</pre><p>When combining pointcut sub-expressions, '&amp;&amp;' is awkward within an XML
	document, and so the keywords 'and', 'or' and 'not' can be used in place
	of '&amp;&amp;', '||' and '!' respectively.</p><p>Note that pointcuts defined in this way are referred to by their XML id, and
	cannot define pointcut parameters. The named pointcut support in the schema based
	definition style is thus more limited than that offered by the @AspectJ style.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-advice"></a>6.3.3.&nbsp;Declaring advice</h3></div></div></div><p>The same five advice kinds are supported as for the @AspectJ style, and they
	have exactly the same semantics.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-before"></a>6.3.3.1.&nbsp;Before advice</h4></div></div></div><p>Before advice runs before a matched method execution.
        It is declared inside an <code class="literal">&lt;aop:aspect&gt;</code> using
        the &lt;aop:before&gt; element.</p><pre class="programlisting">&lt;aop:aspect id="beforeExample" ref="aBean"&gt;

    &lt;aop:before 
      pointcut-ref="dataAccessOperation" 
      method="doAccessCheck"/&gt;
          
    ...
    
&lt;/aop:aspect&gt;</pre><p>Here <code class="literal">dataAccessOperation</code> is the id of a pointcut defined at 
	  the top (<code class="literal">&lt;aop:config&gt;</code>) level. To define the pointcut
	  inline instead, replace the <code class="literal">pointcut-ref</code> attribute with a
	  <code class="literal">pointcut</code> attribute:</p><pre class="programlisting">&lt;aop:aspect id="beforeExample" ref="aBean"&gt;

    &lt;aop:before 
      pointcut="execution(* com.xyz.myapp.dao.*.*(..))" 
      method="doAccessCheck"/&gt;
          
    ...
    
&lt;/aop:aspect&gt;</pre><p>As we noted in the discussion of the @AspectJ style, using named pointcuts
	  can significantly improve the readability of your code.</p><p>The method attribute identifies a method (<code class="literal">doAccessCheck</code>) that
	  provides the body of the advice. This method must be defined for the bean referenced
	  by the aspect element containing the advice. Before a data access operation is 
	  executed (a method execution join point matched by the pointcut expression), the
	  "doAccessCheck" method on the aspect bean will be invoked.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-after-returning"></a>6.3.3.2.&nbsp;After returning advice</h4></div></div></div><p>After returning advice runs when a matched method execution completes normally.
	    It is declared inside an <code class="literal">&lt;aop:aspect&gt;</code> in
	    the same way as before advice. For example:
	  </p><pre class="programlisting">&lt;aop:aspect id="afterReturningExample" ref="aBean"&gt;

    &lt;aop:after-returning 
      pointcut-ref="dataAccessOperation" 
      method="doAccessCheck"/&gt;
          
    ...
    
&lt;/aop:aspect&gt;</pre><p>Just as in the @AspectJ style, it is possible to get hold of the return value within
	the advice body. Use the returning attribute to specify the name of the parameter to which
	the return value should be passed:</p><pre class="programlisting">&lt;aop:aspect id="afterReturningExample" ref="aBean"&gt;

    &lt;aop:after-returning 
      pointcut-ref="dataAccessOperation"
      returning="retVal" 
      method="doAccessCheck"/&gt;
          
    ...
    
&lt;/aop:aspect&gt;</pre><p>The doAccessCheck method must declare a parameter named <code class="literal">retVal</code>. The
	type of this parameter constrains matching in the same way as described for @AfterReturning.
	For example, the method signature may be declared as:
	</p><pre class="programlisting">public void doAccessCheck(Object retVal) {...</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-after-throwing"></a>6.3.3.3.&nbsp;After throwing advice</h4></div></div></div><p>After throwing advice executes when a matched method execution exits by throwing
	an exception. It is declared inside an <code class="literal">&lt;aop:aspect&gt;</code> using
	the after-throwing element:</p><pre class="programlisting">&lt;aop:aspect id="afterThrowingExample" ref="aBean"&gt;

    &lt;aop:after-throwing
      pointcut-ref="dataAccessOperation" 
      method="doRecoveryActions"/&gt;
          
    ...
    
&lt;/aop:aspect&gt;</pre><p>Just as in the @AspectJ style, it is possible to get hold of the thrown exception within
	the advice body. Use the throwing attribute to specify the name of the parameter to which
	the exception should be passed:</p><pre class="programlisting">&lt;aop:aspect id="afterThrowingExample" ref="aBean"&gt;

    &lt;aop:after-throwing 
      pointcut-ref="dataAccessOperation"
      throwing="dataAccessEx" 
      method="doRecoveryActions"/&gt;
          
    ...
    
&lt;/aop:aspect&gt;</pre><p>The doRecoveryActions method must declare a parameter named <code class="literal">dataAccessEx</code>. 
	The type of this parameter constrains matching in the same way as described for 
	@AfterThrowing.
	For example, the method signature may be declared as:
	</p><pre class="programlisting">public void doRecoveryActions(DataAccessException dataAccessEx) {...</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-after-finally"></a>6.3.3.4.&nbsp;After (finally) advice</h4></div></div></div><p>After (finally) advice runs however a matched method execution exits. It is declared
	using the <code class="literal">after</code> element:</p><pre class="programlisting">&lt;aop:aspect id="afterFinallyExample" ref="aBean"&gt;

    &lt;aop:after
      pointcut-ref="dataAccessOperation" 
      method="doReleaseLock"/&gt;
          
    ...
    
&lt;/aop:aspect&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-around"></a>6.3.3.5.&nbsp;Around advice</h4></div></div></div><p>The final kind of advice is around advice. Around advice runs "around" a
	matched method execution. It has the opportunity to do work both before and 
	after the method executes, and to determine when, how, and even if, the method
	actually gets to execute at all. Around advice is often used if you need to 
	share state before and after a method execution in a thread-safe manner (starting
	and stopping a timer for example).  Always use the least powerful form of 
	advice that meets your requirements; don't use around advice if simple
	before advice would do.</p><p>Around advice is declared using the <code class="literal">aop:around</code> element. 
	The first parameter of the advice method must be of type
	<code class="interfacename">ProceedingJoinPoint</code>. Within the body of the
	advice, calling <code class="literal">proceed()</code> on the
	<code class="interfacename">ProceedingJoinPoint</code> causes the
	underlying method to execute. The <code class="literal">proceed</code> method may also be
	calling passing in an <code class="classname">Object[]</code> - the values in the array will be used as the arguments
	to the method execution when it proceeds. See <a href="#aop-ataspectj-around-advice" title="6.2.4.5.&nbsp;Around advice">Section&nbsp;6.2.4.5, &#8220;Around advice&#8221;</a>
	for notes on calling proceed with an <code class="classname">Object[]</code>.
	</p><pre class="programlisting">&lt;aop:aspect id="aroundExample" ref="aBean"&gt;

    &lt;aop:around
      pointcut-ref="businessService" 
      method="doBasicProfiling"/&gt;
          
    ...
    
&lt;/aop:aspect&gt;</pre><p>The implementation of the <code class="literal">doBasicProfiling</code> advice would be
	exactly the same as in the @AspectJ example (minus the annotation of course):
	</p><pre class="programlisting">public Object doBasicProfiling(ProceedingJoinPoint pjp) throws Throwable {
    <em class="lineannotation"><span class="lineannotation">// start stopwatch</span></em>
    Object retVal = pjp.proceed();
    <em class="lineannotation"><span class="lineannotation">// stop stopwatch</span></em>
    return retVal;
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-params"></a>6.3.3.6.&nbsp;Advice parameters</h4></div></div></div><p>The schema based declaration style supports fully typed advice in the same way as 
	 described for the @AspectJ support - by matching pointcut parameters by name 
	 against advice method parameters. See <a href="#aop-ataspectj-advice-params" title="6.2.4.6.&nbsp;Advice parameters">Section&nbsp;6.2.4.6, &#8220;Advice parameters&#8221;</a>
	 for details.
	 </p><p>If you wish to explicity specify argument names for the advice methods (not
	 relying on either of the detection strategies previously described) then this is
	 done using the <code class="literal">arg-names</code> attribute of the advice element. For
	 example:</p><pre class="programlisting">&lt;aop:before
  pointcut="com.xyz.lib.Pointcuts.anyPublicMethod() and @annotation(auditable)"
  method="audit"
  arg-names="auditable"/&gt;</pre><p>The <code class="literal">arg-names</code> attribute accepts a comma-delimited list of
	parameter names.</p><p>Find below a slightly more involved example of the XSD-based approach that
	illustrates some around advice used in conjunction with a number of strongly typed
	parameters.</p><pre class="programlisting">package x.y.service;

public interface FooService {

   Foo getFoo(String fooName, int age);
}

public class DefaultFooService implements FooService {

   public Foo getFoo(String name, int age) {
      return new Foo(name, age);
   }
}</pre><p>Next up is the aspect. Notice the fact that the
    <code class="methodname">profile(..)</code> method accepts a number of strongly-typed parameters,
    the first of which happens to be the join point used to proceed with the method call: the
    presence of this parameter is an indication that the <code class="methodname">profile(..)</code>
    is to be used as <code class="literal">around</code> advice:</p><pre class="programlisting">package x.y;

import org.aspectj.lang.ProceedingJoinPoint;
import org.springframework.util.StopWatch;

public class SimpleProfiler {

   public Object profile(ProceedingJoinPoint call, String name, int age) throws Throwable {
      StopWatch clock = new StopWatch(
            "Profiling for '" + name + "' and '" + age + "'");
      try {
         clock.start(call.toShortString());
         return call.proceed();
      } finally {
         clock.stop();
         System.out.println(clock.prettyPrint());
      }
   }
}</pre><p>Finally, here is the XML configuration that is required to effect the
        execution of the above advice for a particular joinpoint:</p><pre class="programlisting">&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:aop="http://www.springframework.org/schema/aop"
      xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;

   <em class="lineannotation"><span class="lineannotation">&lt;!-- this is the object that will be proxied by Spring's AOP infrastructure --&gt;</span></em>
   &lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;

   <em class="lineannotation"><span class="lineannotation">&lt;!-- this is the actual advice itself --&gt;</span></em>
   &lt;bean id="profiler" class="x.y.SimpleProfiler"/&gt;

   &lt;aop:config&gt;
      &lt;aop:aspect ref="profiler"&gt;

         &lt;aop:pointcut id="theExecutionOfSomeFooServiceMethod"
                    expression="execution(* x.y.service.FooService.getFoo(String,int))
                    and args(name, age)"/&gt;

         &lt;aop:around pointcut-ref="theExecutionOfSomeFooServiceMethod"
                  method="profile"/&gt;

      &lt;/aop:aspect&gt;
   &lt;/aop:config&gt;

&lt;/beans&gt;</pre><p>If we had the following driver script, we would get output something like this
        on standard output:</p><pre class="programlisting">import org.springframework.beans.factory.BeanFactory;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import x.y.service.FooService;

public final class Boot {

   public static void main(final String[] args) throws Exception {
      BeanFactory ctx = new ClassPathXmlApplicationContext("x/y/plain.xml");
      FooService foo = (FooService) ctx.getBean("fooService");
      foo.getFoo("Pengo", 12);
   }
}</pre><pre class="programlisting">StopWatch 'Profiling for 'Pengo' and '12'': running time (millis) = 0
-----------------------------------------
ms     %     Task name
-----------------------------------------
00000  ?  execution(getFoo)</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-ordering"></a>6.3.3.7.&nbsp;Advice ordering</h4></div></div></div><p>When multiple advice needs to execute at the same join point (executing
	method) the ordering rules are as described in <a href="#aop-ataspectj-advice-ordering" title="6.2.4.7.&nbsp;Advice ordering">Section&nbsp;6.2.4.7, &#8220;Advice ordering&#8221;</a>.
	The precedence between aspects is determined by either adding the <code class="interfacename">Order</code>
	annotation to the bean backing the aspect or by having the bean implement the
	<code class="interfacename">Ordered</code> interface.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-introductions"></a>6.3.4.&nbsp;Introductions</h3></div></div></div><p>Introductions (known as inter-type declarations in AspectJ) enable an aspect
	to declare that advised objects implement a given interface, and to provide an implementation
	of that interface on behalf of those objects.</p><p>An introduction is made using the <code class="literal">aop:declare-parents</code> element
	inside an <code class="literal">aop:aspect</code> This element is
	used to declare that matching types have a new parent (hence the name). For example, given
	an interface <code class="interfacename">UsageTracked</code>, and an implementation of that
	interface <code class="classname">DefaultUsageTracked</code>, the following
	aspect declares that all implementors of service interfaces also implement the
	<code class="interfacename">UsageTracked</code> interface. (In order to expose statistics
	via JMX for example.)
	</p><pre class="programlisting">&lt;aop:aspect id="usageTrackerAspect" ref="usageTracking"&gt;

  &lt;aop:declare-parents
      types-matching="com.xzy.myapp.service.*+"
      implement-interface="com.xyz.myapp.service.tracking.UsageTracked"
      default-impl="com.xyz.myapp.service.tracking.DefaultUsageTracked"/&gt;
  
  &lt;aop:before
    pointcut="com.xyz.myapp.SystemArchitecture.businessService()
              and this(usageTracked)"
    method="recordUsage"/&gt;
  
&lt;/aop:aspect&gt;</pre><p>The class backing the <code class="literal">usageTracking</code> bean would contain the
    method:</p><pre class="programlisting">public void recordUsage(UsageTracked usageTracked) {
    usageTracked.incrementUseCount();
}</pre><p>
	The interface to be implemented is determined by <code class="literal">implement-interface</code>
	attribute. The value of the 
	<code class="literal">types-matching</code> attribute is an AspectJ type pattern :- 
	any bean of a matching type will implement the <code class="interfacename">UsageTracked</code>
	interface. Note that in the before advice of the above example, service
	beans can be directly used as implementations of the <code class="interfacename">UsageTracked</code> interface. If accessing
	a bean programmatically you would write the following:
	</p><pre class="programlisting">UsageTracked usageTracked = (UsageTracked) context.getBean("myService");</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-instatiation-models"></a>6.3.5.&nbsp;Aspect instantiation models</h3></div></div></div><p>The only supported instantiation model for schema-defined aspects is the 
	singleton model. Other instantiation models may be supported in future releases.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-advisors"></a>6.3.6.&nbsp;Advisors</h3></div></div></div><p>The concept of "advisors" is brought forward from the AOP support defined 
	in Spring 1.2 and does not have a direct equivalent in AspectJ. An advisor is
	like a small self-contained aspect that has a single piece of advice. The advice
	itself is represented by a bean, and must implement one of the advice 
	interfaces described in <a href="#aop-api-advice-types" title="7.3.2.&nbsp;Advice types in Spring">Section&nbsp;7.3.2, &#8220;Advice types in Spring&#8221;</a>. Advisors can
	take advantage of AspectJ pointcut expressions though.
	</p><p>Spring 2.0 supports the advisor concept with the <code class="literal">&lt;aop:advisor&gt;</code> 
	element. You will most commonly see it used in conjunction with transactional advice, 
	which also has its own namespace support in Spring 2.0. Here's how it looks:
	</p><pre class="programlisting">&lt;aop:config&gt;

  &lt;aop:pointcut id="businessService"
        expression="execution(* com.xyz.myapp.service.*.*(..))"/&gt;

  &lt;aop:advisor 
      pointcut-ref="businessService"
      advice-ref="tx-advice"/&gt;
      
&lt;/aop:config&gt;

&lt;tx:advice id="tx-advice"&gt;
  &lt;tx:attributes&gt;
    &lt;tx:method name="*" propagation="REQUIRED"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</pre></div><p>As well as the <code class="literal">pointcut-ref</code> attribute used in the above
	example, you can also use the <code class="literal">pointcut</code> attribute to define a 
	pointcut expression inline.</p><p>To define the precedence of an advisor so that the advice can participate
	in ordering, use the <code class="literal">order</code> attribute to define the
	<code class="literal">Ordered</code> value of the advisor.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-example"></a>6.3.7.&nbsp;Example</h3></div></div></div><p>Let's see how the concurrent locking failure retry example from
	<a href="#aop-ataspectj-example" title="6.2.7.&nbsp;Example">Section&nbsp;6.2.7, &#8220;Example&#8221;</a> looks when rewritten using the schema support. 
	</p><p>The execution of business services can sometimes fail
      due to concurrency issues (for example, deadlock loser).
      If the operation is retried, it is quite likely it will succeed next time round. For
      business services where it is appropriate to retry in such conditions (idempotent
      operations that don't need to go back to the user for conflict resolution), we'd like
      to transparently retry the operation to avoid the client seeing a 
      <code class="classname">PessimisticLockingFailureException</code>. This is a requirement that clearly cuts across
      multiple services in the service layer, and hence is ideal for implementing via an aspect.
      </p><p>Because we want to retry the operation, we'll need to use around advice so
      that we can call proceed multiple times. Here's how the basic aspect implementation
      looks (it's just a regular Java class using the schema support):
      </p><pre class="programlisting">public class ConcurrentOperationExecutor implements Ordered {
   
   private static final int DEFAULT_MAX_RETRIES = 2;

   private int maxRetries = DEFAULT_MAX_RETRIES;
   private int order = 1;

   public void setMaxRetries(int maxRetries) {
      this.maxRetries = maxRetries;
   }
   
   public int getOrder() {
      return this.order;
   }
   
   public void setOrder(int order) {
      this.order = order;
   }
   
   public Object doConcurrentOperation(ProceedingJoinPoint pjp) throws Throwable { 
      int numAttempts = 0;
      PessimisticLockingFailureException lockFailureException;
      do {
         numAttempts++;
         try { 
            return pjp.proceed();
         }
         catch(PessimisticLockingFailureException ex) {
            lockFailureException = ex;
         }
      }
      while(numAttempts &lt;= this.maxRetries);
      throw lockFailureException;
   }

}</pre><p>Note that the aspect implements the <code class="interfacename">Ordered</code> interface so we can set the precedence
      of the aspect higher than the transaction advice (we want a fresh transaction
      each time we retry). The <code class="literal">maxRetries</code> and <code class="literal">order</code>
      properties will both be configured by Spring. The main action happens in the
      <code class="literal">doConcurrentOperation</code> around advice method. We
      try to proceed, and if we fail with a <code class="classname">PessimisticLockingFailureException</code>
      we simply try again unless we have exhausted all of our retry attempts.
      </p><p class="remark"><i><span class="remark">This class is identical to the one used in the @AspectJ example, but
      with the annotations removed.</span></i></p><p>The corresponding Spring configuration is:</p><pre class="programlisting">&lt;aop:config&gt;

  &lt;aop:aspect id="concurrentOperationRetry" ref="concurrentOperationExecutor"&gt;

    &lt;aop:pointcut id="idempotentOperation"
        expression="execution(* com.xyz.myapp.service.*.*(..))"/&gt;
       
    &lt;aop:around
       pointcut-ref="idempotentOperation"
       method="doConcurrentOperation"/&gt;
  
  &lt;/aop:aspect&gt;

&lt;/aop:config&gt;

&lt;bean id="concurrentOperationExecutor"
  class="com.xyz.myapp.service.impl.ConcurrentOperationExecutor"&gt;
     &lt;property name="maxRetries" value="3"/&gt;
     &lt;property name="order" value="100"/&gt;  
&lt;/bean&gt;</pre><p>Notice that for the time being we assume that all business services
       are idempotent. If this is not the case we can refine the aspect so that it only 
       retries genuinely idempotent operations, by introducing an 
       <code class="interfacename">Idempotent</code> annotation:</p><pre class="programlisting">@Retention(RetentionPolicy.RUNTIME)
public @interface Idempotent {
  <em class="lineannotation"><span class="lineannotation">// marker annotation</span></em>
}</pre><p>and using the annotation to annotate the implementation of service operations.
       The change to the aspect to only retry idempotent operations simply involves
       refining the pointcut expression so that only <code class="interfacename">@Idempotent</code> operations match:</p><pre class="programlisting">  &lt;aop:pointcut id="idempotentOperation"
        expression="execution(* com.xyz.myapp.service.*.*(..)) and
                    @annotation(com.xyz.myapp.service.Idempotent)"/&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-choosing"></a>6.4.&nbsp;Choosing which AOP declaration style to use</h2></div></div></div><p>
    Once you have decided that an aspect is the best approach for implementing a 
    given requirement, how do you decide between using Spring AOP or AspectJ, 
    and between the Aspect language (code) style, @AspectJ annotation style, and
	the XML style? These decisions are influenced by a number of factors including
	application requirements, development tools, and team familiarity with AOP. 
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-spring-or-aspectj"></a>6.4.1.&nbsp;Spring AOP or full AspectJ?</h3></div></div></div><p>Use the simplest thing that can work. Spring AOP is simpler than using 
    	full AspectJ as there is no requirement to introduce the AspectJ 
    	compiler / weaver into your development and build processes. 
    	If you only need to advise the execution of operations on Spring beans, 
    	then Spring AOP is the right choice. If you need to advise domain objects, 
    	or any other object not managed by the Spring container, then you will 
    	need to use AspectJ. You will also need to use AspectJ if you wish to 
    	advise join points other than simple method executions (for example, call 
    	join points, field get or set join points, and so on).</p><p>When using AspectJ, you have the choice of the AspectJ language syntax 
    	(also known as the "code style") or the @AspectJ annotation style. 
    	If aspects play a large role in your design, and you are able to use the 
    	<a href="http://www.eclipse.org/ajdt/" target="_top">AspectJ Development Tools (AJDT)</a>
		in Eclipse, then the AspectJ language syntax is the preferred option: it is cleaner
		and simpler because the language was purposefully designed for writing aspects.
		If you are not using Eclipse, or have only a few aspects that do not play a
		major role in your application, then you may want to consider using the @AspectJ
		style and sticking with a regular Java compilation in your IDE, and adding an aspect
    	weaving (linking) phase to your build scripts.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ataspectj-or-xml"></a>6.4.2.&nbsp;@AspectJ or XML for Spring AOP?</h3></div></div></div><p>
			The XML style will be most familiar to existing Spring users. It can be
			used with any JDK level (referring to named pointcuts from within
			pointcut expressions does still require Java 5 though) and is backed
			by genuine POJOs. When using AOP as a tool to configure enterprise
			services (a good test is whether you consider the pointcut expression
			to be a part of your configuration you might want to change independently)
			then XML can be a good choice. With the XML style it is arguably
			clearer from your configuration what aspects are present in the system.
    	</p><p>
			The XML style has two disadvantages. Firstly it does not fully encapsulate
			the implementation of the requirement it addresses in a single place.
			The DRY principle says that there should be a single, unambiguous, authoritative
			representation of any piece of knowledge within a system. When using the
			XML style, the knowledge of how a requirement is implemented is split across
			the declaration of the backing bean class, and the XML in the configuration
			file. When using the @AspectJ style there is a single module - the aspect - in
			which this information is encapsulated. Secondly, the XML style is more
			limited in what in can express than the @AspectJ style: only the "singleton"
			aspect instantiation model is supported, and it is not possible to combine
			named pointcuts declared in XML. For example, in the @AspectJ style we
			can write something like:
    	</p><pre class="programlisting">  @Pointcut(execution(* get*()))
  public void propertyAccess() {}

  @Pointcut(execution(org.xyz.Account+ *(..))
  public void operationReturningAnAccount() {}

  @Pointcut(propertyAccess() &amp;&amp; operationReturningAnAccount())
  public void accountPropertyAccess() {}</pre><p>In the XML style I certainly can declare the first two pointcuts:</p><pre class="programlisting">  &lt;aop:pointcut id="propertyAccess" 
      expression="execution(* get*())"/&gt;

  &lt;aop:pointcut id="operationReturningAnAccount" 
      expression="execution(org.xyz.Account+ *(..))"/&gt;</pre><p>
		The downside of the XML approach becomes evident in this case because I
		cannot define the '<code class="literal">accountPropertyAccess</code>' pointcut by
		combining these definitions.
	</p><p>
		The @AspectJ style supports additional instantiation models, and richer
		pointcut composition. It has the advantage of keeping the aspect as a
		modular unit. It also has the advantage the @AspectJ aspects can be
		understood both by Spring AOP and by AspectJ - so if you later decide
		you need the capabilities of AspectJ to implement additional requirements
		then it is very easy to migrate to an AspectJ based approach.
	</p><p>So much for the pros and cons of each style then: which is best? If you are not using Java 5
	(or above) then clearly the XML-style is appropriate because it is the only option available to you.
	If you are using Java 5+, then you really will have to come to your own decision as to which style suits
	you best. In the experience of the Spring team, we advocate the use of the @AspectJ style whenever
	there are aspects that do more than simple "configuration" of enterprise services. If you are writing,
	have written, or have access to an aspect that is not part of the business contract of a particular
	class (such as a tracing aspect), then the XML-style is better.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-mixing-styles"></a>6.5.&nbsp;Mixing aspect types</h2></div></div></div><p>It is perfectly possible to mix @AspectJ style aspects using the autoproxying
    support, schema-defined <code class="literal">&lt;aop:aspect&gt;</code> aspects, 
    <code class="literal">&lt;aop:advisor&gt;</code> declared advisors and even proxies and 
    interceptors defined using the Spring 1.2 style in the same configuration. All of
    these are implemented using the same underlying support mechanism and will co-exist
    without any difficulty.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-proxying"></a>6.6.&nbsp;Proxying mechanisms</h2></div></div></div><p>Spring AOP uses either JDK dynamic proxies or CGLIB to create the proxy for a given
    target object. (JDK dynamic proxies are preferred whenever you have a choice). </p><p>If the target object to be proxied implements at least one interface then a JDK
    dynamic proxy will be used. All of the interfaces implemented by the target type will be
    proxied. If the target object does not implement any interfaces then a CGLIB proxy
    will be created.</p><p>If you want to force the use of CGLIB proxying (for example, to proxy every
    method defined for the target object, not just those implemented by its interfaces)
    you can do so. However, there are some issues to consider:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">final</code> methods cannot be advised, as they cannot be overriden.</p></li><li><p>You will need the CGLIB 2 binaries on your classpath, whereas dynamic proxies are available with the JDK.
		Spring will automatically warn you when it needs CGLIB and the CGLIB library classes are not found on the
		classpath.</p></li><li><p>The constructor of your proxied object will be called twice. This is a natural consequence of the CGLIB
		proxy model whereby a subclass is generated for each proxied object. For each proxied instance, two objects are
		created: the actual proxied object and an instance of the subclass that implements the advice. This behavior
		is not exhibited when using JDK proxies. Usually, calling the constructor of the proxied type twice, is not an
		issue, as there are usually only assignments taking place and no real logic is implemented in the constructor.</p></li></ul></div><p><a name="aop-autoproxy-force-CGLIB"></a>
		To force the use of CGLIB proxies set the value of the <code class="literal">proxy-target-class</code>
		attribute of the <code class="literal">&lt;aop:config&gt;</code> element to true:
	</p><pre class="programlisting">&lt;aop:config <span class="bold"><strong>proxy-target-class="true"</strong></span>&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- other beans defined here... --&gt;</span></em>
&lt;/aop:config&gt;</pre><p>To force CGLIB proxying when using the @AspectJ autoproxy support, set the 
  	 <code class="literal">'proxy-target-class'</code> attribute of the 
  	 <code class="literal">&lt;aop:aspectj-autoproxy&gt;</code> element to <code class="literal">true</code>:
  	</p><pre class="programlisting">&lt;aop:aspectj-autoproxy <span class="bold"><strong>proxy-target-class="true"</strong></span>/&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Multiple <code class="literal">&lt;aop:config/&gt;</code> sections are collapsed into a single unified auto-proxy
		creator at runtime, which applies the <span class="emphasis"><em>strongest</em></span> proxy settings that any of the
		<code class="literal">&lt;aop:config/&gt;</code> sections (typically from different XML bean definition files) specified.
		This also applies to the <code class="literal">&lt;tx:annotation-driven/&gt;</code> and
		<code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code> elements.</p><p>To be clear: using '<code class="literal">proxy-target-class="true"</code>' on
		<code class="literal">&lt;tx:annotation-driven/&gt;</code>, <code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code> or
		<code class="literal">&lt;aop:config/&gt;</code> elements will force the use of CGLIB proxies
		<span class="emphasis"><em>for all three of them</em></span>.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-understanding-aop-proxies"></a>6.6.1.&nbsp;Understanding AOP proxies</h3></div></div></div><p>Spring AOP is <span class="emphasis"><em>proxy-based</em></span>. It is vitally important that you grasp
    the semantics of what that last statement actually means before you write your own aspects or
    use any of the Spring AOP-based aspects supplied with the Spring Framework.</p><p>Consider first the scenario where you have a plain-vanilla, un-proxied,
    nothing-special-about-it, straight object reference, as illustrated by the following code snippet.</p><pre class="programlisting">public class SimplePojo implements Pojo {

   public void foo() {
      <em class="lineannotation"><span class="lineannotation">// this next method invocation is a <span class="bold"><strong>direct</strong></span> call on the 'this' reference</span></em>
      this.bar();
   }
   
   public void bar() {
      <em class="lineannotation"><span class="lineannotation">// some logic...</span></em>
   }
}</pre><p>If you invoke a method on an object reference, the method is invoked
	<span class="emphasis"><em>directly</em></span> on that object reference, as can be seen below.</p><p>
		</p><div class="mediaobject" align="center"><img src="images/aop-proxy-plain-pojo-call.png" align="middle"></div><p>
	</p><pre class="programlisting">public class Main {

   public static void main(String[] args) {
   
      Pojo pojo = new SimplePojo();
      
      <em class="lineannotation"><span class="lineannotation">// this is a <span class="bold"><strong>direct</strong></span> method call on the 'pojo' reference</span></em>
      pojo.foo();
   }
}</pre><p>Things change slightly when the reference that client code has is a proxy. Consider the
	following diagram and code snippet.</p><p>
		</p><div class="mediaobject" align="center"><img src="images/aop-proxy-call.png" align="middle"></div><p>
	</p><pre class="programlisting">public class Main {

   public static void main(String[] args) {
   
      ProxyFactory factory = new ProxyFactory(new SimplePojo());
      factory.addInterface(Pojo.class);
      factory.addAdvice(new RetryAdvice());

      Pojo pojo = (Pojo) factory.getProxy();
      
      <em class="lineannotation"><span class="lineannotation">// this is a method call <span class="bold"><strong>on the proxy!</strong></span></span></em>
      pojo.foo();
   }
}</pre><p>The key thing to understand here is that the client code inside the
	<code class="methodname">main(..)</code> of the <code class="classname">Main</code> class
	<span class="emphasis"><em>has a reference to the proxy</em></span>. This means that method calls on that object
	reference will be calls on the proxy, and as such the proxy will be able to delegate to
	all of the interceptors (advice) that are relevant to that particular method call.
	However, once the call has finally reached the target object, the <code class="classname">SimplePojo</code>
	reference in this case, any method calls that it may make on itself, such as
	<code class="methodname">this.bar()</code> or <code class="methodname">this.foo()</code>, are going to be
	invoked against the <span class="emphasis"><em><code class="literal">this</code></em></span> reference, and <span class="emphasis"><em>not</em></span>
	the proxy. This has important implications. It means that self-invocation is <span class="emphasis"><em>not</em></span>
	going to result in the advice associated with a method invocation getting a chance to execute.</p><p>Okay, so what is to be done about this? The best approach (the term best is used loosely here)
	is to refactor your code such that the self-invocation does not happen. For sure, this does entail
	some work on your part, but it is the best, least-invasive approach. The next approach is
	absolutely horrendous, and I am almost reticent to point it out precisely because it is so
	horrendous. You can (choke!) totally tie the logic within your class to Spring AOP by doing
	this:</p><pre class="programlisting">public class SimplePojo implements Pojo {

   public void foo() {
      <em class="lineannotation"><span class="lineannotation">// this works, but... gah!</span></em>
      ((Pojo) AopContext.currentProxy()).bar();
   }
   
   public void bar() {
      <em class="lineannotation"><span class="lineannotation">// some logic...</span></em>
   }
}</pre><p>This totally couples your code to Spring AOP, <span class="emphasis"><em>and</em></span> it makes the class
    itself aware of the fact that it is being used in an AOP context, which flies in the face of AOP.
    It also requires some additional configuration when the proxy is being created:</p><pre class="programlisting">public class Main {

   public static void main(String[] args) {
   
      ProxyFactory factory = new ProxyFactory(new SimplePojo());
      factory.adddInterface(Pojo.class);
      factory.addAdvice(new RetryAdvice());
      <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>factory.setExposeProxy(true);</strong></span></span></em>

      Pojo pojo = (Pojo) factory.getProxy();

      <em class="lineannotation"><span class="lineannotation">// this is a method call <span class="bold"><strong>on the proxy!</strong></span></span></em>
      pojo.foo();
   }
}</pre><p>Finally, it must be noted that AspectJ does not have this self-invocation issue because it is
	not a proxy-based AOP framework.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-aspectj-programmatic"></a>6.7.&nbsp;Programmatic creation of @AspectJ Proxies</h2></div></div></div><p>In addition to declaring aspects in your configuration using either
	<code class="literal">&lt;aop:config&gt;</code> or <code class="literal">&lt;aop:aspectj-autoproxy&gt;</code>,
	it is also possible programmatically to create proxies that advise target objects. For the
	full details of Spring's AOP API, see the next chapter. Here we want to focus on the ability
	to automatically create proxies	using @AspectJ aspects.</p><p>The class <code class="classname">org.springframework.aop.aspectj.annotation.AspectJProxyFactory</code>
	can be used to create a proxy for a target object that is advised by one or more
	@AspectJ aspects. Basic usage for this class is very simple, as illustrated below. See 
	the Javadocs for full information.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// create a factory that can generate a proxy for the given target object</span></em>
AspectJProxyFactory factory = new AspectJProxyFactory(targetObject); 

<em class="lineannotation"><span class="lineannotation">// add an aspect, the class must be an @AspectJ aspect
// you can call this as many times as you need with different aspects</span></em>
factory.addAspect(SecurityManager.class);

<em class="lineannotation"><span class="lineannotation">// you can also add existing aspect instances, the type of the object supplied must be an @AspectJ aspect</span></em>
factory.addAspect(usageTracker);	

<em class="lineannotation"><span class="lineannotation">// now get the proxy object...</span></em>
MyInterfaceType proxy = factory.getProxy();</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-using-aspectj"></a>6.8.&nbsp;Using AspectJ with Spring applications</h2></div></div></div><p>
  	Everything we've covered so far in this chapter is pure Spring AOP. In this section,
  	we're going to look at how you can use the AspectJ compiler/weaver instead of or in
  	addition to Spring AOP if your needs go beyond the facilities offered by Spring AOP
  	alone.
  	</p><p>
  	Spring ships with a small AspectJ aspect library (it's available standalone in
  	your distribution as <code class="filename">spring-aspects.jar</code>, you'll need to add
    this to your classpath to use the aspects in it). <a href="#aop-atconfigurable" title="6.8.1.&nbsp;Using AspectJ to dependency inject domain objects with Spring">Section&nbsp;6.8.1, &#8220;Using AspectJ to dependency inject domain objects with Spring&#8221;</a>
  	and <a href="#aop-ajlib-other" title="6.8.2.&nbsp;Other Spring aspects for AspectJ">Section&nbsp;6.8.2, &#8220;Other Spring aspects for AspectJ&#8221;</a> discuss the content of this library and how you 
  	can use it. <a href="#aop-aj-configure" title="6.8.3.&nbsp;Configuring AspectJ aspects using Spring IoC">Section&nbsp;6.8.3, &#8220;Configuring AspectJ aspects using Spring IoC&#8221;</a> discusses how to dependency inject AspectJ
  	aspects that are woven using the AspectJ compiler. Finally, 
  	<a href="#aop-aj-ltw" title="6.8.4.&nbsp;Using AspectJ Load-time weaving (LTW) with Spring applications">Section&nbsp;6.8.4, &#8220;Using AspectJ Load-time weaving (LTW) with Spring applications&#8221;</a> provides an introduction to load-time weaving for Spring applications
  	using AspectJ.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-atconfigurable"></a>6.8.1.&nbsp;Using AspectJ to dependency inject domain objects with Spring</h3></div></div></div><p>
		  The Spring container instantiates and configures beans defined in your 
		  application context. It is also possible to ask a bean factory to configure
		  a <span class="emphasis"><em>pre-existing</em></span> object given the name of a bean definition 
		  containing the configuration to be applied. The <code class="filename">spring-aspects.jar</code>
		  contains an annotation-driven aspect that exploits this capability to allow dependency-injection
		  of any object. The support is intended to be used for objects created 
		  <span class="emphasis"><em>outside of the control of any container</em></span>. Domain objects
		  often fall into this category: they may be created programmatically using the
		  <code class="literal">new</code> operator, or by an ORM tool as a result of a database query.
		</p><p>
		  The <code class="interfacename">@Configurable</code> annotation marks a class as eligible for
		  Spring-driven configuration. In the simplest case it can be used just as a 
		  marker annotation:
		</p><pre class="programlisting">package com.xyz.myapp.domain;

import org.springframework.beans.factory.annotation.Configurable;

@Configurable
public class Account {
   ...
}</pre><p>
			When used as a marker interface in this way, Spring will configure
			new instances of the annotated type (<code class="classname">Account</code> in this case) using a 
			prototypical bean definition with the same name as the fully-qualified
			type name (<code class="classname">com.xyz.myapp.domain.Account</code>). Since the
			default name for a bean is the fully-qualified name of its type, a 
			convenient way to declare the prototype definition is simply to omit the
			id attribute:</p><pre class="programlisting">&lt;bean class="com.xyz.myapp.domain.Account" scope="prototype"&gt;
  &lt;property name="fundsTransferService" ref="fundsTransferService"/&gt;
  ...
&lt;/bean&gt;</pre><p>If you want to explicitly specify the name of the prototype bean 
		definition to use, you can do so directly in the annotation:</p><pre class="programlisting">package com.xyz.myapp.domain;

import org.springframework.beans.factory.annotation.Configurable;

@Configurable("account")
public class Account {
   ...
}</pre><p>Spring will now look for a bean definition named "account" and 
		use that as a prototypical definition to configure new <code class="classname">Account</code>
		instances.</p><p>You can also use autowiring to avoid having to specify a prototypical
		bean definition at all. To have Spring apply autowiring use the 
		autowire property of the <code class="interfacename">@Configurable</code> annotation: specify either
		<code class="literal">@Configurable(autowire=Autowire.BY_TYPE)</code> or
		<code class="literal">@Configurable(autowire=Autowire.BY_NAME</code> for autowiring
		by type or by name respectively.</p><p>Finally you can enable Spring dependency checking for the object references
		in the newly created and configured object by using the <code class="literal">dependencyCheck</code>
		attribute (for example: 
			<code class="literal">@Configurable(autowire=Autowire.BY_NAME,dependencyCheck=true)</code> ).
		If this attribute is set to true, then Spring will validate after configuration that all properties
		(<span class="emphasis"><em>that are not primitives or collections</em></span>) have been set.
		</p><p>Using the annotation on its own does nothing of course. It's the 
		<code class="literal">AnnotationBeanConfigurerAspect</code> in <code class="filename">spring-aspects.jar</code> that 
		acts on the presence of the annotation. In essence the aspect says "after 
		returning from the initialization of a new object of a type with the 
		<code class="interfacename">@Configurable</code> annotation, configure the newly created object using Spring
		in accordance with the properties of the annotation". For this to work the
		annotated types must be woven with the AspectJ weaver - you can either 
		use a build-time ant or maven task to do this (see for example the
		<a href="http://www.eclipse.org/aspectj/doc/released/devguide/antTasks.html" target="_top">AspectJ 
		Development Environment Guide</a>) or load-time weaving (see <a href="#aop-aj-ltw" title="6.8.4.&nbsp;Using AspectJ Load-time weaving (LTW) with Spring applications">Section&nbsp;6.8.4, &#8220;Using AspectJ Load-time weaving (LTW) with Spring applications&#8221;</a>).
		</p><p>The <code class="classname">AnnotationBeanConfigurerAspect</code> itself needs
		configuring by Spring (in order to obtain a reference to the bean factory that
		is to be used to configure new objects). The Spring AOP namespace defines a
		convenient tag for doing this. Simply include the following in your
		application context configuration:</p><pre class="programlisting">&lt;aop:spring-configured/&gt;</pre><p>If you are using the DTD instead of schema, the equivalent definition is:</p><pre class="programlisting">&lt;bean 
  class="org.springframework.beans.factory.aspectj.AnnotationBeanConfigurerAspect"
  factory-method="aspectOf"/&gt;</pre><p>Instances of @Configurable objects created <span class="emphasis"><em>before</em></span>
		the aspect has been configured will result in a warning being issued to the
		log and no configuration of the object taking place. An example might be 
		a bean in the Spring configuration that creates domain objects when it is 
		initialized by Spring. In this case you can use the "depends-on" bean
		attribute to manually specify that the bean depends on the
		configuration aspect.</p><pre class="programlisting">&lt;bean id="myService"
  class="com.xzy.myapp.service.MyService"
  depends-on="org.springframework.beans.factory.aspectj.AnnotationBeanConfigurerAspect"&gt;
  ...
&lt;/bean&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-configurable-testing"></a>6.8.1.1.&nbsp;Unit testing <code class="interfacename">@Configurable</code> objects</h4></div></div></div><p>One of the goals of the <code class="interfacename">@Configurable</code> support is to enable independent
		  unit testing of domain objects without the difficulties associated with
		  hard-coded lookups. If <code class="interfacename">@Configurable</code> types have not been woven by AspectJ
		  then the annotation has no affect during unit testing, and you can simply
		  set mock or stub property references in the object under test and proceed
		  as normal. If <code class="interfacename">@Configurable</code> types <span class="emphasis"><em>have</em></span> been woven by
		  AspectJ then you can still unit test outside of the container as normal,
		  but you will see a warning message each time that you construct an 
		  <code class="interfacename">@Configurable</code> object indicating that it has not been configured by Spring.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-configurable-container"></a>6.8.1.2.&nbsp;Working with multiple application contexts</h4></div></div></div><p>The <code class="classname">AnnotationBeanConfigurerAspect</code> used to implement
		  the <code class="interfacename">@Configurable</code> support is an AspectJ singleton aspect. The scope of a 
		  singleton aspect is the same as the scope of <code class="literal">static</code> members, that is to say there is 
		  one aspect instance per classloader that defines the type. This means that if
		  you define multiple application contexts within the same classloader hierarchy
		  you need to consider where to define the <code class="literal">&lt;aop:spring-configured/&gt;</code> bean and where to place
		  <code class="filename">spring-aspects.jar</code>on the classpath.</p><p>
			  Consider a typical Spring web-app configuration with a shared parent application
			  context defining common business services and everything needed to support
			  them, and one child application context per servlet containing definitions
			  particular to that servlet. All of these contexts will co-exist within the 
			  same classloader hierarchy, and so the <code class="literal">AnnotationBeanConfigurerAspect</code>
			  can only hold a reference to one of them. In this case we recommend
			  defining the <code class="literal">&lt;aop:spring-configured/&gt;</code> bean in the
			  shared (parent) application context: this defines the services that you are
			  likely to want to inject into domain objects. A consequence is that you cannot
			  configure domain objects with references to beans defined in the child 
			  (servlet-specific) contexts using the @Configurable mechanism 
			  (probably not something you want to do anyway!).
		  </p><p>
			  When deploying multiple web-apps within the same container, ensure that each
			  web-application loads the types in <code class="filename">spring-aspects.jar</code> using its own classloader
			  (for example, by placing <code class="filename">spring-aspects.jar</code>
			  in <code class="filename">'WEB-INF/lib'</code>). If <code class="filename">spring-aspects.jar</code>
			  is only added to the container wide classpath (and hence loaded by the shared
			  parent classloader), all web applications will share the same aspect instance
			  which is probably not what you want.  
		  </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ajlib-other"></a>6.8.2.&nbsp;Other Spring aspects for AspectJ</h3></div></div></div><p>In addition to the <code class="interfacename">@Configurable</code> support,
		<code class="filename">spring-aspects.jar</code> contains an
		AspectJ aspect that can be used to drive Spring's transaction management for
		types and methods annotated with the <code class="literal">@Transactional</code> annotation. 
		This is primarily intended for users who want to use Spring's transaction support outside of the Spring container.</p><p>The aspect that interprets <code class="literal">@Transactional</code> annotations is the
		<code class="interfacename">AnnotationTransactionAspect</code>. When using this 
		aspect, you must annotate the <span class="emphasis"><em>implementation</em></span> class 
	    (and/or methods within that class), <span class="emphasis"><em>not</em></span> the interface 
	    (if any) that the class implements. AspectJ follows Java's rule that annotations on 
	    interfaces are <span class="emphasis"><em>not inherited</em></span>.</p><p>A <code class="literal">@Transactional</code> annotation on a class specifies the default transaction
        semantics for the execution of any <span class="emphasis"><em>public</em></span> operation in the class.</p><p>A <code class="literal">@Transactional</code> annotation on a method within the class overrides the
        default transaction semantics given by the class annotation (if present). 
        Methods with public, protected, and default visibility may all be annotated.
        Annotating protected and default visibility methods directly is the only way
        to get transaction demarcation for the execution of such operations.</p><p>For AspectJ programmers that want to use the Spring configuration and 
		transaction management support but don't want to (or can't) use annotations,
		<code class="filename">spring-aspects.jar</code> also contains abstract aspects you can extend to provide
		your own pointcut definitions. See the Javadocs for 
		<code class="classname">AbstractBeanConfigurerAspect</code> and 
		<code class="classname">AbstractTransactionAspect</code> for more information. As an example,
		the following excerpt shows how you could write an aspect to configure
		all instances of objects defined in the domain model
		using prototypical bean definitions that match the fully-qualified class
		names:</p><pre class="programlisting">public aspect DomainObjectConfiguration extends AbstractBeanConfigurerAspect {

  public DomainObjectConfiguration() {
    setBeanWiringInfoResolver(new ClassNameBeanWiringInfoResolver());
  }

  <em class="lineannotation"><span class="lineannotation">// the creation of a new bean (any object in the domain model)</span></em>
  protected pointcut beanCreation(Object beanInstance) :
    initialization(new(..)) &amp;&amp;
    SystemArchitecture.inDomainModel() &amp;&amp; 
    this(beanInstance);
		   		   
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-aj-configure"></a>6.8.3.&nbsp;Configuring AspectJ aspects using Spring IoC</h3></div></div></div><p>When using AspectJ aspects with Spring applications, it's natural to want
		to configure such aspects using Spring. The AspectJ runtime itself is responsible
		for aspect creation, and the means of configuring the AspectJ created aspects via
		Spring depends on the AspectJ instantiation model (per-clause) used by the aspect. 
		</p><p>The majority of AspectJ aspects are
		<span class="emphasis"><em>singleton</em></span> aspects. Configuration of these aspects is very
		easy, simply create a bean definition referencing the aspect type as normal, and 
		include the bean attribute <code class="literal">'factory-method="aspectOf"'</code>. This
		ensures that Spring obtains the aspect instance by asking AspectJ for it rather
		than trying to create an instance itself. For example:</p><pre class="programlisting">&lt;bean id="profiler" class="com.xyz.profiler.Profiler"
      factory-method="aspectOf"&gt;
  &lt;property name="profilingStrategy" ref="jamonProfilingStrategy"/&gt;
&lt;/bean&gt;</pre><p>For non-singleton aspects, the easiest way to configure them is to create
	   prototypical bean definitions and annotate use the @Configurable support from
	   <code class="filename">spring-aspects.jar</code> to configure the aspect instances once they have bean created
	   by the AspectJ runtime.</p><p>If you have some @AspectJ aspects that you want to weave with AspectJ
	   (for example, using load-time weaving for domain model types) and other @AspectJ
	   aspects that you want to use with Spring AOP, and these aspects are all configured
	   using Spring, then you'll need to tell the Spring AOP @AspectJ autoproxying support
	   which subset of the @AspectJ aspects defined in the configuration should be used
	   for autoproxying. You can do this by using one or more <code class="literal">&lt;include/&gt;</code>
	   elements inside the <code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code> declaration.
	   Each include element specifies a name pattern, and only beans with names matched
	   by at least one of the patterns will be used for Spring AOP autoproxy configuration:</p><pre class="programlisting">&lt;aop:aspectj-autoproxy&gt;
  &lt;aop:include name="thisBean"/&gt;
  &lt;aop:include name="thatBean"/&gt;
&lt;/aop:aspectj-autoproxy&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-aj-ltw"></a>6.8.4.&nbsp;Using AspectJ Load-time weaving (LTW) with Spring applications</h3></div></div></div><p>Load-time weaving (or LTW) refers to the process of weaving AspectJ aspects
		with an application's class files as they are loaded into the VM. For full details
		on configuring load-time weaving with AspectJ, see the 
		<a href="http://www.eclipse.org/aspectj/doc/released/devguide/ltw.html" target="_top">
		LTW section of the AspectJ Development Environment Guide
		</a>. We will focus here on the essentials of configuring load-time weaving
		for Spring applications running on Java 5.</p><p>
		Load-time weaving is controlled by defining a file '<code class="literal">aop.xml</code>' in
		the META-INF directory. AspectJ automatically looks for all 'META-INF/aop.xml' files
		visible on the classpath and configures itself based on the aggregation of their
		content.
		</p><p>
		A basic META-INF/aop.xml for your application should look like this:
		</p><pre class="programlisting">&lt;!DOCTYPE aspectj PUBLIC    
  "-//AspectJ//DTD//EN"    "http://www.eclipse.org/aspectj/dtd/aspectj.dtd"&gt;    

&lt;aspectj&gt;    
   &lt;weaver&gt;
	 &lt;include within="com.xyz.myapp..*"/&gt;
   &lt;/weaver&gt;
&lt;/aspectj&gt;</pre><p>
			The <code class="literal">&lt;include/&gt;</code> element tells AspectJ which set of types
			should be included in the weaving process. Use the package prefix for your
			application followed by "..*" (meaning '... and any type defined in a subpackage
			of this') as a good default. Using the include element is important as otherwise
			AspectJ will look at every type loaded in support of your application (including
			all the Spring library classes and many more besides). Normally you don't want
			to weave these types and don't want to pay the overhead of AspectJ attempting
			to match against them.
		</p><p>
			To get informational messages in your log file regarding the activity of the
			load-time weaver, add the following options to the weaver element:
		</p><pre class="programlisting">&lt;!DOCTYPE aspectj PUBLIC    
  "-//AspectJ//DTD//EN"    "http://www.eclipse.org/aspectj/dtd/aspectj.dtd"&gt;    

&lt;aspectj&gt;    
   &lt;weaver 
	 options="-showWeaveInfo
              -XmessageHandlerClass:org.springframework.aop.aspectj.AspectJWeaverMessageHandler"&gt;
	 &lt;include within="com.xyz.myapp..*"/&gt;
   &lt;/weaver&gt;
&lt;/aspectj&gt;</pre><p>Finally, to control exactly which aspects are used, you can use the 
	<code class="literal">aspects</code> element. By default all defined aspects are used for 
	weaving (<code class="filename">spring-aspects.jar</code> contains a META-INF/aop.xml file that defines the
	configuration and transaction aspects). If you were using <code class="filename">spring-aspects.jar</code>, but
	only want the configuration support and not the transaction support you could 
	specify this as follows:</p><pre class="programlisting">&lt;!DOCTYPE aspectj PUBLIC    
  "-//AspectJ//DTD//EN"    "http://www.eclipse.org/aspectj/dtd/aspectj.dtd"&gt;    

&lt;aspectj&gt;   
  &lt;weaver 
    options="-showWeaveInfo -XmessageHandlerClass:org.springframework.aop.aspectj.AspectJWeaverMessageHandler"&gt;
    &lt;include within="com.xyz.myapp..*"/&gt;
  &lt;/weaver&gt;
  &lt;aspects&gt;
    &lt;include within="org.springframework.beans.factory.aspectj.AnnotationBeanConfigurerAspect"/&gt;
  &lt;/aspects&gt; 
&lt;/aspectj&gt;</pre><p>On the Java 5 platform, load-time weaving is enabled by specifying the following
	VM argument when launching the Java virtual machine:</p><pre class="programlisting">-javaagent:&lt;path-to-ajlibs&gt;/aspectjweaver.jar</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-resources"></a>6.9.&nbsp;Further Resources</h2></div></div></div><p>More information on AspectJ can be found at the <a href="http://www.eclipse.org/aspectj" target="_top">
  	AspectJ home page</a>.</p><p>The book <span class="emphasis"><em>Eclipse AspectJ</em></span> by Adrian Colyer et. al. (Addison-Wesley, 
  	2005) provides a comprehensive introduction and reference for the AspectJ language.</p><p>The excellent <span class="emphasis"><em>AspectJ in Action</em></span> by Ramnivas Laddad (Manning, 2003)
	comes highly recommended as an introduction to AOP; the focus of the book is on
	AspectJ, but a lot of general AOP themes are explored in some depth.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="aop-api"></a>Chapter&nbsp;7.&nbsp;Spring AOP APIs</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-introduction"></a>7.1.&nbsp;Introduction</h2></div></div></div><p>The previous chapter described the Spring 2.0 support for AOP using
	@AspectJ and schema-based aspect definitions. In this chapter we discuss 
	the lower-level Spring AOP APIs and the AOP support used in Spring 1.2 applications.
	For new applications, we recommend the use of the Spring 2.0 AOP support 
	described in the previous chapter, but when working with existing applications,
	or when reading books and articles, you may come across Spring 1.2 style examples.
	Spring 2.0 is fully backwards compatible with Spring 1.2 and everything described
	in this chapter is fully supported in Spring 2.0.
	</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-pointcuts"></a>7.2.&nbsp;Pointcut API in Spring</h2></div></div></div><p>Let's look at how Spring handles the crucial pointcut concept.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-concepts"></a>7.2.1.&nbsp;Concepts</h3></div></div></div><p>Spring's pointcut model enables pointcut reuse independent of
      advice types. It's possible to target different advice using the same
      pointcut.</p><p>The <code class="literal">org.springframework.aop.Pointcut</code> interface
      is the central interface, used to target advices to particular classes
      and methods. The complete interface is shown below:</p><pre class="programlisting">public interface Pointcut {

    ClassFilter getClassFilter();

    MethodMatcher getMethodMatcher();

}</pre><p>Splitting the <code class="interfacename">Pointcut</code> interface into two parts
      allows reuse of class and method matching parts, and fine-grained
      composition operations (such as performing a "union" with another method
      matcher).</p><p>The <code class="interfacename">ClassFilter</code> interface is used to restrict
      the pointcut to a given set of target classes. If the
      <code class="literal">matches()</code> method always returns true, all target
      classes will be matched:</p><pre class="programlisting">public interface ClassFilter {

    boolean matches(Class clazz);
}</pre><p>The <code class="interfacename">MethodMatcher</code> interface is normally more
      important. The complete interface is shown below:</p><pre class="programlisting">public interface MethodMatcher {

    boolean matches(Method m, Class targetClass);

    boolean isRuntime();

    boolean matches(Method m, Class targetClass, Object[] args);
}</pre><p>The <code class="literal">matches(Method, Class) </code>method is used to
      test whether this pointcut will ever match a given method on a target
      class. This evaluation can be performed when an AOP proxy is created, to
      avoid the need for a test on every method invocation. If the 2-argument
      matches method returns true for a given method, and the
      <code class="literal">isRuntime()</code> method for the MethodMatcher returns
      true, the 3-argument matches method will be invoked on every method
      invocation. This enables a pointcut to look at the arguments passed to
      the method invocation immediately before the target advice is to
      execute.</p><p>Most MethodMatchers are static, meaning that their
      <code class="literal">isRuntime()</code> method returns false. In this case, the
      3-argument matches method will never be invoked.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If possible, try to make pointcuts static, allowing the AOP
				framework to cache the results of pointcut evaluation when an AOP proxy
				is created.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcut-ops"></a>7.2.2.&nbsp;Operations on pointcuts</h3></div></div></div><p>Spring supports operations on pointcuts: notably,
      <span class="emphasis"><em>union</em></span> and <span class="emphasis"><em>intersection</em></span>.</p><div class="itemizedlist"><ul type="disc"><li><p>Union means the methods that either pointcut matches.</p></li><li><p>Intersection means the methods that both pointcuts match.</p></li><li><p>Union is usually more useful.</p></li><li><p>Pointcuts can be composed using the static methods in the
					<span class="emphasis"><em>org.springframework.aop.support.Pointcuts</em></span> class, or
					using the <span class="emphasis"><em>ComposablePointcut</em></span> class in the same
					package. However, using AspectJ pointcut expressions is usually a
					simpler approach.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcuts-aspectj"></a>7.2.3.&nbsp;AspectJ expression pointcuts</h3></div></div></div><p>Since 2.0, the most important type of pointcut used by Spring is
      <code class="literal">org.springframework.aop.aspectj.AspectJExpressionPointcut</code>.
      This is a pointcut that uses an AspectJ supplied library to parse an AspectJ
      pointcut expression string.</p><p>See the previous chapter for a discussion of supported AspectJ pointcut
      primitives.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcuts-impls"></a>7.2.4.&nbsp;Convenience pointcut implementations</h3></div></div></div><p>Spring provides several convenient pointcut implementations. Some
      can be used out of the box; others are intended to be subclassed in
      application-specific pointcuts.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-pointcuts-static"></a>7.2.4.1.&nbsp;Static pointcuts</h4></div></div></div><p>Static pointcuts are based on method and target class, and
        cannot take into account the method's arguments. Static pointcuts are
        sufficient - <span class="emphasis"><em>and best</em></span> - for most usages. It's possible for Spring to
        evaluate a static pointcut only once, when a method is first invoked:
        after that, there is no need to evaluate the pointcut again with each
        method invocation.</p><p>Let's consider some static pointcut implementations included
        with Spring.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-api-pointcuts-regex"></a>7.2.4.1.1.&nbsp;Regular expression pointcuts</h5></div></div></div><p>One obvious way to specify static pointcuts is regular
          expressions. Several AOP frameworks besides Spring make this
          possible.
          <code class="literal">org.springframework.aop.support.Perl5RegexpMethodPointcut</code>
          is a generic regular expression pointcut, using Perl 5 regular
          expression syntax. The <code class="literal">Perl5RegexpMethodPointcut</code>
          class depends on Jakarta ORO for regular expression matching. Spring
          also provides the <code class="literal">JdkRegexpMethodPointcut</code> class
          that uses the regular expression support in JDK 1.4+.</p><p>Using the <code class="literal">Perl5RegexpMethodPointcut</code> class,
          you can provide a list of pattern Strings. If any of these is a
          match, the pointcut will evaluate to true. (So the result is
          effectively the union of these pointcuts.)</p><p>The usage is shown below:</p><pre class="programlisting">&lt;bean id="settersAndAbsquatulatePointcut" 
    class="org.springframework.aop.support.Perl5RegexpMethodPointcut"&gt;
    &lt;property name="patterns"&gt;
        &lt;list&gt;
            &lt;value&gt;.*set.*&lt;/value&gt;
            &lt;value&gt;.*absquatulate&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>Spring provides a convenience class,
          <code class="literal">RegexpMethodPointcutAdvisor</code>, that allows us to
          also reference an Advice (remember that an Advice can be an
          interceptor, before advice, throws advice etc.). Behind the scenes,
          Spring will use the <code class="literal">JdkRegexpMethodPointcut</code> on
          J2SE 1.4 or above, and will fall back to
          <code class="literal">Perl5RegexpMethodPointcut</code> on older VMs. The use
          of <code class="literal">Perl5RegexpMethodPointcut</code> can be forced by
          setting the <code class="literal">perl5</code> property to true. Using
          <code class="literal">RegexpMethodPointcutAdvisor</code> simplifies wiring, as
          the one bean encapsulates both pointcut and advice, as shown
          below:</p><pre class="programlisting">&lt;bean id="settersAndAbsquatulateAdvisor" 
    class="org.springframework.aop.support.RegexpMethodPointcutAdvisor"&gt;
    &lt;property name="advice"&gt;
        &lt;ref local="beanNameOfAopAllianceInterceptor"/&gt;
    &lt;/property&gt;
    &lt;property name="patterns"&gt;
        &lt;list&gt;
            &lt;value&gt;.*set.*&lt;/value&gt;
            &lt;value&gt;.*absquatulate&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p><span class="emphasis"><em>RegexpMethodPointcutAdvisor</em></span> can be used
          with any Advice type.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-api-pointcuts-attribute-driven"></a>7.2.4.1.2.&nbsp;Attribute-driven pointcuts</h5></div></div></div><p>An important type of static pointcut is a
          <span class="emphasis"><em>metadata-driven</em></span> pointcut. This uses the values
          of metadata attributes: typically, source-level metadata.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-pointcuts-dynamic"></a>7.2.4.2.&nbsp;Dynamic pointcuts</h4></div></div></div><p>Dynamic pointcuts are costlier to evaluate than static
        pointcuts. They take into account method
        <span class="emphasis"><em>arguments</em></span>, as well as static information. This
        means that they must be evaluated with every method invocation; the
        result cannot be cached, as arguments will vary.</p><p>The main example is the <code class="literal">control flow</code>
        pointcut.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-api-pointcuts-cflow"></a>7.2.4.2.1.&nbsp;Control flow pointcuts</h5></div></div></div><p>Spring control flow pointcuts are conceptually similar to
          AspectJ <span class="emphasis"><em>cflow</em></span> pointcuts, although less
          powerful. (There is currently no way to specify that a pointcut
          executes below a join point matched by another pointcut.) 
          A control flow pointcut matches
          the current call stack. For example, it might fire if the join point
          was invoked by a method in the <code class="literal">com.mycompany.web</code>
          package, or by the <code class="literal">SomeCaller</code> class. Control flow
          pointcuts are specified using the
          <code class="literal">org.springframework.aop.support.ControlFlowPointcut
          </code>class.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Control flow pointcuts are significantly more expensive to
              evaluate at runtime than even other dynamic pointcuts. In Java
              1.4, the cost is about 5 times that of other dynamic pointcuts;
              in Java 1.3 more than 10.</p></td></tr></table></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcuts-superclasses"></a>7.2.5.&nbsp;Pointcut superclasses</h3></div></div></div><p>Spring provides useful pointcut superclasses to help you to
      implement your own pointcuts.</p><p>Because static pointcuts are most useful, you'll probably subclass
      StaticMethodMatcherPointcut, as shown below. This requires implementing
      just one abstract method (although it's possible to override other
      methods to customize behavior):</p><pre class="programlisting">class TestStaticPointcut extends StaticMethodMatcherPointcut {

    public boolean matches(Method m, Class targetClass) {
        // return true if custom criteria match
    }
}</pre><p>There are also superclasses for dynamic pointcuts.</p><p>You can use custom pointcuts with any advice type in Spring 1.0
      RC2 and above.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcuts-custom"></a>7.2.6.&nbsp;Custom pointcuts</h3></div></div></div><p>Because pointcuts in Spring AOP are Java classes, rather than
      language features (as in AspectJ) it's possible to declare custom
      pointcuts, whether static or dynamic. Custom pointcuts in Spring can be
      arbitrarily complex. However, using the AspectJ pointcut expression
      language is recommended if possible.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Later versions of Spring may offer support for "semantic
				pointcuts" as offered by JAC: for example, "all methods that change
				instance variables in the target object."</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-advice"></a>7.3.&nbsp;Advice API in Spring</h2></div></div></div><p>Let's now look at how Spring AOP handles advice.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-advice-lifecycle"></a>7.3.1.&nbsp;Advice lifecycles</h3></div></div></div><p>Each advice is a Spring bean. An advice instance can be shared across all 
      advised objects, or unique
      to each advised object. This corresponds to
      <span class="emphasis"><em>per-class</em></span> or <span class="emphasis"><em>per-instance</em></span>
      advice.</p><p>Per-class advice is used most often. It is appropriate for generic
      advice such as transaction advisors. These do not depend on the state of
      the proxied object or add new state; they merely act on the method and
      arguments.</p><p>Per-instance advice is appropriate for introductions, to support
      mixins. In this case, the advice adds state to the proxied
      object.</p><p>It's possible to use a mix of shared and per-instance advice in
      the same AOP proxy.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-advice-types"></a>7.3.2.&nbsp;Advice types in Spring</h3></div></div></div><p>Spring provides several advice types out of the box, and is
      extensible to support arbitrary advice types. Let us look at the basic
      concepts and standard advice types.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-around"></a>7.3.2.1.&nbsp;Interception around advice</h4></div></div></div><p>The most fundamental advice type in Spring is
        <span class="emphasis"><em>interception around advice</em></span>.</p><p>Spring is compliant with the AOP Alliance interface for around
        advice using method interception. MethodInterceptors implementing
        around advice should implement the following interface:</p><pre class="programlisting">public interface MethodInterceptor extends Interceptor {
  
    Object invoke(MethodInvocation invocation) throws Throwable;
}</pre><p>The <code class="classname">MethodInvocation</code> argument to the
        <code class="methodname">invoke()</code> method exposes the method being invoked;
        the target join point; the AOP proxy; and the arguments to the method.
        The <code class="methodname">invoke()</code> method should return the
        invocation's result: the return value of the join point.</p><p>A simple <code class="classname">MethodInterceptor</code> implementation
        looks as follows:</p><pre class="programlisting">public class DebugInterceptor implements MethodInterceptor {

    public Object invoke(MethodInvocation invocation) throws Throwable {
        System.out.println("Before: invocation=[" + invocation + "]");
        Object rval = invocation.proceed();
        System.out.println("Invocation returned");
        return rval;
    }
}</pre><p>Note the call to the MethodInvocation's
        <code class="methodname">proceed()</code> method. This proceeds down the
        interceptor chain towards the join point. Most interceptors will invoke
        this method, and return its return value. However, a
        MethodInterceptor, like any around advice, can return a different
        value or throw an exception rather than invoke the proceed method.
        However, you don't want to do this without good reason!</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>MethodInterceptors offer interoperability with other AOP
        Alliance-compliant AOP implementations. The other advice types
        discussed in the remainder of this section implement common AOP
        concepts, but in a Spring-specific way. While there is an advantage in
        using the most specific advice type, stick with MethodInterceptor
        around advice if you are likely to want to run the aspect in another
        AOP framework. Note that pointcuts are not currently interoperable
        between frameworks, and the AOP Alliance does not currently define
        pointcut interfaces.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-before"></a>7.3.2.2.&nbsp;Before advice</h4></div></div></div><p>A simpler advice type is a <span class="bold"><strong>before
        advice</strong></span>. This does not need a
        <code class="literal">MethodInvocation</code> object, since it will only be
        called before entering the method.</p><p>The main advantage of a before advice is that there is no need
        to invoke the <code class="literal">proceed() </code>method, and therefore no
        possibility of inadvertently failing to proceed down the interceptor
        chain.</p><p>The <code class="literal">MethodBeforeAdvice</code> interface is shown
        below. (Spring's API design would allow for field before advice,
        although the usual objects apply to field interception and it's
        unlikely that Spring will ever implement it).</p><pre class="programlisting">public interface MethodBeforeAdvice extends BeforeAdvice {

    void before(Method m, Object[] args, Object target) throws Throwable;
}</pre><p>Note the return type is <code class="literal">void</code>. Before
        advice can insert custom behavior before the join point executes, but
        cannot change the return value. If a before advice throws an
        exception, this will abort further execution of the interceptor chain.
        The exception will propagate back up the interceptor chain. If it is
        unchecked, or on the signature of the invoked method, it will be
        passed directly to the client; otherwise it will be wrapped in an
        unchecked exception by the AOP proxy.</p><p>An example of a before advice in Spring, which counts all method
        invocations:</p><pre class="programlisting">public class CountingBeforeAdvice implements MethodBeforeAdvice {

    private int count;

    public void before(Method m, Object[] args, Object target) throws Throwable {
        ++count;
    }

    public int getCount() { 
        return count; 
    }
}</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Before advice can be used with any pointcut.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-throws"></a>7.3.2.3.&nbsp;Throws advice</h4></div></div></div><p><span class="bold"><strong>Throws advice</strong></span> is invoked after
        the return of the join point if the join point threw an exception.
        Spring offers typed throws advice. Note that this means that the
        <code class="literal">org.springframework.aop.ThrowsAdvice</code> interface does
        not contain any methods: it is a tag interface identifying that the
        given object implements one or more typed throws advice methods. These
        should be in the form of:</p><pre class="programlisting">afterThrowing([Method, args, target], subclassOfThrowable) </pre><p>Only the last argument is required. The method signatures may
		have either one or four arguments, depending on whether the advice
		method is interested in the method and arguments. The following
		classes are examples of throws advice.</p><p>The advice below is invoked if a <code class="exceptionname">RemoteException</code>
		is thrown (including subclasses):</p><pre class="programlisting">public class RemoteThrowsAdvice implements ThrowsAdvice {

    public void afterThrowing(RemoteException ex) throws Throwable {
        <em class="lineannotation"><span class="lineannotation">// Do something with remote exception</span></em>
    }
}</pre><p>The following advice is invoked if a
        <code class="exceptionname">ServletException</code> is thrown. Unlike the above
        advice, it declares 4 arguments, so that it has access to the invoked
        method, method arguments and target object:</p><pre class="programlisting">public class ServletThrowsAdviceWithArguments implements ThrowsAdvice {

    public void afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        <em class="lineannotation"><span class="lineannotation">// Do something with all arguments</span></em>
    }
}</pre><p>The final example illustrates how these two methods could be
        used in a single class, which handles both
        <code class="literal">RemoteException</code> and
        <code class="literal">ServletException</code>. Any number of throws advice
        methods can be combined in a single class.</p><pre class="programlisting">public static class CombinedThrowsAdvice implements ThrowsAdvice {

    public void afterThrowing(RemoteException ex) throws Throwable {
        // Do something with remote exception
    }
 
    public void afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        // Do something with all arguments
    }
}</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Throws advice can be used with any pointcut.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-after-returning"></a>7.3.2.4.&nbsp;After Returning advice</h4></div></div></div><p>An after returning advice in Spring must implement the
        <span class="emphasis"><em>org.springframework.aop.AfterReturningAdvice</em></span>
        interface, shown below:</p><pre class="programlisting">public interface AfterReturningAdvice extends Advice {

    void afterReturning(Object returnValue, Method m, Object[] args, Object target) 
            throws Throwable;
}</pre><p>An after returning advice has access to the return value (which
        it cannot modify), invoked method, methods arguments and
        target.</p><p>The following after returning advice counts all successful
        method invocations that have not thrown exceptions:</p><pre class="programlisting">public class CountingAfterReturningAdvice implements AfterReturningAdvice {

    private int count;

    public void afterReturning(Object returnValue, Method m, Object[] args, Object target)
            throws Throwable {
        ++count;
    }

    public int getCount() {
        return count;
    }
}</pre><p>This advice doesn't change the execution path. If it throws an
        exception, this will be thrown up the interceptor chain instead of the
        return value.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>After returning advice can be used with any pointcut.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-introduction"></a>7.3.2.5.&nbsp;Introduction advice</h4></div></div></div><p>Spring treats introduction advice as a special kind of
        interception advice.</p><p>Introduction requires an <code class="literal">IntroductionAdvisor</code>,
        and an <code class="literal">IntroductionInterceptor</code>, implementing the
        following interface:</p><pre class="programlisting">public interface IntroductionInterceptor extends MethodInterceptor {

    boolean implementsInterface(Class intf);
}</pre><p>The <code class="literal">invoke() </code>method inherited from the AOP
        Alliance <code class="literal">MethodInterceptor</code> interface must implement
        the introduction: that is, if the invoked method is on an introduced
        interface, the introduction interceptor is responsible for handling
        the method call - it cannot invoke <code class="literal">proceed()</code>.</p><p>Introduction advice cannot be used with any pointcut, as it
        applies only at class, rather than method, level. You can only use
        introduction advice with the <code class="literal">IntroductionAdvisor</code>,
        which has the following methods:</p><pre class="programlisting">public interface IntroductionAdvisor extends Advisor, IntroductionInfo {

	ClassFilter getClassFilter();

	void validateInterfaces() throws IllegalArgumentException;
}

public interface IntroductionInfo {

	Class[] getInterfaces();
}</pre><p>There is no <code class="interfacename">MethodMatcher</code>, and hence no
        <code class="interfacename">Pointcut</code>, associated with introduction advice. Only
        class filtering is logical.</p><p>The <code class="literal">getInterfaces()</code> method returns the
        interfaces introduced by this advisor.</p>

         The 

        <code class="literal">validateInterfaces()</code>

         method is used internally to see whether or not the introduced interfaces can be implemented by the configured 

        <code class="literal">IntroductionInterceptor</code>

         . 

        <p>Let's look at a simple example from the Spring test suite. Let's
        suppose we want to introduce the following interface to one or more
        objects:</p><p>
          </p><pre class="programlisting">public interface Lockable {
    void lock();
    void unlock();
    boolean locked();
}</pre><p>
        </p><p>This illustrates a <span class="bold"><strong>mixin</strong></span>. We
        want to be able to cast advised objects to Lockable, whatever their
        type, and call lock and unlock methods. If we call the lock() method,
        we want all setter methods to throw a
        <code class="literal">LockedException</code>. Thus we can add an aspect that
        provides the ability to make objects immutable, without them having
        any knowledge of it: a good example of AOP.</p><p>Firstly, we'll need an
        <code class="literal">IntroductionInterceptor</code> that does the heavy
        lifting. In this case, we extend the
        <code class="literal">org.springframework.aop.support.DelegatingIntroductionInterceptor</code>
        convenience class. We could implement IntroductionInterceptor
        directly, but using
        <code class="literal">DelegatingIntroductionInterceptor</code> is best for most
        cases.</p><p>The <code class="literal">DelegatingIntroductionInterceptor</code> is
        designed to delegate an introduction to an actual implementation of
        the introduced interface(s), concealing the use of interception to do
        so. The delegate can be set to any object using a constructor
        argument; the default delegate (when the no-arg constructor is used)
        is this. Thus in the example below, the delegate is the
        <code class="literal">LockMixin</code> subclass of
        <code class="literal">DelegatingIntroductionInterceptor</code>. Given a delegate
        (by default itself), a
        <code class="literal">DelegatingIntroductionInterceptor</code> instance looks
        for all interfaces implemented by the delegate (other than
        IntroductionInterceptor), and will support introductions against any
        of them. It's possible for subclasses such as
        <code class="literal">LockMixin</code> to call the
        <code class="literal">suppressInterface(Class intf) </code>method to suppress
        interfaces that should not be exposed. However, no matter how many
        interfaces an <code class="literal">IntroductionInterceptor</code> is prepared
        to support, the <code class="literal">IntroductionAdvisor</code> used will
        control which interfaces are actually exposed. An introduced interface
        will conceal any implementation of the same interface by the
        target.</p><p>Thus LockMixin subclasses
        <code class="literal">DelegatingIntroductionInterceptor</code> and implements
        Lockable itself. The superclass automatically picks up that Lockable
        can be supported for introduction, so we don't need to specify that.
        We could introduce any number of interfaces in this way.</p><p>Note the use of the <code class="literal">locked</code> instance variable.
        This effectively adds additional state to that held in the target
        object.</p><p>
          </p><pre class="programlisting">public class LockMixin extends DelegatingIntroductionInterceptor 
    implements Lockable {

    private boolean locked;

    public void lock() {
        this.locked = true;
    }

    public void unlock() {
        this.locked = false;
    }

    public boolean locked() {
        return this.locked;
    }

    public Object invoke(MethodInvocation invocation) throws Throwable {
        if (locked() &amp;&amp; invocation.getMethod().getName().indexOf("set") == 0)
            throw new LockedException();
        return super.invoke(invocation);
    }

}</pre><p>
        </p><p>Often it isn't necessary to override the <code class="literal">invoke()
        </code>method: the
        <code class="literal">DelegatingIntroductionInterceptor</code>
        implementation - which calls the delegate method if the method is
        introduced, otherwise proceeds towards the join point - is usually
        sufficient. In the present case, we need to add a check: no setter
        method can be invoked if in locked mode.</p><p>The introduction advisor required is simple. All it needs to do
        is hold a distinct <code class="literal">LockMixin</code> instance, and specify
        the introduced interfaces - in this case, just
        <code class="literal">Lockable</code>. A more complex example might take a
        reference to the introduction interceptor (which would be defined as a
        prototype): in this case, there's no configuration relevant for a
        <code class="literal">LockMixin</code>, so we simply create it using
        <code class="literal">new</code>.</p><p>
          </p><pre class="programlisting">public class LockMixinAdvisor extends DefaultIntroductionAdvisor {

    public LockMixinAdvisor() {
        super(new LockMixin(), Lockable.class);
    }
}</pre><p>
        </p><p>We can apply this advisor very simply: it requires no
        configuration. (However, it <span class="emphasis"><em>is</em></span> necessary: It's
        impossible to use an <code class="literal">IntroductionInterceptor</code>
        without an <span class="emphasis"><em>IntroductionAdvisor</em></span>.) As usual with
        introductions, the advisor must be per-instance, as it is stateful. We
        need a different instance of <code class="literal">LockMixinAdvisor</code>, and
        hence <code class="literal">LockMixin</code>, for each advised object. The
        advisor comprises part of the advised object's state.</p><p>We can apply this advisor programmatically, using the
        <code class="literal">Advised.addAdvisor() </code>method, or (the recommended
        way) in XML configuration, like any other advisor. All proxy creation
        choices discussed below, including "auto proxy creators," correctly
        handle introductions and stateful mixins.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-advisor"></a>7.4.&nbsp;Advisor API in Spring</h2></div></div></div><p>In Spring, an Advisor is an aspect that contains just a single advice
    object associated with a pointcut expression.</p><p>Apart from the special case of introductions, any advisor can be
    used with any advice.
    <code class="literal">org.springframework.aop.support.DefaultPointcutAdvisor</code>
    is the most commonly used advisor class. For example, it can be used with
    a <code class="literal">MethodInterceptor</code>, <code class="literal">BeforeAdvice</code> or
    <code class="literal">ThrowsAdvice</code>.</p><p>It is possible to mix advisor and advice types in Spring in the same
    AOP proxy. For example, you could use a interception around advice, throws
    advice and before advice in one proxy configuration: Spring will
    automatically create the necessary interceptor chain.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-pfb"></a>7.5.&nbsp;Using the ProxyFactoryBean to create AOP proxies</h2></div></div></div><p>If you're using the Spring IoC container (an ApplicationContext or
    BeanFactory) for your business objects - and you should be! - you will want
    to use one of Spring's AOP FactoryBeans. (Remember that a factory bean
    introduces a layer of indirection, enabling it to create objects of a
    different type.)</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The Spring 2.0 AOP support also uses factory beans under the covers.</p></td></tr></table></div><p>The basic way to create an AOP proxy in Spring is to use the
    <span class="emphasis"><em>org.springframework.aop.framework.ProxyFactoryBean</em></span>.
    This gives complete control over the pointcuts and advice that will apply,
    and their ordering. However, there are simpler options that are preferable
    if you don't need such control.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-pfb-1"></a>7.5.1.&nbsp;Basics</h3></div></div></div><p>The <code class="literal">ProxyFactoryBean</code>, like other Spring
      <code class="literal">FactoryBean</code> implementations, introduces a level of
      indirection. If you define a <code class="literal">ProxyFactoryBean</code> with
      name <code class="literal">foo</code>, what objects referencing
      <code class="literal">foo</code> see is not the
      <code class="literal">ProxyFactoryBean</code> instance itself, but an object
      created by the <code class="literal">ProxyFactoryBean</code>'s implementation of
      the <code class="literal">getObject() </code>method. This method will create an
      AOP proxy wrapping a target object.</p><p>One of the most important benefits of using a
      <code class="literal">ProxyFactoryBean</code> or another IoC-aware class to create
      AOP proxies, is that it means that advices and pointcuts can also be
      managed by IoC. This is a powerful feature, enabling certain approaches
      that are hard to achieve with other AOP frameworks. For example, an
      advice may itself reference application objects (besides the target,
      which should be available in any AOP framework), benefiting from all the
      pluggability provided by Dependency Injection.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-pfb-2"></a>7.5.2.&nbsp;JavaBean properties</h3></div></div></div><p>
		In common with most <code class="interfacename">FactoryBean</code> implementations
		provided with Spring, the <code class="classname">ProxyFactoryBean</code> class is
		itself a JavaBean. Its properties are used to:
	  </p><div class="itemizedlist"><ul type="disc"><li><p>Specify the target you want to proxy.</p></li><li><p>Specify whether to use CGLIB (see below and also the section entitled
			<a href="#aop-pfb-proxy-types" title="7.5.3.&nbsp;JDK- and CGLIB-based proxies">Section&nbsp;7.5.3, &#8220;JDK- and CGLIB-based proxies&#8221;</a>).</p></li></ul></div><p>
		Some key properties are inherited from
		<code class="classname">org.springframework.aop.framework.ProxyConfig</code> (the
		superclass for all AOP proxy factories in Spring). These key properties include:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
			<code class="literal">proxyTargetClass</code>: <code class="literal">true</code> if the
			target class is to be proxied, rather than the target class' interfaces.
			If this property value is set to <code class="literal">true</code>, then CGLIB proxies
			will be created (but see also below the section entitled
			<a href="#aop-pfb-proxy-types" title="7.5.3.&nbsp;JDK- and CGLIB-based proxies">Section&nbsp;7.5.3, &#8220;JDK- and CGLIB-based proxies&#8221;</a>).
		  </p></li><li><p>
			<code class="literal">optimize</code>: controls whether or not aggressive
			optimizations are applied to proxies <span class="emphasis"><em>created via CGLIB</em></span>.
			One should not blithely use this setting unless one fully understands
			how the relevant AOP proxy handles optimization. This is currently used only
			for CGLIB proxies; it has no effect with JDK dynamic proxies.
          </p></li><li><p><code class="literal">frozen</code>: if a proxy configuration is <code class="literal">frozen</code>,
			then changes to the configuration are no longer allowed. This is useful both as
			a slight optimization and for those cases when you don't want callers to be able
			to manipulate the proxy (via the <code class="interfacename">Advised</code> interface)
			after the proxy has been created. The default value of this property is
			<code class="literal">false</code>, so changes such as adding additional advice are allowed.</p></li><li><p>
			<code class="literal">exposeProxy</code>: determines whether or not the current
			proxy should be exposed in a <code class="classname">ThreadLocal</code> so that
			it can be accessed by the target. If a target needs to obtain
			the proxy and the <code class="literal">exposeProxy</code> property is set to
			<code class="literal">true</code>, the target can use the
			<code class="methodname">AopContext.currentProxy()</code> method.
          </p></li><li><p>
			<code class="literal">aopProxyFactory</code>: the implementation of
			<code class="interfacename">AopProxyFactory</code> to use. Offers a way of
			customizing whether to use dynamic proxies, CGLIB or any other proxy
			strategy. The default implementation will choose dynamic proxies or
			CGLIB appropriately. There should be no need to use this property;
			it is intended to allow the addition of new proxy types in Spring 1.1.
          </p></li></ul></div><p>
		Other properties specific to <code class="classname">ProxyFactoryBean</code> include:
	  </p><div class="itemizedlist"><ul type="disc"><li><p>
			<code class="literal">proxyInterfaces</code>: array of String interface
			names. If this isn't supplied, a CGLIB proxy for the target class
			will be used (but see also below the section entitled
			<a href="#aop-pfb-proxy-types" title="7.5.3.&nbsp;JDK- and CGLIB-based proxies">Section&nbsp;7.5.3, &#8220;JDK- and CGLIB-based proxies&#8221;</a>).
          </p></li><li><p>
			<code class="literal">interceptorNames</code>: String array of
			<code class="interfacename">Advisor</code>, interceptor or other advice
			names to apply. Ordering is significant, on a first come-first served
			basis. That is to say that the first interceptor in the list
			will be the first to be able to intercept the invocation.
          </p><p>
			The names are bean names in the current factory, including
			bean names from ancestor factories. You can't mention bean
			references here since doing so would result in the
			<code class="classname">ProxyFactoryBean</code> ignoring the singleton
			setting of the advice.
          </p><p>
			You can append an interceptor name with an asterisk
			(<code class="literal">*</code>). This will result in the application of all
			advisor beans with names starting with the part before the asterisk
			to be applied. An example of using this feature can be found in
			<a href="#aop-global-advisors" title="7.5.6.&nbsp;Using 'global' advisors">Section&nbsp;7.5.6, &#8220;Using 'global' advisors&#8221;</a>.
          </p></li><li><p>
			singleton: whether or not the factory should return a single
			object, no matter how often the <code class="literal">getObject()</code>
			method is called. Several <code class="interfacename">FactoryBean</code>
			implementations offer such a method. The default value is
			<code class="literal">true</code>. If you	want to use stateful advice - 
			for example, for stateful mixins - use	prototype advices along
			with a singleton value of <code class="literal">false</code>.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-pfb-proxy-types"></a>7.5.3.&nbsp;JDK- and CGLIB-based proxies</h3></div></div></div><p>
			This section serves as the definitive documentation on how the
			<code class="classname">ProxyFactoryBean</code> chooses to create one of
			either a JDK- and CGLIB-based proxy for a particular target object
			(that is to be proxied).
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
				The behavior of the <code class="classname">ProxyFactoryBean</code> with regard
				to creating JDK- or CGLIB-based proxies changed between versions 1.2.x and
				2.0 of Spring. The <code class="classname">ProxyFactoryBean</code> now
				exhibits similar semantics with regard to auto-detecting interfaces
				as those of the <code class="classname">TransactionProxyFactoryBean</code> class.		
			</p></td></tr></table></div><p>
			If the class of a target object that is to be proxied (hereafter simply
			referred to as the target class) doesn't implement any interfaces, then
			a CGLIB-based proxy will be created. This is the easiest scenario, because
			JDK proxies are interface based, and no interfaces means JDK proxying
			isn't even possible. One simply plugs in the target bean, and specifies the
			list of interceptors via the <code class="literal">interceptorNames</code> property.
			Note that a CGLIB-based proxy will be created even if the
			<code class="literal">proxyTargetClass</code> property of the
			<code class="classname">ProxyFactoryBean</code> has been set to <code class="literal">false</code>.
			(Obviously this makes no sense, and is best removed from the bean
			definition because it is at best redundant, and at worst confusing.)
		</p><p>
			If the target class implements one (or more) interfaces, then the type of
			proxy that is created depends on the configuration of the
			<code class="classname">ProxyFactoryBean</code>.
		</p><p>
			If the <code class="literal">proxyTargetClass</code> property of the
			<code class="classname">ProxyFactoryBean</code> has been set to <code class="literal">true</code>,
			then a CGLIB-based proxy will be created. This makes sense, and is in
			keeping with the principle of least surprise. Even if the
			<code class="literal">proxyInterfaces</code> property of the
			<code class="classname">ProxyFactoryBean</code> has been set to one or more
			fully qualified interface names, the fact that the
			<code class="literal">proxyTargetClass</code> property is set to 
			<code class="literal">true</code> <span class="emphasis"><em>will</em></span> cause
			CGLIB-based proxying to be in effect.
		</p><p>
			If the <code class="literal">proxyInterfaces</code> property of the
			<code class="classname">ProxyFactoryBean</code> has been set to one or more
			fully qualified interface names, then a JDK-based proxy will be created.
			The created proxy will implement all of the interfaces that were specified
			in the <code class="literal">proxyInterfaces</code> property; if the target class
			happens to implement a whole lot more interfaces than those specified in
			the <code class="literal">proxyInterfaces</code> property, that is all well and
			good but those additional interfaces will not be implemented by the
			returned proxy.
		</p><p>
			If the <code class="literal">proxyInterfaces</code> property of the
			<code class="classname">ProxyFactoryBean</code> has <span class="emphasis"><em>not</em></span> been
			set, but the target class <span class="emphasis"><em>does implement one (or more)</em></span>
			interfaces, then the <code class="classname">ProxyFactoryBean</code> will auto-detect
			the fact that the target class does actually implement at least one interface,
			and a JDK-based proxy will be created. The interfaces that are actually
			proxied will be <span class="emphasis"><em>all</em></span> of the interfaces that the target
			class implements; in effect, this is the same as simply supplying a list
			of each and every interface that the target class implements to the
			<code class="literal">proxyInterfaces</code> property. However, it is significantly less
			work, and less prone to typos.
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-proxying-intf"></a>7.5.4.&nbsp;Proxying interfaces</h3></div></div></div><p>
		Let's look at a simple example of <code class="classname">ProxyFactoryBean</code>
		in action. This example involves:
      </p><div class="itemizedlist"><ul type="disc"><li><p>A <span class="emphasis"><em>target bean</em></span> that will be proxied. This
          is the "personTarget" bean definition in the example below.</p></li><li><p>An Advisor and an Interceptor used to provide advice.</p></li><li><p>An AOP proxy bean definition specifying the target object (the
          personTarget bean) and the interfaces to proxy, along with the
          advices to apply.</p></li></ul></div><pre class="programlisting">&lt;bean id="personTarget" class="com.mycompany.PersonImpl"&gt;
    &lt;property name="name"&gt;&lt;value&gt;Tony&lt;/value&gt;&lt;/property&gt;
    &lt;property name="age"&gt;&lt;value&gt;51&lt;/value&gt;&lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="myAdvisor" class="com.mycompany.MyAdvisor"&gt;
    &lt;property name="someProperty"&gt;&lt;value&gt;Custom string property value&lt;/value&gt;&lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="debugInterceptor" class="org.springframework.aop.interceptor.DebugInterceptor"&gt;
&lt;/bean&gt;

&lt;bean id="person" 
    class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
    &lt;property name="proxyInterfaces"&gt;&lt;value&gt;com.mycompany.Person&lt;/value&gt;&lt;/property&gt;

    &lt;property name="target"&gt;&lt;ref local="personTarget"/&gt;&lt;/property&gt;
    &lt;property name="interceptorNames"&gt;
        &lt;list&gt;
            &lt;value&gt;myAdvisor&lt;/value&gt;
            &lt;value&gt;debugInterceptor&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>Note that the <code class="literal">interceptorNames</code> property takes a
      list of String: the bean names of the interceptor or advisors in the
      current factory. Advisors, interceptors, before, after returning and
      throws advice objects can be used. The ordering of advisors is
      significant.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You might be wondering why the list doesn't hold bean
				references. The reason for this is that if the ProxyFactoryBean's
				singleton property is set to false, it must be able to return
				independent proxy instances. If any of the advisors is itself a
				prototype, an independent instance would need to be returned, so it's
				necessary to be able to obtain an instance of the prototype from the
				factory; holding a reference isn't sufficient.</p></td></tr></table></div><p>The "person" bean definition above can be used in place of a
      Person implementation, as follows:</p><pre class="programlisting">Person person = (Person) factory.getBean("person");</pre><p>Other beans in the same IoC context can express a strongly typed
      dependency on it, as with an ordinary Java object:</p><pre class="programlisting">&lt;bean id="personUser" class="com.mycompany.PersonUser"&gt;
  &lt;property name="person"&gt;&lt;ref local="person" /&gt;&lt;/property&gt;
&lt;/bean&gt;</pre><p>The <code class="literal">PersonUser</code> class in this example would
      expose a property of type Person. As far as it's concerned, the AOP
      proxy can be used transparently in place of a "real" person
      implementation. However, its class would be a dynamic proxy class. It
      would be possible to cast it to the <code class="literal">Advised</code> interface
      (discussed below).</p><p>It's possible to conceal the distinction between target and proxy
      using an anonymous <span class="emphasis"><em>inner bean</em></span>, as follows. Only the
      <code class="literal">ProxyFactoryBean</code> definition is different; the advice
      is included only for completeness:</p><pre class="programlisting">&lt;bean id="myAdvisor" class="com.mycompany.MyAdvisor"&gt;
  &lt;property name="someProperty"&gt;&lt;value&gt;Custom string property value&lt;/value&gt;&lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="debugInterceptor" class="org.springframework.aop.interceptor.DebugInterceptor"/&gt;

&lt;bean id="person" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
  &lt;property name="proxyInterfaces"&gt;&lt;value&gt;com.mycompany.Person&lt;/value&gt;&lt;/property&gt;
  &lt;!-- Use inner bean, not local reference to target --&gt;
  &lt;property name="target"&gt;
    &lt;bean class="com.mycompany.PersonImpl"&gt;
      &lt;property name="name"&gt;&lt;value&gt;Tony&lt;/value&gt;&lt;/property&gt;
      &lt;property name="age"&gt;&lt;value&gt;51&lt;/value&gt;&lt;/property&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
  &lt;property name="interceptorNames"&gt;
    &lt;list&gt;
      &lt;value&gt;myAdvisor&lt;/value&gt;
      &lt;value&gt;debugInterceptor&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>This has the advantage that there's only one object of type
      <code class="literal">Person</code>: useful if we want to prevent users of the
      application context from obtaining a reference to the un-advised object, or
      need to avoid any ambiguity with Spring IoC
      <span class="emphasis"><em>autowiring</em></span>. There's also arguably an advantage in
      that the ProxyFactoryBean definition is self-contained. However, there
      are times when being able to obtain the un-advised target from the
      factory might actually be an <span class="emphasis"><em>advantage</em></span>: for
      example, in certain test scenarios.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-proxying-class"></a>7.5.5.&nbsp;Proxying classes</h3></div></div></div><p>What if you need to proxy a class, rather than one or more
      interfaces?</p><p>Imagine that in our example above, there was no
      <code class="literal">Person</code> interface: we needed to advise a class called
      <code class="literal">Person</code> that didn't implement any business interface.
      In this case, you can configure Spring to use CGLIB proxying, rather
      than dynamic proxies. Simply set the <code class="literal">proxyTargetClass</code>
      property on the ProxyFactoryBean above to true. While it's best to
      program to interfaces, rather than classes, the ability to advise
      classes that don't implement interfaces can be useful when working with
      legacy code. (In general, Spring isn't prescriptive. While it makes it
      easy to apply good practices, it avoids forcing a particular
      approach.)</p><p>If you want to, you can force the use of CGLIB in any case, even if
      you do have interfaces.</p><p>CGLIB proxying works by generating a subclass of the target class
      at runtime. Spring configures this generated subclass to delegate method
      calls to the original target: the subclass is used to implement the
      <span class="emphasis"><em>Decorator</em></span> pattern, weaving in the advice.</p><p>CGLIB proxying should generally be transparent to users. However,
      there are some issues to consider:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">Final</code> methods can't be advised, as they
          can't be overridden.</p></li><li><p>You'll need the CGLIB 2 binaries on your classpath; dynamic
          proxies are available with the JDK.</p></li></ul></div><p>There's little performance difference between CGLIB proxying and
      dynamic proxies. As of Spring 1.0, dynamic proxies are slightly faster.
      However, this may change in the future. Performance should not be a
      decisive consideration in this case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-global-advisors"></a>7.5.6.&nbsp;Using 'global' advisors</h3></div></div></div><p>By appending an asterisk to an interceptor name, all advisors with
      bean names matching the part before the asterisk, will be added to the
      advisor chain. This can come in handy if you need to add a standard set
      of 'global' advisors: </p><pre class="programlisting">
&lt;bean id="proxy" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
  &lt;property name="target" ref="service"/&gt;
  &lt;property name="interceptorNames"&gt;
    &lt;list&gt;
      &lt;value&gt;global*&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="global_debug" class="org.springframework.aop.interceptor.DebugInterceptor"/&gt;
&lt;bean id="global_performance" class="org.springframework.aop.interceptor.PerformanceMonitorInterceptor"/&gt;
</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-concise-proxy"></a>7.6.&nbsp;Concise proxy definitions</h2></div></div></div><p>Especially when defining transactional proxies, you may end up with
    many similar proxy definitions. The use of parent and child bean
    definitions, along with inner bean definitions, can result in much cleaner
    and more concise proxy definitions.</p><p>First a parent, <span class="emphasis"><em>template</em></span>, bean definition is
    created for the proxy:</p><pre class="programlisting">&lt;bean id="txProxyTemplate" abstract="true"
        class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"&gt;
  &lt;property name="transactionManager" ref="transactionManager"/&gt;
  &lt;property name="transactionAttributes"&gt;
    &lt;props&gt;
      &lt;prop key="*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
    &lt;/props&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>This will never be instantiated itself, so may actually be
    incomplete. Then each proxy which needs to be created is just a child bean
    definition, which wraps the target of the proxy as an inner bean
    definition, since the target will never be used on its own
    anyway.</p><pre class="programlisting">&lt;bean id="myService" parent="txProxyTemplate"&gt;
  &lt;property name="target"&gt;
    &lt;bean class="org.springframework.samples.MyServiceImpl"&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>It is of course possible to override properties from the parent
    template, such as in this case, the transaction propagation
    settings:</p><pre class="programlisting">&lt;bean id="mySpecialService" parent="txProxyTemplate"&gt;
  &lt;property name="target"&gt;
    &lt;bean class="org.springframework.samples.MySpecialServiceImpl"&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
  &lt;property name="transactionAttributes"&gt;
    &lt;props&gt;
      &lt;prop key="get*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;
      &lt;prop key="find*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;
      &lt;prop key="load*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;
      &lt;prop key="store*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
    &lt;/props&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>Note that in the example above, we have explicitly marked the parent
    bean definition as <span class="emphasis"><em>abstract</em></span> by using the
    <span class="emphasis"><em>abstract</em></span> attribute, as described <a href="#beans-child-bean-definitions" title="3.6.&nbsp;Bean definition inheritance">previously</a>, so that it may
    not actually ever be instantiated. Application contexts (but not simple
    bean factories) will by default pre-instantiate all singletons. It is therefore
    important (at least for singleton beans) that if you have a (parent)
    bean definition which you intend to use only as a template, and this
    definition specifies a class, you must make sure to set the
    <span class="emphasis"><em>abstract</em></span> attribute to <span class="emphasis"><em>true</em></span>,
    otherwise the application context will actually try to pre-instantiate
    it.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-prog"></a>7.7.&nbsp;Creating AOP proxies programmatically with the ProxyFactory</h2></div></div></div><p>It's easy to create AOP proxies programmatically using Spring. This
    enables you to use Spring AOP without dependency on Spring IoC.</p><p>The following listing shows creation of a proxy for a target object,
    with one interceptor and one advisor. The interfaces implemented by the
    target object will automatically be proxied:</p><pre class="programlisting">ProxyFactory factory = new ProxyFactory(myBusinessInterfaceImpl);
factory.addInterceptor(myMethodInterceptor);
factory.addAdvisor(myAdvisor);
MyBusinessInterface tb = (MyBusinessInterface) factory.getProxy();</pre><p>The first step is to construct an object of type
    <code class="literal">org.springframework.aop.framework.ProxyFactory</code>. You can
    create this with a target object, as in the above example, or specify the
    interfaces to be proxied in an alternate constructor.</p><p>You can add interceptors or advisors, and manipulate them for the
    life of the ProxyFactory. If you add an
    IntroductionInterceptionAroundAdvisor you can cause the proxy to implement
    additional interfaces.</p><p>There are also convenience methods on ProxyFactory (inherited from
    <code class="classname">AdvisedSupport</code>) which allow you to add other advice types 
		such as before and throws advice. AdvisedSupport is the superclass of both 
    ProxyFactory and ProxyFactoryBean.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Integrating AOP proxy creation with the IoC framework is best
			practice in most applications. We recommend that you externalize
			configuration from Java code with AOP, as in general.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-advised"></a>7.8.&nbsp;Manipulating advised objects</h2></div></div></div><p>However you create AOP proxies, you can manipulate them using the
    <code class="literal">org.springframework.aop.framework.Advised</code> interface.
    Any AOP proxy can be cast to this interface, whichever other interfaces it
    implements. This interface includes the following methods:</p><pre class="programlisting">Advisor[] getAdvisors();

void addAdvice(Advice advice) throws AopConfigException;

void addAdvice(int pos, Advice advice) 
        throws AopConfigException;

void addAdvisor(Advisor advisor) throws AopConfigException;

void addAdvisor(int pos, Advisor advisor) throws AopConfigException;

int indexOf(Advisor advisor);

boolean removeAdvisor(Advisor advisor) throws AopConfigException;

void removeAdvisor(int index) throws AopConfigException;

boolean replaceAdvisor(Advisor a, Advisor b) throws AopConfigException;

boolean isFrozen();</pre><p>The <code class="literal">getAdvisors()</code> method will return an Advisor
    for every advisor, interceptor or other advice type that has been added to
    the factory. If you added an Advisor, the returned advisor at this index
    will be the object that you added. If you added an interceptor or other
    advice type, Spring will have wrapped this in an advisor with a pointcut
    that always returns true. Thus if you added a
    <code class="literal">MethodInterceptor</code>, the advisor returned for this index
    will be an <code class="literal">DefaultPointcutAdvisor</code> returning your
    <code class="literal">MethodInterceptor</code> and a pointcut that matches all
    classes and methods.</p><p>The <code class="literal">addAdvisor()</code> methods can be used to add any
    Advisor. Usually the advisor holding pointcut and advice will be the
    generic <code class="literal">DefaultPointcutAdvisor</code>, which can be used with
    any advice or pointcut (but not for introductions).</p><p>By default, it's possible to add or remove advisors or interceptors
    even once a proxy has been created. The only restriction is that it's
    impossible to add or remove an introduction advisor, as existing proxies
    from the factory will not show the interface change. (You can obtain a new
    proxy from the factory to avoid this problem.)</p><p>A simple example of casting an AOP proxy to the
    <code class="literal">Advised</code> interface and examining and manipulating its
    advice:</p><pre class="programlisting">Advised advised = (Advised) myObject;
Advisor[] advisors = advised.getAdvisors();
int oldAdvisorCount = advisors.length;
System.out.println(oldAdvisorCount + " advisors");

// Add an advice like an interceptor without a pointcut
// Will match all proxied methods
// Can use for interceptors, before, after returning or throws advice
advised.addAdvice(new DebugInterceptor());

// Add selective advice using a pointcut
advised.addAdvisor(new DefaultPointcutAdvisor(mySpecialPointcut, myAdvice));

assertEquals("Added two advisors",
     oldAdvisorCount + 2, advised.getAdvisors().length);</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>It's questionable whether it's advisable (no pun intended) to
			modify advice on a business object in production, although there are no
			doubt legitimate usage cases. However, it can be very useful in
			development: for example, in tests. I have sometimes found it very useful
			to be able to add test code in the form of an interceptor or other advice,
			getting inside a method invocation I want to test. (For example, the
			advice can get inside a transaction created for that method: for example,
			to run SQL to check that a database was correctly updated, before marking
			the transaction for roll back.)</p></td></tr></table></div><p>Depending on how you created the proxy, you can usually set a
    <code class="literal">frozen</code> flag, in which case the
    <code class="literal">Advised</code> <code class="literal">isFrozen()</code> method will
    return true, and any attempts to modify advice through addition or removal
    will result in an <code class="literal">AopConfigException</code>. The ability to
    freeze the state of an advised object is useful in some cases, for
    example, to prevent calling code removing a security interceptor. It may
    also be used in Spring 1.1 to allow aggressive optimization if runtime
    advice modification is known not to be required.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-autoproxy"></a>7.9.&nbsp;Using the "autoproxy" facility</h2></div></div></div><p>So far we've considered explicit creation of AOP proxies using a
    <code class="literal">ProxyFactoryBean</code> or similar factory bean.</p><p>Spring also allows us to use "autoproxy" bean definitions, which can
    automatically proxy selected bean definitions. This is built on Spring
    "bean post processor" infrastructure, which enables modification of any
    bean definition as the container loads.</p><p>In this model, you set up some special bean definitions in your XML
    bean definition file to configure the auto proxy infrastructure. This
    allows you just to declare the targets eligible for autoproxying: you
    don't need to use <code class="literal">ProxyFactoryBean</code>.</p><p>There are two ways to do this:</p><div class="itemizedlist"><ul type="disc"><li><p>Using an autoproxy creator that refers to specific beans in the
        current context.</p></li><li><p>A special case of autoproxy creation that deserves to be
        considered separately; autoproxy creation driven by source-level
        metadata attributes.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-autoproxy-choices"></a>7.9.1.&nbsp;Autoproxy bean definitions</h3></div></div></div><p>The <code class="literal">org.springframework.aop.framework.autoproxy</code>
      package provides the following standard autoproxy creators.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-autoproxy"></a>7.9.1.1.&nbsp;BeanNameAutoProxyCreator</h4></div></div></div><p>The BeanNameAutoProxyCreator automatically creates AOP proxies
        for beans with names matching literal values or wildcards.</p><pre class="programlisting">&lt;bean class="org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"&gt;
  &lt;property name="beanNames"&gt;&lt;value&gt;jdk*,onlyJdk&lt;/value&gt;&lt;/property&gt;
  &lt;property name="interceptorNames"&gt;
    &lt;list&gt;
      &lt;value&gt;myInterceptor&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>As with <code class="literal">ProxyFactoryBean</code>, there is an
        <code class="literal">interceptorNames</code> property rather than a list of interceptors, to allow
        correct behavior for prototype advisors. Named "interceptors" can be
        advisors or any advice type.</p><p>As with auto proxying in general, the main point of using
        <code class="literal">BeanNameAutoProxyCreator</code> is to apply the same
        configuration consistently to multiple objects, with minimal
        volume of configuration. It is a popular choice for applying
        declarative transactions to multiple objects.</p><p>Bean definitions whose names match, such as "jdkMyBean" and
        "onlyJdk" in the above example, are plain old bean definitions with
        the target class. An AOP proxy will be created automatically by the
        <code class="literal">BeanNameAutoProxyCreator</code>. The same advice will be
        applied to all matching beans. Note that if advisors are used (rather
        than the interceptor in the above example), the pointcuts may apply
        differently to different beans.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-autoproxy-default"></a>7.9.1.2.&nbsp;DefaultAdvisorAutoProxyCreator</h4></div></div></div><p>A more general and extremely powerful auto proxy creator is
        <code class="literal">DefaultAdvisorAutoProxyCreator</code>. This will
        automagically apply eligible advisors in the current context, without
        the need to include specific bean names in the autoproxy advisor's
        bean definition. It offers the same merit of consistent configuration
        and avoidance of duplication as
        <code class="literal">BeanNameAutoProxyCreator</code>.</p><p>Using this mechanism involves:</p><div class="itemizedlist"><ul type="disc"><li><p>Specifying a
            <code class="literal">DefaultAdvisorAutoProxyCreator</code> bean
            definition.</p></li><li><p>Specifying any number of Advisors in the same or related
            contexts. Note that these <span class="emphasis"><em>must</em></span> be Advisors,
            not just interceptors or other advices. This is necessary because
            there must be a pointcut to evaluate, to check the eligibility of
            each advice to candidate bean definitions.</p></li></ul></div><p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> will
        automatically evaluate the pointcut contained in each advisor, to see
        what (if any) advice it should apply to each business object (such as
        "businessObject1" and "businessObject2" in the example).</p><p>This means that any number of advisors can be applied
        automatically to each business object. If no pointcut in any of the
        advisors matches any method in a business object, the object will not
        be proxied. As bean definitions are added for new business objects,
        they will automatically be proxied if necessary.</p><p>Autoproxying in general has the advantage of making it
        impossible for callers or dependencies to obtain an un-advised object.
        Calling getBean("businessObject1") on this ApplicationContext will
        return an AOP proxy, not the target business object. (The "inner bean"
        idiom shown earlier also offers this benefit.)</p><pre class="programlisting">&lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/&gt;

&lt;bean class="org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"&gt;
  &lt;property name="transactionInterceptor" ref="transactionInterceptor"/&gt;
&lt;/bean&gt;

&lt;bean id="customAdvisor" class="com.mycompany.MyAdvisor"/&gt;

&lt;bean id="businessObject1" class="com.mycompany.BusinessObject1"&gt;
  &lt;!-- Properties omitted --&gt;
&lt;/bean&gt;

&lt;bean id="businessObject2" class="com.mycompany.BusinessObject2"/&gt;
</pre><p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> is very
        useful if you want to apply the same advice consistently to many
        business objects. Once the infrastructure definitions are in place,
        you can simply add new business objects without including specific
        proxy configuration. You can also drop in additional aspects very
        easily - for example, tracing or performance monitoring aspects - with
        minimal change to configuration.</p><p>The DefaultAdvisorAutoProxyCreator offers support for filtering
        (using a naming convention so that only certain advisors are
        evaluated, allowing use of multiple, differently configured,
        AdvisorAutoProxyCreators in the same factory) and ordering. Advisors
        can implement the <code class="literal">org.springframework.core.Ordered</code>
        interface to ensure correct ordering if this is an issue. The
        TransactionAttributeSourceAdvisor used in the above example has a
        configurable order value; the default setting is unordered.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-autoproxy-abstract"></a>7.9.1.3.&nbsp;AbstractAdvisorAutoProxyCreator</h4></div></div></div><p>This is the superclass of DefaultAdvisorAutoProxyCreator. You
        can create your own autoproxy creators by subclassing this class, in
        the unlikely event that advisor definitions offer insufficient
        customization to the behavior of the framework
        <code class="literal">DefaultAdvisorAutoProxyCreator</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-autoproxy-metadata"></a>7.9.2.&nbsp;Using metadata-driven auto-proxying</h3></div></div></div><p>A particularly important type of autoproxying is driven by
      metadata. This produces a similar programming model to .NET
      <code class="literal">ServicedComponents</code>. Instead of using XML deployment
      descriptors as in EJB, configuration for transaction management and
      other enterprise services is held in source-level attributes.</p><p>In this case, you use the
      <code class="literal">DefaultAdvisorAutoProxyCreator</code>, in combination with
      Advisors that understand metadata attributes. The metadata specifics are
      held in the pointcut part of the candidate advisors, rather than in the
      autoproxy creation class itself.</p><p>This is really a special case of the
      <code class="literal">DefaultAdvisorAutoProxyCreator</code>, but deserves
      consideration on its own. (The metadata-aware code is in the pointcuts
      contained in the advisors, not the AOP framework itself.)</p><p>The <code class="literal">/attributes</code> directory of the JPetStore
      sample application shows the use of attribute-driven autoproxying. In
      this case, there's no need to use the
      <code class="literal">TransactionProxyFactoryBean</code>. Simply defining
      transactional attributes on business objects is sufficient, because of
      the use of metadata-aware pointcuts. The bean definitions include the
      following code, in <code class="literal">/WEB-INF/declarativeServices.xml</code>.
      Note that this is generic, and can be used outside the JPetStore:</p><pre class="programlisting">&lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/&gt;

&lt;bean class="org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"&gt;
  &lt;property name="transactionInterceptor" ref="transactionInterceptor"/&gt;
&lt;/bean&gt;

&lt;bean id="transactionInterceptor"
    class="org.springframework.transaction.interceptor.TransactionInterceptor"&gt;
  &lt;property name="transactionManager" ref="transactionManager"/&gt;
  &lt;property name="transactionAttributeSource"&gt;
    &lt;bean class="org.springframework.transaction.interceptor.AttributesTransactionAttributeSource"&gt;
      &lt;property name="attributes" ref="attributes"/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="attributes" class="org.springframework.metadata.commons.CommonsAttributes"/&gt;</pre><p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> bean
      definition (the name is not significant, hence it can even be omitted)
      will pick up all eligible pointcuts in the current application context.
      In this case, the "transactionAdvisor" bean definition, of type
      <code class="literal">TransactionAttributeSourceAdvisor</code>, will apply to
      classes or methods carrying a transaction attribute. The
      TransactionAttributeSourceAdvisor depends on a TransactionInterceptor,
      via constructor dependency. The example resolves this via autowiring.
      The <code class="literal">AttributesTransactionAttributeSource</code> depends on
      an implementation of the
      <code class="literal">org.springframework.metadata.Attributes</code> interface. In
      this fragment, the "attributes" bean satisfies this, using the Jakarta
      Commons Attributes API to obtain attribute information. (The application
      code must have been compiled using the Commons Attributes compilation
      task.)</p><p>The <code class="literal">/annotation</code> directory of the JPetStore
      sample application contains an analogous example for auto-proxying
      driven by JDK 1.5+ annotations. The following configuration enables
      automatic detection of Spring's <code class="literal">Transactional</code>
      annotation, leading to implicit proxies for beans containing that
      annotation:</p><pre class="programlisting">&lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/&gt;

&lt;bean class="org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"&gt;
  &lt;property name="transactionInterceptor" ref="transactionInterceptor"/&gt;
&lt;/bean&gt;

&lt;bean id="transactionInterceptor"
    class="org.springframework.transaction.interceptor.TransactionInterceptor"&gt;
  &lt;property name="transactionManager" ref="transactionManager"/&gt;
  &lt;property name="transactionAttributeSource"&gt;
    &lt;bean class="org.springframework.transaction.annotation.AnnotationTransactionAttributeSource"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>The <code class="literal">TransactionInterceptor</code> defined here depends
      on a <code class="literal">PlatformTransactionManager</code> definition, which is
      not included in this generic file (although it could be) because it will
      be specific to the application's transaction requirements (typically
      JTA, as in this example, or Hibernate, JDO or JDBC):</p><pre class="programlisting">&lt;bean id="transactionManager" 
    class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you require only declarative transaction management, using
				these generic XML definitions will result in Spring automatically
				proxying all classes or methods with transaction attributes. You won't
				need to work directly with AOP, and the programming model is similar to
				that of .NET ServicedComponents.</p></td></tr></table></div><p>This mechanism is extensible. It's possible to do autoproxying
      based on custom attributes. You need to:</p><div class="itemizedlist"><ul type="disc"><li><p>Define your custom attribute.</p></li><li><p>Specify an Advisor with the necessary advice, including a
          pointcut that is triggered by the presence of the custom attribute
          on a class or method. You may be able to use an existing advice,
          merely implementing a static pointcut that picks up the custom
          attribute.</p></li></ul></div><p>It's possible for such advisors to be unique to each advised class
      (for example, mixins): they simply need to be defined as prototype,
      rather than singleton, bean definitions. For example, the
      <code class="literal">LockMixin</code> introduction interceptor from the Spring
      test suite, shown above, could be used in conjunction with an
      attribute-driven pointcut to target a mixin, as shown here. We use the
      generic <code class="literal">DefaultPointcutAdvisor</code>, configured using
      JavaBean properties:</p><pre class="programlisting">&lt;bean id="lockMixin" class="org.springframework.aop.LockMixin"
    scope="prototype"/&gt;

&lt;bean id="lockableAdvisor" class="org.springframework.aop.support.DefaultPointcutAdvisor"
    scope="prototype"&gt;
  &lt;property name="pointcut" ref="myAttributeAwarePointcut"/&gt;
  &lt;property name="advice" ref="lockMixin"/&gt;
&lt;/bean&gt;

&lt;bean id="anyBean" class="anyclass" ...</pre><p>If the attribute aware pointcut matches any methods in the
      <code class="literal">anyBean</code> or other bean definitions, the mixin will be
      applied. Note that both <code class="literal">lockMixin</code> and
      <code class="literal">lockableAdvisor</code> definitions are prototypes. The
      <code class="literal">myAttributeAwarePointcut</code> pointcut can be a singleton
      definition, as it doesn't hold state for individual advised
      objects.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-targetsource"></a>7.10.&nbsp;Using TargetSources</h2></div></div></div><p>Spring offers the concept of a <span class="emphasis"><em>TargetSource</em></span>,
    expressed in the <code class="literal">org.springframework.aop.TargetSource</code>
    interface. This interface is responsible for returning the "target object"
    implementing the join point. The <code class="literal">TargetSource</code>
    implementation is asked for a target instance each time the AOP proxy
    handles a method invocation.</p><p>Developers using Spring AOP don't normally need to work directly
    with TargetSources, but this provides a powerful means of supporting
    pooling, hot swappable and other sophisticated targets. For example, a
    pooling TargetSource can return a different target instance for each
    invocation, using a pool to manage instances.</p><p>If you do not specify a TargetSource, a default implementation is
    used that wraps a local object. The same target is returned for each
    invocation (as you would expect).</p><p>Let's look at the standard target sources provided with Spring, and
    how you can use them.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>When using a custom target source, your target will usually need
			to be a prototype rather than a singleton bean definition. This allows
			Spring to create a new target instance when required.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ts-swap"></a>7.10.1.&nbsp;Hot swappable target sources</h3></div></div></div><p>The
      <code class="literal">org.springframework.aop.target.HotSwappableTargetSource</code>
      exists to allow the target of an AOP proxy to be switched while allowing
      callers to keep their references to it.</p><p>Changing the target source's target takes effect immediately. The
      <code class="literal">HotSwappableTargetSource</code> is threadsafe.</p><p>You can change the target via the <code class="literal">swap()</code> method
      on HotSwappableTargetSource as follows:</p><pre class="programlisting">HotSwappableTargetSource swapper = 
    (HotSwappableTargetSource) beanFactory.getBean("swapper");
Object oldTarget = swapper.swap(newTarget);</pre><p>The XML definitions required look as follows:</p><pre class="programlisting">&lt;bean id="initialTarget" class="mycompany.OldTarget"/&gt;

&lt;bean id="swapper" class="org.springframework.aop.target.HotSwappableTargetSource"&gt;
  &lt;constructor-arg ref="initialTarget"/&gt;
&lt;/bean&gt;

&lt;bean id="swappable" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
  &lt;property name="targetSource" ref="swapper"/&gt;
&lt;/bean&gt;</pre><p>The above <code class="literal">swap()</code> call changes the target of the
      swappable bean. Clients who hold a reference to that bean will be
      unaware of the change, but will immediately start hitting the new
      target.</p><p>Although this example doesn't add any advice - and it's not
      necessary to add advice to use a <code class="literal">TargetSource</code> - of
      course any <code class="literal">TargetSource</code> can be used in conjunction
      with arbitrary advice.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ts-pool"></a>7.10.2.&nbsp;Pooling target sources</h3></div></div></div><p>Using a pooling target source provides a similar programming model
      to stateless session EJBs, in which a pool of identical instances is
      maintained, with method invocations going to free objects in the
      pool.</p><p>A crucial difference between Spring pooling and SLSB pooling is
      that Spring pooling can be applied to any POJO. As with Spring in
      general, this service can be applied in a non-invasive way.</p><p>Spring provides out-of-the-box support for Jakarta Commons Pool
      1.3, which provides a fairly efficient pooling implementation. You'll
      need the commons-pool Jar on your application's classpath to use this
      feature. It's also possible to subclass
      <code class="literal">org.springframework.aop.target.AbstractPoolingTargetSource</code>
      to support any other pooling API.</p><p>Sample configuration is shown below:</p><pre class="programlisting">&lt;bean id="businessObjectTarget" class="com.mycompany.MyBusinessObject" 
    scope="prototype"&gt;
  ... properties omitted
&lt;/bean&gt;

&lt;bean id="poolTargetSource" class="org.springframework.aop.target.CommonsPoolTargetSource"&gt;
  &lt;property name="targetBeanName" value="businessObjectTarget"/&gt;
  &lt;property name="maxSize" value="25"/&gt;
&lt;/bean&gt;

&lt;bean id="businessObject" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
  &lt;property name="targetSource" ref="poolTargetSource"/&gt;
  &lt;property name="interceptorNames" value="myInterceptor"/&gt;
&lt;/bean&gt;</pre><p>Note that the target object - "businessObjectTarget" in the
      example - <span class="emphasis"><em>must</em></span> be a prototype. This allows the
      <code class="literal">PoolingTargetSource</code> implementation to create new
      instances of the target to grow the pool as necessary. See the Javadoc
      for <code class="literal">AbstractPoolingTargetSource</code> and the concrete
      subclass you wish to use for information about it's properties: maxSize
      is the most basic, and always guaranteed to be present.</p><p>In this case, "myInterceptor" is the name of an interceptor that
      would need to be defined in the same IoC context. However, it isn't
      necessary to specify interceptors to use pooling. If you want only
      pooling, and no other advice, don't set the interceptorNames property at
      all.</p><p>It's possible to configure Spring so as to be able to cast any
      pooled object to the
      <code class="literal">org.springframework.aop.target.PoolingConfig</code>
      interface, which exposes information about the configuration and current
      size of the pool through an introduction. You'll need to define an
      advisor like this:</p><pre class="programlisting">&lt;bean id="poolConfigAdvisor" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean"&gt;
  &lt;property name="targetObject" ref="poolTargetSource"/&gt;
  &lt;property name="targetMethod" value="getPoolingConfigMixin"/&gt;
&lt;/bean&gt;</pre><p>This advisor is obtained by calling a convenience method on the
      <code class="literal">AbstractPoolingTargetSource</code> class, hence the use of
      MethodInvokingFactoryBean. This advisor's name ("poolConfigAdvisor"
      here) must be in the list of interceptors names in the ProxyFactoryBean
      exposing the pooled object.</p><p>The cast will look as follows:</p><pre class="programlisting">PoolingConfig conf = (PoolingConfig) beanFactory.getBean("businessObject");
System.out.println("Max pool size is " + conf.getMaxSize());</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Pooling stateless service objects is not usually necessary. We
				don't believe it should be the default choice, as most stateless objects
				are naturally thread safe, and instance pooling is problematic if
				resources are cached.</p></td></tr></table></div><p>Simpler pooling is available using autoproxying. It's possible to
      set the TargetSources used by any autoproxy creator.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ts-prototype"></a>7.10.3.&nbsp;Prototype target sources</h3></div></div></div><p>Setting up a "prototype" target source is similar to a pooling
      TargetSource. In this case, a new instance of the target will be created
      on every method invocation. Although the cost of creating a new object
      isn't high in a modern JVM, the cost of wiring up the new object
      (satisfying its IoC dependencies) may be more expensive. Thus you
      shouldn't use this approach without very good reason.</p><p>To do this, you could modify the
      <code class="literal">poolTargetSource</code> definition shown above as follows.
      (I've also changed the name, for clarity.)</p><pre class="programlisting">&lt;bean id="prototypeTargetSource" class="org.springframework.aop.target.PrototypeTargetSource"&gt;
  &lt;property name="targetBeanName" ref="businessObjectTarget"/&gt;
&lt;/bean&gt;</pre><p>There's only one property: the name of the target bean.
      Inheritance is used in the TargetSource implementations to ensure
      consistent naming. As with the pooling target source, the target bean
      must be a prototype bean definition.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ts-threadlocal"></a>7.10.4.&nbsp;<code class="classname">ThreadLocal</code> target sources</h3></div></div></div><p><code class="classname">ThreadLocal</code> target sources are useful if you need an object to be
      created for each incoming request (per thread that is). The concept of a
      <code class="classname">ThreadLocal</code> provide a JDK-wide facility to
      transparently store resource alongside a thread. Setting up a
      <code class="classname">ThreadLocalTargetSource</code> is pretty much the same as was explained for the
      other types of target source:</p><pre class="programlisting">&lt;bean id="threadlocalTargetSource" class="org.springframework.aop.target.ThreadLocalTargetSource"&gt;
  &lt;property name="targetBeanName" value="businessObjectTarget"/&gt;
&lt;/bean&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>ThreadLocals come with serious issues (potentially
				resulting in memory leaks) when incorrectly using them in a
				multi-threaded and multi-classloader environments. One should always
				consider wrapping a threadlocal in some other class and never directly
				use the <code class="classname">ThreadLocal</code> itself (except of course in the wrapper class).
				Also, one should always remember to correctly set and unset (where the
				latter simply involved a call to <code class="literal">ThreadLocal.set(null)</code>) the resource
				local to the thread. Unsetting should be done in any case since not
				unsetting it might result in problematic behavior. Spring's ThreadLocal
				support does this for you and should always be considered in favor
				of using ThreadLocals without other proper handling
				code.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-extensibility"></a>7.11.&nbsp;Defining new <code class="interfacename">Advice</code> types</h2></div></div></div><p>Spring AOP is designed to be extensible. While the interception
    implementation strategy is presently used internally, it is possible to
    support arbitrary advice types in addition to the out-of-the-box interception around advice,
    before, throws advice and after returning advice.</p><p>The <code class="literal">org.springframework.aop.framework.adapter</code>
    package is an SPI package allowing support for new custom advice types to
    be added without changing the core framework. The only constraint on a
    custom <code class="interfacename">Advice</code> type is that it must implement the
    <code class="interfacename">org.aopalliance.aop.Advice</code> tag interface.</p><p>Please refer to the
    <code class="literal">org.springframework.aop.framework.adapter</code> package's
    Javadocs for further information.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-resources"></a>7.12.&nbsp;Further resources</h2></div></div></div><p>Please refer to the Spring sample applications for further examples
    of Spring AOP:</p><div class="itemizedlist"><ul type="disc"><li><p>The JPetStore's default configuration illustrates the use of the
        <code class="classname">TransactionProxyFactoryBean</code> for declarative transaction
        management.</p></li><li><p>The <code class="literal">/attributes</code> directory of the JPetStore
        illustrates the use of attribute-driven declarative transaction management.</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="testing"></a>Chapter&nbsp;8.&nbsp;Testing</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing-introduction"></a>8.1.&nbsp;Introduction</h2></div></div></div><p>The Spring team considers developer testing to be an absolutely
		integral part of enterprise software development. A thorough treatment
		of testing in the enterprise is beyond the scope of this chapter;
		rather, the focus here is on the value add that the adoption of the
		IoC principle can bring to <a href="#unit-testing" title="8.2.&nbsp;Unit testing">unit testing</a>;
		and on the benefits that the Spring Framework provides in
		<a href="#integration-testing" title="8.3.&nbsp;Integration testing">integration testing</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="unit-testing"></a>8.2.&nbsp;Unit testing</h2></div></div></div><p>One of the main benefits of Dependency Injection is that your code
		should really depend far less on the container than in traditional J2EE
		development. The POJOs that comprise your application should be testable
		in JUnit tests, with objects simply instantiated using the
		<code class="literal">new</code> operator, <span class="emphasis"><em>without Spring or any other
		container</em></span>. You can use mock objects (in conjunction with many
		other valuable testing techniques) to test your code in isolation. If you
		follow the architecture recommendations around Spring you will find that
		the resulting clean layering and componentization of your codebase will
		naturally faciliate <span class="emphasis"><em>easier</em></span> unit testing. For example,
		you will be able to test service layer objects by stubbing or mocking DAO
		interfaces, without any need to access persistent data while running unit
		tests.</p><p>True unit tests typically will run extremely quickly, as there is no
		runtime infrastructure to set up, whether application server, database, ORM
		tool, or whatever. Thus emphasizing true unit tests as part of your
		development methodology will boost your productivity. The upshot of this is
		that you do not need this section of the testing chapter to help you write
		effective <span class="emphasis"><em>unit</em></span> tests for your IoC-based applications.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="integration-testing"></a>8.3.&nbsp;Integration testing</h2></div></div></div><p>However, it is also important to be able to perform some integration
		testing without requiring deployment to your application server or
		connecting to other enterprise infrastructure. This will enable you to test
		things such as:</p><div class="itemizedlist"><ul type="disc"><li><p>The correct wiring of your Spring IoC container contexts.</p></li><li><p>Data access using JDBC or an ORM tool. This would include
				such things such as the correctness of SQL statements / or Hibernate
				XML mapping files.</p></li></ul></div><p>The Spring Framework provides first class support for integration
		testing in the form of the classes that are packaged in the
		<code class="filename">spring-mock.jar</code> library.
		<span class="emphasis"><em>Please note that these test classes are JUnit-specific.</em></span></p><p>The <code class="literal">org.springframework.test</code> package provides
		valuable JUnit <code class="classname">TestCase</code> superclasses for integration
		testing using a Spring container, while at the same time not being reliant
		on an application server or other deployed environment. They will be slower
		to run than unit tests, but much faster to run than the equivalent Cactus
		tests or remote tests relying on deployment to an application server.</p><p>These superclasses provide the following functionality:</p><div class="itemizedlist"><ul type="disc"><li><p><a href="#testing-ctx-management" title="8.3.1.&nbsp;Context management and caching">Spring IoC container caching</a>
				between test case execution.</p></li><li><p>The pretty-much-transparent
				<a href="#testing-fixture-di" title="8.3.2.&nbsp;Dependency Injection of test fixtures">Dependency Injection of test fixture instances</a>
				(this is nice).</p></li><li><p><a href="#testing-tx" title="8.3.3.&nbsp;Transaction management">Transaction management</a>
				appropriate to integration testing (this is even nicer).</p></li><li><p>A number of Spring-specific
				<a href="#testing-superclasses" title="8.3.4.&nbsp;Convenience variables">inherited instance variables</a>
				that are really useful when integration testing.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testing-ctx-management"></a>8.3.1.&nbsp;Context management and caching</h3></div></div></div><p>The <code class="literal">org.springframework.test</code> package provides
			support for consistent loading of Spring contexts, and caching of loaded
			contexts. Support for the caching of loaded contexts is important,
			because if you are working on a large project, startup time may become
			an issue - not because of the overhead of Spring itself, but because the
			objects instantiated by the Spring container will themselves take time
			to instantiate. For example, a project with 50-100 Hibernate mapping
			files might take 10-20 seconds to load the mapping files, and incurring
			that cost before running every single test case in every single test
			fixture will lead to slower overall test runs that could reduce productivity.</p><p>To address this issue, the
			<code class="classname">AbstractDependencyInjectionSpringContextTests</code> has an
			<code class="literal">protected</code> method that subclasses must implement
			to provide the location of context definition files:</p><pre class="programlisting">protected String[] getConfigLocations();</pre><p>Implementations of this method must provide an array containing the
			resource locations of XML configuration metadata - typically on the
			classpath - used to configure the application. This will be the same, or
			nearly the same, as the list of configuration locations specified in
			<code class="literal">web.xml</code> or other deployment configuration.</p><p>By default, once loaded, the configuration fileset will be reused
			for each test case. Thus the setup cost will be incurred only once (per
			test fixture), and subsequent test execution will be much faster. In
			the unlikely case that a test may 'dirty' the config location, requiring
			reloading - for example, by changing a bean definition or the state of
			an application object - you can call the
			<code class="methodname">setDirty()</code>	method on
			<code class="classname">AbstractDependencyInjectionSpringContextTests</code> to
			cause the test fixture to reload the configurations and rebuild the
			application context before executing the next test case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testing-fixture-di"></a>8.3.2.&nbsp;Dependency Injection of test fixtures</h3></div></div></div><p>When <code class="classname">AbstractDependencyInjectionSpringContextTests</code>
			(and subclasses) load your application context, they can optionally
			configure instances of your test classes by Setter Injection. All you
			need to do is to define instance variables and the corresponding
			setters. <code class="classname">AbstractDependencyInjectionSpringContextTests</code>
			will automatically locate the corresponding object in the set of
			configuration files specified in the <code class="methodname">getConfigLocations()</code>
			method.</p><p>Consider the scenario where we have a class,
			<code class="classname">HibernateTitleDao</code>, that performs data access
			logic for say, the <code class="classname">Title</code> domain object. We want
			to write integration tests that test all of the following areas:</p><div class="itemizedlist"><ul type="disc"><li><p>The Spring configuration; basically, is everything related
					to the configuration of the
					<code class="classname">HibernateTitleDao</code> bean correct and present?</p></li><li><p>The Hibernate mapping file configuration; is everything
					mapped correctly and are the correct lazy-loading settings in place?</p></li><li><p>The logic of the <code class="classname">HibernateTitleDao</code>;
					does the configured instance of this class perform as anticipated?</p></li></ul></div><p>Let's look at the test class itself (we will look at the
			configuration immediately afterwards).</p><pre class="programlisting">public final class HibernateTitleDaoTests <span class="bold"><strong>extends AbstractDependencyInjectionSpringContextTests</strong></span>  {

    <em class="lineannotation"><span class="lineannotation">// this instance will be (automatically) dependency injected</span></em>    
    private HibernateTitleDao titleDao;

    <em class="lineannotation"><span class="lineannotation">// a setter method to enable DI of the 'titleDao' instance variable</span></em>
    public void setTitleDao(HibernateTitleDao titleDao) {
        this.titleDao = titleDao;
    }

    public void testLoadTitle() throws Exception {
        Title title = this.titleDao.loadTitle(new Long(10));
        assertNotNull(title);
    }

    <em class="lineannotation"><span class="lineannotation">// specifies the Spring configuration to load for this test fixture</span></em>
    protected String[] getConfigLocations() {
        return new String[] { "classpath:com/foo/daos.xml" };
    }

}</pre><p>The file referenced by the
			<code class="methodname">getConfigLocations()</code> method
			(<code class="literal">'classpath:com/foo/daos.xml'</code>) looks like this:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE beans PUBLIC  "-//SPRING//DTD BEAN 2.0//EN"
    "http://www.springframework.org/dtd/http://www.springframework.org/dtd/spring-beans-2.0.dtd"&gt;
&lt;beans&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- this bean will be injected into the <code class="classname">HibernateTitleDaoTests</code> class --&gt;</span></em>
    &lt;bean id="titleDao" class="com.foo.dao.hibernate.HibernateTitleDao"&gt;
        &lt;property name="sessionFactory" ref="sessionFactory"/&gt;
    &lt;/bean&gt;
    
    &lt;bean id="sessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
        <em class="lineannotation"><span class="lineannotation">&lt;!-- dependencies elided for clarity --&gt;</span></em>
    &lt;/bean&gt;

&lt;/beans&gt;</pre><p>The <code class="classname">AbstractDependencyInjectionSpringContextTests</code>
			classes uses
			<a href="#beans-factory-autowire" title="3.3.6.&nbsp;Autowiring collaborators"><span class="emphasis"><em>autowire by type</em></span></a>.
			Thus if you have multiple bean definitions of the same type, you cannot
			rely on this approach for those particular beans. In that case, you can
			use the inherited <code class="literal">applicationContext</code> instance variable,
			and explicit lookup using (for example) an explicit call to
			<code class="methodname">applicationContext.getBean("titleDao")</code>.</p><p>If you don't want dependency injection applied to your test cases,
			simply don't declare any setters. Alternatively, you can extend the
			<code class="classname">AbstractSpringContextTests</code> - the root of the class
			hierarchy in the <code class="literal">org.springframework.test</code> package.
			It merely contains convenience methods to load Spring contexts, and
			performs no Dependency Injection of the test fixture.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="testing-fixture-di-field"></a>8.3.2.1.&nbsp;Field level injection</h4></div></div></div><p>If, for whatever reason, you don't fancy having setter
				methods in your test fixtures, Spring can (in this one case)
				inject dependencies into <code class="literal">protected</code> fields.
				Find below a reworking of the previous example to use field level
				injection (the Spring XML configuration does not need to change,
				merely the test fixture).</p><pre class="programlisting">public final class HibernateTitleDaoTests <span class="bold"><strong>extends AbstractDependencyInjectionSpringContextTests</strong></span>  {

    public HibernateTitleDaoTests() {
    	<em class="lineannotation"><span class="lineannotation">// switch on field level injection</span></em>
        setPopulateProtectedVariables(true);
    }

    <em class="lineannotation"><span class="lineannotation">// this instance will be (automatically) dependency injected</span></em>
    <em class="lineannotation"><span class="lineannotation"><span class="emphasis"><em>protected</em></span></span></em> HibernateTitleDao <em class="lineannotation"><span class="lineannotation"><span class="emphasis"><em>titleDao</em></span></span></em>;

    public void testLoadTitle() throws Exception {
        Title title = this.titleDao.loadTitle(new Long(10));
        assertNotNull(title);
    }

    <em class="lineannotation"><span class="lineannotation">// specifies the Spring configuration to load for this test fixture</span></em>
    protected String[] getConfigLocations() {
        return new String[] { "classpath:com/foo/daos.xml" };
    }

}</pre><p>In the case of field injection, there is no autowiring going on:
				the name of your <code class="literal">protected</code> instances variable(s)
				are used as the lookup bean name in the configured Spring container.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testing-tx"></a>8.3.3.&nbsp;Transaction management</h3></div></div></div><p>One common issue in tests that access a real database is their
			affect on the state of the persistence store. Even when you're using
			a development database, changes to the state may affect future tests.
			Also, many operations - such as inserting to or modifying
			persistent data - cannot be done (or verified) outside a transaction.</p><p>The
			<code class="classname">org.springframework.test.AbstractTransactionalDataSourceSpringContextTests</code>
			superclass (and subclasses) exist to meet this need. By default, they
			create and roll back a transaction for each test. You simply write
			code that can assume the existence of a transaction. If you call
			transactionally proxied objects in your tests, they will behave
			correctly, according to their transactional semantics. </p><p> <code class="classname">AbstractTransactionalSpringContextTests</code>
			depends on a <code class="classname">PlatformTransactionManager</code> bean being
			defined in the application context. The name doesn't matter, due to the
			use of autowire by type.</p><p>Typically you will extend the subclass,
			<code class="classname">AbstractTransactionalDataSourceSpringContextTests</code>.
			This also requires that a <code class="classname">DataSource</code> bean
			definition - again, with any name - be present in the configurations. It
			creates a <code class="classname">JdbcTemplate</code> instance variable that is
			useful for convenient querying, and provides handy methods to delete the
			contents of selected tables (remember that the transaction will roll
			back by default, so this is safe to do).</p><p>If you want a transaction to commit - unusual, but occasionally
			useful when you want a particular test to populate the database - you can
			call the <code class="methodname">setComplete()</code> method inherited from
			<code class="classname">AbstractTransactionalSpringContextTests</code>. This will
			cause the transaction to commit instead of roll back.</p><p>There is also convenient ability to end a transaction before the
			test case ends, through calling the <code class="methodname">endTransaction()</code> method.
			This will roll back the transaction by default, and commit it only if
			<code class="methodname">setComplete()</code> had previously been called. This
			functionality is useful if you want to test the behavior of
			'disconnected' data objects, such as Hibernate-mapped objects
			that will be used in a web or remoting tier outside a transaction.
			Often, lazy loading errors are discovered only through UI testing; if
			you call <code class="methodname">endTransaction()</code> you can ensure correct
			operation of the UI through your JUnit test suite.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testing-superclasses"></a>8.3.4.&nbsp;Convenience variables</h3></div></div></div><p>When you extend the
			<code class="classname">AbstractTransactionalDataSourceSpringContextTests</code>
			class you will have access to the following <code class="literal">protected</code>
			instance variables:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">applicationContext</code>
					(a <code class="interfacename">ConfigurableApplicationContext</code>):
					inherited from the
					<code class="classname">AbstractDependencyInjectionSpringContextTests</code>
					superclass. Use this to perfom explicit bean lookup, or test the
					state of the context as a whole.</p></li><li><p><code class="literal">jdbcTemplate</code>: inherited from
					<code class="classname">AbstractTransactionalDataSourceSpringContextTests</code>.
					Useful for querying to confirm state. For example, you might query
					before and after testing application code that creates an object and
					persists it using an ORM tool, to verify that the data appears in
					the database. (Spring will ensure that the query runs in the scope
					of the same transaction.) You will need to tell your ORM tool to
					'flush' its changes for this to work correctly, for example
					using the <code class="methodname">flush()</code> method on Hibernate's
					<code class="classname">Session</code> interface.</p></li></ul></div><p>Often you will provide an application-wide superclass for
			integration tests that provides further useful instance variables
			used in many tests.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testing-java5-support"></a>8.3.5.&nbsp;Java 5+ specific support</h3></div></div></div><p>If you are developing against Java 5 or greater, there are
			some additional annotations and support classes that you can use
			in your testing. The <code class="classname">AbstractAnnotationAwareTransactionalTests</code>
			class extends the <code class="classname">AbstractTransactionalDataSourceSpringContextTests</code>
			makes the text fixtures that you write that inherit from it aware of a number
			of (Spring-specific) annotations.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="testing-java5-support-annotations"></a>8.3.5.1.&nbsp;Annotations</h4></div></div></div><p>The Spring Framework provides a number of annotations to
				help when writing integration tests. Please note that these annotations
				<span class="emphasis"><em>must</em></span> be used in conjunction with the
				aforementioned
				<code class="classname">AbstractAnnotationAwareTransactionalTests</code> in
				order for the presence of these annotations to have any effect.</p><div class="itemizedlist"><ul type="disc"><li><p><code class="interfacename">@DirtiesContext</code>.</p><p>The presence
						of this annotation on a text method indicates that the
						underlying Spring container is 'dirtied' during the execution of
					    of the test method, and thus must be rebuilt after the test
						method finishes execution (regardless of whether the test
						passed or not). Has the same effect as a regular
						<code class="methodname">setDirty()</code> invocation.</p><pre class="programlisting">@DirtiesContext
public void testProcess() {
	<em class="lineannotation"><span class="lineannotation">// some logic that results in the Spring container being dirtied</span></em>
}</pre></li><li><p><code class="interfacename">@ExpectedException</code>.</p><p>Indicates that the annotated test method is expected to throw
						an exception during execution. The type of the expected
						exception is provided in the annotation, and if an an instance
						of the exception is thrown during the test method execution then
						the test passes. Likewise if an instance
						of the exception is <span class="emphasis"><em>not</em></span> thrown during the
						test method execution then the test fails.</p><pre class="programlisting">@ExpectedException(SomeBusinessException.class)
public void testProcessRainyDayScenario() {
	<em class="lineannotation"><span class="lineannotation">// some logic that results in an <code class="classname">Exception</code> being thrown</span></em>
}</pre></li><li><p><code class="interfacename">@NotTransactional</code>.</p><p>Simply indicates that the annotated test method must
						<span class="emphasis"><em>not</em></span> execute in a transactional context.</p><pre class="programlisting">@NotTransactional
public void testProcess() {
	<em class="lineannotation"><span class="lineannotation">// ...</span></em>
}</pre></li><li><p><code class="interfacename">@Repeat</code></p><p>Indicates that the annotated test method must be
						executed repeatedly. The number of times that the test
						method is to be executed is specified in the annotation.</p><pre class="programlisting">@Repeat(10)
public void testProcessRepeatedly() {
	<em class="lineannotation"><span class="lineannotation">// ...</span></em>
}</pre></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testing-examples-petclinic"></a>8.3.6.&nbsp;PetClinic example</h3></div></div></div><p>The PetClinic sample application included with the Spring
			distribution illustrates the use of these test superclasses. Most
			test functionality is included in the
			<code class="classname">AbstractClinicTests</code>,	for which a partial
			listing is shown below:</p><pre class="programlisting">public abstract class AbstractClinicTests
               extends AbstractTransactionalDataSourceSpringContextTests {

   protected Clinic clinic;

   public void setClinic(Clinic clinic) {
      this.clinic = clinic;
   }

   public void testGetVets() {
      Collection vets = this.clinic.getVets();
      assertEquals('JDBC query must show the same number of vets',
         jdbcTemplate.queryForInt('SELECT COUNT(0) FROM VETS'), 
         vets.size());
      Vet v1 = (Vet) EntityUtils.getById(vets, Vet.class, 2);
      assertEquals('Leary', v1.getLastName());
      assertEquals(1, v1.getNrOfSpecialties());
      assertEquals('radiology', ((Specialty) v1.getSpecialties().get(0)).getName());
      Vet v2 = (Vet) EntityUtils.getById(vets, Vet.class, 3);
      assertEquals('Douglas', v2.getLastName());
      assertEquals(2, v2.getNrOfSpecialties());
      assertEquals('dentistry', ((Specialty) v2.getSpecialties().get(0)).getName());
      assertEquals('surgery', ((Specialty) v2.getSpecialties().get(1)).getName());
}</pre><p>Notes:</p><div class="itemizedlist"><ul type="disc"><li><p>This test case extends the
					<code class="classname">AbstractTransactionalDataSourceSpringContextTests</code>
					class, from which it inherits Dependency Injection and transactional
					behavior.</p></li><li><p>The <code class="literal">clinic</code> instance variable - the application object
					being tested - is set by Dependency Injection through the
					<code class="methodname">setClinic(..)</code> method.</p></li><li><p>The <code class="methodname">testGetVets()</code> method illustrates how the
					inherited <code class="literal">JdbcTemplate</code> variable can be used to verify
					correct behavior of the application code being tested. This allows
					for stronger tests, and lessens dependency on the exact test data.
					For example, you can add additional rows in the database without
					breaking tests. </p></li><li><p>Like many integration tests using a database, most of the
					tests in <code class="classname">AbstractClinicTests</code> depend on a minimum
					amount of data already in the database before the test cases run.
					You might, however, choose to populate the database in your test
					cases also - again, within the one transaction.</p></li></ul></div><p>The PetClinic application supports four data access
			technologies - JDBC, Hibernate, TopLink, and JPA. Thus the
			<code class="classname">AbstractClinicTests</code> class does not itself specify the
			context locations - this is deferred to subclasses,
			that implement the necessary protected abstract method from
			<code class="classname">AbstractDependencyInjectionSpringContextTests</code>.</p><p>For example, the Hibernate implementation of the PetClinic tests
			contains the following implementation:</p><pre class="programlisting">public final class HibernateClinicTests extends AbstractClinicTests {

   protected String[] getConfigLocations() {
      return new String[] { 
         "/org/springframework/samples/petclinic/hibernate/applicationContext-hibernate.xml" 
      };
   }
}</pre><p>As the PetClinic is a very simple application, there is only one
			Spring configuration file. Of course, more complex applications will
			typically break their Spring configuration across multiple files.
			Instead of being defined in a leaf class, config locations will
			often be specified in a common base class for all application-specific
			integration tests. This may also add useful instance
			variables - populated by Dependency Injection, naturally - such as a
			<code class="classname">HibernateTemplate</code>, in the case of an application
			using Hibernate.</p><p>As far as possible, you should have exactly the same Spring
			configuration files in your integration tests as in the deployed
			environment. One likely point of difference concerns database connection
			pooling and transaction infrastructure. If you are deploying to a
			full-blown application server, you will probably use its connection pool
			(available through JNDI) and JTA implementation. Thus in production you
			will use a <code class="classname">JndiObjectFactoryBean</code> for the
			<code class="classname">DataSource</code>, and <code class="classname">JtaTransactionManager</code>.
			JNDI and JTA will not be available in out-of-container integration
			tests, so you should use a combination like the Commons DBCP
			<code class="classname">BasicDataSource</code> and <code class="classname">DataSourceTransactionManager</code>
			or <code class="classname">HibernateTransactionManager</code> for them. You can
			factor out this variant behavior into a single XML file, having the
			choice between application server and 'local' configuration
			separated from all other configuration, which will not vary between the
			test and production environments.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing-resources"></a>8.4.&nbsp;Further Resources</h2></div></div></div><p>This section contains links to further resources about testing in general.</p><div class="itemizedlist"><ul type="disc"><li><p>The <a href="http://www.junit.org/index.htm" target="_top">JUnit homepage</a>.
				The Spring Framework's unit test suite is written using JUnit as the testing
				framework.</p></li><li><p>The <a href="http://www.easymock.org/" target="_top">EasyMock homepage</a>.
				The Spring Framework uses EasyMock extensively in it's test suite.</p></li><li><p>The <a href="http://www.jmock.org/" target="_top">JMock homepage</a>.</p></li><li><p>The <a href="http://dbunit.sourceforge.net/" target="_top">DbUnit homepage</a>.</p></li><li><p>The <a href="http://grinder.sourceforge.net/" target="_top">Grinder homepage</a> (load testing framework).</p></li></ul></div></div></div></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="spring-middle-tier"></a>Part&nbsp;II.&nbsp;Middle Tier Data Access</h1></div></div></div><div class="partintro" lang="en"><div></div><p>
				This part of the reference documentation is concerned
				with the middle tier, and specifically the data access
				responsibilities of said tier.
			</p><p>
				Spring's comprehensive transaction management support is
				covered in some detail, followed by thorough coverage of
				the various middle tier data access frameworks and
				technologies that the Spring Framework integrates with.
			</p><div class="itemizedlist"><ul type="disc"><li><a href="#transaction" title="Chapter&nbsp;9.&nbsp;Transaction management">Chapter&nbsp;9, <i>Transaction management</i></a></li><li><a href="#dao" title="Chapter&nbsp;10.&nbsp;DAO support">Chapter&nbsp;10, <i>DAO support</i></a></li><li><a href="#jdbc" title="Chapter&nbsp;11.&nbsp;Data access using JDBC">Chapter&nbsp;11, <i>Data access using JDBC</i></a></li><li><a href="#orm" title="Chapter&nbsp;12.&nbsp;Object Relational Mapping (ORM) data access">Chapter&nbsp;12, <i>Object Relational Mapping (ORM) data access</i></a></li></ul></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="transaction"></a>Chapter&nbsp;9.&nbsp;Transaction management</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-intro"></a>9.1.&nbsp;Introduction</h2></div></div></div><p>One of the most compelling reasons to use the Spring Framework is the
        comprehensive transaction support. The Spring Framework provides a consistent
        abstraction for transaction management that delivers the following benefits:</p><div class="itemizedlist"><ul type="disc"><li><p>Provides a consistent programming model across different
                transaction APIs such as JTA, JDBC, Hibernate, JPA, and JDO.</p></li><li><p>Supports <a href="#transaction-declarative" title="9.5.&nbsp;Declarative transaction management">declarative transaction management</a>.</p></li><li><p>Provides a simpler API for <a href="#transaction-programmatic" title="9.6.&nbsp;Programmatic transaction management">programmatic</a>
                transaction management than a number of complex transaction APIs such as JTA.</p></li><li><p>Integrates very well with Spring's various data access abstractions.</p></li></ul></div><p>This chapter is divided up into a number of sections, each detailing one of the
        value-adds or technologies of the Spring Framework's transaction support. The chapter
        closes up with some discussion of best practices surrounding transaction management
        (for example, choosing between declarative and programmatic transaction management).</p><div class="itemizedlist"><ul type="disc"><li><p>The first section, entitled
                <a href="#transaction-motivation" title="9.2.&nbsp;Motivations">Motivations</a>,
                describes <span class="emphasis"><em>why</em></span> one would want to use
                the Spring Framework's transaction abstraction as opposed to EJB CMT
                or driving transactions via a proprietary API such
                as Hibernate.</p></li><li><p>The second section, entitled
                <a href="#transaction-strategies" title="9.3.&nbsp;Key abstractions">Key abstractions</a>
                outlines the core classes in the Spring Framework's transaction support,
                as well as how to configure and obtain <code class="interfacename">DataSource</code>
                instances from a variety of sources.</p></li><li><p>The third section, entitled
                <a href="#transaction-declarative" title="9.5.&nbsp;Declarative transaction management">Declarative transaction management</a>,
                covers the Spring Framework's support for declarative transaction management.</p></li><li><p>The fourth section, entitled
                <a href="#transaction-programmatic" title="9.6.&nbsp;Programmatic transaction management">Programmatic transaction management</a>,
                covers the Spring Framework's support for programmatic (that is, explicitly
                coded) transaction management.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-motivation"></a>9.2.&nbsp;Motivations</h2></div></div></div><div class="sidebar"><p class="title"><b>Is an application server needed for transaction management?</b></p><p>The Spring Framework's transaction management support significantly changes
            traditional thinking as to when a J2EE application requires an application
            server.</p><p>In particular, you don't need an application server just to have
            declarative transactions via EJB. In fact, even if you have an application
            server with powerful JTA capabilities, you may well decide that the Spring Framework's
            declarative transactions offer more power and a much more productive
            programming model than EJB CMT.</p><p>Typically you need an application server's JTA capability only if you need to
            enlist multiple transactional resources, and for many applications being able
            to handle transactions across multiple resources isn't a requirement. 
            For example, many high-end applications use a single, highly scalable 
            database (such as Oracle 9i RAC). Standalone transaction managers such as
            <a href="http://www.atomikos.com/" target="_top">Atomikos Transactions</a> and
            <a href="http://jotm.objectweb.org/" target="_top">JOTM</a> are other options. (Of course
            you may need other application server capabilities such as JMS and JCA.)</p><p>The most important point is that with the Spring Framework <span class="emphasis"><em>you can
            choose when to scale your application up to a full-blown application
            server</em></span>. Gone are the days when the only alternative to using
            EJB CMT or JTA was to write code using local transactions such as those
            on JDBC connections, and face a hefty rework if you ever needed that code
            to run within global, container-managed transactions. With the Spring Framework,
            only configuration needs to change so that your code doesn't have to.</p></div><p>Traditionally, J2EE developers have had two choices for transaction
        management: <span class="emphasis"><em>global</em></span> or <span class="emphasis"><em>local</em></span> transactions.
        Global transactions are managed by the application server, using the Java Transaction 
        API (JTA). Local transactions are resource-specific: the most common example would
        be a transaction associated with a JDBC connection. This choice has profound
        implications. For instance, global transactions provide the ability to work with multiple
        transactional resources (typically relational databases and message queues).
        With local transactions, the application server is not involved in
        transaction management and cannot help ensure correctness across multiple
        resources. (It is worth noting that most applications use a single transaction
        resource.)</p><p><b>Global Transactions.&nbsp;</b>Global transactions have a significant downside, in that code needs
            to use JTA, and JTA is a cumbersome API to use (partly due to its exception
            model). Furthermore, a JTA <code class="interfacename">UserTransaction</code>
            normally needs to be sourced from JNDI: meaning that we need to use
            <span class="emphasis"><em>both</em></span> JNDI <span class="emphasis"><em>and</em></span> JTA to use JTA.
            Obviously all use of global transactions limits the reusability of application
            code, as JTA is normally only available in an application server environment.  Previously, the preferred way to use global transactions was via EJB
            <span class="emphasis"><em>CMT</em></span> (<span class="emphasis"><em>Container Managed Transaction</em></span>):
            CMT is a form of <span class="bold"><strong>declarative transaction management</strong></span>
            (as distinguished from <span class="bold"><strong>programmatic transaction management</strong></span>).
            EJB CMT removes the need for transaction-related JNDI lookups - although of course
            the use of EJB itself necessitates the use of JNDI. It removes most of the need (although
            not entirely) to write Java code to control transactions. The significant
            downside is that CMT is tied to JTA and an application server
            environment. Also, it is only available if one chooses to implement
            business logic in EJBs, or at least behind a transactional EJB facade. The
            negatives around EJB in general are so great that this is not an
            attractive proposition, especially in the face of compelling alternatives for
            declarative transaction management.</p><p><b>Local Transactions.&nbsp;</b>Local transactions may be easier to use, but have significant
            disadvantages: they cannot work across multiple transactional resources.
	        For example, code that manages transactions using a JDBC connection cannot 
	        run within a global JTA transaction. Another downside is that local 
	        transactions tend to be invasive to the programming model.</p><p>Spring resolves these problems. It enables application developers to
        use a <span class="emphasis"><em>consistent</em></span> programming model <span class="emphasis"><em>in any
        environment</em></span>. You write your code once, and it can benefit from
        different transaction management strategies in different environments.
        The Spring Framework provides both declarative and programmatic transaction management.
        Declarative transaction management is preferred by most users, and is
        recommended in most cases.</p><p>With programmatic transaction management, developers work with the
        Spring Framework transaction abstraction, which can run over any underlying
        transaction infrastructure. With the preferred declarative model,
        developers typically write little or no code related to transaction
        management, and hence don't depend on the Spring Framework's transaction API
        (or indeed on any other transaction API).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-strategies"></a>9.3.&nbsp;Key abstractions</h2></div></div></div><p>The key to the Spring transaction abstraction is the notion of a
        <span class="emphasis"><em>transaction strategy</em></span>. A transaction strategy is
        defined by the
        <code class="interfacename">org.springframework.transaction.PlatformTransactionManager</code>
        interface, shown below:</p><pre class="programlisting">public interface PlatformTransactionManager {

    TransactionStatus getTransaction(TransactionDefinition definition)
        throws TransactionException;

    void commit(TransactionStatus status) throws TransactionException;

    void rollback(TransactionStatus status) throws TransactionException;
}</pre><p>This is primarily an SPI interface, although it can be used
        <a href="#transaction-programmatic-ptm" title="9.6.2.&nbsp;Using the PlatformTransactionManager">programmatically</a>.
        Note that in keeping with the Spring Framework's philosophy, 
        <code class="interfacename">PlatformTransactionManager</code> is
        an <span class="emphasis"><em>interface</em></span>, and can thus be easily mocked or stubbed
        as necessary. Nor is it tied to a lookup strategy such as JNDI:
        <code class="interfacename">PlatformTransactionManager</code> implementations
        are defined like any other object (or bean) in the Spring Framework's IoC container.
        This benefit alone makes it a worthwhile abstraction even when working
        with JTA: transactional code can be tested much more easily than if it
        used JTA directly.</p><p>Again in keeping with Spring's philosophy, the <code class="exceptionname">TransactionException</code>
        that can be thrown by any of the <code class="interfacename">PlatformTransactionManager</code>
        interface's methods is <span class="emphasis"><em>unchecked</em></span> (i.e. it extends the
        <code class="exceptionname">java.lang.RuntimeException</code> class). Transaction infrastructure
        failures are almost invariably fatal. In rare cases where application code can actually
        recover from a transaction failure, the application developer can still choose to catch
        and handle <code class="exceptionname">TransactionException</code>. The salient point is
        that developers are not <span class="emphasis"><em>forced</em></span> to do so.</p><p>The <code class="methodname">getTransaction(..)</code> method returns a
        <code class="interfacename">TransactionStatus</code> object, depending on a
        <code class="interfacename">TransactionDefinition</code> parameter. The returned
        <code class="interfacename">TransactionStatus</code> might represent a new or
        existing transaction (if there were a matching transaction in the current
        call stack - with the implication being that (as with J2EE transaction contexts)
        a <code class="interfacename">TransactionStatus</code> is associated with a
        <span class="bold"><strong>thread</strong></span> of execution).</p><p>The <code class="interfacename">TransactionDefinition</code> interface specifies:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>Isolation</strong></span>: the
                degree of isolation this transaction has from the work of other
                transactions. For example, can this transaction see uncommitted
                writes from other transactions?</p></li><li><p><span class="bold"><strong>Propagation</strong></span>:
                normally all code executed within a transaction scope will run in that
                transaction. However, there are several options specifying behavior if
                a transactional method is executed when a transaction context already
                exists: for example, simply continue running in the existing transaction
                (the common case); or suspending the existing transaction and creating
                a new transaction. <span class="emphasis"><em>Spring offers all of the transaction propagation
                options familiar from EJB CMT</em></span>.</p></li><li><p><span class="bold"><strong>Timeout</strong></span>: how long
                this transaction may run before timing out (and automatically being
                rolled back by the underlying transaction infrastructure).</p></li><li><p><span class="bold"><strong>Read-only status</strong></span>: a read-only
                transaction does not modify any data. Read-only transactions can be a
                useful optimization in some cases (such as when using Hibernate).</p></li></ul></div><p>These settings reflect standard transactional concepts. If necessary,
        please refer to a resource discussing transaction isolation levels and other
        core transaction concepts because understanding such core concepts is essential
        to using the Spring Framework or indeed any other transaction management solution.</p><p>The <code class="interfacename">TransactionStatus</code> interface provides a simple
        way for transactional code to control transaction execution and query
        transaction status. The concepts should be familiar, as they are common to
        all transaction APIs:</p><pre class="programlisting">public interface TransactionStatus {

    boolean isNewTransaction();

    void setRollbackOnly();

    boolean isRollbackOnly();
}</pre><p>Regardless of whether you opt for declarative or programmatic transaction
        management in Spring, defining the correct
        <code class="interfacename">PlatformTransactionManager</code> implementation is
        absolutely essential. In good Spring fashion, this important definition typically
        is made using via Dependency Injection.</p><p><code class="interfacename">PlatformTransactionManager</code> implementations
        normally require knowledge of the environment in which they work: JDBC, JTA,
        Hibernate, etc The following examples from the
        <code class="literal">dataAccessContext-local.xml</code> file from Spring's 
        <span class="bold"><strong>jPetStore</strong></span> sample application show how a local
        <code class="interfacename">PlatformTransactionManager</code> implementation can be
        defined. (This will work with plain JDBC.)</p><p>We must define a JDBC <code class="interfacename">DataSource</code>, and
        then use the Spring <code class="classname">DataSourceTransactionManager</code>, giving
        it a reference to the <code class="interfacename">DataSource</code>.</p><pre class="programlisting">&lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
  &lt;property name="driverClassName" value="${jdbc.driverClassName}" /&gt;
  &lt;property name="url" value="${jdbc.url}" /&gt;
  &lt;property name="username" value="${jdbc.username}" /&gt;
  &lt;property name="password" value="${jdbc.password}" /&gt;
&lt;/bean&gt;</pre><p>The related <code class="interfacename">PlatformTransactionManager</code> bean
        definition will look like this:</p><pre class="programlisting">&lt;bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
  &lt;property name="dataSource" ref="dataSource"/&gt;
&lt;/bean&gt;</pre><p>If we use JTA in a J2EE container, as in the <code class="filename">'dataAccessContext-jta.xml'</code>
        file from the same sample application, we use a container <code class="interfacename">DataSource</code>,
        obtained via JNDI, in conjunction with Spring's <code class="classname">JtaTransactionManager</code>.
        The <code class="classname">JtaTransactionManager</code> doesn't need to know about the
        <code class="interfacename">DataSource</code>, or any other specific resources, as
        it will use the container's global transaction management infrastructure.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jee="http://www.springframework.org/schema/jee"
xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-2.0.xsd"&gt;

  &lt;jee:jndi-lookup id="dataSource" jndi-name="jdbc/jpetstore"/&gt; 

  &lt;bean id="txManager" class="org.springframework.transaction.jta.JtaTransactionManager" /&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- other <code class="literal">&lt;bean/&gt;</code> definitions here --&gt;</span></em>

&lt;/beans&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The above definition of the <code class="literal">'dataSource'</code> bean uses the
            <code class="literal">&lt;jndi-lookup/&gt;</code> tag from the <code class="literal">'jee'</code>
            namespace. For more information on schema-based configuration, see <a href="#xsd-config" title="Appendix&nbsp;A.&nbsp;XML Schema-based configuration">Appendix&nbsp;A, <i>XML Schema-based configuration</i></a>,
            and for more information on the <code class="literal">&lt;jee/&gt;</code> tags
            see the section entitled <a href="#xsd-config-body-schemas-jee" title="A.2.3.&nbsp;The jee schema">Section&nbsp;A.2.3, &#8220;The <code class="literal">jee</code> schema&#8221;</a>.</p></td></tr></table></div><p>We can also use Hibernate local transactions easily, as shown in the
        following examples from the Spring Framework's  <span class="bold"><strong>PetClinic</strong></span>
        sample application. In this case, we need to define a Hibernate
        <code class="classname">LocalSessionFactoryBean</code>, which application code will
        use to obtain Hibernate <code class="interfacename">Session</code> instances.</p><p>The <code class="interfacename">DataSource</code> bean definition will be
        similar to the one shown previously (and thus is not shown). If the
        <code class="interfacename">DataSource</code> is managed by the JEE container it should
        be non-transactional as the Spring Framework, rather than the JEE container, will
        manage transactions.</p><p>The <code class="literal">'txManager'</code> bean in this case is of the
        <code class="classname">HibernateTransactionManager</code> type. In the same way as the
        <code class="classname">DataSourceTransactionManager</code> needs a reference to the
        <code class="interfacename">DataSource</code>, the
        <code class="classname">HibernateTransactionManager</code> needs a reference to the
        <code class="interfacename">SessionFactory</code>.</p><pre class="programlisting">&lt;bean id="sessionFactory" class="org.springframework.orm.hibernate.LocalSessionFactoryBean"&gt;
  &lt;property name="dataSource" ref="dataSource" /&gt;
  &lt;property name="mappingResources"&gt;
    &lt;list&gt;
      &lt;value&gt;org/springframework/samples/petclinic/hibernate/petclinic.hbm.xml&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
  &lt;property name="hibernateProperties"&gt;
    &lt;value&gt;
	  hibernate.dialect=${hibernate.dialect}
	&lt;/value&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="txManager" class="org.springframework.orm.hibernate.HibernateTransactionManager"&gt;
  &lt;property name="sessionFactory" ref="sessionFactory" /&gt;
&lt;/bean&gt;</pre><p>With Hibernate and JTA transactions, we can simply use the
        <code class="classname">JtaTransactionManager</code> as with JDBC or any other resource strategy.</p><pre class="programlisting">&lt;bean id="txManager" class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;</pre><p>Note that this is identical to JTA configuration for any resource,
        as these are global transactions, which can enlist any transactional
        resource.</p><p class="remark"><i><span class="remark">
            <p>In all these cases, application code will not need to change at
            all. We can change how transactions are managed merely by changing
            configuration, even if that change means moving from local to global
            transactions or vice versa.</p>
        </span></i></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tx-resource-synchronization"></a>9.4.&nbsp;Resource synchronization with transactions</h2></div></div></div><p>It should now be clear how different transaction managers are
        created, and how they are linked to related resources which need to be
        synchronized to transactions (i.e. <code class="classname">DataSourceTransactionManager</code>
        to a JDBC <code class="interfacename">DataSource</code>,
        <code class="classname">HibernateTransactionManager</code> to a Hibernate
        <code class="interfacename">SessionFactory</code>, etc). There remains the question
        however of how the application code, directly or indirectly using a
        persistence API (JDBC, Hibernate, JDO, etc), ensures that these resources
        are obtained and handled properly in terms of proper
        creation/reuse/cleanup and trigger (optionally) transaction
        synchronization via the relevant <code class="interfacename">PlatformTransactionManager</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-high"></a>9.4.1.&nbsp;High-level approach</h3></div></div></div><p>The preferred approach is to use Spring's highest level
            persistence integration APIs. These do not replace the native APIs, but
            internally handle resource creation/reuse, cleanup, optional
            transaction synchronization of the resources and exception mapping so
            that user data access code doesn't have to worry about these concerns at
            all, but can concentrate purely on non-boilerplate persistence logic.
            Generally, the same <span class="emphasis"><em>template</em></span> approach is used
            for all persistence APIs, with examples including the
            <code class="classname">JdbcTemplate</code>, <code class="classname">HibernateTemplate</code>,
            and <code class="classname">JdoTemplate</code> classes (detailed in subsequent chapters
            of this reference documentation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-low"></a>9.4.2.&nbsp;Low-level approach</h3></div></div></div><p>At a lower level exist classes such as
            <code class="classname">DataSourceUtils</code> (for JDBC),
            <code class="classname">SessionFactoryUtils</code> (for Hibernate),
            <code class="classname">PersistenceManagerFactoryUtils</code> (for JDO), and so on.
            When it is preferable for application code to deal directly with the
            resource types of the native persistence APIs, these classes ensure that
            proper Spring Framework-managed instances are obtained, transactions are
            (optionally) synchronized, and exceptions which happen in the process
            are properly mapped to a consistent API.</p><p>For example, in the case of JDBC, instead of the traditional JDBC approach of
            calling the <code class="literal">getConnection()</code> method on the
            <code class="interfacename">DataSource</code>, you would instead use Spring's
            <code class="classname">org.springframework.jdbc.datasource.DataSourceUtils</code>
            class as follows:</p><pre class="programlisting">Connection conn = DataSourceUtils.getConnection(dataSource);</pre><p>If an existing transaction exists, and already has a connection
            synchronized (linked) to it, that instance will be returned. Otherwise,
            the method call will trigger the creation of a new connection, which
            will be (optionally) synchronized to any existing transaction, and
            made available for subsequent reuse in that same transaction. As mentioned,
            this has the added advantage that any <code class="exceptionname">SQLException</code>
            will be wrapped in a Spring Framework
            <code class="exceptionname">CannotGetJdbcConnectionException</code> - one of the Spring
            Framework's hierarchy of unchecked DataAccessExceptions. This gives you more
            information than can easily be obtained from the
            <code class="exceptionname">SQLException</code>, and ensures portability across
            databases: even across different persistence technologies.</p><p>It should be noted that this will also work fine without Spring
            transaction management (transaction synchronization is optional), so you
            can use it whether or not you are using Spring for transaction
            management.</p><p>Of course, once you've used Spring's JDBC support or Hibernate
            support, you will generally prefer not to use
            <code class="classname">DataSourceUtils</code> or the other helper classes, because
            you'll be much happier working via the Spring abstraction than directly
            with the relevant APIs. For example, if you use the Spring
            <code class="classname">JdbcTemplate</code> or <code class="literal">jdbc.object</code>
            package to simplify your use of JDBC, correct connection retrieval happens
            behind the scenes and you won't need to write any special code.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-tadsp"></a>9.4.3.&nbsp;<code class="classname">TransactionAwareDataSourceProxy</code></h3></div></div></div><p>At the very lowest level exists the
            <code class="classname">TransactionAwareDataSourceProxy</code> class. This is a
            proxy for a target <code class="interfacename">DataSource</code>, which wraps the
            target <code class="interfacename">DataSource</code> to add awareness of Spring-managed
            transactions. In this respect, it is similar to a transactional JNDI
            <code class="interfacename">DataSource</code> as provided by a J2EE server.</p><p>It should almost never be necessary or desirable to use this
            class, except when existing code exists which must be called and passed
            a standard JDBC <code class="interfacename">DataSource</code> interface implementation.
            In that case, it's possible to still have this code be usable, but
            participating in Spring managed transactions. It is preferable to write
            your new code using the higher level abstractions mentioned
            above.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-declarative"></a>9.5.&nbsp;Declarative transaction management</h2></div></div></div><p class="remark"><i><span class="remark">Most users of the Spring Framework choose declarative transaction management.
		It is the option with the least impact on application code, and hence is most
        consistent with the ideals of a <span class="emphasis"><em>non-invasive</em></span>
        lightweight container.</span></i></p><p>The Spring Framework's declarative transaction management is made possible
		with Spring AOP, although, as the transactional aspects code comes with the
		Spring Framework distribution and may be used in a boilerplate fashion, AOP concepts
		do not generally have to be understood to make effective use of this code.</p><p>It may be helpful to begin by considering EJB CMT and explaining the
        similarities and differences with the Spring Framework's declarative transaction
        management. The basic approach is similar: it is possible to specify
        transaction behavior (or lack of it) down to individual method level. It is
        possible to make a <code class="methodname">setRollbackOnly()</code> call within a
        transaction context if necessary. The differences are:</p><div class="itemizedlist"><ul type="disc"><li><p>Unlike EJB CMT, which is tied to JTA, the Spring Framework's
				declarative transaction management works in any environment. It can
				work with JDBC, JDO, Hibernate or other transactions under the covers,
				with configuration changes only.</p></li><li><p>The Spring Framework enables declarative transaction management
				to be applied to any class, not merely special classes such as EJBs.</p></li><li><p>The Spring Framework offers declarative <span class="emphasis"><em>rollback rules</em></span>:
				a feature with no EJB equivalent, which we'll discuss below. Rollback
                can be controlled declaratively, not merely programmatically.</p></li><li><p>The Spring Framework gives you an opportunity to customize transactional
                behavior, using AOP. For example, if you want to insert custom
                behavior in the case of transaction rollback, you can. You can also
                add arbitrary advice, along with the transactional advice. With EJB
                CMT, you have no way to influence the container's transaction
                management other than <code class="methodname">setRollbackOnly()</code>.</p></li><li><p>The Spring Framework does not support propagation of transaction contexts
                across remote calls, as do high-end application servers. If you need
                this feature, we recommend that you use EJB. However, consider carefully before
                using such a feature. Normally, we do not want transactions to span remote
                calls.</p></li></ul></div><div class="sidebar"><p class="title"><b>Where is <code class="classname">TransactionProxyFactoryBean</code>?</b></p><p>Declarative transaction configuration in versions of Spring 2.0 and above
            differs considerably from previous versions of Spring. The main difference is
            that there is no longer any need to configure
            <code class="classname">TransactionProxyFactoryBean</code> beans.</p><p>The old, pre-Spring 2.0 configuration style is still 100% 
            valid configuration; under the covers think of the new <code class="literal">&lt;tx:tags/&gt;</code>
            as simply defining <code class="classname">TransactionProxyFactoryBean</code> beans
            on your behalf.</p></div><p>The concept of rollback rules is important: they enable us to
        specify which exceptions (and throwables) should cause automatic roll
        back. We specify this declaratively, in configuration, not in Java code.
        So, while we can still call <code class="methodname">setRollbackOnly()</code>on the
        <code class="interfacename">TransactionStatus</code> object to roll the current
        transaction back programmatically, most often we can specify a rule that
        <code class="exceptionname">MyApplicationException</code> must always result in
        rollback. This has the significant advantage that business objects don't need
        to depend on the transaction infrastructure. For example, they typically
        don't need to import any Spring APIs, transaction or other.</p><p>While the EJB default behavior is for the EJB container to
        automatically roll back the transaction on a <span class="emphasis"><em>system
        exception</em></span> (usually a runtime exception), EJB CMT does not roll
        back the transaction automatically on an <span class="emphasis"><em>application exception</em></span>
        (i.e. a checked exception other than <code class="exceptionname">java.rmi.RemoteException</code>).
        While the Spring default behavior for declarative transaction management follows
        EJB convention (roll back is automatic only on unchecked exceptions), it is often
		useful to customize this.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-decl-explained"></a>9.5.1.&nbsp;Understanding the Spring Framework's declarative transaction implementation</h3></div></div></div><p>The aim of this section is to dispel the mystique that is sometimes associated
			with the use of declarative transactions. It is all very well for this reference
			documentation simply to tell you to annotate your classes with the
			<code class="interfacename">@Transactional</code> annotation, add the line
			(<code class="literal">'&lt;tx:annotation-driven/&gt;'</code>) to your configuration,
            and then expect you to understand how it all works. This section will explain the
			inner workings of the Spring Framework's declarative transaction infrastructure to
			help you navigate your way back upstream to calmer waters in the event of
			transaction-related issues.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Looking at the Spring Framework source code is a good way to get a real
				understanding of the transaction support. We also suggest turning the logging
				level to <code class="literal">'DEBUG'</code> during development to better see what goes
				on under the hood.</p></td></tr></table></div><p>The most important concepts to grasp with regard to the Spring Framework's
			declarative transaction support are that this support is enabled
            <a href="#aop-understanding-aop-proxies" title="6.6.1.&nbsp;Understanding AOP proxies"><span class="emphasis"><em>via AOP proxies</em></span></a>,
            and that the transactional advice is driven by <span class="emphasis"><em>metadata</em></span> (currently
            XML- or annotation-based). The combination of AOP with transactional metadata yields
            an AOP proxy that uses a <code class="classname">TransactionInterceptor</code> in conjunction
            with an appropriate <code class="classname">PlatformTransactionManager</code> implementation
            to drive transactions <span class="emphasis"><em>around method invocations</em></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Although knowledge of Spring AOP is not required to use Spring's declarative
                transaction support, it can help. Spring AOP is thoroughly covered in the chapter
                entitled <a href="#aop" title="Chapter&nbsp;6.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;6, <i>Aspect Oriented Programming with Spring</i></a>.</p></td></tr></table></div><p>Conceptually, calling a method on a transactional proxy looks like this...</p><p>
			    </p><div class="mediaobject" align="center"><img src="images/tx.png" align="middle"></div><p>
		    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-first-example"></a>9.5.2.&nbsp;A first example</h3></div></div></div><p>Consider the following interface, and its attendant implementation.
            (The intent is to convey the concepts, and using the rote <code class="classname">Foo</code> and
            <code class="classname">Bar</code> tropes means that you can concentrate on the transaction
            usage and not have to worry about the domain model.)</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// the service interface that we want to make transactional</span></em>
            
package x.y.service;
            
public interface FooService {

    Foo getFoo(String fooName);

    Foo getFoo(String fooName, String barName);

    void insertFoo(Foo foo);

    void updateFoo(Foo foo);

}</pre><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// an implementation of the above interface</span></em>
            
package x.y.service;

public class DefaultFooService implements FooService {

    public Foo getFoo(String fooName) {
        throw new UnsupportedOperationException();
    }

    public Foo getFoo(String fooName, String barName) {
        throw new UnsupportedOperationException();
    }

    public void insertFoo(Foo foo) {
        throw new UnsupportedOperationException();
    }

    public void updateFoo(Foo foo) {
        throw new UnsupportedOperationException();
    }

}</pre><p><span class="emphasis"><em>(For the purposes of this example, the fact that the
            <code class="classname">DefaultFooService</code> class throws
            <code class="exceptionname">UnsupportedOperationException</code> instances in the body
            of each implemented method is good; it will allow us to see transactions being created
            and then rolled back in response to the <code class="exceptionname">UnsupportedOperationException</code>
            instance being thrown.)</em></span></p><p>Let's assume that the first two methods of the <code class="interfacename">FooService</code>
            interface (<code class="literal">getFoo(String)</code> and <code class="literal">getFoo(String, String)</code>)
            have to execute in the context of a transaction with read-only semantics, and that
            the other methods (<code class="literal">insertFoo(Foo)</code> and
            <code class="literal">updateFoo(Foo)</code>) have to execute in the context of a transaction
			with read-write semantics. Don't worry about taking the following configuration in
			all at once; everything will be explained in detail in the next few paragraphs.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- from the file <code class="literal">'context.xml'</code> --&gt;</span></em>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>xmlns:tx="http://www.springframework.org/schema/tx"</strong></span></span></em>
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd</strong></span></span></em>
       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- this is the service object that we want to make transactional --&gt;</span></em>
  &lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!-- the transactional advice (i.e. what 'happens'; see the <code class="literal">&lt;aop:advisor/&gt;</code> bean below) --&gt;</span></em>
  &lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- the transactional semantics... --&gt;</span></em>
    &lt;tx:attributes&gt;
      <em class="lineannotation"><span class="lineannotation">&lt;!-- all methods starting with <code class="literal">'get'</code> are read-only --&gt;</span></em>
      &lt;tx:method name="get*" read-only="true"/&gt;
      <em class="lineannotation"><span class="lineannotation">&lt;!-- other methods use the default transaction settings (see below) --&gt;</span></em>
      &lt;tx:method name="*"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- ensure that the above transactional advice runs for any execution
      of an operation defined by the <code class="interfacename">FooService</code> interface --&gt;</span></em>
  &lt;aop:config&gt;
    &lt;aop:pointcut id="fooServiceOperation" expression="execution(* x.y.service.FooService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="fooServiceOperation"/&gt;
  &lt;/aop:config&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- don't forget the <code class="interfacename">DataSource</code> --&gt;</span></em>
  &lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"/&gt;
    &lt;property name="url" value="jdbc:oracle:thin:@rj-t42:1521:elvis"/&gt;
    &lt;property name="username" value="scott"/&gt;
    &lt;property name="password" value="tiger"/&gt;
  &lt;/bean&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!-- similarly, don't forget the <code class="interfacename">PlatformTransactionManager</code> --&gt;</span></em>
  &lt;bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
    &lt;property name="dataSource" ref="dataSource"/&gt;
  &lt;/bean&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- other <code class="literal">&lt;bean/&gt;</code> definitions here --&gt;</span></em>

&lt;/beans&gt;</pre><p>Let's pick apart the above configuration. We have a service object
            (the <code class="literal">'fooService'</code> bean) that we want to make transactional.
            The transaction semantics that we want to apply are encapsulated in the
            <code class="literal">&lt;tx:advice/&gt;</code> definition. The
            <code class="literal">&lt;tx:advice/&gt;</code> definition reads as
            &#8220;<span class="quote"><span class="emphasis"><em>... all methods on starting with <code class="literal">'get'</code> are to execute
            in the context of a read-only transaction, and all other methods are to execute
            with the default transaction semantics</em></span></span>&#8221;. The
            <code class="literal">'transaction-manager'</code> attribute of the
            <code class="literal">&lt;tx:advice/&gt;</code> tag is set to the
            name of the <code class="interfacename">PlatformTransactionManager</code> bean
            that is going to actually <span class="emphasis"><em>drive</em></span> the transactions (in this
            case the <code class="literal">'txManager'</code> bean).</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You can actually omit the <code class="literal">'transaction-manager'</code>
                attribute in the transactional advice (<code class="literal">&lt;tx:advice/&gt;</code>) 
                if the bean name of the <code class="interfacename">PlatformTransactionManager</code>
                that you want to wire in has the name <code class="literal">'transactionManager'</code>.
                If the <code class="interfacename">PlatformTransactionManager</code> bean
                that you want to wire in has any other name, then you have to be explicit
                and use the <code class="literal">'transaction-manager'</code> attribute as in the example above.</p></td></tr></table></div><p>The <code class="literal">&lt;aop:config/&gt;</code> definition ensures that the transactional
            advice defined by the <code class="literal">'txAdvice'</code> bean actually executes at the appropriate
            points in the program. First we define a pointcut that matches the execution of any
            operation defined in the <code class="interfacename">FooService</code> interface
            (<code class="literal">'fooServiceOperation'</code>). Then we associate the pointcut with the
            <code class="literal">'txAdvice'</code> using an advisor. The result indicates that at the execution
            of a <code class="literal">'fooServiceOperation'</code>, the advice defined by <code class="literal">'txAdvice'</code>
            will be run.</p><p>The expression defined within the <code class="literal">&lt;aop:pointcut/&gt;</code>
            element is an AspectJ pointcut expression; see the chapter entitled <a href="#aop" title="Chapter&nbsp;6.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;6, <i>Aspect Oriented Programming with Spring</i></a>
            for more details on pointcut expressions in Spring 2.0.</p><p>A common requirement is to make an entire service layer transactional.
            The best way to do this is simply to change the pointcut expression to match
            any operation in your service layer. For example:</p><pre class="programlisting">&lt;aop:config&gt;
    &lt;aop:pointcut id="fooServiceMethods" expression="execution(* x.y.service.*.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="fooServiceMethods"/&gt;
  &lt;/aop:config&gt;</pre><p><span class="emphasis"><em>(This example assumes that all your service interfaces are defined
            in the <code class="literal">'x.y.service'</code> package; see the chapter entitled
            <a href="#aop" title="Chapter&nbsp;6.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;6, <i>Aspect Oriented Programming with Spring</i></a> for more details.)</em></span></p><p>Now that we've analyzed the configuration, you may be asking
            yourself, &#8220;<span class="quote"><span class="emphasis"><em>Okay... but what does all this configuration actually
            do?</em></span></span>&#8221;.</p><p>The above configuration is going to effect the creation of a
            transactional proxy around the object that is created from the
            <code class="literal">'fooService'</code> bean definition. The proxy will be configured
            with the transactional advice, so that when an appropriate method is invoked
            <span class="emphasis"><em>on the proxy</em></span>, a transaction <span class="emphasis"><em>may</em></span>
            be started, suspended, be marked as read-only, etc., depending on the
            transaction configuration associated with that method. Consider the following
			program that test drives the above configuration.</p><pre class="programlisting">public final class Boot {

    public static void main(final String[] args) throws Exception {
        ApplicationContext ctx = new ClassPathXmlApplicationContext("context.xml", Boot.class);
        FooService fooService = (FooService) ctx.getBean("fooService");
        fooService.insertFoo (new Foo());
    }
}</pre><p>The output from running the above program will look something
            like this. <span class="emphasis"><em>(Please note that the Log4J output and the stacktrace
            from the <code class="exceptionname">UnsupportedOperationException</code> thrown by the
            <code class="methodname">insertFoo(..)</code> method of the
            <code class="classname">DefaultFooService</code> class have been truncated in
            the interest of clarity.)</em></span></p><pre class="programlisting">    <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>&lt;!-- the Spring container is starting up... --&gt;</strong></span></span></em>
[AspectJInvocationContextExposingAdvisorAutoProxyCreator] - Creating implicit proxy
        for bean 'fooService' with 0 common interceptors and 1 specific interceptors
    <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>&lt;!-- the <code class="classname">DefaultFooService</code> is actually proxied --&gt;</strong></span></span></em>
[JdkDynamicAopProxy] - Creating JDK dynamic proxy for [x.y.service.DefaultFooService]

    <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>&lt;!-- ... the <code class="literal">insertFoo(..)</code> method is now being invoked on the proxy --&gt;</strong></span></span></em>

[TransactionInterceptor] - Getting transaction for x.y.service.FooService.insertFoo
    <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>&lt;!-- the transactional advice kicks in here... --&gt;</strong></span></span></em>
[DataSourceTransactionManager] - Creating new transaction with name [x.y.service.FooService.insertFoo]
[DataSourceTransactionManager] - Acquired Connection
        [org.apache.commons.dbcp.PoolableConnection@a53de4] for JDBC transaction

    <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>&lt;!-- the <code class="literal">insertFoo(..)</code> method from <code class="classname">DefaultFooService</code> throws an exception... --&gt;</strong></span></span></em>
[RuleBasedTransactionAttribute] - Applying rules to determine whether transaction should
        rollback on java.lang.UnsupportedOperationException
[TransactionInterceptor] - Invoking rollback for transaction on x.y.service.FooService.insertFoo
        due to throwable [java.lang.UnsupportedOperationException]

   <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>&lt;!-- and the transaction is rolled back (by default, <code class="exceptionname">RuntimeException</code> instances cause rollback) --&gt;</strong></span></span></em>
[DataSourceTransactionManager] - Rolling back JDBC transaction on Connection
        [org.apache.commons.dbcp.PoolableConnection@a53de4]
[DataSourceTransactionManager] - Releasing JDBC Connection after transaction
[DataSourceUtils] - Returning JDBC Connection to DataSource

Exception in thread "main" java.lang.UnsupportedOperationException
	at x.y.service.DefaultFooService.insertFoo(DefaultFooService.java:14)
   <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>&lt;!-- AOP infrastructure stack trace elements removed for clarity --&gt;</strong></span></span></em>
	at $Proxy0.insertFoo(Unknown Source)
	at Boot.main(Boot.java:11)</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-rolling-back"></a>9.5.3.&nbsp;Rolling back</h3></div></div></div><p>The previous section outlined the basics of how to specify the transactional
            settings for the classes, typically service layer classes, in your application in a
            declarative fashion. This section describes how you can control the rollback of
            transactions in a simple declarative fashion.</p><p>The recommended way to indicate to the Spring Framework's
            transaction infrastructure that a transaction's work is to be rolled back is to
            throw an <code class="exceptionname">Exception</code> from code that is currently
            executing in the context of a transaction. The Spring Framework's
            transaction infrastructure code will catch any unhandled
			<code class="exceptionname">Exception</code> as it bubbles up the call stack, and will
			mark the transaction for rollback.</p><p>However, please note that the Spring Framework's transaction infrastructure
			code will, by default, <span class="emphasis"><em>only</em></span> mark a transaction for rollback in
			the case of runtime, unchecked exceptions; that is, when the thrown exception is an
			instance or subclass of <code class="exceptionname">RuntimeException</code>.
			(<code class="literal">Errors</code> will also - by default - result in a rollback.) Checked
			exceptions that are thrown from a transactional method will
            <span class="emphasis"><em>not</em></span> result in the transaction being rolled back.</p><p>Exactly which <code class="exceptionname">Exception</code> types mark a transaction
			for rollback can be configured. Find below a snippet of XML configuration that
			demonstrates how one would configure rollback for a checked, application-specific
			<code class="exceptionname">Exception</code> type.</p><pre class="programlisting">&lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;
  &lt;tx:attributes&gt;
	 &lt;tx:method name="get*" read-only="false" <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>rollback-for="NoProductInStockException"</strong></span></span></em>/&gt;
	 &lt;tx:method name="*"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</pre><p>The second way to indicate to the transaction infrastructure that a
			rollback is required is to do so <span class="emphasis"><em>programmatically</em></span>.
            Although very simple, this way is quite invasive, and tightly couples your
			code to the Spring Framework's transaction infrastructure. Find below a
			snippet of code that does programmatic rollback of a
			Spring Framework-managed transaction:</p><pre class="programlisting">public void resolvePosition() {
    try {
        <em class="lineannotation"><span class="lineannotation">// some business logic...</span></em>
    } catch (NoProductInStockException ex) {
        <em class="lineannotation"><span class="lineannotation">// trigger rollback programmatically</span></em>
        TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
    }
}</pre><p>You are strongly encouraged to use the declarative approach to rollback if at
            all possible. Programmatic rollback is available should you need it, but its usage
			flies in the face of achieving a clean POJO-based application model.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-diff-tx"></a>9.5.4.&nbsp;Configuring different transactional semantics for different beans</h3></div></div></div><p>Consider the scenario where you have a number of service layer objects,
            and you want to apply <span class="emphasis"><em>totally different</em></span> transactional configuration
            to each of them. This is achieved by defining distinct <code class="literal">&lt;aop:advisor/&gt;</code>
            elements with differing <code class="literal">'pointcut'</code> and <code class="literal">'advice-ref'</code>
            attribute values.</p><p>Let's assume that all of your service layer classes are defined in a root
            <code class="literal">'x.y.service'</code> package. To make all beans that are instances of classes
            defined in that package (or in subpackages) and that have names ending in
            <code class="literal">'Service'</code> have the default transactional configuration, you would write
            the following:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:tx="http://www.springframework.org/schema/tx"
    xsi:schemaLocation="
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
    http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
    http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;

    &lt;aop:config&gt;

        &lt;aop:pointcut id="serviceOperation"
                    expression="<em class="lineannotation"><span class="lineannotation">execution(* x.y.service..*Service.*(..))</span></em>"/&gt;

        &lt;aop:advisor pointcut-ref="serviceOperation" advice-ref="txAdvice"/&gt;

    &lt;/aop:config&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- these two beans will be transactional... --&gt;</span></em>
    &lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;
    &lt;bean id="barService" class="x.y.service.extras.SimpleBarService"/&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- ... and these two beans won't --&gt;</span></em>
    &lt;bean id="anotherService" class="org.xyz.SomeService"/&gt; <em class="lineannotation"><span class="lineannotation">&lt;!-- (not in the right package) --&gt;</span></em>
    &lt;bean id="barManager" class="x.y.service.SimpleBarManager"/&gt; <em class="lineannotation"><span class="lineannotation">&lt;!-- (doesn't end in 'Service') --&gt;</span></em>

    &lt;tx:advice id="txAdvice"&gt;
        &lt;tx:attributes&gt;
            &lt;tx:method name="get*" read-only="true"/&gt;
            &lt;tx:method name="*"/&gt;
        &lt;/tx:attributes&gt;
    &lt;/tx:advice&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- other transaction infrastructure beans such as a <code class="interfacename">PlatformTransactionManager</code> omitted... --&gt;</span></em>

&lt;/beans&gt;</pre><p>Find below an example of configuring two distinct beans with totally different
        transactional settings.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:tx="http://www.springframework.org/schema/tx"
    xsi:schemaLocation="
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
    http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
    http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;

    &lt;aop:config&gt;

        &lt;aop:pointcut id="defaultServiceOperation"
                    expression="<em class="lineannotation"><span class="lineannotation">execution(* x.y.service.*Service.*(..))</span></em>"/&gt;

        &lt;aop:pointcut id="noTxServiceOperation"
                    expression="<em class="lineannotation"><span class="lineannotation">execution(* x.y.service.ddl.DefaultDdlManager.*(..))</span></em>"/&gt;

        &lt;aop:advisor pointcut-ref="defaultServiceOperation" advice-ref="defaultTxAdvice"/&gt;

        &lt;aop:advisor pointcut-ref="noTxServiceOperation" advice-ref="noTxAdvice"/&gt;

    &lt;/aop:config&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- this bean will be transactional (see the <code class="literal">'defaultServiceOperation'</code> pointcut) --&gt;</span></em>
    &lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- this bean will also be transactional, but with totally different transactional settings --&gt;</span></em>
    &lt;bean id="anotherFooService" class="x.y.service.ddl.DefaultDdlManager"/&gt;

    &lt;tx:advice id="defaultTxAdvice"&gt;
        &lt;tx:attributes&gt;
            &lt;tx:method name="get*" read-only="true"/&gt;
            &lt;tx:method name="*"/&gt;
        &lt;/tx:attributes&gt;
    &lt;/tx:advice&gt;
    
    &lt;tx:advice id="noTxAdvice"&gt;
        &lt;tx:attributes&gt;
            &lt;tx:method name="*" propagation="NEVER"/&gt;
        &lt;/tx:attributes&gt;
    &lt;/tx:advice&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- other transaction infrastructure beans such as a <code class="interfacename">PlatformTransactionManager</code> omitted... --&gt;</span></em>

&lt;/beans&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-txadvice-settings"></a>9.5.5.&nbsp;<code class="literal">&lt;tx:advice/&gt;</code> settings</h3></div></div></div><p>This section summarises the various transactional settings that can be specified
            using the <code class="literal">&lt;tx:advice/&gt;</code> tag. The default
            <code class="literal">&lt;tx:advice/&gt;</code> settings are:</p><p>
                </p><div class="itemizedlist"><ul type="disc"><li><p>The propagation setting is <code class="literal">REQUIRED</code></p></li><li><p>The isolation level is <code class="literal">DEFAULT</code></p></li><li><p>The transaction is read/write</p></li><li><p>The transaction timeout defaults to the default timeout of the
                        underlying transaction system, or or none if timeouts are not supported</p></li><li><p>Any <code class="exceptionname">RuntimeException</code> will trigger
                        rollback, and any checked <code class="exceptionname">Exception</code>
                        will not</p></li></ul></div><p>
            </p><p>These default settings can, of course, be changed; the various
            attributes of the <code class="literal">&lt;tx:method/&gt;</code> tags that are nested within
            <code class="literal">&lt;tx:advice/&gt;</code> and <code class="literal">&lt;tx:attributes/&gt;</code>
            tags are summarized below:</p><p>
                </p><div class="table"><a name="tx-method-settings"></a><p class="title"><b>Table&nbsp;9.1.&nbsp;<code class="literal">&lt;tx:method/&gt;</code> settings</b></p><div class="table-contents"><table summary="<tx:method/&gt; settings" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>Attribute</th><th>Required?</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">name</code></td><td>Yes</td><td>&nbsp;</td><td>
                                    <p>The method name(s) with which the transaction attributes
                                    are to be associated. The wildcard (*) character can be used to
                                    associate the same transaction attribute settings with a number
                                    of methods; for example, <code class="literal">'get*'</code>,
                                    <code class="literal">'handle*'</code>,<code class="literal"> 'on*Event'</code>, etc.</p>
                                </td></tr><tr><td><code class="literal">propagation</code></td><td>No</td><td>REQUIRED</td><td>The transaction propagation behavior</td></tr><tr><td><code class="literal">isolation</code></td><td>No</td><td>DEFAULT</td><td>The transaction isolation level</td></tr><tr><td><code class="literal">timeout</code></td><td>No</td><td>-1</td><td>The transaction timeout value (in seconds)</td></tr><tr><td><code class="literal">read-only</code></td><td>No</td><td>false</td><td>Is this transaction read-only?</td></tr><tr><td><code class="literal">rollback-for</code></td><td>No</td><td>&nbsp;</td><td>
                                    <p>The <code class="literal">Exception(s)</code> that will trigger
                                    rollback; comma-delimited. For example,
                                    <code class="literal">'com.foo.MyBusinessException,ServletException'</code></p>
                                </td></tr><tr><td><code class="literal">no-rollback-for</code></td><td>No</td><td>&nbsp;</td><td>
                                    <p>The <code class="literal">Exception(s)</code> that will
                                    <span class="emphasis"><em>not</em></span> trigger rollback; comma-delimited.
	                                For example,
	                                <code class="literal">'com.foo.MyBusinessException,ServletException'</code></p>
                                </td></tr></tbody></table></div></div><p><br class="table-break">
            </p><p>At the time of writing it is not possible to have explicit control over the
			name of a transaction, where 'name' means the transaction name that will be shown
			in a transaction monitor, if applicable (for example, WebLogic's transaction
			monitor), and in logging output. For declarative transactions, the transaction
			name is always the fully-qualified class name + "." + method name of the
			transactionally-advised class. For example
			<code class="literal">'com.foo.BusinessService.handlePayment'</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-annotations"></a>9.5.6.&nbsp;Using <code class="interfacename">@Transactional</code></h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The functionality offered by the <code class="interfacename">@Transactional</code>
				annotation and the support classes is only available to you if you
				are using Java 5+.</p></td></tr></table></div><p>In addition to the XML-based declarative approach to transaction configuration,
            you can also use an annotation-based approach to transaction configuration. Declaring
            transaction semantics directly in the Java source code puts the declarations much
            closer to the affected code, and there is generally not much danger of undue coupling,
            since code that is meant to be used transactionally is almost always deployed that way
            anyway.</p><p>The ease-of-use afforded by the use of the <code class="interfacename">@Transactional</code>
            annotation is best illustrated with an example, after which all of the details
            will be explained. Consider the following class definition:</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// the service class that we want to make transactional</span></em>
<span class="bold"><strong>@Transactional</strong></span>
public class DefaultFooService implements FooService {

    Foo getFoo(String fooName);

    Foo getFoo(String fooName, String barName);

    void insertFoo(Foo foo);

    void updateFoo(Foo foo);
}</pre><p>When the above POJO is defined as a bean in a Spring IoC container, the bean
            instance can be made transactional by adding merely <span class="emphasis"><em>one</em></span> line of
            XML configuration, like so:</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- from the file <code class="literal">'context.xml'</code> --&gt;</span></em>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- this is the service object that we want to make transactional --&gt;</span></em>
  &lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!-- enable the configuration of transactional behavior based on annotations --&gt;</span></em>
  <span class="bold"><strong>&lt;tx:annotation-driven transaction-manager="txManager"/&gt;</strong></span>

  <em class="lineannotation"><span class="lineannotation">&lt;!-- a <code class="interfacename">PlatformTransactionManager</code> is still required --&gt;</span></em>
  &lt;bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- (this dependency is defined somewhere else) --&gt;</span></em>
    &lt;property name="dataSource" ref="dataSource"/&gt;
  &lt;/bean&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- other <code class="literal">&lt;bean/&gt;</code> definitions here --&gt;</span></em>

&lt;/beans&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You can actually omit the <code class="literal">'transaction-manager'</code>
                attribute in the <code class="literal">&lt;tx:annotation-driven/&gt;</code> tag 
                if the bean name of the <code class="interfacename">PlatformTransactionManager</code>
                that you want to wire in has the name <code class="literal">'transactionManager'</code>.
                If the <code class="interfacename">PlatformTransactionManager</code> bean
                that you want to dependency inject has any other name, then you have to be
                explicit and use the <code class="literal">'transaction-manager'</code> attribute as
                in the example above.</p></td></tr></table></div><div class="sidebar"><p class="title"><b>Method visibility and <code class="interfacename">@Transactional</code></b></p><p>When using proxies, the <code class="interfacename">@Transactional</code> annotation
                should only be applied to methods with <span class="emphasis"><em>public</em></span> visibility.
                If you do annotate protected, private or package-visible methods with the
                <code class="interfacename">@Transactional</code> annotation, no error will be raised,
                but the annotated method will not exhibit the configured transactional settings.
                Consider the use of AspectJ (see below) if you need to annotate non-public methods.</p></div><p>The <code class="interfacename">@Transactional</code> annotation may be placed
            before an interface definition, a method on an interface, a class definition, or a
            <span class="emphasis"><em>public</em></span> method on a class. However, please note that the mere
            presence of the <code class="interfacename">@Transactional</code> annotation is not
            enough to actually turn on the transactional behavior - the
            <code class="interfacename">@Transactional</code> annotation <span class="emphasis"><em>is simply metadata</em></span>
            that can be consumed by something that is <code class="interfacename">@Transactional</code>-aware
            and that can use the metadata to configure the appropriate beans with transactional
            behavior. In the case of the above example, it is the presence of the
            <code class="literal">&lt;tx:annotation-driven/&gt;</code> element that
            <span class="emphasis"><em>switches on</em></span> the transactional behavior.</p><p>The Spring team's recommendation is that you only annotate concrete
            classes with the <code class="interfacename">@Transactional</code> annotation,
            as opposed to annotating interfaces. You certainly can place the
            <code class="interfacename">@Transactional</code> annotation on an interface (or
            an interface method), but this will only work as you would expect it to if
            you are using interface-based proxies. The fact that annotations are
            <span class="emphasis"><em>not inherited</em></span> means that if you are using class-based
            proxies then the transaction settings will not be recognised by the
            class-based proxying infrastructure and the object will not be wrapped in a
            transactional proxy (which would be decidedly <span class="emphasis"><em>bad</em></span>).
            So please do take the Spring team's advice and only annotate concrete classes
            (and the methods of concrete classes) with the
            <code class="interfacename">@Transactional</code> annotation.</p><p><span class="emphasis"><em>Note: Since this mechanism is based on proxies, only 'external'
            method calls coming in through the proxy will be intercepted.</em></span>
            This means that 'self-invocation', i.e. a method within the target object
            calling some other method of the target object, won't lead to an actual
            transaction at runtime even if the invoked method is marked with
            <code class="interfacename">@Transactional</code>!</p><p>
                </p><div class="table"><a name="tx-annotation-driven-settings"></a><p class="title"><b>Table&nbsp;9.2.&nbsp;<code class="literal">&lt;tx:annotation-driven/&gt;</code> settings</b></p><div class="table-contents"><table summary="<tx:annotation-driven/&gt; settings" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>Attribute</th><th>Required?</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">transaction-manager</code></td><td>No</td><td>transactionManager</td><td>
                                    <p>The name of transaction manager to use. Only required
                                    if the name of the transaction manager is not <code class="literal">transactionManager</code>,
                                    as in the example above.</p>
                                </td></tr><tr><td><code class="literal">proxy-target-class</code></td><td>No</td><td>&nbsp;</td><td>
                                	<p>Controls
									what type of transactional proxies are created for classes annotated
									with the <code class="interfacename">@Transactional</code> annotation.
									If "<code class="literal">proxy-target-class</code>" attribute is set to
									"<code class="literal">true</code>", then class-based proxies will be created.
					                If "<code class="literal">proxy-target-class</code>" is "<code class="literal">false</code>"
									or if the attribute is omitted, then standard JDK interface-based proxies
									will be created. (See the section entitled <a href="#aop-proxying" title="6.6.&nbsp;Proxying mechanisms">Section&nbsp;6.6, &#8220;Proxying mechanisms&#8221;</a>
									for a detailed examination of the different proxy types.)</p></td></tr><tr><td><code class="literal">order</code></td><td>No</td><td>&nbsp;</td><td><p>Defines the order of the transaction advice that will be applied to
                                beans annotated with <code class="code">@Transactional</code>. More on the rules related
                                to ordering of AOP advice can be found in the AOP chapter (see section
                                <a href="#aop-ataspectj-advice-ordering" title="6.2.4.7.&nbsp;Advice ordering">Section&nbsp;6.2.4.7, &#8220;Advice ordering&#8221;</a>). Note that not specifying
                                any ordering will leave the decision as to what order advice is run in to
								the AOP subsystem.</p></td></tr></tbody></table></div></div><p><br class="table-break">
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The "<code class="literal">proxy-target-class</code>" attribute on the
				<code class="literal">&lt;tx:annotation-driven/&gt;</code> element controls
				what type of transactional proxies are created for classes annotated
				with the <code class="interfacename">@Transactional</code> annotation.
				If "<code class="literal">proxy-target-class</code>" attribute is set to
				"<code class="literal">true</code>", then class-based proxies will be created.
                If "<code class="literal">proxy-target-class</code>" is "<code class="literal">false</code>"
				or if the attribute is omitted, then standard JDK interface-based proxies
				will be created. (See the section entitled <a href="#aop-proxying" title="6.6.&nbsp;Proxying mechanisms">Section&nbsp;6.6, &#8220;Proxying mechanisms&#8221;</a>
				for a detailed examination of the different proxy types.)</p></td></tr></table></div><p>The most derived location takes precedence when evaluating the transactional
            settings for a method. In the case of the following example, the
            <code class="classname">DefaultFooService</code> class is annotated at the class level
			with the settings for a read-only transaction, but the
			<code class="interfacename">@Transactional</code> annotation on the
			<code class="methodname">updateFoo(Foo)</code> method in the same class takes precedence
			over the transactional settings defined at the class level.</p><pre class="programlisting">@Transactional(readOnly = true)
public class DefaultFooService implements FooService {

    public Foo getFoo(String fooName) {
        <em class="lineannotation"><span class="lineannotation">// do something</span></em>
    }

    <em class="lineannotation"><span class="lineannotation">// <span class="bold"><strong>these</strong></span> settings have precedence for this method</span></em>
    @Transactional(readOnly = false, propagation = Propagation.REQUIRES_NEW)
    public void updateFoo(Foo foo) {
        <em class="lineannotation"><span class="lineannotation">// do something</span></em>
    }
}</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="transaction-declarative-attransactional-settings"></a>9.5.6.1.&nbsp;<code class="interfacename">@Transactional</code> settings</h4></div></div></div><p>The <code class="interfacename">@Transactional</code> annotation is
                metadata that specifies that an interface, class, or method must have
                transactional semantics; for example, &#8220;<span class="quote"><span class="emphasis"><em>start a brand new read-only
                transaction when this method is invoked, suspending any existing
                transaction</em></span></span>&#8221;. The default
                <code class="interfacename">@Transactional</code> settings are:</p><div class="itemizedlist"><ul type="disc"><li><p>The propagation setting is <code class="literal">PROPAGATION_REQUIRED</code></p></li><li><p>The isolation level is <code class="literal">ISOLATION_DEFAULT</code></p></li><li><p>The transaction is read/write</p></li><li><p>The transaction timeout defaults to the default timeout of the
                        underlying transaction system, or or none if timeouts are not supported</p></li><li><p>Any <code class="exceptionname">RuntimeException</code> will trigger
                        rollback, and any checked <code class="exceptionname">Exception</code>
                        will not</p></li></ul></div><p>These default settings can, of course, be changed; the various
                properties of the <code class="interfacename">@Transactional</code> annotation
                are summarized in the following table:</p><p>
                    </p><div class="table"><a name="tx-attransactional-properties"></a><p class="title"><b>Table&nbsp;9.3.&nbsp;<code class="interfacename">@Transactional</code> properties</b></p><div class="table-contents"><table summary="@Transactional properties" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>
                                        <code class="literal">propagation</code>
                                    </td><td>enum: <code class="classname">Propagation</code></td><td>optional propagation setting</td></tr><tr><td>
                                        <code class="literal">isolation</code>
                                    </td><td>enum: <code class="classname">Isolation</code></td><td>optional isolation level</td></tr><tr><td>
                                        <code class="literal">readOnly</code>
                                    </td><td>boolean</td><td>read/write vs. read-only transaction</td></tr><tr><td>
                                        <code class="literal">timeout</code>
                                    </td><td>int (in seconds granularity)</td><td>the transaction timeout</td></tr><tr><td>
                                        <code class="literal">rollbackFor</code>
                                    </td><td>an array of <code class="classname">Class</code> objects, which
                                    must be derived from <code class="classname">Throwable</code></td><td>an optional array of exception classes which
                                    <span class="bold"><strong>must</strong></span> cause rollback</td></tr><tr><td>
                                        <code class="literal">rollbackForClassname</code>
                                    </td><td>an array of <code class="classname"></code> class names. Classes
                                    must be derived from <code class="classname">Throwable</code></td><td>an optional array of names of exception classes that
                                    <span class="bold"><strong>must</strong></span> cause rollback</td></tr><tr><td>
                                        <code class="literal">noRollbackFor</code>
                                    </td><td>an array of <code class="classname">Class</code> objects, which
                                    must be derived from <code class="classname">Throwable</code></td><td>an optional array of exception classes that
                                    <span class="bold"><strong>must not</strong></span> cause rollback.</td></tr><tr><td>
                                        <code class="literal">noRollbackForClassname</code>
                                    </td><td>an array of <code class="classname">String</code> class names, which
                                    must be derived from <code class="classname">Throwable</code></td><td>an optional array of names of exception classes that
                                    <span class="bold"><strong>must not</strong></span> cause rollback</td></tr></tbody></table></div></div><p><br class="table-break">
                </p><p>At the time of writing it is not possible to have explicit
				control over the name of a transaction, where 'name' means the
				transaction name that will be shown in a transaction monitor, if
				applicable (for example, WebLogic's transaction monitor), and in
				logging output. For declarative transactions, the transaction
				name is always the fully-qualified class name + "." + method name
				of the transactionally-advised class. For example
				<code class="literal">'com.foo.BusinessService.handlePayment'</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-applying-more-than-just-tx-advice"></a>9.5.7.&nbsp;Advising transactional operations</h3></div></div></div><p>Consider the situation where you would like to execute
			<span class="emphasis"><em>both</em></span> transactional <span class="emphasis"><em>and</em></span>
			(to keep things simple) some basic profiling advice. Hhow do you
			effect this in the context of using
			<code class="literal">&lt;tx:annotation-driven/&gt;</code>?</p><p>What we want to see when we invoke the <code class="methodname">updateFoo(Foo)</code>
            method is:</p><div class="itemizedlist"><ul type="disc"><li><p>the configured profiling aspect starting up,</p></li><li><p>then the transactional advice executing,</p></li><li><p>then the method on the advised object executing</p></li><li><p>then the transaction committing (we'll assume a sunny day scenario here),</p></li><li><p>and then finally the profiling aspect reporting (somehow) exactly
                    how long the whole transactional method invocation took</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>This chapter is not concerned with explaining AOP in any great detail
                (except as it applies to transactions). Please see the chapter entitled
                <a href="#aop" title="Chapter&nbsp;6.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;6, <i>Aspect Oriented Programming with Spring</i></a> for detailed coverage of the various bits and pieces
                of the following AOP configuration (and AOP in general).</p></td></tr></table></div><p>Here is the code for a simple profiling aspect. The
            ordering of advice is controlled via the <code class="interfacename">Ordered</code>
            interface. For full details on advice ordering, see <a href="#aop-ataspectj-advice-ordering" title="6.2.4.7.&nbsp;Advice ordering">Section&nbsp;6.2.4.7, &#8220;Advice ordering&#8221;</a>.</p><pre class="programlisting">package x.y;

import org.aspectj.lang.ProceedingJoinPoint;
import org.springframework.util.StopWatch;
import org.springframework.core.Ordered;

public class SimpleProfiler implements Ordered {

    private int order;

    <em class="lineannotation"><span class="lineannotation">// allows us to control the ordering of advice</span></em>
    public int getOrder() {
        return this.order;
    }

    public void setOrder(int order) {
        this.order = order;
    }

    <em class="lineannotation"><span class="lineannotation">// this method <span class="emphasis"><em>is</em></span> the around advice</span></em>
    public Object profile(ProceedingJoinPoint call) throws Throwable {
        Object returnValue;
        StopWatch clock = new StopWatch(getClass().getName());
        try {
            clock.start(call.toShortString());
            returnValue = call.proceed();
        } finally {
            clock.stop();
            System.out.println(clock.prettyPrint());
        }
        return returnValue;
    }
}
</pre><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
   http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
   http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
   http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;

    &lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- this is the aspect --&gt;</span></em>
    &lt;bean id="profiler" class="x.y.SimpleProfiler"&gt;
        <em class="lineannotation"><span class="lineannotation">&lt;!-- execute before the transactional advice (hence the lower order number) --&gt;</span></em>
        &lt;property name="order" <span class="bold"><strong>value="1"</strong></span>/&gt;
    &lt;/bean&gt;
    
    &lt;tx:annotation-driven transaction-manager="txManager" <span class="bold"><strong>order="200"</strong></span>/&gt;

    &lt;aop:config&gt;
        <em class="lineannotation"><span class="lineannotation">&lt;!-- this advice will execute <span class="bold"><strong>around</strong></span> the transactional advice --&gt;</span></em>
        &lt;aop:aspect id="profilingAspect" ref="profiler"&gt;
            &lt;aop:pointcut id="serviceMethodWithReturnValue"
                          expression="execution(!void x.y..*Service.*(..))"/&gt;
            &lt;aop:around method="profile" pointcut-ref="serviceMethodWithReturnValue"/&gt;
        &lt;/aop:aspect&gt;
    &lt;/aop:config&gt;

    &lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
        &lt;property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"/&gt;
        &lt;property name="url" value="jdbc:oracle:thin:@rj-t42:1521:elvis"/&gt;
        &lt;property name="username" value="scott"/&gt;
        &lt;property name="password" value="tiger"/&gt;
    &lt;/bean&gt;

    &lt;bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
        &lt;property name="dataSource" ref="dataSource"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre><p>The result of the above configuration will be a <code class="literal">'fooService'</code>
            bean that has profiling and transactional aspects applied to it
            <span class="emphasis"><em>in that order</em></span>. The configuration of any number of additional
            aspects is effected in a similar fashion.</p><p>Finally, find below some example configuration for effecting the same
            setup as above, but using the purely XML declarative approach.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
   http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
   http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
   http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;

    &lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- the profiling advice --&gt;</span></em>
    &lt;bean id="profiler" class="x.y.SimpleProfiler"&gt;
        <em class="lineannotation"><span class="lineannotation">&lt;!-- execute before the transactional advice (hence the lower order number) --&gt;</span></em>
        <span class="bold"><strong>&lt;property name="order" value="1</strong></span>"/&gt;
    &lt;/bean&gt;

    &lt;aop:config&gt;
        
        &lt;aop:pointcut id="entryPointMethod" expression="execution(* x.y..*Service.*(..))"/&gt;

        <em class="lineannotation"><span class="lineannotation">&lt;!-- will execute after the profiling advice (c.f. the order attribute) --&gt;</span></em>
        &lt;aop:advisor
                advice-ref="txAdvice"
                pointcut-ref="entryPointMethod"
                <span class="bold"><strong>order="2</strong></span>"/&gt; <em class="lineannotation"><span class="lineannotation">&lt;!-- order value is higher than the profiling aspect --&gt;</span></em>

        &lt;aop:aspect id="profilingAspect" ref="profiler"&gt;
            &lt;aop:pointcut id="serviceMethodWithReturnValue"
                          expression="execution(!void x.y..*Service.*(..))"/&gt;
            &lt;aop:around method="profile" pointcut-ref="serviceMethodWithReturnValue"/&gt;
        &lt;/aop:aspect&gt;

    &lt;/aop:config&gt;

    &lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;
        &lt;tx:attributes&gt;
            &lt;tx:method name="get*" read-only="true"/&gt;
            &lt;tx:method name="*"/&gt;
        &lt;/tx:attributes&gt;
    &lt;/tx:advice&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- other &lt;bean/&gt; definitions such as a <code class="interfacename">DataSource</code> and a <code class="interfacename">PlatformTransactionManager</code> here --&gt;</span></em>

&lt;/beans&gt;</pre><p>The result of the above configuration will be a <code class="literal">'fooService'</code>
            bean that has profiling and transactional aspects applied to it
            <span class="emphasis"><em>in that order</em></span>. If we wanted the profiling advice to execute
            <span class="emphasis"><em>after</em></span> the transactional advice on the way in, and
            <span class="emphasis"><em>before</em></span> the transactional advice on the way out, then we would
            simply swap the value of the profiling aspect bean's <code class="literal">'order'</code>
            property such that it was higher than the transactional advice's order value.</p><p>The configuration of any number of additional aspects is achieved in a
            similar fashion.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-aspectj"></a>9.5.8.&nbsp;Using <code class="interfacename">@Transactional</code> with AspectJ</h3></div></div></div><p>It is also possible to use the Spring Framework's
            <code class="interfacename">@Transactional</code> support outside of a Spring container
            by means of an AspectJ aspect. To use this support you must first
            annotate your classes (and optionally your classes' methods with the
            <code class="interfacename">@Transactional</code> annotation, and then you must link
            (weave) your application with the
            <code class="classname">org.springframework.transaction.aspectj.AnnotationTransactionAspect</code>
            defined in the <code class="filename">spring-aspects.jar</code> file.
            The aspect must also be configured with a transaction manager. You could of course
            use the Spring Framework's IoC container to take care of dependency injecting the 
            aspect, but since we're focusing here on applications running outside of a Spring
            container, we'll show you how to do it programmatically.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Prior to continuing, you may well want to read the previous sections entitled
                <a href="#transaction-declarative-annotations" title="9.5.6.&nbsp;Using @Transactional">Section&nbsp;9.5.6, &#8220;Using <code class="interfacename">@Transactional</code>&#8221;</a> and <a href="#aop" title="Chapter&nbsp;6.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;6, <i>Aspect Oriented Programming with Spring</i></a>
                respectively.</p></td></tr></table></div><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// construct an appropriate transaction manager </span></em>
DataSourceTransactionManager txManager = new DataSourceTransactionManager(getDataSource());

<em class="lineannotation"><span class="lineannotation">// configure the <code class="classname">AnnotationTransactionAspect</code> to use it; this must be done before executing any transactional methods</span></em>
AnnotationTransactionAspect.aspectOf().setTransactionManager(txManager); </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>When using this aspect, you must annotate the <span class="emphasis"><em>implementation</em></span>
	            class (and/or methods within that class), <span class="emphasis"><em>not</em></span> the interface 
	            (if any) that the class implements. AspectJ follows Java's rule that annotations on 
	            interfaces are <span class="emphasis"><em>not inherited</em></span>.</p></td></tr></table></div><p>The <code class="interfacename">@Transactional</code> annotation on a class specifies
	        the default transaction semantics for the execution of any method in the class.</p><p>The <code class="interfacename">@Transactional</code> annotation on a method within
	        the class overrides the default transaction semantics given by the class annotation
	        (if present). Any method may be annotated, regardless of visibility.</p><p>To weave your applications with the <code class="classname">AnnotationTransactionAspect</code>
	        you must either build your application with AspectJ (see the
	        <a href="http://www.eclipse.org/aspectj/doc/released/devguide/index.html" target="_top">AspectJ Development Guide</a>)
	        or use load-time weaving. See the section entitled <a href="#aop-aj-ltw" title="6.8.4.&nbsp;Using AspectJ Load-time weaving (LTW) with Spring applications">Section&nbsp;6.8.4, &#8220;Using AspectJ Load-time weaving (LTW) with Spring applications&#8221;</a> for a
	        discussion of load-time weaving with AspectJ.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-programmatic"></a>9.6.&nbsp;Programmatic transaction management</h2></div></div></div><p>The Spring Framework provides two means of programmatic transaction management:</p><div class="itemizedlist"><ul type="disc"><li><p>Using the <code class="classname">TransactionTemplate</code>.</p></li><li><p>Using a <code class="interfacename">PlatformTransactionManager</code>
                implementation directly.</p></li></ul></div><p>If you are going to use programmatic transaction management, the Spring
        team generally recommend, namely that of using the <code class="classname">TransactionTemplate</code>).
	      The second approach is similar to using the JTA <code class="interfacename">UserTransaction</code>
	      API (although exception handling is less cumbersome).</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-prog-template"></a>9.6.1.&nbsp;Using the <code class="classname">TransactionTemplate</code></h3></div></div></div><p>The <code class="classname">TransactionTemplate</code> adopts the same
            approach as other Spring <span class="emphasis"><em>templates</em></span> such as the
            <code class="classname">JdbcTemplate</code>. It uses a callback approach, to
            free application code from having to do the boilerplate acquisition 
            and release of transactional resources, and results in code that is
            intention driven, in that the code that is written focuses solely
            on what the developer wants to do.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>As you will immediately see in the examples that follow, using
				the <code class="classname">TransactionTemplate</code> absolutely
				couples you to Spring's transaction infrastructure and APIs.
				Whether or not programmatic transaction management is suitable
				for your development needs is a decision that you will have to
				make yourself.</p></td></tr></table></div><p>Application code that must execute in a transactional context,
			and that will use the <code class="classname">TransactionTemplate</code> explicitly,
			looks like this. You, as an application developer, will write a
			<code class="interfacename">TransactionCallback</code> implementation (typically
			expressed as an anonymous inner class) that will contain all of the code
			that you need to have execute in the context of a transaction. You will then
			pass an instance of your custom <code class="interfacename">TransactionCallback</code>
			to the <code class="methodname">execute(..)</code> method exposed on the
			<code class="classname">TransactionTemplate</code>. </p><pre class="programlisting">public class SimpleService implements Service {

    <em class="lineannotation"><span class="lineannotation">// single <code class="classname">TransactionTemplate</code> shared amongst all methods in this instance</span></em>
    private final TransactionTemplate transactionTemplate;

    <em class="lineannotation"><span class="lineannotation">// use constructor-injection to supply the <code class="interfacename">PlatformTransactionManager</code></span></em>
    public SimpleService(PlatformTransactionManager transactionManager) {
        Assert.notNull(transactionManager, "The 'transactionManager' argument must not be null.");
        this.transactionTemplate = new TransactionTemplate(transactionManager);
    }

    public Object someServiceMethod() {
        return transactionTemplate.execute(new TransactionCallback() {

            <em class="lineannotation"><span class="lineannotation">// the code in this method executes in a transactional context</span></em>
            public Object doInTransaction(TransactionStatus status) {
                updateOperation1();
                return resultOfUpdateOperation2();
            }
        });
    }
}</pre><p>If there is no return value, use the convenient
            <code class="classname">TransactionCallbackWithoutResult</code> class via an
            anonymous class like so:</p><pre class="programlisting">transactionTemplate.execute(new <span class="bold"><strong>TransactionCallbackWithoutResult</strong></span>() {
    
    protected void doInTransactionWithoutResult(TransactionStatus status) {
        updateOperation1();
        updateOperation2();
    }
});</pre><p>Code within the callback can roll the transaction back by calling
            the <code class="literal">setRollbackOnly()</code> method on the supplied
            <code class="interfacename">TransactionStatus</code> object.</p><pre class="programlisting">transactionTemplate.execute(new TransactionCallbackWithoutResult() {

    protected void doInTransactionWithoutResult(TransactionStatus status) {
        try {
            updateOperation1();
            updateOperation2();
        } catch (SomeBusinessExeption ex) {
            <span class="bold"><strong>status.setRollbackOnly();</strong></span>
        }
    }
});</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tx-prog-template-settings"></a>9.6.1.1.&nbsp;Specifying transaction settings</h4></div></div></div><p>
					Transaction settings such as the propagation mode, the
					isolation level, the timeout, and so forth can be set
					on the <code class="classname">TransactionTemplate</code> either
					programmatically or in configuration. <code class="classname">TransactionTemplate</code>
					instances by default have the <a href="#transaction-declarative-txadvice-settings" title="9.5.5.&nbsp;<tx:advice/&gt; settings">default transactional settings</a>.
					Find below an example of programmatically customizing the
					transactional settings for a specific <code class="classname">TransactionTemplate</code>.
				</p><pre class="programlisting">public class SimpleService implements Service {

    private final TransactionTemplate transactionTemplate;

    public SimpleService(PlatformTransactionManager transactionManager) {
        Assert.notNull(transactionManager, "The 'transactionManager' argument must not be null.");
        this.transactionTemplate = new TransactionTemplate(transactionManager);

        <em class="lineannotation"><span class="lineannotation">// the transaction settings can be set here explicitly if so desired</span></em>
        this.transactionTemplate.setIsolationLevel(TransactionDefinition.ISOLATION_READ_UNCOMMITTED);
        this.transactionTemplate.setTimeout(30); <em class="lineannotation"><span class="lineannotation">// 30 seconds</span></em>
        <em class="lineannotation"><span class="lineannotation">// and so forth...</span></em>
    }
}</pre><p>
					Find below an example of defining a <code class="classname">TransactionTemplate</code> with some custom
					transactional settings, using Spring XML configuration. The '<code class="literal">sharedTransactionTemplate</code>'
					can then be injected into as many services as are required.
				</p><pre class="programlisting">&lt;bean id="sharedTransactionTemplate"
      class="org.springframework.transaction.support.TransactionTemplate"&gt;
    &lt;property name="isolationLevelName" value="ISOLATION_READ_UNCOMMITTED"/&gt;
    &lt;property name="timeout" value="30"/&gt;
&lt;/bean&gt;"</pre></div><p>
				Finally, instances of the <code class="classname">TransactionTemplate</code> class are
				threadsafe, in that instances do not maintain any conversational state.
				<code class="classname">TransactionTemplate</code> instances <span class="emphasis"><em>do</em></span>
				however maintain configuration state, so while a number of classes
				may choose to share a single instance of a <code class="classname">TransactionTemplate</code>, if a class needed
				to use a <code class="classname">TransactionTemplate</code> with different settings
				(for example, a different isolation level), then two distinct
				<code class="classname">TransactionTemplate</code> instances would need to be
				created and used.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-programmatic-ptm"></a>9.6.2.&nbsp;Using the <code class="interfacename">PlatformTransactionManager</code></h3></div></div></div><p>You can also use the
            <code class="interfacename">org.springframework.transaction.PlatformTransactionManager</code>
            directly to manage your transaction. Simply pass the implementation of
            the <code class="interfacename">PlatformTransactionManager</code> you're
            using to your bean via a bean reference. Then, using the
            <code class="interfacename">TransactionDefinition</code> and
            <code class="interfacename">TransactionStatus</code> objects you can
            initiate transactions, rollback and commit.</p><pre class="programlisting">DefaultTransactionDefinition def = new DefaultTransactionDefinition();
<em class="lineannotation"><span class="lineannotation">// explicitly setting the transaction name is something that can only be done programmatically</span></em>
def.setName("SomeTxName");
def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);

TransactionStatus status = txManager.getTransaction(def);
try {
    <em class="lineannotation"><span class="lineannotation">// execute your business logic here</span></em>
}
catch (MyException ex) {
    txManager.rollback(status);
    throw ex;
}
txManager.commit(status);</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tx-decl-vs-prog"></a>9.7.&nbsp;Choosing between programmatic and declarative transaction management</h2></div></div></div><p>Programmatic transaction management is usually a good idea only if
        you have a small number of transactional operations. For example, if you
        have a web application that require transactions only for certain update
        operations, you may not want to set up transactional proxies using Spring
        or any other technology. In this case, using the <code class="classname">TransactionTemplate</code>
        <span class="emphasis"><em>may</em></span> be a good approach. Being able to set the transaction name
		explicitly is also something that can only be done using the programmatic
		approach to transaction management.</p><p>On the other hand, if your application has numerous transactional
        operations, declarative transaction management is usually worthwhile. It
        keeps transaction management out of business logic, and is not difficult
        to configure. When using the Spring Framework, rather than EJB CMT, the
        configuration cost of declarative transaction management is greatly reduced.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-application-server-integration"></a>9.8.&nbsp;Application server-specific integration</h2></div></div></div><p>Spring's transaction abstraction is generally application server
        agnostic. Additionally, Spring's <code class="classname">JtaTransactionManager</code> class,
        which can optionally perform a JNDI lookup for the JTA
        <code class="interfacename">UserTransaction</code> and
        <code class="literal">TransactionManager</code> objects, can be set to autodetect
        the location for the latter object, which varies by application server. Having
        access to the <code class="literal">TransactionManager</code> instance does allow
        enhanced transaction semantics. Please see the
        <code class="classname">JtaTransactionManager</code> Javadocs for more details.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-application-server-integration-weblogic"></a>9.8.1.&nbsp;BEA WebLogic</h3></div></div></div><p>In a WebLogic 7.0, 8.1 or higher environment, you will generally
            prefer to use <code class="classname">WebLogicJtaTransactionManager</code> instead
            of the stock <code class="classname">JtaTransactionManager</code> class. This
            special WebLogic-specific subclass of the normal
            <code class="classname">JtaTransactionManager</code>. It supports the full power of
            Spring's transaction definitions in a WebLogic managed transaction
            environment, beyond standard JTA semantics: features include transaction
            names, per-transaction isolation levels, and proper resuming of
            transactions in all cases.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-application-server-integration-websphere"></a>9.8.2.&nbsp;IBM WebSphere</h3></div></div></div><p>In a WebSphere 5.1, 5.0 and 4 environment, you may wish to use
            Spring's <code class="classname">WebSphereTransactionManagerFactoryBean</code>
            class. This is a factory bean which retrieves the JTA
            <code class="literal">TransactionManager</code> in a WebSphere environment, which
            is done via WebSphere's <code class="literal">static</code> access methods.
            (These methods are different for each version of WebSphere.)
            Once the JTA <code class="interfacename">TransactionManager</code> instance has
            been obtained via this factory bean, Spring's
            <code class="classname">JtaTransactionManager</code> may be configured with a
            reference to it, for enhanced transaction semantics over the use of only
            the JTA <code class="interfacename">UserTransaction</code> object.
            Please see the Javadocs for full details.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-solutions-to-common-problems"></a>9.9.&nbsp;Solutions to common problems</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-solutions-to-common-problems-wrong-ptm"></a>9.9.1.&nbsp;Use of the wrong transaction manager for a specific <code class="interfacename">DataSource</code></h3></div></div></div><p>You should take care to use the correct
            <span class="emphasis"><em><code class="interfacename">PlatformTransactionManager</code></em></span>
            implementation for their requirements. It is important to understand
            how the the Spring Framework's transaction abstraction works with JTA global
			transactions. Used properly, there is no conflict here: the Spring Framework
			merely provides a straightforward and portable abstraction. If you are using
			global transactions, you <span class="emphasis"><em>must</em></span> use the
            <code class="classname">org.springframework.transaction.jta.JtaTransactionManager</code> class
            (or an
            <a href="#transaction-application-server-integration" title="9.8.&nbsp;Application server-specific integration"> application server-specific subclass</a>
             of it) for all your transactional operations. Otherwise the transaction infrastructure
			 will attempt to perform local transactions on resources such as container
             <code class="interfacename">DataSource</code> instances. Such local transactions
             don't make sense, and a good application server will treat them as errors.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-resources"></a>9.10.&nbsp;Further Resources</h2></div></div></div><p>Find below links to further resources about the Spring Framework's transaction support.</p><div class="itemizedlist"><ul type="disc"><li><p>This book,
				<a href="http://www.infoq.com/minibooks/JTDS" target="_top">Java Transaction Design Strategies</a>
				from <a href="http://www.infoq.com/" target="_top">InfoQ</a> is a well-paced introduction
				to transactions in the Java space. It also includes side-by-side examples of how to
				configure and use transactions in both the Spring Framework and EJB3.</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="dao"></a>Chapter&nbsp;10.&nbsp;DAO support</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dao-introduction"></a>10.1.&nbsp;Introduction</h2></div></div></div><p>
			The Data Access Object (DAO) support in Spring is aimed at
			making it easy to work with data access technologies like
			JDBC, Hibernate or JDO in a consistent way. This allows one
			to switch between the aforementioned persistence technologies
			fairly easily and it also allows one to code without worrying
			about catching exceptions that are specific to each technology.
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dao-exceptions"></a>10.2.&nbsp;Consistent exception hierarchy</h2></div></div></div><p>
			Spring provides a convenient translation from technology-specific
			exceptions like <code class="classname">SQLException</code> to its own
			exception class hierarchy with the
			<code class="classname">DataAccessException</code> as the root exception.
			These exceptions wrap the original exception so there is never
			any risk that one might lose any information as to what might
			have gone wrong.
		</p><p>
			In addition to JDBC exceptions, Spring can also wrap Hibernate-specific
			exceptions, converting them from proprietary, checked exceptions
			(in the case of versions of Hibernate prior to Hibernate 3.0), to
			a set of focused runtime exceptions (the same is true for JDO and
			JPA exceptions). This allows one to handle most persistence exceptions,
			which are non-recoverable, only in the appropriate layers, without
			having annoying boilerplate catch-and-throw blocks and exception
			declarations in one's DAOs. (One can still trap and handle exceptions
			anywhere one needs to though.) As mentioned above, JDBC exceptions
			(including database-specific dialects) are also converted to the
			same hierarchy, meaning that one can perform some operations with
			JDBC within a consistent programming model.
		</p><p>
			The above holds true for the various template classes in Springs
			support for various ORM frameworks. If one uses the interceptor-based
			classes then the application must care about handling
			<code class="classname">HibernateExceptions</code> and
			<code class="classname">JDOExceptions</code> itself, preferably via delegating
			to <code class="classname">SessionFactoryUtils</code>'
			<code class="methodname">convertHibernateAccessException(..)</code> or
			<code class="methodname">convertJdoAccessException</code> methods respectively.
			These methods convert the exceptions to ones that are compatible
			with the exceptions in the <code class="literal">org.springframework.dao</code>
			exception hierarchy. As <code class="classname">JDOExceptions</code> are
			unchecked, they can simply get thrown too, sacrificing generic DAO
			abstraction in terms of exceptions though.
		</p><p>
			The exception hierarchy that Spring provides can be seen below.
			(Please note that the class hierarchy detailed in the image
			shows only a subset of the entire
			<code class="classname">DataAccessException</code> hierarchy.)
		</p><div class="mediaobject" align="center"><img src="images/DataAccessException.gif" align="middle"></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dao-abstract-superclasses"></a>10.3.&nbsp;Consistent abstract classes for DAO support</h2></div></div></div><p>
			To make it easier to work with a variety of data access technologies
			such as JDBC, JDO and Hibernate in a consistent way, Spring provides
			a set of <code class="literal">abstract</code> DAO classes that one can extend.
			These abstract classes have methods for providing the data source and
			any other configuration settings that are specific to the relevant
			data-access technology.
		</p><div class="itemizedlist"><ul type="disc"><li><p>
					<code class="classname">JdbcDaoSupport</code> - superclass for JDBC data
					access objects. Requires a <code class="interfacename">DataSource</code>
					to be provided; in turn, this class provides a 
					<code class="classname">JdbcTemplate</code> instance initialized from the
					supplied <code class="interfacename">DataSource</code> to subclasses.
				</p></li><li><p>
					<code class="classname">HibernateDaoSupport</code> - superclass for
					Hibernate data access objects. Requires a
					<code class="interfacename">SessionFactory</code> to be provided;
					in turn, this class provides a
					<code class="classname">HibernateTemplate</code> instance initialized
					from the supplied <code class="interfacename">SessionFactory</code>
					to subclasses. Can alternatively be initialized directly via a
					<code class="classname">HibernateTemplate</code>, to reuse the latters
					settings like <code class="interfacename">SessionFactory</code>,
					flush mode, exception translator, and so forth.
				</p></li><li><p>
					<code class="classname">JdoDaoSupport</code> - super class for JDO data
					access objects. Requires a
					<code class="interfacename">PersistenceManagerFactory</code>
					to be provided; in turn, this class provides a
					<code class="classname">JdoTemplate</code> instance initialized from the
					supplied <code class="interfacename">PersistenceManagerFactory</code>
					to subclasses.
				</p></li><li><p>
					<code class="classname">JpaDaoSupport</code> - super class for JPA data
					access objects. Requires a
					<code class="interfacename">EntityManagerFactory</code> to be provided;
					in turn, this class provides a <code class="classname">JpaTemplate</code>
					instance initialized from the supplied
					<code class="interfacename">EntityManagerFactory</code> to subclasses.
				</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="jdbc"></a>Chapter&nbsp;11.&nbsp;Data access using JDBC</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-introduction"></a>11.1.&nbsp;Introduction</h2></div></div></div><p>
			The value-add provided by the Spring Framework's JDBC abstraction
			framework is perhaps best shown by the following list (note that only
			the italicized lines need to be coded by an application developer):
		</p><div class="orderedlist"><ol type="1"><li><p>Define connection parameters</p></li><li><p>Open the connection</p></li><li><p><span class="emphasis"><em>Specify the statement</em></span></p></li><li><p>Prepare and execute the statement</p></li><li><p>Set up the loop to iterate through the results (if any)</p></li><li><p><span class="emphasis"><em>Do the work for each iteration</em></span></p></li><li><p>Process any exception</p></li><li><p>Handle transactions</p></li><li><p>Close the connection</p></li></ol></div><p>
			The Spring Framework takes care of all the grungy, low-level details
			that can make JDBC such a tedious API to develop with.
		</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-packages"></a>11.1.1.&nbsp;The package hierarchy</h3></div></div></div><p>
				The Spring Framework's JDBC abstraction framework consists of four
				different packages, namely <code class="literal">core</code>,
				<code class="literal">dataSource</code>, <code class="literal">object</code>, and
				<code class="literal">support</code>.
			</p><p>
				The <code class="literal">org.springframework.jdbc.core</code> package
				contains the <code class="classname">JdbcTemplate</code> class and its various 
				callback interfaces, plus a variety of related classes.
			</p><p>
				The <code class="literal">org.springframework.jdbc.datasource</code> package
				contains a utility class for easy <code class="interfacename">DataSource</code>
				access, and various simple <code class="interfacename">DataSource</code>
				implementations that can be used for testing and running
				unmodified JDBC code outside of a J2EE container. The utility class
				provides static methods to obtain connections from JNDI and to close
				connections if necessary. It has support for thread-bound connections,
				e.g. for use with <code class="classname">DataSourceTransactionManager</code>.
			</p><p>
				Next, the <code class="literal">org.springframework.jdbc.object</code> package
				contains classes that represent RDBMS queries, updates, and stored
				procedures as thread safe, reusable objects. This approach is modeled by
				JDO, although of course objects returned by queries are
				&#8220;<span class="quote">disconnected</span>&#8221; from the database. This higher level of JDBC
				abstraction depends on the lower-level abstraction in the
				<code class="literal">org.springframework.jdbc.core</code> package.
			</p><p>
				Finally the <code class="literal">org.springframework.jdbc.support</code>
				package is where you find the <code class="classname">SQLException</code> translation
				functionality and some utility classes.
			</p><p>
				Exceptions thrown during JDBC processing are translated to
				exceptions defined in the <code class="literal">org.springframework.dao</code>
				package. This means that code using the Spring JDBC abstraction layer does
				not need to implement JDBC or RDBMS-specific error handling. All
				translated exceptions are unchecked giving you the option of catching the
				exceptions that you can recover from while allowing other exceptions to be
				propagated to the caller.
			</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-core"></a>11.2.&nbsp;Using the JDBC Core classes to control basic JDBC processing and error handling</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-JdbcTemplate"></a>11.2.1.&nbsp;<code class="classname">JdbcTemplate</code></h3></div></div></div><p>
				The <code class="classname">JdbcTemplate</code> class is the central class in
				the JDBC core package. It simplifies the use of JDBC since it handles the
				creation and release of resources. This helps to avoid common errors such
				as forgetting to always close the connection. It executes the core JDBC
				workflow like statement creation and execution, leaving application code
				to provide SQL and extract results. This class executes SQL queries, update
				statements or stored procedure calls, imitating iteration over
				<code class="interfacename">ResultSet</code>s and extraction of returned
				parameter values. It also catches JDBC exceptions and
				translates them to the generic, more informative, exception hierarchy
				defined in the <code class="literal">org.springframework.dao</code> package.
			</p><p>
				Code using the <code class="classname">JdbcTemplate</code> only need to implement
				callback interfaces, giving them a clearly defined contract. The
				<code class="interfacename">PreparedStatementCreator</code> callback
				interface creates a	prepared statement given a
				<code class="interfacename">Connection</code> provided by this class,
				providing SQL and any necessary parameters. The same is true for the
				<code class="interfacename">CallableStatementCreator</code> interface
				which creates callable statement. The
				<code class="interfacename">RowCallbackHandler</code> interface extracts
				values from each row of a <code class="interfacename">ResultSet</code>.
			</p><p>
				The <code class="classname">JdbcTemplate</code> can be used within a DAO
				implementation via direct instantiation with a <code class="interfacename">DataSource</code>
				reference, or be configured in a Spring IOC container and given to DAOs as a
				bean reference. Note: the <code class="interfacename">DataSource</code> should
				always be configured as a bean in the Spring IoC container, in the first
				case given to the service directly, in the second case to the prepared
				template.
			</p><p>
				Finally, all of the SQL issued by this class is logged at the
				<code class="literal">'DEBUG'</code> level under the category corresponding
				to the fully qualified class name of the template instance (typically
				<code class="classname">JdbcTemplate</code>, but it may be different if a custom
				subclass of the <code class="classname">JdbcTemplate</code> class is being used).
			</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="jdbc-JdbcTemplate-examples"></a>11.2.1.1.&nbsp;Examples</h4></div></div></div><p>Find below some examples of using the <code class="classname">JdbcTemplate</code>
				class. (These examples are not an exhaustive list of all of the functionality
				exposed by the <code class="classname">JdbcTemplate</code>; see the attendant Javadocs for that).</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="jdbc-JdbcTemplate-examples-query"></a>11.2.1.1.1.&nbsp;Querying (SELECT)</h5></div></div></div><p>A simple query for getting the number of rows in a relation.</p><pre class="programlisting">int rowCount = this.jdbcTemplate.queryForInt("select count(0) from t_accrual");</pre><p>A simple query using a bind variable.</p><pre class="programlisting">int countOfActorsNamedJoe
    = this.jdbcTemplate.queryForInt("select count(0) from t_actors where first_name = ?", new Object[]{"Joe"});</pre><p>Querying for a <code class="classname">String</code>.</p><pre class="programlisting">String surname = (String) this.jdbcTemplate
    .queryForObject("select surname from t_actor where id = ?", new Object[]{new Long(1212)}, String.class);</pre><p>Querying and populating a <span class="emphasis"><em>single</em></span> domain object.</p><pre class="programlisting">Actor actor = (Actor) this.jdbcTemplate.queryForObject(
    "select first_name, surname from t_actor where id = ?",
    new Object[]{new Long(1212)},
    new RowMapper() {

        public Object mapRow(ResultSet rs, int rowNum) throws SQLException {
            Actor actor = new Actor();
            actor.setFirstName(rs.getString("first_name"));
            actor.setSurname(rs.getString("surname"));
            return actor;
        }
    });</pre><p>Querying and populating a number of domain objects.</p><pre class="programlisting">Collection actors = this.jdbcTemplate.query(
    "select first_name, surname from t_actor",
    new RowMapper() {

        public Object mapRow(ResultSet rs, int rowNum) throws SQLException {
            Actor actor = new Actor();
            actor.setFirstName(rs.getString("first_name"));
            actor.setSurname(rs.getString("surname"));
            return actor;
        }
    });</pre><p>If the last two snippets of code actually existed in the same application,
					it would make sense to remove the duplication present in the two
					<code class="interfacename">RowMapper</code> anonymous inner classes,
					and extract them out into a single class (typically a <code class="literal">static</code>
					inner class) that can then be referenced by DAO methods as needed. For example,
					the last code snippet might be better off written like so:</p><pre class="programlisting">public Collection findAllActors() {
    return this.jdbcTemplate.query( "select first_name, surname from t_actor", new ActorMapper());
}

private static final class ActorMapper implements RowMapper {

    public Object mapRow(ResultSet rs, int rowNum) throws SQLException {
        Actor actor = new Actor();
        actor.setFirstName(rs.getString("first_name"));
        actor.setSurname(rs.getString("surname"));
        return actor;
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="jdbc-JdbcTemplate-examples-update"></a>11.2.1.1.2.&nbsp;Updating (INSERT/UPDATE/DELETE)</h5></div></div></div><pre class="programlisting">this.jdbcTemplate.update("insert into t_actor (first_name, surname) values (?, ?)", new Object[] {"Leonor", "Watling"});</pre><pre class="programlisting">this.jdbcTemplate.update("update t_actor set weapon = ? where id = ?", new Object[] {"Banjo", new Long(5276)});</pre><pre class="programlisting">this.jdbcTemplate.update("delete from orders");<em class="lineannotation"><span class="lineannotation"> // :)</span></em></pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="jdbc-JdbcTemplate-examples-other"></a>11.2.1.1.3.&nbsp;Other operations</h5></div></div></div><p>The <code class="methodname">execute(..)</code> method can be used to execute any
					arbitrary SQL, and as such is often used for DDL statements. It is heavily overloaded
					with variants taking callback interfaces, bind variable arrays, and suchlike.</p><pre class="programlisting">this.jdbcTemplate.execute("create table mytable (id integer, name varchar(100))");</pre><p>Invoking a simple stored procedure (more sophisticated stored procedure
					support is <a href="#jdbc-StoredProcedure" title="11.4.4.&nbsp;StoredProcedure">covered later</a>).</p><pre class="programlisting">this.jdbcTemplate.update("call SUPPORT.REFRESH_ACTORS_SUMMARY(?)", new Object[]{new Long(unionId)});</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="jdbc-JdbcTemplate-idioms"></a>11.2.1.2.&nbsp;<code class="classname">JdbcTemplate</code> idioms (best practices)</h4></div></div></div><p>Instances of the <code class="classname">JdbcTemplate</code> class are
				<span class="emphasis"><em>threadsafe once configured</em></span>. This is important because it
				means that you can configure a single instance of a <code class="classname">JdbcTemplate</code>
				and then safely inject this <span class="emphasis"><em>shared</em></span> reference into multiple
				DAOs (or repositories). To be clear, the <code class="classname">JdbcTemplate</code>
				is stateful, in that it maintains a reference to a <code class="interfacename">DataSource</code>,
				but this state is <span class="emphasis"><em>not</em></span> conversational state.</p><p>A common idiom when using the <code class="classname">JdbcTemplate</code> class
				(and the associated <a href="#jdbc-SimpleJdbcTemplate" title="11.2.3.&nbsp;SimpleJdbcTemplate"><code class="classname">SimpleJdbcTemplate</code></a>
				and <a href="#jdbc-NamedParameterJdbcTemplate" title="11.2.2.&nbsp;NamedParameterJdbcTemplate"><code class="classname">NamedParameterJdbcTemplate</code></a> classes)
				is to configure a <code class="interfacename">DataSource</code> in your Spring configuration file,
				and then dependency inject that shared <code class="interfacename">DataSource</code> bean
				into your DAO classes; the <code class="classname">JdbcTemplate</code> is created in the setter
				for the <code class="interfacename">DataSource</code>. This leads to DAOs that look
				in part like this:</p><pre class="programlisting">public class JdbcCorporateEventDao implements CorporateEventDao {

    private JdbcTemplate jdbcTemplate;

    public void setDataSource(DataSource dataSource) {
        <span class="bold"><strong>this.jdbcTemplate = new JdbcTemplate(dataSource);</strong></span>
    }

    <em class="lineannotation"><span class="lineannotation">// JDBC-backed implementations of the methods on the <code class="interfacename">CorporateEventDao</code> follow...</span></em>
}</pre><p>The attendant configuration might look like this.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd"&gt;

    &lt;bean id="corporateEventDao" class="com.example.JdbcCorporateEventDao"&gt;
        &lt;property name="dataSource" ref="dataSource"/&gt;
    &lt;/bean&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- the <code class="interfacename">DataSource</code> (parameterized for configuration via a <a href="#beans-factory-placeholderconfigurer" title="3.7.2.1.&nbsp;Example: the PropertyPlaceholderConfigurer"><code class="classname">PropertyPlaceHolderConfigurer</code></a>) --&gt;</span></em>
    &lt;bean id="dataSource" destroy-method="close" class="org.apache.commons.dbcp.BasicDataSource"&gt;
        &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;
        &lt;property name="url" value="${jdbc.url}"/&gt;
        &lt;property name="username" value="${jdbc.username}"/&gt;
        &lt;property name="password" value="${jdbc.password}"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre><p>If you are using Spring's <code class="classname">JdbcDaoSupport</code> class, and
				your various JDBC-backed DAO classes extend from it, then you inherit a
				<code class="methodname">setDataSource(..)</code> method for free from said superclass. It is
				totally up to you as to whether or not you inherit from said class, you certainly are
				not forced to. If you look at the source for the <code class="classname">JdbcDaoSupport</code>
				class you will see that there is not a whole lot to it... it is provided as a convenience
				only.</p><p>Regardless of which of the above template initialization styles you choose
				to use (or not), there is (almost) certainly no need to create a brand new
				instance of a <code class="classname">JdbcTemplate</code> class each and every time you wish
				to execute some SQL... remember, once configured, a <code class="classname">JdbcTemplate</code>
				instance is threadsafe. A reason for wanting multiple <code class="classname">JdbcTemplate</code>
				instances would be when you have an application that accesses multiple databases, which
				requires multiple <code class="interfacename">DataSources</code>, and subsequently
				multiple differently configured <code class="classname">JdbcTemplates</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-NamedParameterJdbcTemplate"></a>11.2.2.&nbsp;<code class="classname">NamedParameterJdbcTemplate</code></h3></div></div></div><p>
				The <code class="classname">NamedParameterJdbcTemplate</code> class adds support
				for programming JDBC statements using named parameters (as opposed to
				programming JDBC statements using only classic placeholder
				(<code class="literal">'?'</code>) arguments. The <code class="classname">NamedParameterJdbcTemplate</code> class wraps
				a <code class="classname">JdbcTemplate</code>, and delegates to the
				wrapped <code class="classname">JdbcTemplate</code> to do much of its work.
				This section will describe only those areas of the
				<code class="classname">NamedParameterJdbcTemplate</code> class that differ from
				the <code class="classname">JdbcTemplate</code> itself; namely, programming
				JDBC statements using named parameters.
			</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// some JDBC-backed DAO class...</span></em>
private NamedParameterJdbcTemplate namedParameterJdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.namedParameterJdbcTemplate = new NamedParameterJdbcTemplate(dataSource);
}

public int countOfActorsByFirstName(String firstName) {

    String sql = "select count(0) from T_ACTOR where first_name = :first_name";

    SqlParameterSource namedParameters = new MapSqlParameterSource("first_name", firstName);

    return namedParameterJdbcTemplate.queryForInt(sql, namedParameters);
}</pre><p>
				Notice the use of the named parameter notation in the value assigned
				to the <code class="literal">'sql'</code> variable, and the corresponding value
				that is plugged into the <code class="literal">'namedParameters'</code> variable
				(of type <code class="classname">MapSqlParameterSource</code>).
			</p><p>
				If you like, you can also pass along named parameters (and their
				corresponding values) to a <code class="classname">NamedParameterJdbcTemplate</code>
				instance using the (perhaps more familiar)
				<code class="interfacename">Map</code>-based style.
				(The rest of the methods exposed by the
				<code class="interfacename">NamedParameterJdbcOperations</code> - and implemented by the <code class="classname">NamedParameterJdbcTemplate</code> class)
				follow a similar pattern and will not be covered here.)
			</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// some JDBC-backed DAO class...</span></em>
private NamedParameterJdbcTemplate namedParameterJdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.namedParameterJdbcTemplate = new NamedParameterJdbcTemplate(dataSource);
}

public int countOfActorsByFirstName(String firstName) {

    String sql = "select count(0) from T_ACTOR where first_name = :first_name";

    Map namedParameters = Collections.singletonMap("first_name", firstName);

    return this.namedParameterJdbcTemplate.queryForInt(sql, namedParameters);
}</pre><p>
				Another nice feature related to the <code class="classname">NamedParameterJdbcTemplate</code>
				(and existing in the same Java package) is the <code class="interfacename">SqlParameterSource</code>
				interface. You have already seen an example of an implementation of this
				interface in one of the preceding code snippets (the <code class="classname">MapSqlParameterSource</code>
				class). The entire point of the <code class="interfacename">SqlParameterSource</code> is to serve as
				a source of named parameter values to a <code class="classname">NamedParameterJdbcTemplate</code>.
				The <code class="classname">MapSqlParameterSource</code> class is a very simple implementation, that
				is simply an adapter around a <code class="interfacename">java.util.Map</code>, where the keys
				are the paramter names and the values are the parameter values.
			</p><p>
				Another <code class="interfacename">SqlParameterSource</code> implementation is the
				<code class="classname">BeanPropertySqlParameterSource</code> class. This class wraps an arbitrary
				JavaBean (that is, an instance of a class that adheres to
				<a href="http://java.sun.com/products/javabeans/docs/spec.html" target="_top">the JavaBean conventions</a>),
				and uses the properties of the wrapped JavaBean as the source of named parameter values.
			</p><pre class="programlisting">public class Actor {

    private Long id;
    private String firstName;
    private String lastName;
    
    public String getFirstName() {
        return this.firstName;
    }
    
    public String getLastName() {
        return this.lastName;
    }
    
    public Long getId() {
        return this.id;
    }
    
    <em class="lineannotation"><span class="lineannotation">// setters omitted...</span></em>

}</pre><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// some JDBC-backed DAO class...</span></em>
private NamedParameterJdbcTemplate namedParameterJdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.namedParameterJdbcTemplate = new NamedParameterJdbcTemplate(dataSource);
}

public int countOfActors(Actor exampleActor) {

    <em class="lineannotation"><span class="lineannotation">// notice how the named parameters match the properties of the above '<code class="classname">Actor</code>' class</span></em>
    String sql = "select count(0) from T_ACTOR where first_name = :firstName and last_name = :lastName";

    SqlParameterSource namedParameters = new BeanPropertySqlParameterSource(exampleActor);

    return this.namedParameterJdbcTemplate.queryForInt(sql, namedParameters);
}</pre><p>
				Remember that the <code class="classname">NamedParameterJdbcTemplate</code> class
				<span class="emphasis"><em>wraps</em></span> a classic <code class="classname">JdbcTemplate</code>
				template; if you need access to the wrapped <code class="classname">JdbcTemplate</code> instance
				(to access some of the functionality only present in the <code class="classname">JdbcTemplate</code>
				class), then you can use the <code class="methodname">getJdbcOperations()</code>
				method to access the wrapped <code class="classname">JdbcTemplate</code>
				<span class="emphasis"><em>via the <code class="interfacename">JdbcOperations</code> interface</em></span>.
			</p><p>
				See also the section entitled <a href="#jdbc-JdbcTemplate-idioms" title="11.2.1.2.&nbsp;JdbcTemplate idioms (best practices)">Section&nbsp;11.2.1.2, &#8220;<code class="classname">JdbcTemplate</code> idioms (best practices)&#8221;</a> for some
				advice on how to best use the <code class="classname">NamedParameterJdbcTemplate</code> class
				in the context of an application.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SimpleJdbcTemplate"></a>11.2.3.&nbsp;<code class="classname">SimpleJdbcTemplate</code></h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
					<span class="emphasis"><em>The functionality offered by the <code class="classname">SimpleJdbcTemplate</code>
					is only available to you if you are using Java 5.</em></span>
				</p></td></tr></table></div><p>
				The <code class="classname">SimpleJdbcTemplate</code> class is a wrapper around
				the classic <code class="classname">JdbcTemplate</code> that takes advantage
				of Java 5 language features such as varargs and autoboxing. The
				<code class="classname">SimpleJdbcTemplate</code> class is somewhat of a sop
				to the syntactic-sugar-like features of Java 5, but as anyone who has
				developed on Java 5 and then had to move back to developing on a
				previous version of the JDK will know, those syntactic-sugar-like features sure are nice.
			</p><p>
				The value-add of the <code class="classname">SimpleJdbcTemplate</code> class
				in the area of syntactic-sugar is best illustrated with a
				<span class="emphasis"><em>'before and after'</em></span> example. The following code
				snippet shows first some data access code using the classic
				<code class="classname">JdbcTemplate</code>, followed immediately thereafter
				by a code snippet that does the same job, only this time using the
				<code class="classname">SimpleJdbcTemplate</code>.
			</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// classic <code class="classname">JdbcTemplate</code>-style...</span></em>
private JdbcTemplate jdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
}

public Actor findActor(long id) {
    String sql = "select id, first_name, last_name from T_ACTOR where id = ?";
    
    RowMapper mapper = new RowMapper() {
    
        public Object mapRow(ResultSet rs, int rowNum) throws SQLException {
            Actor actor = new Actor();
            actor.setId(rs.getLong("id"));
            actor.setFirstName(rs.getString("first_name"));
            actor.setLastName(rs.getString("last_name"));
            return actor;
        }
    };
    
    <em class="lineannotation"><span class="lineannotation">// notice the cast, the wrapping up of the 'id' argument
    // in an array, and the boxing of the 'id' argument as a reference type</span></em>
    return (Actor) jdbcTemplate.queryForObject(sql, mapper, new Object[] {Long.valueOf(id)});
}</pre><p>Here is the same method, only this time using the	<code class="classname">SimpleJdbcTemplate</code>;
			notice how much 'cleaner'the code is.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// <code class="classname">SimpleJdbcTemplate</code>-style...</span></em>
private SimpleJdbcTemplate simpleJdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.simpleJdbcTemplate = new SimpleJdbcTemplate(dataSource);
}
public Actor findActor(long id) {
    String sql = "select id, first_name, last_name from T_ACTOR where id = ?";

    ParameterizedRowMapper&lt;Actor&gt; mapper = new ParameterizedRowMapper&lt;Actor&gt;() {
    
        <em class="lineannotation"><span class="lineannotation">// notice the return type with respect to Java 5 covariant return types</span></em>
        public Actor mapRow(ResultSet rs, int rowNum) throws SQLException {
            Actor actor = new Actor();
            actor.setId(rs.getLong("id"));
            actor.setFirstName(rs.getString("first_name"));
            actor.setLastName(rs.getString("last_name"));
            return actor;
        }
    };

    return this.simpleJdbcTemplate.queryForObject(sql, mapper, id);
}</pre><p>
				See also the section entitled <a href="#jdbc-JdbcTemplate-idioms" title="11.2.1.2.&nbsp;JdbcTemplate idioms (best practices)">Section&nbsp;11.2.1.2, &#8220;<code class="classname">JdbcTemplate</code> idioms (best practices)&#8221;</a> for some
				advice on how to best use the <code class="classname">SimpleJdbcTemplate</code> class
				in the context of an application.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
					The <code class="classname">SimpleJdbcTemplate</code> class only offers
					a much smaller subset of the methods exposed on the <code class="classname">JdbcTemplate</code>
					class. If you need to use a method from the <code class="classname">JdbcTemplate</code> that
					is not defined on the <code class="classname">SimpleJdbcTemplate</code>, you can always
					access the underlying <code class="classname">JdbcTemplate</code> by calling the
					<code class="methodname">getJdbcOperations()</code> method on the <code class="classname">SimpleJdbcTemplate</code>,
					which will then allow you to invoke the method that you want. The only
					downside is that the methods on the <code class="interfacename">JdbcOperations</code>
					interface are not generified, so you are back to casting and such again.
				</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-datasource"></a>11.2.4.&nbsp;<code class="interfacename">DataSource</code></h3></div></div></div><p>
				In order to work with data from a database, one needs to obtain a
				connection to the database. The way Spring does this is through a
				<code class="interfacename">DataSource</code>. A
				<code class="interfacename">DataSource</code> is part
				of the JDBC specification and can be seen as a generalized connection
				factory. It allows a container or a framework to hide connection pooling
				and transaction management issues from the application code. As a
				developer, you don not need to know any details about how to connect to
				the database, that is the responsibility for the administrator that sets
				up the datasource. You will most likely have to fulfill both roles while
				you are developing and testing you code though, but you will not
				necessarily have to know how the production data source is configured.
			</p><p>
				When using Spring's JDBC layer, you can either obtain a data
				source from JNDI or you can configure your own, using an implementation
				that is provided in the Spring distribution. The latter comes in handy
				for unit testing outside of a web container. We will use the
				<code class="classname">DriverManagerDataSource</code> implementation for this
				section but there are several additional implementations that will be
				covered later on. The <code class="classname">DriverManagerDataSource</code> works
				the same way that you probably are used to work when you obtain a JDBC
				connection. You have to specify the fully qualified class name of the
				JDBC driver that you are using so that the
				<code class="classname">DriverManager</code> can load the driver class. Then you
				have to provide a url that varies between JDBC drivers. You have to
				consult the documentation for your driver for the correct value to use
				here. Finally you must provide a username and a password that will be
				used to connect to the database. Here is an example of how to configure
				a <code class="classname">DriverManagerDataSource</code>:
			</p><pre class="programlisting">DriverManagerDataSource dataSource = new DriverManagerDataSource();
dataSource.setDriverClassName("org.hsqldb.jdbcDriver");
dataSource.setUrl("jdbc:hsqldb:hsql://localhost:");
dataSource.setUsername("sa");
dataSource.setPassword("");</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SQLExceptionTranslator"></a>11.2.5.&nbsp;<code class="interfacename">SQLExceptionTranslator</code></h3></div></div></div><p>
				<code class="interfacename">SQLExceptionTranslator</code> is an interface to be
				implemented by classes that can translate between <code class="classname">SQLExceptions</code>
				and Spring's own data-access-strategy-agnostic
				<code class="classname">org.springframework.dao.DataAccessException</code>. Implementations can
				be generic (for example, using SQLState codes for JDBC) or proprietary (for example,
				using Oracle error codes) for greater precision.
			</p><p>
				<code class="classname">SQLErrorCodeSQLExceptionTranslator</code> is the
				implementation of <code class="interfacename">SQLExceptionTranslator</code> that is used by default. This
				implementation uses specific vendor codes. More precise than
				<code class="literal">SQLState</code> implementation, but vendor specific. The
				error code translations are based on codes held in a JavaBean type class
				named <code class="classname">SQLErrorCodes</code>. This class is created and
				populated by an <code class="classname">SQLErrorCodesFactory</code> which as the
				name suggests is a factory for creating <code class="classname">SQLErrorCodes</code>
				based on the contents of a configuration file named
				<code class="filename">'sql-error-codes.xml'</code>. This file is populated
				with vendor codes and based on the DatabaseProductName taken from the
				<code class="interfacename">DatabaseMetaData</code>, the codes for the current database are used.
			</p><p>
				The <code class="classname">SQLErrorCodeSQLExceptionTranslator</code> applies
				the following matching rules:
				</p><div class="itemizedlist"><ul type="disc" compact><li><p>
							Try custom translation implemented by any subclass. Note
							that this class is concrete and is typically used itself, in which
							case this rule does not apply.
						</p></li><li><p>
							Apply error code matching. Error codes are obtained from the
							<code class="classname">SQLErrorCodesFactory</code> by default. This looks
							up error codes from	the classpath and keys into them from the
							database name from the database metadata.
						</p></li><li><p>
							Use the fallback translator. <code class="classname">SQLStateSQLExceptionTranslator</code>
							is the default fallback translator.
						</p></li></ul></div><p>
			</p><p>
				<code class="classname">SQLErrorCodeSQLExceptionTranslator</code> can be extended the following way:
			</p><pre class="programlisting">public class MySQLErrorCodesTranslator extends SQLErrorCodeSQLExceptionTranslator {

    protected DataAccessException customTranslate(String task, String sql, SQLException sqlex) {
        if (sqlex.getErrorCode() == -12345) {
            return new DeadlockLoserDataAccessException(task, sqlex);
        }
        return null;
    }
}</pre><p>
				In this example the specific error code <code class="literal">'-12345'</code> is
				translated and any other errors are simply left to be translated by the
				default translator implementation. To use this custom translator, it is
				necessary to pass it to the <code class="classname">JdbcTemplate</code> using the
				method <code class="literal">setExceptionTranslator</code> and to use this
				<code class="classname">JdbcTemplate</code> for all of the data access processing
				where this translator is needed. Here is an example of how this custom
				translator can be used:
			</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// create a <code class="classname">JdbcTemplate</code> and set data source</span></em> 
JdbcTemplate jt = new JdbcTemplate(); 
jt.setDataSource(dataSource); 
<em class="lineannotation"><span class="lineannotation">// create a custom translator and set the <code class="interfacename">DataSource</code> for the default translation lookup</span></em> 
MySQLErrorCodesTransalator tr = new MySQLErrorCodesTransalator(); 
tr.setDataSource(dataSource); 
jt.setExceptionTranslator(tr); 
<em class="lineannotation"><span class="lineannotation">// use the <code class="classname">JdbcTemplate</code> for this <code class="classname">SqlUpdate</code></span></em>
SqlUpdate su = new SqlUpdate(); 
su.setJdbcTemplate(jt); 
su.setSql("update orders set shipping_charge = shipping_charge * 1.05"); 
su.compile(); 
su.update();</pre><p>
				The custom translator is passed a data source because we still want
				the default translation to look up the error codes in
				<code class="literal">sql-error-codes.xml</code>.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-statements-executing"></a>11.2.6.&nbsp;Executing statements</h3></div></div></div><p>
				To execute an SQL statement, there is very little code needed. All
				you need is a <code class="interfacename">DataSource</code> and a
				<code class="classname">JdbcTemplate</code>. Once you have that, you can use a
				number of convenience methods that are provided with the
				<code class="classname">JdbcTemplate</code>. Here is a short example showing what
				you need to include for a minimal but fully functional class that
				creates a new table.
			</p><pre class="programlisting">import javax.sql.DataSource;
import org.springframework.jdbc.core.JdbcTemplate;

public class ExecuteAStatement {

    private JdbcTemplate jdbcTemplate;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }

    public void doExecute() {
        this.jdbcTemplate.execute("create table mytable (id integer, name varchar(100))");
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-statements-querying"></a>11.2.7.&nbsp;Running Queries</h3></div></div></div><p>
				In addition to the execute methods, there is a large number of
				query methods. Some of these methods are intended to be used for queries
				that return a single value. Maybe you want to retrieve a count or a
				specific value from one row. If that is the case then you can use
				<code class="methodname">queryForInt(..)</code>, <code class="methodname">queryForLong(..)</code> or
				<code class="methodname">queryForObject(..)</code>. The latter will convert the returned
				JDBC <code class="classname">Type</code> to the Java class that is passed in as an argument. If the
				type conversion is invalid, then an
				<code class="exceptionname">InvalidDataAccessApiUsageException</code> will be thrown.
				Here is an example that contains two query methods, one for an
				<code class="classname">int</code> and one that queries for a <code class="classname">String</code>.
			</p><pre class="programlisting">import javax.sql.DataSource;
import org.springframework.jdbc.core.JdbcTemplate;

public class RunAQuery {

    private JdbcTemplate jdbcTemplate;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }
  
    public int getCount() {
        return this.jdbcTemplate.queryForInt("select count(*) from mytable");
    }

    public String getName() {
        return (String) this.jdbcTemplate.queryForObject("select name from mytable", String.class);
    }

    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }
}</pre><p>
				In addition to the single results query methods there are several
				methods that return a List with an entry for each row that the query
				returned. The most generic method is <code class="methodname">queryForList(..)</code> which
				returns a <code class="interfacename">List</code> where each entry is a
				<code class="interfacename">Map</code> with each entry in the map representing the
				column value for that row. If we add a method to the above example to
				retrieve a list of all the rows, it would look like this:
			</p><pre class="programlisting">
private JdbcTemplate jdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
}

public List getList() {
    return this.jdbcTemplate.queryForList("select * from mytable");
}</pre><p>
				The list returned would look something like this:
			</p><pre class="programlisting">[{name=Bob, id=1}, {name=Mary, id=2}]</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-updates"></a>11.2.8.&nbsp;Updating the database</h3></div></div></div><p> There are also a number of update methods that you can use. Find below an
				example where a column is updated for a certain primary key. In this example
				an SQL statement is used that has placeholders for row parameters. Note that
				the parameter values are passed in as an array of objects (and thus
				primitives have to be wrapped in the primitive wrapper classes). </p><pre class="programlisting">import javax.sql.DataSource;

import org.springframework.jdbc.core.JdbcTemplate;

public class ExecuteAnUpdate {

    private JdbcTemplate jdbcTemplate;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }

    public void setName(int id, String name) {
        this.jdbcTemplate.update("update mytable set name = ? where id = ?", new Object[] {name, new Integer(id)});
    }
}</pre><p> 
				One of the <code class="methodname">update</code> convenience methods provides support
				for acquiring the primary keys generated by the database (part of the JDBC 3.0 standard
				- see chapter 13.6 of the specification for details).
				The method takes a <code class="classname">PreparedStatementCreator</code> as its first argument,
				and this is the way the required insert statement is specified.  The other argument is a
				<code class="classname">KeyHolder</code>, which will contain the generated key on successful
				return from the update.  There is not a standard single way to create an 
				appropriate <code class="classname">PreparedStatement</code> (which explains why the method
				signature is the way it is).  An example that works on Oracle and may work on other
				platforms is:
			</p><pre class="programlisting">final String INSERT_SQL = "insert into my_test (name) values(?)";
final String name = "Rob";

KeyHolder keyHolder = new GeneratedKeyHolder();
jdbcTemplate.update(
    new PreparedStatementCreator() {
        public PreparedStatement createPreparedStatement(Connection connection) throws SQLException {
            PreparedStatement ps =
                connection.prepareStatement(INSERT_SQL, new String[] {"id"});
            ps.setString(1, name);
            return ps;
        }
    },
    keyHolder);

<em class="lineannotation"><span class="lineannotation">// keyHolder.getKey() now contains the generated key</span></em></pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-connections"></a>11.3.&nbsp;Controlling database connections</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-DataSourceUtils"></a>11.3.1.&nbsp;<code class="classname">DataSourceUtils</code></h3></div></div></div><p>
				The <code class="classname">DataSourceUtils</code> class is a convenient and
				powerful helper class that provides <code class="literal">static</code> methods to
				obtain connections from JNDI and close connections if necessary. It has
				support for thread-bound connections, for example for use with
				<code class="classname">DataSourceTransactionManager</code>.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SmartDataSource"></a>11.3.2.&nbsp;<code class="interfacename">SmartDataSource</code></h3></div></div></div><p>
				The <code class="interfacename">SmartDataSource</code> interface is to 
				be implemented by classes that can provide a connection to a relational
				database. Extends the <code class="interfacename">DataSource</code> interface to
				allow classes using it to query whether or not the connection should be
				closed after a given operation. This can sometimes be useful for efficiency,
				in the cases where one knows that one wants to reuse a connection.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-AbstractDataSource"></a>11.3.3.&nbsp;<code class="classname">AbstractDataSource</code></h3></div></div></div><p>
				This is an <code class="literal">abstract</code> base class for Spring's
				<code class="interfacename">DataSource</code> implementations, that takes
				care of the "uninteresting" glue. This is the class one would extend if
				one was writing one's own <code class="interfacename">DataSource</code>
				implementation.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SingleConnectionDataSource"></a>11.3.4.&nbsp;<code class="classname">SingleConnectionDataSource</code></h3></div></div></div><p>
				The <code class="classname">SingleConnectionDataSource</code> class is an
				implementation of the <code class="interfacename">SmartDataSource</code>
				interface that wraps a <span class="emphasis"><em>single</em></span>
				<code class="interfacename">Connection</code> that is <span class="emphasis"><em>not</em></span>
				closed after use. Obviously, this is not multi-threading capable.
			</p><p>
				If client code will call close in the assumption of a pooled
				connection, like when using persistence tools, set
				<code class="literal">suppressClose</code> to <code class="literal">true</code>. This will
				return a close-suppressing proxy instead of the physical connection.
				Be aware that you will not be able to cast this to a native Oracle
				<code class="interfacename">Connection</code> or the like anymore.
			</p><p>
				This is primarily a test class. For example, it enables easy
				testing of code outside an application server, in conjunction with a
				simple JNDI environment. In contrast to
				<code class="classname">DriverManagerDataSource</code>, it reuses the same
				connection all the time, avoiding excessive creation of physical
				connections.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-DriverManagerDataSource"></a>11.3.5.&nbsp;<code class="classname">DriverManagerDataSource</code></h3></div></div></div><p>
				The <code class="classname">DriverManagerDataSource</code> class is an
				implementation of the <code class="interfacename">SmartDataSource</code>
				interface that  configures a plain old JDBC Driver via bean properties,
				and returns a new connection every time.
			</p><p>
				This is potentially useful for test or standalone environments
				outside of a J2EE container, either as a <code class="interfacename">DataSource</code>
				bean in a Spring IoC container, or in conjunction with a simple
				JNDI environment. Pool-assuming <code class="literal">Connection.close()</code>
				calls will simply close the connection, so any <code class="interfacename">DataSource</code>-aware
				persistence code should work. However, using JavaBean style connection
				pools such as commons-dbcp is so easy, even in a test environment, that
				it is almost always preferable to use such a connection pool over
				<code class="classname">DriverManagerDataSource</code>.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-TransactionAwareDataSourceProxy"></a>11.3.6.&nbsp;<code class="classname">TransactionAwareDataSourceProxy</code></h3></div></div></div><p>
				<code class="classname">TransactionAwareDataSourceProxy</code> is a proxy for a target
				<code class="interfacename">DataSource</code>, which wraps that target
				<code class="interfacename">DataSource</code> to add awareness of
				Spring-managed transactions. In this respect it is similar to a
				transactional JNDI <code class="interfacename">DataSource</code> as provided by a J2EE
				server.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>It should almost never be necessary or desireable to use this
				class, except when existing code exists which must be called and passed
				a standard JDBC <code class="interfacename">DataSource</code> interface implementation.
				In this case, it's possible to still have this code be usable, but
				participating in Spring managed transactions. It is generally preferable
				to write your own new code using the higher level abstractions for
				resource management, such as <code class="classname">JdbcTemplate</code> or
				<code class="classname">DataSourceUtils</code>.</p></td></tr></table></div><p>
				<span class="emphasis"><em>(See the <code class="classname">TransactionAwareDataSourceProxy</code>
				Javadocs for more details.)</em></span>
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-DataSourceTransactionManager"></a>11.3.7.&nbsp;<code class="classname">DataSourceTransactionManager</code></h3></div></div></div><p>
				The <code class="classname">DataSourceTransactionManager</code> class is a
				<code class="interfacename">PlatformTransactionManager</code> implementation
				for single JDBC datasources. It binds a JDBC connection from the specified
				data source to the currently executing thread, potentially allowing for
				one thread connection per data source.
			</p><p>
				Application code is required to retrieve the JDBC connection via
				<code class="literal">DataSourceUtils.getConnection(DataSource)</code> instead of
				J2EE's standard <code class="literal">DataSource.getConnection</code>. This is
				recommended anyway, as it throws unchecked
				<code class="literal">org.springframework.dao</code> exceptions instead of checked
				<code class="exceptionname">SQLExceptions</code>. All framework classes like
				<code class="classname">JdbcTemplate</code> use this strategy implicitly. If not
				used with this transaction manager, the lookup strategy behaves exactly
				like the common one - it can thus be used in any case.
			</p><p>
				The <code class="classname">DataSourceTransactionManager</code> class supports
				custom isolation levels, and timeouts that get applied as
				appropriate JDBC statement query timeouts. To support the latter,
				application code must either use <code class="classname">JdbcTemplate</code> or call
				<code class="literal">DataSourceUtils.applyTransactionTimeout(..)</code> method for
				each created statement.
			</p><p>
				This implementation can be used instead of
				<code class="classname">JtaTransactionManager</code> in the single resource case, as
				it does not require the container to support JTA. Switching between both
				is just a matter of configuration, if you stick to the required
				connection lookup pattern. Note that JTA does not support custom
				isolation levels!
			</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-object"></a>11.4.&nbsp;Modeling JDBC operations as Java objects</h2></div></div></div><p>
			The <code class="literal">org.springframework.jdbc.object</code> package
			contains classes that allow one to access the database in a more
			object-oriented manner. By way of an example, one can execute queries
			and get the results back as a list containing business objects with
			the relational column data mapped to the properties of the business
			object. One can also execute stored procedures and run update, delete
			and insert statements.
		</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
				There is a view borne from experience acquired in the field
				amongst some of the Spring developers that the various RDBMS
				operation classes described below (with the exception of the
				<a href="#jdbc-StoredProcedure" title="11.4.4.&nbsp;StoredProcedure"><code class="classname">StoredProcedure</code></a>
				class) can often be replaced with straight <code class="classname">JdbcTemplate</code>
				calls... often it is simpler to use and plain easier to read a DAO method
				that simply calls a method on a <code class="classname">JdbcTemplate</code> direct
				(as opposed to encapsulating a query as a full-blown class).
			</p><p>
				It must be stressed however that this is just a <span class="emphasis"><em>view</em></span>...
				if you feel that you are getting measurable value from using the RDBMS
				operation classes, feel free to continue using these classes.
			</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SqlQuery"></a>11.4.1.&nbsp;<code class="classname">SqlQuery</code></h3></div></div></div><p>
				<code class="classname">SqlQuery</code> is a reusable, threadsafe class that
				encapsulates an SQL query. Subclasses must implement the
				<code class="methodname">newRowMapper(..)</code> method to provide a
				<code class="interfacename">RowMapper</code> instance that
				can create one object per row obtained from iterating over the
				<code class="interfacename">ResultSet</code> that is created during the
				execution of the query. The <code class="classname">SqlQuery</code> class is
				rarely used directly since the <code class="classname">MappingSqlQuery</code>
				subclass provides a much more convenient implementation for mapping
				rows to Java classes. Other	implementations that extend
				<code class="classname">SqlQuery</code> are
				<code class="classname">MappingSqlQueryWithParameters</code> and
				<code class="classname">UpdatableSqlQuery</code>.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-MappingSqlQuery"></a>11.4.2.&nbsp;<code class="classname">MappingSqlQuery</code></h3></div></div></div><p><code class="classname">MappingSqlQuery</code> is a reusable query in which
			concrete subclasses must implement the abstract
			<code class="methodname">mapRow(..)</code> method to convert each row of
			the supplied <code class="interfacename">ResultSet</code> into an object.
			Find below a brief example of a custom query that maps the data from the customer
			relation to an instance of the <code class="classname">Customer</code> class.</p><pre class="programlisting">private class CustomerMappingQuery extends MappingSqlQuery {

    public CustomerMappingQuery(DataSource ds) {
        super(ds, "SELECT id, name FROM customer WHERE id = ?");
        super.declareParameter(new SqlParameter("id", Types.INTEGER));
        compile();
    }

    public Object mapRow(ResultSet rs, int rowNumber) throws SQLException {
        Customer cust = new Customer();
        cust.setId((Integer) rs.getObject("id"));
        cust.setName(rs.getString("name"));
        return cust;
    } 
}</pre><p>
				We provide a constructor for this customer query that takes the
				<code class="interfacename">DataSource</code> as the only parameter. In this constructor
				we call the constructor on the superclass with the
				<code class="interfacename">DataSource</code> and the SQL that should be executed to
				retrieve the rows for this query. This SQL will be used to create a
				<code class="interfacename">PreparedStatement</code> so it may contain place holders for
				any parameters to be passed in during execution. Each parameter must be
				declared using the <code class="literal">declareParameter</code> method passing in
				an <code class="classname">SqlParameter</code>. The <code class="classname">SqlParameter</code>
				takes a name and the JDBC type as defined in
				<code class="classname">java.sql.Types</code>. After all parameters have been
				defined we call the <code class="literal">compile()</code> method so the statement
				can be prepared and later be executed.
			</p><pre class="programlisting">public Customer getCustomer(Integer id) {
    CustomerMappingQuery custQry = new CustomerMappingQuery(dataSource); 
    Object[] parms = new Object[1];
    parms[0] = id;
    List customers = custQry.execute(parms);
    if (customers.size() &gt; 0) {
        return (Customer) customers.get(0);
    }
    else {
        return null;
    }
}</pre><p>
				The method in this example retrieves the customer with the id that
				is passed in as the only parameter. After creating an instance of the
				<code class="classname">CustomerMappingQuery</code> class we create an array of
				objects that will contain all parameters that are passed in. In this
				case there is only one parameter and it is passed in as an
				<code class="classname">Integer</code>. Now we are ready to execute the query using
				this array of parameters and we get a <code class="literal">List</code> that
				contains a <code class="classname">Customer</code> object for each row that was
				returned for our query. In this case it will only be one entry if there
				was a match.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SqlUpdate"></a>11.4.3.&nbsp;<code class="classname">SqlUpdate</code></h3></div></div></div><p>The <code class="classname">SqlUpdate</code> class encapsulates an SQL update.
			Like a query, an update object is reusable, and like all
			<code class="classname">RdbmsOperation</code> classes, an update
			can have parameters and is defined in SQL. This class provides a number of
			<code class="methodname">update(..)</code> methods analogous to the
			<code class="methodname">execute(..)</code> methods of query objects.
			This class is concrete. Although it can be subclassed (for example
			to add a custom update method) it can easily be parameterized by setting
			SQL and declaring parameters.</p><pre class="programlisting">import java.sql.Types;

import javax.sql.DataSource;

import org.springframework.jdbc.core.SqlParameter;
import org.springframework.jdbc.object.SqlUpdate;

public class UpdateCreditRating extends SqlUpdate {

    public UpdateCreditRating(DataSource ds) {
        setDataSource(ds);
        setSql("update customer set credit_rating = ? where id = ?");
        declareParameter(new SqlParameter(Types.NUMERIC));
        declareParameter(new SqlParameter(Types.NUMERIC));
        compile();
    }

    <em class="lineannotation"><span class="lineannotation">/**
     * @param id for the Customer to be updated
     * @param rating the new value for credit rating
     * @return number of rows updated
     */</span></em>
    public int run(int id, int rating) {
        Object[] params =
            new Object[] {
                new Integer(rating),
                new Integer(id)};
        return update(params);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-StoredProcedure"></a>11.4.4.&nbsp;<code class="classname">StoredProcedure</code></h3></div></div></div><p>
				The <code class="classname">StoredProcedure</code> class is a superclass for object
				abstractions of RDBMS stored procedures. This class is <code class="literal">abstract</code>,
				and its various <code class="literal">execute(..)</code> methods have
				<code class="literal">protected</code> access, preventing use other than through a
				subclass that offers tighter typing.
			</p><p>
				The inherited <code class="literal">sql</code> property will be the name of the
				stored procedure in the RDBMS. Note that JDBC 3.0 introduces named
				parameters, although the other features provided by this class are
				still necessary in JDBC 3.0.
			</p><p>
				Here is an example of a program that calls a function, <code class="literal">sysdate()</code>,
				that comes with any Oracle database. To use the stored procedure
				functionality one has to create a class that extends
				<code class="classname">StoredProcedure</code>. There are no input parameters, but
				there is an output parameter that is declared as a date type using the class
				<code class="classname">SqlOutParameter</code>. The <code class="literal">execute()</code>
				method returns a map with an entry for each declared output parameter
				using the parameter name as the key.
			</p><pre class="programlisting">import java.sql.Types;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;

import javax.sql.DataSource;

import org.springframework.jdbc.core.SqlOutParameter;
import org.springframework.jdbc.datasource.*;
import org.springframework.jdbc.object.StoredProcedure;

public class TestStoredProcedure {

    public static void main(String[] args)  {
        TestStoredProcedure t = new TestStoredProcedure();
        t.test();
        System.out.println("Done!");
    }
    
    void test() {
        DriverManagerDataSource ds = new DriverManagerDataSource();
        ds.setDriverClassName("oracle.jdbc.OracleDriver");
        ds.setUrl("jdbc:oracle:thin:@localhost:1521:mydb");
        ds.setUsername("scott");
        ds.setPassword("tiger");

        MyStoredProcedure sproc = new MyStoredProcedure(ds);
        Map results = sproc.execute();
        printMap(results);
    }

    private class MyStoredProcedure extends StoredProcedure {
        
        private static final String SQL = "sysdate";

        public MyStoredProcedure(DataSource ds) {
            setDataSource(ds);
            setFunction(true);
            setSql(SQL);
            declareParameter(new SqlOutParameter("date", Types.DATE));
            compile();
        }

        public Map execute() {
            <em class="lineannotation"><span class="lineannotation">// the 'sysdate' sproc has no input parameters, so an empty Map is supplied...</span></em>
            return execute(new HashMap());
        }
    }

    private static void printMap(Map results) {
        for (Iterator it = results.entrySet().iterator(); it.hasNext(); ) {
            System.out.println(it.next());  
        }
    }
}</pre><p>
	        Find below an example of a <code class="classname">StoredProcedure</code> that
	        has two output parameters (in this case Oracle cursors).
		</p><pre class="programlisting">import oracle.jdbc.driver.OracleTypes;
import org.springframework.jdbc.core.SqlOutParameter;
import org.springframework.jdbc.object.StoredProcedure;

import javax.sql.DataSource;
import java.util.HashMap;
import java.util.Map;

public class TitlesAndGenresStoredProcedure extends StoredProcedure {

    private static final String SPROC_NAME = "AllTitlesAndGenres";

    public TitlesAndGenresStoredProcedure(DataSource dataSource) {
        super(dataSource, SPROC_NAME);
        declareParameter(new SqlOutParameter("titles", OracleTypes.CURSOR, new TitleMapper()));
        declareParameter(new SqlOutParameter("genres", OracleTypes.CURSOR, new GenreMapper()));
        compile();
    }

    public Map execute() {
        <em class="lineannotation"><span class="lineannotation">// again, this sproc has no input parameters, so an empty Map is supplied...</span></em>
        return super.execute(new HashMap());
    }
}</pre><p>
				Notice how the overloaded variants of the <code class="literal">declareParameter(..)</code>
				method that have been used in the <code class="classname">TitlesAndGenresStoredProcedure</code>
				constructor are passed <code class="interfacename">RowMapper</code> implementation
				instances; this is a very convenient and powerful way to reuse existing
				functionality. (The code for the two <code class="interfacename">RowMapper</code>
				implementations is provided below in the interest of completeness.)
			</p><p>
				Firstly the <code class="classname">TitleMapper</code> class, which simply
				maps a <code class="interfacename">ResultSet</code> to a <code class="classname">Title</code>
				domain object for each row in the supplied <code class="interfacename">ResultSet</code>.
			</p><pre class="programlisting">import com.foo.sprocs.domain.Title;
import org.springframework.jdbc.core.RowMapper;

import java.sql.ResultSet;
import java.sql.SQLException;

public final class TitleMapper implements RowMapper {
    
    public Object mapRow(ResultSet rs, int rowNum) throws SQLException {
        Title title = new Title();
        title.setId(rs.getLong("id"));
        title.setName(rs.getString("name"));
        return title;
    }
}</pre><p>Secondly, the <code class="classname">GenreMapper</code> class, which again simply
			maps a <code class="interfacename">ResultSet</code> to a <code class="classname">Genre</code>
			domain object for each row in the supplied <code class="interfacename">ResultSet</code>.</p><pre class="programlisting">import org.springframework.jdbc.core.RowMapper;

import java.sql.ResultSet;
import java.sql.SQLException;

import com.foo.domain.Genre;

public final class GenreMapper implements RowMapper {
    
    public Object mapRow(ResultSet rs, int rowNum) throws SQLException {
        return new Genre(rs.getString("name"));
    }
}</pre><p>
				If one needs to pass parameters to a stored procedure (that is
				the stored procedure has been declared as having one or more input
				parameters in its definition in the RDBMS), one would code a
				strongly typed <code class="literal">execute(..)</code> method which would delegate
				to the superclass' (untyped) <code class="literal">execute(Map parameters)</code>
				(which has <code class="literal">protected</code> access); for example:</p><pre class="programlisting">import oracle.jdbc.driver.OracleTypes;
import org.springframework.jdbc.core.SqlOutParameter;
import org.springframework.jdbc.object.StoredProcedure;

import javax.sql.DataSource;
import java.util.HashMap;
import java.util.Map;

public class TitlesAfterDateStoredProcedure extends StoredProcedure {

    private static final String SPROC_NAME = "TitlesAfterDate";
    private static final String CUTOFF_DATE_PARAM = "cutoffDate";

    public TitlesAfterDateStoredProcedure(DataSource dataSource) {
        super(dataSource, SPROC_NAME);
        declareParameter(new SqlParameter(CUTOFF_DATE_PARAM, Types.DATE);
        declareParameter(new SqlOutParameter("titles", OracleTypes.CURSOR, new TitleMapper()));
        compile();
    }

    public Map execute(Date cutoffDate) {
        Map inputs = new HashMap();
        inputs.put(CUTOFF_DATE_PARAM, cutoffDate);
        return super.execute(inputs);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SqlFunction"></a>11.4.5.&nbsp;<code class="classname">SqlFunction</code></h3></div></div></div><p>
				The <code class="classname">SqlFunction</code> RDBMS operation class encapsulates an
				SQL "function" wrapper for a query that returns a single row of
				results. The default behavior is to return an <code class="literal">int</code>, but that
				can be overridden by using the methods with an extra return type parameter.
				This is similar to using the <code class="literal">queryForXxx</code> methods of
				the <code class="classname">JdbcTemplate</code>. The advantage with
				<code class="classname">SqlFunction</code> is that you don't have to create the
				<code class="classname">JdbcTemplate</code>, it is done behind the scenes.
			</p><p>
				This class is intended to use to call SQL functions that return a
				single result using a query like "select user()" or "select sysdate from
				dual". It is not intended for calling more complex stored functions or
				for using a <code class="classname">CallableStatement</code> to invoke a stored
				procedure or stored function. (Use the <code class="classname">StoredProcedure</code> or
				<code class="classname">SqlCall</code> classes for this type of processing).
			</p><p>
				<code class="classname">SqlFunction</code> is a concrete class, and there is typically
				no need to subclass it. Code using this package can create an object of this type,
				declaring SQL and parameters, and then invoke the appropriate run method
				repeatedly to execute the function. Here is an example of retrieving the
				count of rows from a table:
			</p><pre class="programlisting">public int countRows() {
    SqlFunction sf = new SqlFunction(dataSource, "select count(*) from mytable");
    sf.compile();
    return sf.run();
}</pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="orm"></a>Chapter&nbsp;12.&nbsp;Object Relational Mapping (ORM) data access</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-introduction"></a>12.1.&nbsp;Introduction</h2></div></div></div><p>The Spring Framework provides integration with <span class="emphasis"><em>Hibernate,
    JDO, Oracle TopLink, iBATIS SQL Maps</em></span> and <span class="emphasis"><em>JPA</em></span>:
    in terms of resource management, DAO implementation support, and transaction
    strategies. For example for Hibernate, there is first-class support with
    lots of IoC convenience features, addressing many typical Hibernate
    integration issues. All of these support packages for O/R (Object Relational)
    mappers comply with Spring's generic transaction and DAO exception hierarchies.
    There are usually two integration styles: either using Spring's DAO 'templates'
    or coding DAOs against plain Hibernate/JDO/TopLink/etc APIs. In both cases,
    DAOs can be configured through Dependency Injection and participate in
    Spring's resource and transaction management.</p><p>Spring adds significant support when using the O/R mapping layer
    of your choice to create data access applications. First of all, you
    should know that once you started using Spring's support for O/R mapping,
    you don't have to go all the way. No matter to what extent, you're invited
    to review and leverage the Spring approach, before deciding to take the
    effort and risk of building a similar infrastructure in-house. Much of the
    O/R mapping support, no matter what technology you're using may be used in
    a library style, as everything is designed as a set of reusable JavaBeans.
    Usage inside a Spring IoC container does provide additional benefits in
    terms of ease of configuration and deployment; as such, most examples in
    this section show configuration inside a Spring container.</p><p>Some of the benefits of using the Spring Framework to create your
    ORM DAOs include:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>Ease of testing.</em></span> Spring's IoC approach makes it
        easy to swap the implementations and config locations of Hibernate 
        <code class="interfacename">SessionFactory</code>
        instances, JDBC <code class="interfacename">DataSource</code> instances,
        transaction managers, and mapper object implementations (if needed).
        This makes it much easier to isolate and test each piece of
        persistence-related code in isolation.</p></li><li><p><span class="emphasis"><em>Common data access exceptions.</em></span> Spring can
        wrap exceptions from your O/R mapping tool of choice, converting them
        from proprietary (potentially checked) exceptions to a common runtime
        DataAccessException hierarchy. This allows you to handle most
        persistence exceptions, which are non-recoverable, only in the
        appropriate layers, without annoying boilerplate catches/throws, and
        exception declarations. You can still trap and handle exceptions
        anywhere you need to. Remember that JDBC exceptions (including DB
        specific dialects) are also converted to the same hierarchy, meaning
        that you can perform some operations with JDBC within a consistent
        programming model.</p></li><li><p><span class="emphasis"><em>General resource management.</em></span> Spring
        application contexts can handle the location and configuration of
        Hibernate <code class="interfacename">SessionFactory</code> instances,
        JDBC <code class="interfacename">DataSource</code> instances, iBATIS SQL
        Maps configuration objects, and other related resources. This makes
        these values easy to manage and change. Spring offers efficient, easy
        and safe handling of persistence resources. For example: related code
        using Hibernate generally needs to use the same Hibernate
        <code class="interfacename">Session</code> for efficiency and proper
        transaction handling. Spring makes it easy to transparently create and
        bind a <code class="interfacename">Session</code> to the current thread,
        either by using an explicit 'template' wrapper class at the Java code
        level or by exposing a current <code class="interfacename">Session</code>
        through the Hibernate <code class="interfacename">SessionFactory</code>
        (for DAOs based on plain Hibernate API). Thus Spring solves many of
        the issues that repeatedly arise from typical Hibernate usage, for any
        transaction environment (local or JTA).</p></li><li><p><span class="emphasis"><em>Integrated transaction management.</em></span> Spring
        allows you to wrap your O/R mapping code with either a declarative,
        AOP style method interceptor, or an explicit 'template' wrapper class
        at the Java code level. In either case, transaction semantics are
        handled for you, and proper transaction handling (rollback, etc) in
        case of exceptions is taken care of. As discussed below, you also get
        the benefit of being able to use and swap various transaction
        managers, without your Hibernate/JDO related code being affected: for
        example, between local transactions and JTA, with the same full
        services (such as declarative transactions) available in both
        scenarios. As an additional benefit, JDBC-related code can fully
        integrate transactionally with the code you use to do O/R mapping.
        This is useful for data access that's not suitable for O/R mapping,
        such as batch processing or streaming of BLOBs, which still needs to
        share common transactions with ORM operations.</p></li></ul></div><p>The PetClinic sample in the Spring distribution offers alternative
    DAO implementations and application context configurations for JDBC,
    Hibernate, Oracle TopLink, and JPA. PetClinic can therefore serve as
    working sample app that illustrates the use of Hibernate, TopLink and JPA
    in a Spring web application. It also leverages declarative transaction
    demarcation with different transaction strategies.</p><p>The JPetStore sample illustrates the use of iBATIS SQL Maps in a
    Spring environment. It also features two web tier versions: one based on
    Spring Web MVC, one based on Struts.</p><p>Beyond the samples shipped with Spring, there are a variety of
    Spring-based O/R mapping samples provided by specific vendors: for
    example, the JDO implementations JPOX (<a href="http://www.jpox.org/" target="_top">http://www.jpox.org/</a>)
    and Kodo (<a href="http://www.bea.com/kodo/" target="_top">http://www.bea.com/kodo/</a>).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-hibernate"></a>12.2.&nbsp;Hibernate</h2></div></div></div><p>We will start with a coverage of <a href="http://www.hibernate.org/" target="_top">Hibernate 3</a> in a Spring
    environment, using it to demonstrate the approach that Spring takes towards integrating O/R mappers. This section
    will cover many issues in detail and show different variations of DAO implementations and transaction demarcations.
    Most of these patterns can be directly translated to all other supported ORM tools. The following sections in this
    chapter will then cover the other ORM technologies, showing briefer examples there.</p><p>The following discussion focuses on Hibernate 3: this is the current
    major production ready version of Hibernate. Hibernate 2.x, which has been
    supported in Spring since its inception continues to be supported... it is
    just that the following examples all use the Hibernate 3 classes and
    configuration. All of this can (pretty much) be applied to Hibernate 2.x
    as-is, using the analogous Hibernate 2.x support package:
    <code class="literal">org.springframework.orm.hibernate</code>, mirroring
    <code class="literal">org.springframework.orm.hibernate3</code> with analogous
    support classes for Hibernate 2.x. Furthermore, all references to the
    <code class="literal">org.hibernate</code> package need to be replaced with
    <code class="literal">net.sf.hibernate</code>, following the root package change in
    Hibernate 3. Simply adapt the package names (as used in the examples)
    accordingly.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-resource-mngmnt"></a>12.2.1.&nbsp;Resource management</h3></div></div></div><p>Typical business applications are often cluttered with repetitive
      resource management code. Many projects try to invent their own
      solutions for this issue, sometimes sacrificing proper handling of
      failures for programming convenience. Spring advocates strikingly simple
      solutions for proper resource handling, namely IoC via
      templating; for example infrastructure classes with callback interfaces, or
      applying AOP interceptors. The infrastructure cares for proper resource
      handling, and for appropriate conversion of specific API exceptions to
      an unchecked infrastructure exception hierarchy. Spring introduces a DAO
      exception hierarchy, applicable to any data access strategy. For direct
      JDBC, the <code class="classname">JdbcTemplate</code> class mentioned in a
      previous section cares for connection handling, and for proper
      conversion of <code class="classname">SQLException</code> to the
      <code class="classname">DataAccessException</code> hierarchy, including
      translation of database-specific SQL error codes to meaningful exception
      classes. It supports both JTA and JDBC transactions, via respective
      Spring transaction managers.</p><p>Spring also offers Hibernate and JDO support, consisting of a
      <code class="classname">HibernateTemplate</code> /
      <code class="classname">JdoTemplate</code> analogous to
      <code class="classname">JdbcTemplate</code>, a
      <code class="classname">HibernateInterceptor</code> /
      <code class="classname">JdoInterceptor</code>, and a Hibernate / JDO transaction
      manager. The major goal is to allow for clear application layering, with
      any data access and transaction technology, and for loose coupling of
      application objects. No more business service dependencies on the data
      access or transaction strategy, no more hard-coded resource lookups, no
      more hard-to-replace singletons, no more custom service registries. One
      simple and consistent approach to wiring up application objects, keeping
      them as reusable and free from container dependencies as possible. All
      the individual data access features are usable on their own but
      integrate nicely with Spring's application context concept, providing
      XML-based configuration and cross-referencing of plain JavaBean
      instances that don't need to be Spring-aware. In a typical Spring app,
      many important objects are JavaBeans: data access templates, data access
      objects (that use the templates), transaction managers, business
      services (that use the data access objects and transaction managers),
      web view resolvers, web controllers (that use the business services),and so on.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-session-factory-setup"></a>12.2.2.&nbsp;<code class="interfacename">SessionFactory</code> setup in a Spring container</h3></div></div></div><p>To avoid tying application objects to hard-coded resource lookups,
      Spring allows you to define resources like a JDBC <code class="interfacename">DataSource</code> or a
      Hibernate <code class="interfacename">SessionFactory</code> as beans in an
      application context. Application objects that need to access resources
      just receive references to such pre-defined instances via bean
      references (the DAO definition in the next section illustrates this).
      The following excerpt from an XML application context definition shows
      how to set up a JDBC <code class="classname">DataSource</code> and a Hibernate
      <code class="interfacename">SessionFactory</code> on top of it:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myDataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName" value="org.hsqldb.jdbcDriver"/&gt;
    &lt;property name="url" value="jdbc:hsqldb:hsql://localhost:9001"/&gt;
    &lt;property name="username" value="sa"/&gt;
    &lt;property name="password" value=""/&gt;
  &lt;/bean&gt;

  &lt;bean id="mySessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
    &lt;property name="dataSource" ref="myDataSource"/&gt;
    &lt;property name="mappingResources"&gt;
      &lt;list&gt;
        &lt;value&gt;product.hbm.xml&lt;/value&gt;
      &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="hibernateProperties"&gt;
      &lt;value&gt;
        hibernate.dialect=org.hibernate.dialect.HSQLDialect
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>Note that switching from a local Jakarta Commons DBCP
      <code class="classname">BasicDataSource</code> to a JNDI-located
      <code class="interfacename">DataSource</code> (usually managed by an
      application server) is just a matter of configuration:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myDataSource" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName" value="java:comp/env/jdbc/myds"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>You can also access a JNDI-located <code class="interfacename">SessionFactory</code>,
      using Spring's <code class="classname">JndiObjectFactoryBean</code> to retrieve and expose it.
      However, that is typically not common outside of an EJB context.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-template"></a>12.2.3.&nbsp;The <code class="classname">HibernateTemplate</code></h3></div></div></div><p>The basic programming model for templating looks as follows, for
      methods that can be part of any custom data access object or business
      service. There are no restrictions on the implementation of the
      surrounding object at all, it just needs to provide a Hibernate
      <code class="interfacename">SessionFactory</code>. It can get the latter
      from anywhere, but preferably as bean reference from a Spring
      IoC container - via a simple
      <code class="methodname">setSessionFactory(..)</code> bean property setter. The
      following snippets show a DAO definition in a Spring container, referencing the
      above defined <code class="interfacename">SessionFactory</code>, and an example
      for a DAO method implementation.</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private HibernateTemplate hibernateTemplate;

    public void setSessionFactory(SessionFactory sessionFactory) {
        this.hibernateTemplate = new HibernateTemplate(sessionFactory);
    }

    public Collection loadProductsByCategory(String category) throws DataAccessException {
    	return this.hibernateTemplate.find("from test.Product product where product.category=?", category);
    }
}</pre><p>The <code class="classname">HibernateTemplate</code> class provides many methods
	  that mirror the methods exposed on the Hibernate <code class="interfacename">Session</code>
	  interface, in addition to a number of convenience methods such as the one shown above.
	  If you need access to the <code class="interfacename">Session</code> to invoke
	  methods that are not exposed on the <code class="classname">HibernateTemplate</code>, you
	  can always drop down to a callback-based approach like so.</p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private HibernateTemplate hibernateTemplate;

    public void setSessionFactory(SessionFactory sessionFactory) {
        this.hibernateTemplate = new HibernateTemplate(sessionFactory);
    }

    public Collection loadProductsByCategory(final String category) throws DataAccessException {
        return this.hibernateTemplate.execute(new HibernateCallback() {
            public Object doInHibernate(Session session) {
                Criteria criteria = session.createCriteria(Product.class);
                criteria.add(Expression.eq("category", category));
                criteria.setMaxResults(6);
                return criteria.list();
            }
        };
    }
}</pre><p>A callback implementation effectively can be used for any
      Hibernate data access. <code class="classname">HibernateTemplate</code> will
      ensure that <code class="interfacename">Session</code> instances are
      properly opened and closed, and automatically participate in
      transactions. The template instances are thread-safe and reusable, they
      can thus be kept as instance variables of the surrounding class. For
      simple single step actions like a single find, load, saveOrUpdate, or
      delete call, <code class="classname">HibernateTemplate</code> offers alternative
      convenience methods that can replace such one line callback
      implementations. Furthermore, Spring provides a convenient
      <code class="classname">HibernateDaoSupport</code> base class that provides a
      <code class="methodname">setSessionFactory(..)</code> method for receiving a
      <code class="interfacename">SessionFactory</code>, and
      <code class="methodname">getSessionFactory()</code> and
      <code class="methodname">getHibernateTemplate()</code>for use by subclasses. In
      combination, this allows for very simple DAO implementations for typical
      requirements:</p><pre class="programlisting">public class ProductDaoImpl extends HibernateDaoSupport implements ProductDao {

    public Collection loadProductsByCategory(String category) throws DataAccessException {
        return this.getHibernateTemplate().find(
            "from test.Product product where product.category=?", category);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-daos"></a>12.2.4.&nbsp;Implementing Spring-based DAOs without callbacks</h3></div></div></div><p>As alternative to using Spring's
      <code class="classname">HibernateTemplate</code> to implement DAOs, data access
      code can also be written in a more traditional fashion, without wrapping
      the Hibernate access code in a callback, while still respecting and
	  participating in Spring's generic <code class="classname">DataAccessException</code>
	  hierarchy.
      The <code class="classname">HibernateDaoSupport</code> base class offers
      methods to access the current transactional
      <code class="interfacename">Session</code> and to convert exceptions in such
      a scenario; similar methods are also available as static helpers on the
      <code class="classname">SessionFactoryUtils</code> class. Note that such code
      will usually pass '<code class="literal">false</code>' as the value of the
	  <code class="methodname">getSession(..)</code> methods '<code class="literal">allowCreate</code>'
	  argument, to enforce running within a transaction (which
      avoids the need to close the returned <code class="interfacename">Session</code>, as
      its lifecycle is managed by the transaction).</p><pre class="programlisting">public class HibernateProductDao extends HibernateDaoSupport implements ProductDao {

    public Collection loadProductsByCategory(String category) throws DataAccessException, MyException {
        Session session = getSession(false);
        try {
            Query query = session.createQuery("from test.Product product where product.category=?");
            query.setString(0, category);
            List result = query.list();
            if (result == null) {
                throw new MyException("No search results.");
            }
            return result;
        }
        catch (HibernateException ex) {
            throw convertHibernateAccessException(ex);
        }
    }
}</pre><p>The advantage of such direct Hibernate access code is that
      it allows <span class="emphasis"><em>any</em></span> checked application exception to
	  be thrown within the data access code; contrast this to the
	  <code class="classname">HibernateTemplate</code> class which is
      restricted to throwing only unchecked exceptions within the callback.
	  Note that you can often defer the corresponding checks and the throwing
	  of application exceptions to after the callback, which still allows
	  working with <code class="classname">HibernateTemplate</code>. In general, the
      <code class="classname">HibernateTemplate</code> class' convenience methods are
      simpler and more convenient for many scenarios.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-straight"></a>12.2.5.&nbsp;Implementing DAOs based on plain Hibernate 3 API</h3></div></div></div><p>Hibernate 3.0.1 introduced a feature called "contextual Sessions",
      where Hibernate itself manages one current
      <code class="interfacename">Session</code> per transaction. This is roughly
      equivalent to Spring's synchronization of one Hibernate
      <code class="interfacename">Session</code> per transaction. A corresponding
      DAO implementation looks like as follows, based on the plain Hibernate API:</p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private SessionFactory sessionFactory;

    public void setSessionFactory(SessionFactory sessionFactory) {
        this.sessionFactory = sessionFactory;
    }

    public Collection loadProductsByCategory(String category) {
        return this.sessionFactory.getCurrentSession()
                .createQuery("from test.Product product where product.category=?")
                .setParameter(0, category)
                .list();
    }
}</pre><p>This style is very similar to what you will find in the Hibernate
	  reference documentation and examples, except for holding the
      <code class="interfacename">SessionFactory</code> in an instance variable.
      We strongly recommend such an instance-based setup over the old-school
      <code class="literal">static</code> <code class="classname">HibernateUtil</code> class
      from Hibernate's CaveatEmptor sample application. (In general, do not
      keep any resources in <code class="literal">static</code> variables unless
      <span class="emphasis"><em>absolutely</em></span> necessary.)</p><p>The above DAO follows the Dependency Injection pattern: it fits
      nicely into a Spring IoC container, just like it would if
      coded against Spring's <code class="classname">HibernateTemplate</code>. Of course,
      such a DAO can also be set up in plain Java (for example, in unit tests):
	  simply instantiate it and call <code class="methodname">setSessionFactory(..)</code>
	  with the desired factory reference. As a Spring bean definition, it would
      look as follows:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>The main advantage of this DAO style is that it depends on
      Hibernate API only; no import of any Spring class is required. This is
      of course appealing from a non-invasiveness perspective, and will no doubt
      feel more natural to Hibernate developers.</p><p>However, the DAO throws plain <code class="classname">HibernateException</code>
      (which is unchecked, so does not have to be declared or caught), which means
      that callers can only treat exceptions as generally fatal - unless they want to
      depend on Hibernate's own exception hierarchy. Catching specific causes such as
      an optimistic locking failure is not possible without tieing the caller to
      the implementation strategy. This tradeoff might be acceptable to
      applications that are strongly Hibernate-based and/or do not need any
      special exception treatment.</p><p>Fortunately, Spring's
      <code class="classname">LocalSessionFactoryBean</code> supports Hibernate's
      <code class="methodname">SessionFactory.getCurrentSession()</code> method for any
      Spring transaction strategy, returning the current Spring-managed
      transactional <code class="interfacename">Session</code> even with
      <code class="classname">HibernateTransactionManager</code>. Of course, the
      standard behavior of that method remains: returning the current
      <code class="interfacename">Session</code> associated with the ongoing JTA
      transaction, if any (no matter whether driven by Spring's
      <code class="classname">JtaTransactionManager</code>, by EJB CMT, or by JTA).</p><p>In summary: DAOs can be implemented based on the plain Hibernate 3
      API, while still being able to participate in Spring-managed transactions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-tx-programmatic"></a>12.2.6.&nbsp;Programmatic transaction demarcation</h3></div></div></div><p>Transactions can be demarcated in a higher level of the application,
      on top of such lower-level data access services spanning any number
      of operations. There are no restrictions on the implementation of the
      surrounding business service here as well, it just needs a Spring
      <code class="classname">PlatformTransactionManager</code>. Again, the latter can
      come from anywhere, but preferably as bean reference via a
      <code class="methodname">setTransactionManager(..)</code> method - just like
      the <code class="classname">productDAO</code> should be set via a
      <code class="methodname">setProductDao(..)</code> method. The following snippets
      show a transaction manager and a business service definition in a Spring
      application context, and an example for a business method implementation.</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myTxManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="product.ProductServiceImpl"&gt;
    &lt;property name="transactionManager" ref="myTxManager"/&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><pre class="programlisting">public class ProductServiceImpl implements ProductService {

    private TransactionTemplate transactionTemplate;
    private ProductDao productDao;

    public void setTransactionManager(PlatformTransactionManager transactionManager) {
        this.transactionTemplate = new TransactionTemplate(transactionManager);
    }

    public void setProductDao(ProductDao productDao) {
        this.productDao = productDao;
    }

    public void increasePriceOfAllProductsInCategory(final String category) {
        this.transactionTemplate.execute(new TransactionCallbackWithoutResult() {

                public void doInTransactionWithoutResult(TransactionStatus status) {
                    List productsToChange = this.productDao.loadProductsByCategory(category);
                    <em class="lineannotation"><span class="lineannotation">// do the price increase...</span></em>
                }
            }
        );
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-tx-declarative"></a>12.2.7.&nbsp;Declarative transaction demarcation</h3></div></div></div><p>Alternatively, one can use Spring's declarative transaction
      support, which essentially enables you to replace explicit transaction
      demarcation API calls in your Java code with an AOP transaction
      interceptor configured in a Spring container. This allows you
      to keep business services free of repetitive transaction demarcation
      code, and allows you to focus on adding business logic which is where
      the real value of your application lies. Furthermore, transaction
      semantics like propagation behavior and isolation level can be changed
      in a configuration file and do not affect the business service implementations.</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myTxManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
    &lt;property name="proxyInterfaces" value="product.ProductService"/&gt;
    &lt;property name="target"&gt;
        &lt;bean class="product.DefaultProductService"&gt;
            &lt;property name="productDao" ref="myProductDao"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name="interceptorNames"&gt;
      &lt;list&gt;
        &lt;value&gt;myTxInterceptor&lt;/value&gt; <em class="lineannotation"><span class="lineannotation">&lt;!-- the transaction interceptor (configured elsewhere) --&gt;</span></em>
      &lt;/list&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><pre class="programlisting">public class ProductServiceImpl implements ProductService {

    private ProductDao productDao;

    public void setProductDao(ProductDao productDao) {
        this.productDao = productDao;
    }

    <em class="lineannotation"><span class="lineannotation">// notice the absence of transaction demarcation code in this method</span></em>
    <em class="lineannotation"><span class="lineannotation">// Spring's declarative transaction infrastructure will be demarcating transactions on your behalf </span></em>
    public void increasePriceOfAllProductsInCategory(final String category) {
        List productsToChange = this.productDao.loadProductsByCategory(category);
        <em class="lineannotation"><span class="lineannotation">// ...</span></em>
    }
}</pre><p>Spring's <code class="classname">TransactionInterceptor</code> allows any
      checked application exception to be thrown with the callback code, while
      <code class="classname">TransactionTemplate</code> is restricted to unchecked
      exceptions within the callback.
      <code class="classname">TransactionTemplate</code> will trigger a rollback in
      case of an unchecked application exception, or if the transaction has
      been marked rollback-only by the application (via <code class="classname">TransactionStatus</code>).
      <code class="classname">TransactionInterceptor</code> behaves the same way by
      default but allows configurable rollback policies per method.</p><p>The following higher level approach to declarative transactions
      doesn't use the <code class="classname">ProxyFactoryBean</code>, and as such may
      be easier to use if you have a large number of service objects that you
      wish to make transactional.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You are <span class="emphasis"><em>strongly</em></span> encouraged to read the section
        entitled <a href="#transaction-declarative" title="9.5.&nbsp;Declarative transaction management">Section&nbsp;9.5, &#8220;Declarative transaction management&#8221;</a> if you have not done so
        already prior to continuing.</p></td></tr></table></div><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!-- <code class="interfacename">SessionFactory</code>, <code class="interfacename">DataSource</code>, etc. omitted --&gt;</span></em>

  &lt;bean id="myTxManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;
  
  &lt;aop:config&gt;
    &lt;aop:pointcut id="productServiceMethods" expression="execution(* product.ProductService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="productServiceMethods"/&gt;
  &lt;/aop:config&gt;

  &lt;tx:advice id="txAdvice" transaction-manager="myTxManager"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="increasePrice*" propagation="REQUIRED"/&gt;
      &lt;tx:method name="someOtherBusinessMethod" propagation="REQUIRES_NEW"/&gt;
      &lt;tx:method name="*" propagation="SUPPORTS" read-only="true"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

  &lt;bean id="myProductService" class="product.SimpleProductService"&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-tx-strategies"></a>12.2.8.&nbsp;Transaction management strategies</h3></div></div></div><p>Both <code class="classname">TransactionTemplate</code> and
      <code class="classname">TransactionInterceptor</code> delegate the actual
      transaction handling to a
      <code class="classname">PlatformTransactionManager</code> instance, which can be
      a <code class="classname">HibernateTransactionManager</code> (for a single
      Hibernate <code class="interfacename">SessionFactory</code>, using a
      <code class="classname">ThreadLocal</code>
      <code class="interfacename">Session</code> under the hood) or a
      <code class="classname">JtaTransactionManager</code> (delegating to the JTA
      subsystem of the container) for Hibernate applications. You could even
      use a custom <code class="classname">PlatformTransactionManager</code>
      implementation. So switching from native Hibernate transaction
      management to JTA, such as when facing distributed transaction requirements
      for certain deployments of your application, is just a matter of
      configuration. Simply replace the Hibernate transaction manager with
      Spring's JTA transaction implementation. Both transaction demarcation
      and data access code will work without changes, as they just use the
      generic transaction management APIs.</p><p>For distributed transactions across multiple Hibernate session
      factories, simply combine <code class="classname">JtaTransactionManager</code>
      as a transaction strategy with multiple
      <code class="classname">LocalSessionFactoryBean</code> definitions. Each of your
      DAOs then gets one specific <code class="interfacename">SessionFactory</code>
      reference passed into it's respective bean property. If all underlying JDBC
      data sources are transactional container ones, a business service can demarcate
      transactions across any number of DAOs and any number of session
      factories without special regard, as long as it is using
      <code class="classname">JtaTransactionManager</code> as the strategy.</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myDataSource1" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName value="java:comp/env/jdbc/myds1"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myDataSource2" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName" value="java:comp/env/jdbc/myds2"/&gt;
  &lt;/bean&gt;

  &lt;bean id="mySessionFactory1" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
    &lt;property name="dataSource" ref="myDataSource1"/&gt;
    &lt;property name="mappingResources"&gt;
      &lt;list&gt;
        &lt;value&gt;product.hbm.xml&lt;/value&gt;
      &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="hibernateProperties"&gt;
      &lt;value&gt;
        hibernate.dialect=org.hibernate.dialect.MySQLDialect
        hibernate.show_sql=true
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="mySessionFactory2" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
    &lt;property name="dataSource" ref="myDataSource2"/&gt;
    &lt;property name="mappingResources"&gt;
      &lt;list&gt;
        &lt;value&gt;inventory.hbm.xml&lt;/value&gt;
      &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="hibernateProperties"&gt;
      &lt;value&gt;
        hibernate.dialect=org.hibernate.dialect.OracleDialect
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="myTxManager" class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory1"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myInventoryDao" class="product.InventoryDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory2"/&gt;
  &lt;/bean&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!-- this shows the Spring 1.x style of declarative transaction configuration --&gt;</span></em>
  <em class="lineannotation"><span class="lineannotation">&lt;!-- it is totally supported, 100% legal in Spring 2.x, but see also above for the sleeker, Spring 2.0 style --&gt;</span></em>
  &lt;bean id="myProductService"
      class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"&gt;
    &lt;property name="transactionManager" ref="myTxManager"/&gt;
    &lt;property name="target"&gt;
      &lt;bean class="product.ProductServiceImpl"&gt;
        &lt;property name="productDao" ref="myProductDao"/&gt;
        &lt;property name="inventoryDao" ref="myInventoryDao"/&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name="transactionAttributes"&gt;
      &lt;props&gt;
        &lt;prop key="increasePrice*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
        &lt;prop key="someOtherBusinessMethod"&gt;PROPAGATION_REQUIRES_NEW&lt;/prop&gt;
        &lt;prop key="*"&gt;PROPAGATION_SUPPORTS,readOnly&lt;/prop&gt;
      &lt;/props&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>Both <code class="classname">HibernateTransactionManager</code> and
      <code class="classname">JtaTransactionManager</code> allow for proper JVM-level
      cache handling with Hibernate - without container-specific transaction
      manager lookup or JCA connector (as long as not using EJB to initiate
      transactions).</p><p><code class="classname">HibernateTransactionManager</code> can export the
      JDBC <code class="interfacename">Connection</code> used by Hibernate to
      plain JDBC access code, for a specific
      <code class="interfacename">DataSource</code>. This allows for high-level
      transaction demarcation with mixed Hibernate/JDBC data access completely
      without JTA, as long as you are just accessing one database!
      <code class="classname">HibernateTransactionManager</code> will automatically
      expose the Hibernate transaction as JDBC transaction if the passed-in
      <code class="interfacename">SessionFactory</code> has been set up with a
      <code class="interfacename">DataSource</code> (through the "dataSource"
      property of the <code class="classname">LocalSessionFactoryBean</code> class).
      Alternatively, the <code class="interfacename">DataSource</code> that the
      transactions are supposed to be exposed for can also be specified
      explicitly, through the "dataSource" property of the
      <code class="classname">HibernateTransactionManager</code> class.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-resources"></a>12.2.9.&nbsp;Container resources versus local resources</h3></div></div></div><p>Spring's resource management allows for simple switching between a
      JNDI <code class="interfacename">SessionFactory</code> and a local one,
      without having to change a single line of application code. The decision
      as to whether to keep the resource definitions in the container or
      locally within the application, is mainly a matter of the transaction
      strategy being used. Compared to a Spring-defined local
      <code class="interfacename">SessionFactory</code>, a manually registered
      JNDI <code class="interfacename">SessionFactory</code> does not provide any
      benefits. Deploying a <code class="interfacename">SessionFactory</code>
      through Hibernate's JCA connector provides the added value of
      participating in the J2EE server's management infrastructure, but does
      not add actual value beyond that.</p><p>An important benefit of Spring's transaction support is that it
      isn't bound to a container at all. Configured to any other strategy than
      JTA, it will work in a standalone or test environment too. Especially
      for the typical case of single-database transactions, this is a very
      lightweight and powerful alternative to JTA. When using local EJB
      Stateless Session Beans to drive transactions, you depend both on an EJB
      container and JTA - even if you just access a single database anyway,
      and just use SLSBs for declarative transactions via CMT. The alternative
      of using JTA programmatically requires a J2EE environment as well. JTA
      does not just involve container dependencies in terms of JTA itself and
      of JNDI <code class="interfacename">DataSource</code> instances. For
      non-Spring JTA-driven Hibernate transactions, you have to use the
      Hibernate JCA connector, or extra Hibernate transaction code with the
      <code class="interfacename">TransactionManagerLookup</code> being configured
      for proper JVM-level caching.</p><p>Spring-driven transactions can work with a locally defined
      Hibernate <code class="interfacename">SessionFactory</code> nicely, just
      like with a local JDBC <code class="interfacename">DataSource</code> - if
      accessing a single database, of course. Therefore you just have to fall
      back to Spring's JTA transaction strategy when actually facing
      distributed transaction requirements. Note that a JCA connector needs
      container-specific deployment steps, and obviously JCA support in the
      first place. This is far more hassle than deploying a simple web app
      with local resource definitions and Spring-driven transactions. And you
      often need the Enterprise Edition of your container, as for example WebLogic
      Express does not provide JCA. A Spring application with local resources
      and transactions spanning one single database will work in any J2EE web
      container (without JTA, JCA, or EJB) - like Tomcat, Resin, or even plain
      Jetty. Additionally, such a middle tier can be reused in desktop
      applications or test suites easily.</p><p>All things considered: if you do not use EJB, stick with local
      <code class="interfacename">SessionFactory</code> setup and Spring's
      <code class="classname">HibernateTransactionManager</code> or
      <code class="classname">JtaTransactionManager</code>. You will get all of the
      benefits including proper transactional JVM-level caching and
      distributed transactions, without any container deployment hassle. JNDI
      registration of a Hibernate
      <code class="interfacename">SessionFactory</code> via the JCA connector
      really only adds value when used in conjunction with EJBs.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-invalid-jdbc-access-error"></a>12.2.10.&nbsp;Spurious application server warnings when using Hibernate</h3></div></div></div><p>In some JTA environments with very strict
      <code class="interfacename">XADataSource</code> implementations -- currently
      only some WebLogic and WebSphere versions -- when using Hibernate configured
      without any awareness of the JTA <code class="interfacename">PlatformTransactionManager</code>
      object for that environment, it is possible for spurious warning or exceptions to
      show up in the application server log. These warnings or exceptions will say something
      to the effect that the connection being accessed is no longer valid, or JDBC access
      is no longer valid, possibly because the transaction is no longer active. As an
      example, here is an actual exception from WebLogic:</p><pre class="programlisting">java.sql.SQLException: The transaction is no longer active - status: 'Committed'.
   No further JDBC access is allowed within this transaction.</pre><p>This warning is easy to resolve by simply making Hibernate aware of the JTA
      <code class="interfacename">PlatformTransactionManager</code> instance, to which it will
      also synchronize (along with Spring). This may be done in two ways:</p><div class="itemizedlist"><ul type="disc"><li><p>If in your application context you are already directly
          obtaining the JTA
          <code class="interfacename">PlatformTransactionManager</code> object
          (presumably from JNDI via <code class="literal">JndiObjectFactoryBean</code>)
          and feeding it for example to Spring's
          <code class="classname">JtaTransactionManager</code>, then the easiest way
          is to simply specify a reference to this as the value of
          <code class="classname">LocalSessionFactoryBean</code>'s
          <span class="emphasis"><em>jtaTransactionManager</em></span> property. Spring will
          then make the object available to Hibernate.</p></li><li><p>More likely you do not already have the JTA
          <code class="interfacename">PlatformTransactionManager</code> instance
          (since Spring's <code class="classname">JtaTransactionManager</code> can
          find it itself) so you need to instead configure Hibernate to also
          look it up directly. This is done by configuring an AppServer
          specific <code class="literal">TransactionManagerLookup</code> class in the
          Hibernate configuration, as described in the Hibernate
          manual.</p></li></ul></div><p>It is not necessary to read any more for proper usage, but the
      full sequence of events with and without Hibernate being aware of the
      JTA <code class="interfacename">PlatformTransactionManager</code> will now
      be described.</p><p>When Hibernate is not configured with any awareness of the JTA
      <code class="interfacename">PlatformTransactionManager</code>, the sequence
      of events when a JTA transaction commits is as follows:</p><div class="itemizedlist"><ul type="disc"><li><p>JTA transaction commits</p></li><li><p>Spring's <code class="classname">JtaTransactionManager</code> is
          synchronized to the JTA transaction, so it is called back via an
          <span class="emphasis"><em>afterCompletion</em></span> callback by the JTA transaction
          manager.</p></li><li><p>Among other activities, this can trigger a callback by Spring
          to Hibernate, via Hibernate's
          <code class="literal">afterTransactionCompletion</code> callback (used to
          clear the Hibernate cache), followed by an explicit
          <code class="literal">close()</code> call on the Hibernate Session, which
          results in Hibernate trying to <code class="literal">close()</code> the JDBC
          Connection.</p></li><li><p>In some environments, this <code class="methodname">Connection.close()</code> call
          then triggers the warning or error, as the application server no longer considers the
          <code class="interfacename">Connection</code> usable at all, since the transaction has
          already been committed.</p></li></ul></div><p>When Hibernate is configured with awareness of the JTA
      <code class="interfacename">PlatformTransactionManager</code>, the sequence
      of events when a JTA transaction commits is instead as follows:</p><div class="itemizedlist"><ul type="disc"><li><p>JTA transaction is ready to commit</p></li><li><p>Spring's <code class="classname">JtaTransactionManager</code> is
          synchronized to the JTA transaction, so it is called back via a
          <span class="emphasis"><em>beforeCompletion</em></span> callback by the JTA
          transaction manager.</p></li><li><p>Spring is aware that Hibernate itself is synchronized to the JTA transaction,
          and behaves differently than in the previous scenario. Assuming the Hibernate
          <code class="interfacename">Session</code> needs to be closed at all, Spring will close it now.</p></li><li><p>JTA Transaction commits</p></li><li><p>Hibernate is synchronized to the JTA transaction, so it is
          called back via an <span class="emphasis"><em>afterCompletion</em></span> callback by
          the JTA transaction manager, and can properly clear its cache.</p></li></ul></div><p></p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-jdo"></a>12.3.&nbsp;JDO</h2></div></div></div><p>Spring supports the standard JDO 1.0/2.0 API as data access
    strategy, following the same style as the Hibernate support. The
    corresponding integration classes reside in the
    <code class="literal">org.springframework.orm.jdo</code> package.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-setup"></a>12.3.1.&nbsp;<code class="interfacename">PersistenceManagerFactory</code> setup</h3></div></div></div><p>Spring provides a
      <code class="classname">LocalPersistenceManagerFactoryBean</code> class that
      allows for defining a local JDO
      <code class="interfacename">PersistenceManagerFactory</code> within a Spring
      application context:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myPmf" class="org.springframework.orm.jdo.LocalPersistenceManagerFactoryBean"&gt;
    &lt;property name="configLocation" value="classpath:kodo.properties"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>Alternatively, a
      <code class="interfacename">PersistenceManagerFactory</code> can also be set
      up through direct instantiation of a
      <code class="interfacename">PersistenceManagerFactory</code> implementation
      class. A JDO <code class="interfacename">PersistenceManagerFactory</code>
      implementation class is supposed to follow the JavaBeans pattern, just
      like a JDBC <code class="interfacename">DataSource</code> implementation
      class, which is a natural fit for a Spring bean definition. This setup
      style usually supports a Spring-defined JDBC
      <code class="interfacename">DataSource</code>, passed into the
      "connectionFactory" property. For example, for the open source JDO
      implementation JPOX (<a href="http://www.jpox.org" target="_top">http://www.jpox.org</a>):</p><pre class="programlisting">&lt;beans&gt;

 &lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
   &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;
   &lt;property name="url" value="${jdbc.url}"/&gt;
   &lt;property name="username" value="${jdbc.username}"/&gt;
   &lt;property name="password" value="${jdbc.password}"/&gt;
 &lt;/bean&gt;

 &lt;bean id="myPmf" class="org.jpox.PersistenceManagerFactoryImpl" destroy-method="close"&gt;
   &lt;property name="connectionFactory" ref="dataSource"/&gt;
   &lt;property name="nontransactionalRead" value="true"/&gt;
 &lt;/bean&gt;

&lt;/beans&gt;</pre><p>A JDO <code class="interfacename">PersistenceManagerFactory</code> can
      also be set up in the JNDI environment of a J2EE application server,
      usually through the JCA connector provided by the particular JDO
      implementation. Spring's standard
      <code class="literal">JndiObjectFactoryBean</code> can be used to retrieve and
      expose such a <code class="interfacename">PersistenceManagerFactory</code>.
      However, outside an EJB context, there is often no compelling benefit in
      holding the <code class="interfacename">PersistenceManagerFactory</code> in
      JNDI: only choose such setup for a good reason. See "container resources
      versus local resources" in the Hibernate section for a discussion; the
      arguments there apply to JDO as well.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-template"></a>12.3.2.&nbsp;<code class="classname">JdoTemplate</code> and <code class="classname">JdoDaoSupport</code></h3></div></div></div><p>Each JDO-based DAO will then receive the
      <code class="interfacename">PersistenceManagerFactory</code> through
      dependency injection. Such a DAO could be coded against plain JDO API,
      working with the given
      <code class="interfacename">PersistenceManagerFactory</code>, but will
      usually rather be used with the Spring Framework's
      <code class="classname">JdoTemplate</code>:</p><pre class="programlisting">&lt;beans&gt;
  
  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmf"/&gt;
  &lt;/bean&gt;
  
&lt;/beans&gt;</pre><pre class="programlisting">public class ProductDaoImpl implements ProductDao {
  
    private JdoTemplate jdoTemplate;

    public void setPersistenceManagerFactory(PersistenceManagerFactory pmf) {
        this.jdoTemplate = new JdoTemplate(pmf);
    }

    public Collection loadProductsByCategory(final String category) throws DataAccessException {
        return (Collection) this.jdoTemplate.execute(new JdoCallback() {
            public Object doInJdo(PersistenceManager pm) throws JDOException {
                Query query = pm.newQuery(Product.class, "category = pCategory");
                query.declareParameters("String pCategory"); 
                List result = query.execute(category);
                <em class="lineannotation"><span class="lineannotation">// do some further stuff with the result list</span></em>
                return result;
            }
        });
    }
}</pre><p>A callback implementation can effectively be used for any JDO data
      access. <code class="classname">JdoTemplate</code> will ensure that
      <code class="classname">PersistenceManager</code>s are properly opened and
      closed, and automatically participate in transactions. The template
      instances are thread-safe and reusable, they can thus be kept as
      instance variables of the surrounding class. For simple single-step
      actions such as a single <code class="literal">find</code>,
      <code class="literal">load</code>, <code class="literal">makePersistent</code>, or
      <code class="literal">delete</code> call, <code class="classname">JdoTemplate</code>
      offers alternative convenience methods that can replace such one line
      callback implementations. Furthermore, Spring provides a convenient
      <code class="classname">JdoDaoSupport</code> base class that provides a
      <code class="literal">setPersistenceManagerFactory(..)</code> method for receiving
      a <code class="classname">PersistenceManagerFactory</code>, and
      <code class="methodname">getPersistenceManagerFactory()</code> and
      <code class="methodname">getJdoTemplate()</code> for use by subclasses. In
      combination, this allows for very simple DAO implementations for typical
      requirements:</p><pre class="programlisting">public class ProductDaoImpl extends JdoDaoSupport implements ProductDao {
  
    public Collection loadProductsByCategory(String category) throws DataAccessException {
        return getJdoTemplate().find(
            Product.class, "category = pCategory", "String category", new Object[] {category});
    }
}</pre><p>As alternative to working with Spring's
      <code class="classname">JdoTemplate</code>, you can also code Spring-based DAOs
      at the JDO API level, explicitly opening and closing a
      <code class="interfacename">PersistenceManager</code>. As elaborated in the
      corresponding Hibernate section, the main advantage of this approach is
      that your data access code is able to throw checked exceptions.
      <code class="classname">JdoDaoSupport</code> offers a variety of support methods
      for this scenario, for fetching and releasing a transactional
      <code class="interfacename">PersistenceManager</code> as well as for
      converting exceptions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-daos-straight"></a>12.3.3.&nbsp;Implementing DAOs based on the plain JDO API</h3></div></div></div><p>DAOs can also be written against plain JDO API, without any Spring
      dependencies, directly using an injected
      <code class="interfacename">PersistenceManagerFactory</code>. A
      corresponding DAO implementation looks like as follows:</p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private PersistenceManagerFactory persistenceManagerFactory;

    public void setPersistenceManagerFactory(PersistenceManagerFactory pmf) {
        this.persistenceManagerFactory = pmf;
    }

    public Collection loadProductsByCategory(String category) {
        PersistenceManager pm = this.persistenceManagerFactory.getPersistenceManager();
        try {
            Query query = pm.newQuery(Product.class, "category = pCategory");
            query.declareParameters("String pCategory"); 
            return query.execute(category);
        }
        finally {
          pm.close();
        }
    }
}</pre><p>As the above DAO still follows the Dependency Injection pattern,
      it still fits nicely into a Spring container, just like it
      would if coded against Spring's <code class="classname">JdoTemplate</code>:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmf"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>The main issue with such DAOs is that they always get a new
      <code class="interfacename">PersistenceManager</code> from the factory. To
      still access a Spring-managed transactional
      <code class="interfacename">PersistenceManager</code>, consider defining a
      <code class="classname">TransactionAwarePersistenceManagerFactoryProxy</code>
      (as included in Spring) in front of your target
      <code class="interfacename">PersistenceManagerFactory</code>, passing the
      proxy into your DAOs.</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myPmfProxy"
      class="org.springframework.orm.jdo.TransactionAwarePersistenceManagerFactoryProxy"&gt;
    &lt;property name="targetPersistenceManagerFactory" ref="myPmf"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmfProxy"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>Your data access code will then receive a transactional
      <code class="interfacename">PersistenceManager</code> (if any) from the
      <code class="methodname">PersistenceManagerFactory.getPersistenceManager()</code>
      method that it calls. The latter method call goes through the proxy,
      which will first check for a current transactional
      <code class="interfacename">PersistenceManager</code> before getting a new
      one from the factory. <code class="methodname">close()</code> calls on the
      <code class="interfacename">PersistenceManager</code> will be ignored in
      case of a transactional <code class="interfacename">PersistenceManager</code>.</p><p>If your data access code will always run within an active
      transaction (or at least within active transaction synchronization), it
      is safe to omit the <code class="methodname">PersistenceManager.close()</code> call
      and thus the entire <code class="literal">finally</code> block, which you might
      prefer to keep your DAO implementations concise:</p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private PersistenceManagerFactory persistenceManagerFactory;

    public void setPersistenceManagerFactory(PersistenceManagerFactory pmf) {
        this.persistenceManagerFactory = pmf;
    }

    public Collection loadProductsByCategory(String category) {
        PersistenceManager pm = this.persistenceManagerFactory.getPersistenceManager();
        Query query = pm.newQuery(Product.class, "category = pCategory");
        query.declareParameters("String pCategory"); 
        return query.execute(category);
    }
}</pre><p>With such DAOs that rely on active transactions, it is recommended
      to enforce active transactions through turning
      <code class="classname">TransactionAwarePersistenceManagerFactoryProxy</code>'s
      "allowCreate" flag off:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myPmfProxy"
      class="org.springframework.orm.jdo.TransactionAwarePersistenceManagerFactoryProxy"&gt;
    &lt;property name="targetPersistenceManagerFactory" ref="myPmf"/&gt;
    &lt;property name="allowCreate" value="false"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmfProxy"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>The main advantage of this DAO style is that it depends on JDO API
      only; no import of any Spring class is required. This is of course
      appealing from a non-invasiveness perspective, and might feel more
      natural to JDO developers.</p><p>However, the DAO throws plain <code class="exceptionname">JDOException</code>
      (which is unchecked, so does not have to be declared or caught), which
      means that callers can only treat exceptions as generally fatal - unless
      they want to depend on JDO's own exception structure. Catching specific
      causes such as an optimistic locking failure is not possible without
      tying the caller to the implementation strategy. This tradeoff might be
      acceptable to applications that are strongly JDO-based and/or do not
      need any special exception treatment.</p><p>In summary: DAOs can be implemented based on plain JDO API, while
      still being able to participate in Spring-managed transactions. This
      might in particular appeal to people already familiar with JDO, feeling
      more natural to them. However, such DAOs will throw plain
      <code class="exceptionname">JDOException</code>; conversion to Spring's
      <code class="exceptionname">DataAccessException</code> would have to happen
      explicitly (if desired).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-tx"></a>12.3.4.&nbsp;Transaction management</h3></div></div></div><p>To execute service operations within transactions, you can use
      Spring's common declarative transaction facilities. For example:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans
        xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:aop="http://www.springframework.org/schema/aop"
        xmlns:tx="http://www.springframework.org/schema/tx"
        xsi:schemaLocation="
   http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
   http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
   http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;

  &lt;bean id="myTxManager" class="org.springframework.orm.jdo.JdoTransactionManager"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmf"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="product.ProductServiceImpl"&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;

  &lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="increasePrice*" propagation="REQUIRED"/&gt;
      &lt;tx:method name="someOtherBusinessMethod" propagation="REQUIRES_NEW"/&gt;
      &lt;tx:method name="*" propagation="SUPPORTS" read-only="true"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

  &lt;aop:config&gt;
    &lt;aop:pointcut id="productServiceMethods" expression="execution(* product.ProductService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="productServiceMethods"/&gt;
  &lt;/aop:config&gt;

&lt;/beans&gt;</pre><p>Note that JDO requires an active transaction when modifying a
      persistent object. There is no concept like a non-transactional flush in
      JDO, in contrast to Hibernate. For this reason, the chosen JDO
      implementation needs to be set up for a specific environment: in
      particular, it needs to be explicitly set up for JTA synchronization, to
      detect an active JTA transaction itself. This is not necessary for local
      transactions as performed by Spring's
      <code class="classname">JdoTransactionManager</code>, but it is necessary for
      participating in JTA transactions (whether driven by Spring's
      <code class="classname">JtaTransactionManager</code> or by EJB CMT / plain
      JTA).</p><p><code class="classname">JdoTransactionManager</code> is capable of
      exposing a JDO transaction to JDBC access code that accesses the same
      JDBC <code class="interfacename">DataSource</code>, provided that the
      registered <code class="classname">JdoDialect</code> supports retrieval of the
      underlying JDBC <code class="interfacename">Connection</code>. This is by
      default the case for JDBC-based JDO 2.0 implementations; for JDO 1.0
      implementations, a custom <code class="classname">JdoDialect</code> needs to be
      used. See next section for details on the
      <code class="classname">JdoDialect</code> mechanism.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-dialect"></a>12.3.5.&nbsp;<code class="interfacename">JdoDialect</code></h3></div></div></div><p>As an advanced feature, both <code class="classname">JdoTemplate</code>
      and <code class="classname">interfacename</code> support a custom
      <code class="interfacename">JdoDialect</code>, to be passed into the "jdoDialect"
      bean property. In such a scenario, the DAOs won't receive a
      <code class="interfacename">PersistenceManagerFactory</code> reference but
      rather a full <code class="classname">JdoTemplate</code> instance instead (for
      example, passed into <code class="classname">JdoDaoSupport</code>'s
      "jdoTemplate" property). A <code class="interfacename">JdoDialect</code>
      implementation can enable some advanced features supported by Spring,
      usually in a vendor-specific manner:</p><div class="itemizedlist"><ul type="disc"><li><p>applying specific transaction semantics (such as custom
          isolation level or transaction timeout)</p></li><li><p>retrieving the transactional JDBC
          <code class="interfacename">Connection</code> (for exposure to
          JDBC-based DAOs)</p></li><li><p>applying query timeouts (automatically calculated from
          Spring-managed transaction timeout)</p></li><li><p>eagerly flushing a
          <code class="interfacename">PersistenceManager</code> (to make
          transactional changes visible to JDBC-based data access code)</p></li><li><p>advanced translation of <code class="literal">JDOExceptions</code> to
          Spring <code class="literal">DataAccessExceptions</code></p></li></ul></div><p>This is particularly valuable for JDO 1.0 implementations, where
      none of those features are covered by the standard API. On JDO 2.0, most
      of those features are supported in a standard manner: Hence, Spring's
      <code class="literal">DefaultJdoDialect</code> uses the corresponding JDO 2.0 API
      methods by default (as of Spring 1.2). For special transaction semantics
      and for advanced translation of exception, it is still valuable to
      derive vendor-specific <code class="classname">JdoDialect</code>
      subclasses.</p><p>See the <code class="classname">JdoDialect</code> Javadoc for more details
      on its operations and how they are used within Spring's JDO support.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-toplink"></a>12.4.&nbsp;Oracle TopLink</h2></div></div></div><p>Since Spring 1.2, Spring supports Oracle TopLink (<a href="http://www.oracle.com/technology/products/ias/toplink" target="_top">http://www.oracle.com/technology/products/ias/toplink</a>) as
    data access strategy, following the same style as the Hibernate support.
    Both TopLink 9.0.4 (the production version as of Spring 1.2) and 10.1.3
    (still in beta as of Spring 1.2) are supported. The corresponding
    integration classes reside in the
    <code class="literal">org.springframework.orm.toplink</code> package.</p><p>Spring's TopLink support has been co-developed with the Oracle
    TopLink team. Many thanks to the TopLink team, in particular to Jim Clark
    who helped to clarify details in all areas!</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-toplink-abstraction"></a>12.4.1.&nbsp;<code class="interfacename">SessionFactory</code> abstraction</h3></div></div></div><p>TopLink itself does not ship with a SessionFactory abstraction.
      Instead, multi-threaded access is based on the concept of a central
      <code class="literal">ServerSession</code>, which in turn is able to spawn
      <code class="literal">ClientSession</code> instances for single-threaded usage.
      For flexible setup options, Spring defines a
      <code class="interfacename">SessionFactory</code> abstraction for TopLink,
      enabling to switch between different
      <code class="interfacename">Session</code> creation strategies.</p><p>As a one-stop shop, Spring provides a
      <code class="classname">LocalSessionFactoryBean</code> class that allows for
      defining a TopLink <code class="interfacename">SessionFactory</code> with
      bean-style configuration. It needs to be configured with the location of
      the TopLink session configuration file, and usually also receives a
      Spring-managed JDBC <code class="interfacename">DataSource</code> to use.</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;
    &lt;property name="url" value="${jdbc.url}"/&gt;
    &lt;property name="username" value="${jdbc.username}"/&gt;
    &lt;property name="password" value="${jdbc.password}"/&gt;
  &lt;/bean&gt;

  &lt;bean id="mySessionFactory" class="org.springframework.orm.toplink.LocalSessionFactoryBean"&gt;
    &lt;property name="configLocation" value="toplink-sessions.xml"/&gt;
    &lt;property name="dataSource" ref="dataSource"/&gt;
  &lt;/bean&gt;
    
&lt;/beans&gt;</pre><pre class="programlisting">&lt;toplink-configuration&gt;

  &lt;session&gt;
    &lt;name&gt;Session&lt;/name&gt;
    &lt;project-xml&gt;toplink-mappings.xml&lt;/project-xml&gt;
    &lt;session-type&gt;
      &lt;server-session/&gt;
    &lt;/session-type&gt;
    &lt;enable-logging&gt;true&lt;/enable-logging&gt;
    &lt;logging-options/&gt;
  &lt;/session&gt;

&lt;/toplink-configuration&gt;</pre><p>Usually, <code class="classname">LocalSessionFactoryBean</code> will hold
      a multi-threaded TopLink <code class="literal">ServerSession</code> underneath and
      create appropriate client <code class="interfacename">Session</code>s for
      it: either a plain <code class="interfacename">Session</code> (typical), a
      managed <code class="literal">ClientSession</code>, or a transaction-aware
      <code class="interfacename">Session</code> (the latter are mainly used
      internally by Spring's TopLink support). It might also hold a
      single-threaded TopLink <code class="literal">DatabaseSession</code>; this is
      rather unusual, though.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-toplink-template"></a>12.4.2.&nbsp;<code class="classname">TopLinkTemplate</code> and <code class="classname">TopLinkDaoSupport</code></h3></div></div></div><p>Each TopLink-based DAO will then receive the
      <code class="interfacename">SessionFactory</code> through dependency
      injection, i.e. through a bean property setter or through a constructor
      argument. Such a DAO could be coded against plain TopLink API, fetching
      a <code class="interfacename">Session</code> from the given
      <code class="interfacename">SessionFactory</code>, but will usually rather
      be used with Spring's <code class="literal">TopLinkTemplate</code>:</p><pre class="programlisting">&lt;beans&gt;
  
  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;
  
&lt;/beans&gt;</pre><pre class="programlisting">public class TopLinkProductDao implements ProductDao {
  
    private TopLinkTemplate tlTemplate;

    public void setSessionFactory(SessionFactory sessionFactory) {
        this.tlTemplate = new TopLinkTemplate(sessionFactory);
    }

    public Collection loadProductsByCategory(final String category) throws DataAccessException {
        return (Collection) this.tlTemplate.execute(new TopLinkCallback() {
            public Object doInTopLink(Session session) throws TopLinkException {
                ReadAllQuery findOwnersQuery = new ReadAllQuery(Product.class);
                findOwnersQuery.addArgument("Category");
                ExpressionBuilder builder = this.findOwnersQuery.getExpressionBuilder();
                findOwnersQuery.setSelectionCriteria(
                    builder.get("category").like(builder.getParameter("Category")));

                Vector args = new Vector();
                args.add(category);
                List result = session.executeQuery(findOwnersQuery, args);
                <em class="lineannotation"><span class="lineannotation">// do some further stuff with the result list</span></em>
                return result;
            }
        });
    }
}</pre><p>A callback implementation can effectively be used for any TopLink
      data access. <code class="classname">TopLinkTemplate</code> will ensure that
      <code class="interfacename">Session</code>s are properly opened and closed,
      and automatically participate in transactions. The template instances
      are thread-safe and reusable, they can thus be kept as instance
      variables of the surrounding class. For simple single-step actions such
      as a single <code class="literal">executeQuery</code>, <code class="literal">readAll</code>,
      <code class="literal">readById</code>, or <code class="literal">merge</code> call,
      <code class="classname">JdoTemplate</code> offers alternative convenience
      methods that can replace such one line callback implementations.
      Furthermore, Spring provides a convenient
      <code class="classname">TopLinkDaoSupport</code> base class that provides a
      <code class="literal">setSessionFactory(..)</code> method for receiving a
      <code class="interfacename">SessionFactory</code>, and
      <code class="literal">getSessionFactory()</code> and
      <code class="literal">getTopLinkTemplate()</code> for use by subclasses. In
      combination, this allows for simple DAO implementations for typical
      requirements:</p><pre class="programlisting">public class ProductDaoImpl extends TopLinkDaoSupport implements ProductDao {
  
    public Collection loadProductsByCategory(String category) throws DataAccessException {
        ReadAllQuery findOwnersQuery = new ReadAllQuery(Product.class);
        findOwnersQuery.addArgument("Category");
        ExpressionBuilder builder = this.findOwnersQuery.getExpressionBuilder();
        findOwnersQuery.setSelectionCriteria(
            builder.get("category").like(builder.getParameter("Category")));

        return getTopLinkTemplate().executeQuery(findOwnersQuery, new Object[] {category});
    }
}</pre><p>Side note: TopLink query objects are thread-safe and can be cached
      within the DAO, i.e. created on startup and kept in instance variables.</p><p>As alternative to working with Spring's
      <code class="classname">TopLinkTemplate</code>, you can also code your TopLink data
      access based on the raw TopLink API, explicitly opening and closing a
      <code class="interfacename">Session</code>. As elaborated in the
      corresponding Hibernate section, the main advantage of this approach is
      that your data access code is able to throw checked exceptions.
      <code class="classname">TopLinkDaoSupport</code> offers a variety of support methods
      for this scenario, for fetching and releasing a transactional
      <code class="interfacename">Session</code> as well as for converting
      exceptions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-toplink-straight"></a>12.4.3.&nbsp;Implementing DAOs based on plain TopLink API</h3></div></div></div><p>DAOs can also be written against plain TopLink API, without any
      Spring dependencies, directly using an injected TopLink
      <code class="interfacename">Session</code>. The latter will usually be based
      on a <code class="interfacename">SessionFactory</code> defined by a
      <code class="classname">LocalSessionFactoryBean</code>, exposed for bean
      references of type <code class="interfacename">Session</code> through
      Spring's <code class="literal">TransactionAwareSessionAdapter</code>.</p><p>The <code class="literal">getActiveSession()</code> method defined on
      TopLink's <code class="interfacename">Session</code> interface will return
      the current transactional <code class="interfacename">Session</code> in such
      a scenario. If there is no active transaction, it will return the shared
      TopLink <code class="literal">ServerSession</code> as-is, which is only supposed
      to be used directly for read-only access. There is also an analogous
      <code class="methodname">getActiveUnitOfWork()</code> method, returning the TopLink
      <code class="interfacename">UnitOfWork</code> associated with the current transaction,
      if any (returning <code class="literal">null</code> else).</p><p>A corresponding DAO implementation looks like as follows:</p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private Session session;

    public void setSession(Session session) {
        this.session = session;
    }

    public Collection loadProductsByCategory(String category) {
        ReadAllQuery findOwnersQuery = new ReadAllQuery(Product.class);
        findOwnersQuery.addArgument("Category");
        ExpressionBuilder builder = this.findOwnersQuery.getExpressionBuilder();
        findOwnersQuery.setSelectionCriteria(
            builder.get("category").like(builder.getParameter("Category")));

        Vector args = new Vector();
        args.add(category);
        return session.getActiveSession().executeQuery(findOwnersQuery, args);
    }
}</pre><p>As the above DAO still follows the Dependency Injection pattern,
      it still fits nicely into a Spring application context, analogous to
      like it would if coded against Spring's
      <code class="classname">TopLinkTemplate</code>. Spring's
      <code class="literal">TransactionAwareSessionAdapter</code> is used to expose a
      bean reference of type <code class="interfacename">Session</code>, to be
      passed into the DAO:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="mySessionAdapter"
      class="org.springframework.orm.toplink.support.TransactionAwareSessionAdapter"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="session" ref="mySessionAdapter"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>The main advantage of this DAO style is that it depends on TopLink
      API only; no import of any Spring class is required. This is of course
      appealing from a non-invasiveness perspective, and might feel more
      natural to TopLink developers.</p><p>However, the DAO throws plain <code class="exceptionname">TopLinkException</code>
      (which is unchecked, so does not have to be declared or caught), which
      means that callers can only treat exceptions as generally fatal - unless
      they want to depend on TopLink's own exception structure. Catching
      specific causes such as an optimistic locking failure is not possible
      without tying the caller to the implementation strategy. This tradeoff
      might be acceptable to applications that are strongly TopLink-based
      and/or do not need any special exception treatment.</p><p>A further disadvantage of that DAO style is that TopLink's
      standard <code class="methodname">getActiveSession()</code> feature just works within
      JTA transactions. It does <span class="emphasis"><em>not</em></span> work with any other transaction strategy
      out-of-the-box, in particular not with local TopLink transactions.</p><p>Fortunately, Spring's
      <code class="literal">TransactionAwareSessionAdapter</code> exposes a
      corresponding proxy for the TopLink <code class="literal">ServerSession</code>
      which supports TopLink's <code class="literal">Session.getActiveSession()</code>
      and <code class="literal">Session.getActiveUnitOfWork()</code> methods for any
      Spring transaction strategy, returning the current Spring-managed
      transactional <code class="interfacename">Session</code> even with
      <code class="literal">TopLinkTransactionManager</code>. Of course, the standard
      behavior of that method remains: returning the current
      <code class="interfacename">Session</code> associated with the ongoing JTA
      transaction, if any (no matter whether driven by Spring's
      <code class="classname">JtaTransactionManager</code>, by EJB CMT, or by plain
      JTA).</p><p>In summary: DAOs can be implemented based on plain TopLink API,
      while still being able to participate in Spring-managed transactions.
      This might in particular appeal to people already familiar with TopLink,
      feeling more natural to them. However, such DAOs will throw plain
      <code class="exceptionname">TopLinkException</code>; conversion to Spring's
      <code class="classname">DataAccessException</code> would have to happen
      explicitly (if desired).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-toplink-tx"></a>12.4.4.&nbsp;Transaction management</h3></div></div></div><p>To execute service operations within transactions, you can use
      Spring's common declarative transaction facilities. For example:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans
        xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:aop="http://www.springframework.org/schema/aop"
        xmlns:tx="http://www.springframework.org/schema/tx"
        xsi:schemaLocation="
   http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
   http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
   http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;

  &lt;bean id="myTxManager" class="org.springframework.orm.toplink.TopLinkTransactionManager"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="product.ProductServiceImpl"&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;
  
  &lt;aop:config&gt;
    &lt;aop:pointcut id="productServiceMethods" expression="execution(* product.ProductService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="productServiceMethods"/&gt;
  &lt;/aop:config&gt;

  &lt;tx:advice id="txAdvice" transaction-manager="myTxManager"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="increasePrice*" propagation="REQUIRED"/&gt;
      &lt;tx:method name="someOtherBusinessMethod" propagation="REQUIRES_NEW"/&gt;
      &lt;tx:method name="*" propagation="SUPPORTS" read-only="true"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

&lt;/beans&gt;</pre><p>Note that TopLink requires an active <code class="interfacename">UnitOfWork</code>
      for modifying a persistent object. (You should never modify objects
      returned by a plain TopLink <code class="interfacename">Session</code> -
      those are usually read-only objects, directly taken from the
      second-level cache!) There is no concept like a non-transactional flush
      in TopLink, in contrast to Hibernate. For this reason, TopLink needs to
      be set up for a specific environment: in particular, it needs to be
      explicitly set up for JTA synchronization, to detect an active JTA
      transaction itself and expose a corresponding active
      <code class="interfacename">Session</code> and
      <code class="interfacename">UnitOfWork</code>. This is not necessary for local
      transactions as performed by Spring's
      <code class="literal">TopLinkTransactionManager</code>, but it is necessary for
      participating in JTA transactions (whether driven by Spring's
      <code class="classname">JtaTransactionManager</code> or by EJB CMT / plain
      JTA).</p><p>Within your TopLink-based DAO code, use the
      <code class="literal">Session.getActiveUnitOfWork()</code> method to access the
      current <code class="interfacename">UnitOfWork</code> and perform write operations
      through it. This will only work within an active transaction (both
      within Spring-managed transactions and plain JTA transactions). For
      special needs, you can also acquire separate
      <code class="interfacename">UnitOfWork</code> instances that won't participate in the
      current transaction; this is hardly needed, though.</p><p><code class="classname">TopLinkTransactionManager</code> is capable of
      exposing a TopLink transaction to JDBC access code that accesses the
      same JDBC <code class="interfacename">DataSource</code>, provided that
      TopLink works with JDBC in the backend and is thus able to expose the
      underlying JDBC <code class="interfacename">Connection</code>. The
      <code class="interfacename">DataSource</code> to expose the transactions for
      needs to be specified explicitly; it won't be autodetected.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-ibatis"></a>12.5.&nbsp;iBATIS SQL Maps</h2></div></div></div><p>The iBATIS support in the Spring Framework much resembles
    the JDBC / Hibernate support in that it supports the same template style
    programming and just as with JDBC or Hibernate, the iBATIS support works
    with Spring's exception hierarchy and let's you enjoy the all IoC features
    Spring has.</p><p>Transaction management can be handled through Spring's standard
    facilities. There are no special transaction strategies for iBATIS, as
    there is no special transactional resource involved other than a JDBC
    <code class="interfacename">Connection</code>. Hence, Spring's standard JDBC
    <code class="classname">DataSourceTransactionManager</code> or
    <code class="classname">JtaTransactionManager</code> are perfectly
    sufficient.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Spring does actually support both iBatis 1.x and 2.x. However, only
        support for iBatis 2.x is actually shipped with the core Spring distribution.
        The iBatis 1.x support classes were moved to the Spring Modules project
        as of Spring 2.0, and you are directed there for documentation.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-ibatis-setup"></a>12.5.1.&nbsp;Setting up the <code class="classname">SqlMapClient</code></h3></div></div></div><p>If we want to map the previous Account class with iBATIS 2.x we
        need to create the following SQL map
        <code class="filename">'Account.xml'</code>:</p><pre class="programlisting">&lt;sqlMap namespace="Account"&gt;

  &lt;resultMap id="result" class="examples.Account"&gt;
    &lt;result property="name" column="NAME" columnIndex="1"/&gt;
    &lt;result property="email" column="EMAIL" columnIndex="2"/&gt;
  &lt;/resultMap&gt;

  &lt;select id="getAccountByEmail" resultMap="result"&gt;
    select ACCOUNT.NAME, ACCOUNT.EMAIL
    from ACCOUNT
    where ACCOUNT.EMAIL = #value#
  &lt;/select&gt;

  &lt;insert id="insertAccount"&gt;
    insert into ACCOUNT (NAME, EMAIL) values (#name#, #email#)
  &lt;/insert&gt;

&lt;/sqlMap&gt;</pre><p>The configuration file for iBATIS 2 looks like this:</p><pre class="programlisting">&lt;sqlMapConfig&gt;

  &lt;sqlMap resource="example/Account.xml"/&gt;

&lt;/sqlMapConfig&gt;</pre><p>Remember that iBATIS loads resources from the class path, so be
        sure to add the <code class="filename">'Account.xml'</code> file to the class
        path.</p><p>We can use the <code class="classname">SqlMapClientFactoryBean</code> in the
        Spring container. Note that with iBATIS SQL Maps 2.x, the
        JDBC <code class="interfacename">DataSource</code> is usually specified on
        the <code class="classname">SqlMapClientFactoryBean</code>, which enables lazy
        loading.</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;
    &lt;property name="url" value="${jdbc.url}"/&gt;
    &lt;property name="username" value="${jdbc.username}"/&gt;
    &lt;property name="password" value="${jdbc.password}"/&gt;
  &lt;/bean&gt;

  &lt;bean id="sqlMapClient" class="org.springframework.orm.ibatis.SqlMapClientFactoryBean"&gt;
    &lt;property name="configLocation" value="WEB-INF/sqlmap-config.xml"/&gt;
    &lt;property name="dataSource" ref="dataSource"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-ibatis-template"></a>12.5.2.&nbsp;Using <code class="classname">SqlMapClientTemplate</code> and <code class="classname">SqlMapClientDaoSupport</code></h3></div></div></div><p>The <code class="classname">SqlMapClientDaoSupport</code> class offers a
        supporting class similar to the <code class="classname">SqlMapDaoSupport</code>.
        We extend it to implement our DAO:</p><pre class="programlisting">public class SqlMapAccountDao extends SqlMapClientDaoSupport implements AccountDao {

    public Account getAccount(String email) throws DataAccessException {
        return (Account) getSqlMapClientTemplate().queryForObject("getAccountByEmail", email);
    }

    public void insertAccount(Account account) throws DataAccessException {
        getSqlMapClientTemplate().update("insertAccount", account);
    }
}</pre><p>In the DAO, we use the pre-configured
        <code class="classname">SqlMapClientTemplate</code> to execute the queries,
        after setting up the <code class="literal">SqlMapAccountDao</code> in the
        application context and wiring it with our
        <code class="literal">SqlMapClient</code> instance:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="accountDao" class="example.SqlMapAccountDao"&gt;
    &lt;property name="sqlMapClient" ref="sqlMapClient"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>Note that a <code class="classname">SqlMapTemplate</code> instance could
        also be created manually, passing in the
        <code class="literal">SqlMapClient</code> as constructor argument. The
        <code class="literal">SqlMapClientDaoSupport</code> base class simply
        pre-initializes a <code class="classname">SqlMapClientTemplate</code> instance
        for us.</p><p>The <code class="classname">SqlMapClientTemplate</code> also offers a
        generic <code class="literal">execute</code> method, taking a custom
        <code class="literal">SqlMapClientCallback</code> implementation as argument.
        This can, for example, be used for batching:</p><pre class="programlisting">public class SqlMapAccountDao extends SqlMapClientDaoSupport implements AccountDao {

    public void insertAccount(Account account) throws DataAccessException {
        getSqlMapClientTemplate().execute(new SqlMapClientCallback() {
            public Object doInSqlMapClient(SqlMapExecutor executor) throws SQLException {
                executor.startBatch();
                executor.update("insertAccount", account);
                executor.update("insertAddress", account.getAddress());
                executor.executeBatch();
            }
        });
    }
}</pre><p>In general, any combination of operations offered by the native
        <code class="literal">SqlMapExecutor</code> API can be used in such a callback.
        Any <code class="literal">SQLException</code> thrown will automatically get
        converted to Spring's generic
        <code class="classname">DataAccessException</code> hierarchy.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-ibatis-straight"></a>12.5.3.&nbsp;Implementing DAOs based on plain iBATIS API</h3></div></div></div><p>DAOs can also be written against plain iBATIS API, without any
        Spring dependencies, directly using an injected
        <code class="literal">SqlMapClient</code>. A corresponding DAO implementation
        looks like as follows:</p><pre class="programlisting">public class SqlMapAccountDao implements AccountDao {
        
    private SqlMapClient sqlMapClient;
    
    public void setSqlMapClient(SqlMapClient sqlMapClient) {
        this.sqlMapClient = sqlMapClient;
    }

    public Account getAccount(String email) {
        try {
            return (Account) this.sqlMapClient.queryForObject("getAccountByEmail", email);
        }
        catch (SQLException ex) {
            throw new MyDaoException(ex);
        }
    }

    public void insertAccount(Account account) throws DataAccessException {
        try {
            this.sqlMapClient.update("insertAccount", account);
        }
        catch (SQLException ex) {
            throw new MyDaoException(ex);
        }
    }
}</pre><p>In such a scenario, the <code class="literal">SQLException</code> thrown
        by the iBATIS API needs to be handled in a custom fashion: usually,
        wrapping it in your own application-specific DAO exception. Wiring in
        the application context would still look like before, due to the fact
        that the plain iBATIS-based DAO still follows the Dependency Injection
        pattern:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="accountDao" class="example.SqlMapAccountDao"&gt;
    &lt;property name="sqlMapClient" ref="sqlMapClient"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-jpa"></a>12.6.&nbsp;JPA</h2></div></div></div><p>Spring JPA (available under the
    <code class="literal">org.springframework.orm.jpa</code> package) offers
    comprehensive support for the <a href="http://java.sun.com/developer/technicalArticles/J2EE/jpa/index.html" target="_top">Java
    Persistence API</a> in a similar manner to the integration with
    Hibernate or JDO, while being aware of the underlying implementation in
    order to provide additional features.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jpa-setup"></a>12.6.1.&nbsp;JPA setup in a Spring environment</h3></div></div></div><p>Spring JPA offers three ways of setting up JPA
      <code class="interfacename">EntityManagerFactory</code>:</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jpa-setup-lemfb"></a>12.6.1.1.&nbsp;<code class="classname">LocalEntityManagerFactoryBean</code></h4></div></div></div><p>The <code class="classname">LocalEntityManagerFactoryBean</code> creates
        an <code class="interfacename">EntityManagerFactory</code> suitable for
        environments which solely use JPA for data access. The factory bean
        will use the JPA <code class="interfacename">PersistenceProvider</code>
        autodetection mechanism (according to JPA's Java SE bootstrapping) and,
        in most cases, requires only the persistence unit name to be specified:</p><pre class="programlisting">&lt;beans&gt;

   &lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalEntityManagerFactoryBean"&gt;
      &lt;property name="persistenceUnitName" value="myPersistenceUnit"/&gt;
   &lt;/bean&gt;

&lt;/beans&gt;</pre><p>This is the simplest but also most limited form of JPA deployment.
        There is no way to link to an existing JDBC <code class="interfacename">DataSource</code>
        and no support for global transactions, for example. Furthermore, weaving
        (byte-code transformation) of persistent classes is provider-specific,
        often requiring a specific JVM agent to specified on startup. All in all,
        this option is only really sufficient for standalone applications and test
        environments (which is exactly what the JPA specification designed it for).</p><p><span class="emphasis"><em>Only use this option in simple deployment environments
        like standalone applications and integration tests.</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jpa-setup-jndi"></a>12.6.1.2.&nbsp;<code class="classname">Obtaining an EntityManagerFactory from JNDI</code></h4></div></div></div><p>Obtaining an <code class="interfacename">EntityManagerFactory</code> from JNDI
        (for example in a Java EE 5 environment), is just a matter of changing the XML
        configuration:</p><pre class="programlisting">&lt;beans&gt;

    &lt;jee:jndi-lookup id="entityManagerFactory" jndi-name="persistence/myPersistenceUnit"/&gt;

&lt;/beans&gt;</pre><p>This assumes standard Java EE 5 bootstrapping, with the Java EE server
        autodetecting persistence units (i.e. <code class="literal">META-INF/persistence.xml</code>
        files in application jars) and <code class="literal">persistence-unit-ref</code> entries
        in the Java EE deployment descriptor (e.g. <code class="literal">web.xml</code>) defining
        environment naming context locations for those persistence units.</p><p>In such a scenario, the entire persistence unit deployment, including the
        weaving (byte-code transformation) of persistent classes, is up to the Java EE
        server. The JDBC <code class="interfacename">DataSource</code> is defined through
        a JNDI location in the <code class="literal">META-INF/persistence.xml</code> file;
        EntityManager transactions are integrated with the server's JTA subsystem.
        Spring merely uses the obtained <code class="interfacename">EntityManagerFactory</code>,
        passing it on to application objects via dependency injection, and managing
        transactions for it (typically through <code class="classname">JtaTransactionManager</code>).</p><p>Note that, in case of multiple persistence units used in the same application,
        the bean names of such a JNDI-retrieved persistence units should match the
        persistence unit names that the application uses to refer to them (e.g. in
        <code class="literal">@PersistenceUnit</code> and <code class="literal">@PersistenceContext</code>
        annotations).</p><p><span class="emphasis"><em>Use this option when deploying to a Java EE 5 server.
        Check your server's documentation on how to deploy a custom JPA provider
        into your server, allowing for a different provider than the server's default.
        </em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jpa-setup-lcemfb"></a>12.6.1.3.&nbsp;<code class="classname">LocalContainerEntityManagerFactoryBean</code></h4></div></div></div><p>The <code class="classname">LocalContainerEntityManagerFactoryBean</code>
        gives full control over <code class="interfacename">EntityManagerFactory</code>
        configuration and is appropriate for environments where fine-grained
        customization is required. The
        <code class="classname">LocalContainerEntityManagerFactoryBean</code> will
        create a <code class="interfacename">PersistenceUnitInfo</code> based on
        the <code class="literal">persistence.xml</code> file, the supplied
        <code class="literal">dataSourceLookup</code> strategy and the specified
        <code class="literal">loadTimeWeaver</code>. It is thus possible to work with
        custom DataSources outside of JNDI and to control the weaving process.</p><pre class="programlisting">&lt;beans&gt;
        
 &lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="dataSource" ref="someDataSource"/&gt;
  &lt;property name="loadTimeWeaver"&gt;
    &lt;bean class="org.springframework.instrument.classloading.InstrumentationLoadTimeWeaver"/&gt;
  &lt;/property&gt;
 &lt;/bean&gt;
 
&lt;/beans&gt;</pre><p>This is the most powerful JPA setup option, allowing for flexible
        local configuration within the application. It supports links to an
        existing JDBC <code class="interfacename">DataSource</code>, supports both
        local and global transactions, etc. However, it also imposes requirements
        onto the runtime environment, such as the availability of a weaving-capable
        ClassLoader if the persistence provider demands byte-code transformation.</p><p>Note that this option may conflict with the built-in JPA capabilities
        of a Java EE 5 server. So when running in a full Java EE 5 environment,
        consider obtaining your <code class="interfacename">EntityManagerFactory</code>
        from JNDI. Alternatively, specify a custom "persistenceXmlLocation" on
        your <code class="classname">LocalContainerEntityManagerFactoryBean</code> definition,
        e.g. "META-INF/my-persistence.xml", and only include a descriptor with that
        name in your application jar files. Since the Java EE 5 server will only
        look for default <code class="literal">META-INF/persistence.xml</code> files, it
        will ignore such custom persistence units and hence avoid conflicts with a
        Spring-driven JPA setup upfront. (This applies to Resin 3.1, for example.)</p><p><span class="emphasis"><em>Use this option for full JPA capabilities in a Spring-based
        application environment. This includes web containers such as Tomcat as well
        as standalone applications and integration tests with sophisticated
        persistence requirements.</em></span></p><div class="sidebar"><p class="title"><b>When is load time weaving required?</b></p><p>Not all JPA providers impose the need of a JVM agent
          (Hibernate being an example). If your provider does not require an
          agent or you have other alternatives (for example applying
          enhancements at build time through a custom compiler or an ant task)
          the load time weaver <span class="bold"><strong>should not</strong></span> be
          used.</p></div><p>The <code class="interfacename">LoadTimeWeaver</code> interface is a
        Spring-provided class that allows JPA
        <code class="interfacename">ClassTransformer</code> instances to be
        plugged in a specific manner depending on the environment (web
        container/application server). Hooking
        <code class="literal">ClassTransformers</code> through a JDK 5.0 <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/instrument/package-summary.html" target="_top">agent</a>
        is typically not efficient - the agents work against the
        <span class="emphasis"><em>entire virtual machine</em></span> and inspect
        <span class="emphasis"><em>every</em></span> class that is loaded - something that is
        typically undesirable in a production server enviroment.</p><p>Spring provides a number of
        <code class="interfacename">LoadTimeWeaver</code> implementations for
        various environments, allowing
        <code class="interfacename">ClassTransformer</code> instances to be
        applied only <span class="emphasis"><em>per ClassLoader</em></span> and not per
        VM.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="orm-jpa-setup-lcemfb-tomcat"></a>12.6.1.3.1.&nbsp;Tomcat load-time weaving setup (5.0+)</h5></div></div></div><p><a href="http://tomcat.apache.org/" target="_top">Jakarta
          Tomcat's</a> default ClassLoader does not support class
          transformation but allows custom ClassLoaders to be used. Spring
          offers the <code class="classname">TomcatInstrumentableClassLoader</code>
          (inside the
          <code class="literal">org.springframework.instrument.classloading.tomcat</code>
          package) which extends the Tomcat ClassLoader
          (<code class="classname">WebappClassLoader</code>) and allows JPA
          <code class="classname">ClassTransformer</code> instances to 'enhance' all
          classes loaded by it. In short, JPA transformers will be applied
          only inside a specific web application (which uses the
          <code class="classname">TomcatInstrumentableClassLoader</code>).</p><p>In order to use the custom ClassLoader on:</p><div class="itemizedlist"><div class="orderedlist"><ol type="1"><li><p>Copy <code class="literal">spring-tomcat-weaver.jar</code> into
              <span class="emphasis"><em>$CATALINA_HOME</em></span>/server/lib (where
              <span class="emphasis"><em>$CATALINA_HOME</em></span> represents the root of the
              Tomcat installation).</p></li><li><p>Instruct Tomcat to use the custom ClassLoader (instead of
              the default one) by editing the web application context file:</p><pre class="programlisting">&lt;Context path="/myWebApp" docBase="/my/webApp/location"&gt;
   &lt;Loader loaderClass="org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader" /&gt;
&lt;/Context&gt;</pre><p>Tomcat 5.0.x and 5.5.x series support several context
              locations: server configuration file
              (<span class="emphasis"><em>$CATALINA_HOME/conf/server.xml</em></span>), the
              default context configuration
              (<span class="emphasis"><em>$CATALINA_HOME/conf/context.xml</em></span>) that
              affects all deployed web applications and per-webapp
              configurations, deployed on the server
              <span class="emphasis"><em>($CATALINA_HOME/conf/[enginename]/[hostname]/my-webapp-context.xml</em></span>)
              side or along with the webapp
              (<span class="emphasis"><em>your-webapp.war/META-INF/context.xml</em></span>). For
              efficiency, inside the web-app configuration style is
              recommended since only applications which use JPA will use the
              custom ClassLoader. See the Tomcat 5.x <a href="http://tomcat.apache.org/tomcat-5.5-doc/config/context.html" target="_top">documentation</a>
              for more details about available context locations.</p><p>Note that versions prior to 5.5.20 contained a bug in the
              XML configuration parsing preventing usage of <code class="literal">Loader
              </code>tag inside <span class="emphasis"><em>server.xml</em></span> (no matter
              if a ClassLoader is specified or not (be it the official or a
              custom one). See Tomcat's bugzilla for <a href="http://issues.apache.org/bugzilla/show_bug.cgi?id=39704" target="_top">more
              details</a>.
              </p><p>
              If you are using Tomcat 5.5.20+ you can set <span class="emphasis"><em>useSystemClassLoaderAsParent</em></span> to
              <code class="literal">false</code> to fix the problem:
              </p><pre class="programlisting">&lt;Context path="/myWebApp" docBase="/my/webApp/location"&gt;
    &lt;Loader loaderClass="org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader"
            useSystemClassLoaderAsParent="false"/&gt;
&lt;/Context&gt;</pre><p>
              </p></li></ol></div><div class="orderedlist"><ol type="1"><li><p>Copy <code class="literal">spring-tomcat-weaver.jar</code> into
              <span class="emphasis"><em>$CATALINA_HOME</em></span>/lib (where
              <span class="emphasis"><em>$CATALINA_HOME</em></span> represents the root of the
              Tomcat installation).</p></li><li><p>Instruct Tomcat to use the custom ClassLoader (instead of
              the default one) by editing the web application context file:</p><pre class="programlisting">&lt;Context path="/myWebApp" docBase="/my/webApp/location"&gt;
    &lt;Loader loaderClass="org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader"/&gt;
&lt;/Context&gt;</pre><p>Tomcat 6.0.x (similar to 5.0.x/5.5.x) series support several context
              locations: server configuration file
              (<span class="emphasis"><em>$CATALINA_HOME/conf/server.xml</em></span>), the
              default context configuration
              (<span class="emphasis"><em>$CATALINA_HOME/conf/context.xml</em></span>) that
              affects all deployed web applications and per-webapp
              configurations, deployed on the server
              <span class="emphasis"><em>($CATALINA_HOME/conf/[enginename]/[hostname]/my-webapp-context.xml</em></span>)
              side or along with the webapp
              (<span class="emphasis"><em>your-webapp.war/META-INF/context.xml</em></span>). For
              efficiency, inside the web-app configuration style is
              recommended since only applications which use JPA will use the
              custom ClassLoader. See the Tomcat 5.x <a href="http://tomcat.apache.org/tomcat-6.0-doc/config/context.html" target="_top">documentation</a>
              for more details about available context locations.</p></li></ol></div><ul type="disc"><li><p>Tomcat 5.0.x/5.5.x</p></li><li><p>Tomcat 6.0.x</p></li></ul></div><p>The last step required on all Tomcat versions, is to use the appropriate 
		  the <code class="interfacename">LoadTimeWeaver</code> when configuring <code class="classname">LocalContainerEntityManagerFactoryBean</code>:</p><pre class="programlisting">&lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="loadTimeWeaver"&gt;
    &lt;bean class="org.springframework.instrument.classloading.ReflectiveLoadTimeWeaver"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>Using this technique, JPA applications relying on
          instrumentation, can run in Tomcat without the need of an agent.
          This is important especially when hosting applications which rely on
          different JPA implementations since the JPA transformers are applied
          only at ClassLoader level and thus, are isolated from each
          other.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If TopLink is being used a JPA provider under Tomcat,
              please place the toplink-essentials jar under
              <span class="emphasis"><em>$CATALINA_HOME</em></span>/shared/lib folder instead of
              your war.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="orm-jpa-oc4j"></a>12.6.1.3.2.&nbsp;OC4J load-time weaving setup (10.1.3.1+)</h5></div></div></div><p>As Oracle's <a href="http://www.oracle.com/technology/tech/java/oc4j/index.html" target="_top">OC4J</a>
          ClassLoader has native bytecode transformation support, switching
          from an JDK agent to a <code class="interfacename">LoadTimeWeaver</code> can be done
          just through the application Spring configuration:</p><pre class="programlisting">&lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="loadTimeWeaver"&gt;
    &lt;bean class="org.springframework.instrument.classloading.oc4j.OC4JLoadTimeWeaver"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="orm-jpa-glassfish"></a>12.6.1.3.3.&nbsp;GlassFish load-time weaving setup</h5></div></div></div><p><a href="https://glassfish.dev.java.net/" target="_top">GlassFish</a>
          application server provides out of the box, an instrumentation cable
          ClassLoader. Spring supports it through
          <code class="classname">GlassFishLoadTimeWeaver</code>:</p><pre class="programlisting">&lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="loadTimeWeaver"&gt;
    &lt;bean class="org.springframework.instrument.classloading.glassfish.GlassFishLoadTimeWeaver"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="orm-jpa-resin"></a>12.6.1.3.4.&nbsp;Resin load-time weaving setup (3.1+)</h5></div></div></div><p>Caucho <a href="http://www.caucho.com/resin-3.1/" target="_top">Resin 3.1</a>
          sesies ClassLoader provides native bytecode capabilities which can
          be used by Spring through <code class="classname">ReflectiveLoadTimeWeaver</code>:</p><pre class="programlisting">&lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="loadTimeWeaver"&gt;
    &lt;bean class="org.springframework.instrument.classloading.ReflectiveLoadTimeWeaver"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="orm-jpa-loadtimeweaver"></a>12.6.1.3.5.&nbsp;General <code class="interfacename">LoadTimeWeaver</code></h5></div></div></div><p>For environments where class instrumentation is required but
          are not supported by the existing LoadTimeWeaver implementations, a
          JDK agent can be the only solution. For such cases, Spring provides
          <code class="classname">InstrumentationLoadTimeWeaver</code> which requires a
          Spring-specific (but very general) VM agent
          (<code class="filename">spring-agent.jar</code>):</p><pre class="programlisting">&lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="loadTimeWeaver"&gt;
    &lt;bean class="org.springframework.instrument.classloading.InstrumentationLoadTimeWeaver"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>Note that the virtual machine has to be started with the
          Spring agent, by supplying the following JVM options:</p><pre class="programlisting">-javaagent:/path/to/spring-agent.jar</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jpa-multiple-pu"></a>12.6.1.4.&nbsp;Dealing with multiple persistence units</h4></div></div></div><p>For applications that rely on multiple persistence units
        locations (stored in various jars in the classpath for example),
        Spring offers the <code class="interfacename">PersistenceUnitManager</code> to act as
        a central repository and avoid the (potentially expensive) persistence
        units discovery process. The default implementation allows multiple
        locations to be specified (by default, the classpath is searched for
        <code class="filename">'META-INF/persistence.xml'</code> files) which are parsed and later on
        retrieved through the persistence unit name:</p><pre class="programlisting">&lt;bean id="persistenceUnitManager" class="org.springframework.orm.jpa.persistenceunit.DefaultPersistenceUnitManager"&gt;
  &lt;property name="persistenceXmlLocation"&gt;
    &lt;list&gt;
     &lt;value&gt;org/springframework/orm/jpa/domain/persistence-multi.xml&lt;/value&gt;
     &lt;value&gt;classpath:/my/package/**/custom-persistence.xml&lt;/value&gt;
     &lt;value&gt;classpath*:META-INF/persistence.xml&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
  &lt;property&gt;
   &lt;map&gt;
    &lt;entry key="localDataSource" value-ref="local-db"/&gt;
    &lt;entry key="remoteDataSource" value-ref="remote-db"/&gt;
   &lt;/map&gt;
  &lt;/property&gt;
  <em class="lineannotation"><span class="lineannotation">&lt;!-- if no datasource is specified, use this one --&gt;</span></em>
  &lt;property name="defaultDataSource" ref="remoteDataSource"/&gt;
  
&lt;/bean&gt;

&lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
 &lt;property name="persistenceUnitManager" ref="persistenceUnitManager"/&gt;
&lt;/bean&gt;</pre><p>Note that the default implementation allows customization of the
        persistence unit infos before feeding them to the JPA provider
        declaratively through its properties (which affect <span class="emphasis"><em>all</em></span>
        housed units) or programmatically, through the
        <code class="literal">PersistenceUnitPostProcessor</code> (which allow
        persistence unit selection). If no persistenceUnitManager is
        specified, one will be created and used internally by
        <code class="literal">LocalContainerEntityManagerFactoryBean</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jpa-template"></a>12.6.2.&nbsp;<code class="classname">JpaTemplate</code> and <code class="classname">JpaDaoSupport</code></h3></div></div></div><p>Each JPA-based DAO will then receive a
      <code class="interfacename">EntityManagerFactory</code> via dependency
      injection. Such a DAO can be coded against plain JPA and work with the
      given <code class="interfacename">EntityManagerFactory</code> or through
      Spring's <code class="classname">JpaTemplate</code>:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="entityManagerFactory" ref="entityManagerFactory"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><pre class="programlisting">public class JpaProductDao implements ProductDao {
  
    private JpaTemplate jpaTemplate;

    public void setEntityManagerFactory(EntityManagerFactory emf) {
        this.jpaTemplate = new JpaTemplate(emf);
    }

    public Collection loadProductsByCategory(final String category) throws DataAccessException {
        return (Collection) this.jpaTemplate.execute(new JpaCallback() {
            public Object doInJpa(EntityManager em) throws PersistenceException {
                Query query = em.createQuery("from Product as p where p.category = :category");
                query.setParameter("category", category);
                List result = query.getResultList(); 
                <em class="lineannotation"><span class="lineannotation">// do some further processing with the result list</span></em>
                return result;
            }
        });
    }
}</pre><p>The <code class="interfacename">JpaCallback</code> implementation
      allows any type of JPA data access. The
      <code class="classname">JpaTemplate</code> will ensure that
      <code class="interfacename">EntityManager</code>s are properly opened and
      closed and automatically participate in transactions. Moreover, the
      <code class="classname">JpaTemplate</code> properly handles exceptions, making
      sure resources are cleaned up and the appropriate transactions rolled
      back. The template instances are thread-safe and reusable and they can
      be kept as instance variable of the enclosing class. Note that
      <code class="classname">JpaTemplate</code> offers single-step actions such as
      find, load, merge, etc along with alternative convenience methods that
      can replace one line callback implementations.</p><p>Furthermore, Spring provides a convenient
      <code class="classname">JpaDaoSupport</code> base class that provides the
      <code class="literal">get/setEntityManagerFactory</code> and
      <code class="methodname">getJpaTemplate()</code> to be used by subclasses:</p><pre class="programlisting">public class ProductDaoImpl extends JpaDaoSupport implements ProductDao {
  
    public Collection loadProductsByCategory(String category) throws DataAccessException {
        Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;();
        params.put("category", category);
        return getJpaTemplate().findByNamedParams("from Product as p where p.category = :category", params);
    }
}</pre><p>Besides working with Spring's <code class="classname">JpaTemplate</code>,
      one can also code Spring-based DAOs against the JPA, doing one's own
      explicit <code class="interfacename">EntityManager</code> handling. As also
      elaborated in the corresponding Hibernate section, the main advantage of
      this approach is that your data access code is able to throw checked exceptions.
      <code class="classname">JpaDaoSupport</code> offers a variety of support methods
      for this scenario, for retrieving and releasing a transaction
      <code class="interfacename">EntityManager</code>, as well as for converting
      exceptions.</p><p><span class="emphasis"><em>JpaTemplate mainly exists as a sibling of JdoTemplate and
      HibernateTemplate, offering the same style for people used to it. For newly
      started projects, consider adopting the native JPA style of coding data
      access objects instead, based on a "shared EntityManager" reference obtained
      through the JPA <code class="literal">@PersistenceContext</code> annotation (using
      Spring's <code class="classname">PersistenceAnnotationBeanPostProcessor</code>;
      see below for details.)</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jpa-straight"></a>12.6.3.&nbsp;Implementing DAOs based on plain JPA</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>While <code class="interfacename">EntityManagerFactory</code>
        instances are thread-safe,
        <code class="interfacename">EntityManager</code> instances are not. The
        injected JPA <code class="interfacename">EntityManager</code> behave just
        like an <code class="interfacename">EntityManager</code> fetched from an
        application server's JNDI environment, as defined by the JPA
        specification. It will delegate all calls to the current transactional
        <code class="interfacename">EntityManager</code>, if any; else, it will
        fall back to a newly created
        <code class="interfacename">EntityManager</code> per operation, making it
        thread-safe.</p></td></tr></table></div><p>It is possible to write code against the plain JPA without using
      any Spring dependencies, using an injected
      <code class="interfacename">EntityManagerFactory</code> or
      <code class="interfacename">EntityManager</code>. Note that Spring can
      understand <code class="interfacename">@PersistenceUnit</code> and
      <code class="interfacename">@PersistenceContext</code> annotations both at
      field and method level if a
      <code class="classname">PersistenceAnnotationBeanPostProcessor</code> is
      enabled. A corresponding DAO implementation might look like this:</p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private EntityManagerFactory emf;

    @PersistenceUnit
    public void setEntityManagerFactory(EntityManagerFactory emf) {
        this.emf = emf;
    }

    public Collection loadProductsByCategory(String category) {
        EntityManager em = this.emf.createEntityManager();
        try {
             Query query = em.createQuery("from Product as p where p.category = ?1");
             query.setParameter(1, category);
             return query.getResultList();
        }
        finally {
            if (em != null) {
                em.close();
            }
        }
    }
}</pre><p>The DAO above has no dependency on Spring and still fits nicely
      into a Spring application context, just like it would if coded against
      Spring's <code class="classname">JpaTemplate</code>. Moreover, the DAO takes
      advantage of annotations to require the injection of the default
      <code class="interfacename">EntityManagerFactory</code>:</p><pre class="programlisting">&lt;beans&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!-- bean post-processor for JPA annotations --&gt;</span></em>
  &lt;bean class="org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor"/&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"/&gt;

&lt;/beans&gt;</pre><p>The main issue with such a DAO is that it always creates a new
      <code class="interfacename">EntityManager</code> via the factory. This can
      be easily overcome by requesting a transactional
      <code class="interfacename">EntityManager</code> (also called "shared
      EntityManager", since it is a shared, thread-safe proxy for the actual
      transactional EntityManager) to be injected instead of the factory:</p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    @PersistenceContext
    private EntityManager em;

    public Collection loadProductsByCategory(String category) {
       Query query = em.createQuery("from Product as p where p.category = :category");
       query.setParameter("category", category);
       return query.getResultList(); 
    }
}</pre><p>Note that the <code class="literal">@PersistenceContext</code> annotation
      has an optional attribute <code class="literal">type</code>, which defaults to
      <code class="literal">PersistenceContextType.TRANSACTION</code>. This default is
      what you need to receive a "shared EntityManager" proxy. The alternative,
      <code class="literal">PersistenceContextType.EXTENDED</code>, is a completely
      different affair: This results in a so-called "extended EntityManager",
      which is <span class="emphasis"><em>not thread-safe</em></span> and hence must not be used
      in a concurrently accessed component such as a Spring-managed singleton
      bean. Extended EntityManagers are only supposed to be used in stateful
      components that, for example, reside in a session, with the lifecycle
      of the EntityManager not tied to a current transaction but rather
      being completely up to the application.</p><div class="sidebar"><p class="title"><b>Method and Field level Injection</b></p><p>Annotations that indicate dependency injections (such as
        <code class="literal">@PersistenceUnit</code> and <code class="literal">@PersistenceContext</code>)
        can be applied on field or methods inside a class, therefore the expression
        "method/field level injection". Field-level annotations concise and easier
        to use while method-level allow for processing the injected dependency. In both
        cases the member visibility (public, protected, private) does not matter.</p><p>What about class level annotations?</p><p>On JEE 5 platform, they are used for dependency declaration and
        not for resource injection.</p></div><p>The injected <code class="interfacename">EntityManager</code> is
      Spring-managed (aware of the ongoing transaction). It is important to
      note that even though the new implementation prefers method level
      injection (of an <code class="interfacename">EntityManager</code> instead of
      an <code class="interfacename">EntityManagerFactory)</code>, no change is
      required in the application context XML due to annotation usage.</p><p>The main advantage of this DAO style is that it depends on Java
      Persistence API; no import of any Spring class is required. Moreover, as
      the JPA annotations are understood, the injections are applied
      automatically by the Spring container. This is of course appealing from
      a non-invasiveness perspective, and might feel more natural to JPA
      developers.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jpa-exceptions"></a>12.6.4.&nbsp;Exception Translation</h3></div></div></div><p>However, the DAO throws the plain
      <code class="classname">PersistenceException</code> exception class (which is
      unchecked, and so does not have to be declared or caught) but also
      <code class="classname">IllegalArgumentException</code> and
      <code class="classname">IllegalStateException</code>, which means that callers
      can only treat exceptions as generally fatal - unless they want to
      depend on JPA's own exception structure. Catching specific causes such
      as an optimistic locking failure is not possible without tying the
      caller to the implementation strategy. This tradeoff might be acceptable
      to applications that are strongly JPA-based and/or do not need any
      special exception treatment. However, Spring offers a solution allowing
      exception translation to be applied transparently through the
      <code class="interfacename">@Repository</code> annotation:</p><pre class="programlisting">@Repository
public class ProductDaoImpl implements ProductDao {

    <em class="lineannotation"><span class="lineannotation">// class body here...</span></em>

}</pre><pre class="programlisting">&lt;beans&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!-- <code class="classname">Exception</code> translation bean post processor --&gt;</span></em>
  &lt;bean class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor"/&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"/&gt;

&lt;/beans&gt;</pre><p>The postprocessor will automatically look for all exception
      translators (implementations of the
      <code class="interfacename">PersistenceExceptionTranslator</code> interface)
      and advice all beans maked with the
      <code class="interfacename">@Repository</code> annotation so that the
      discovered translators can intercept and apply the appropriate
      translation on the thrown exceptions.</p><p>In summary: DAOs can be implemented based on the plain Java
      Persistence API and annotations, while still being able to benefit from
      Spring-managed transactions, dependency injection, and transparent
      exception conversion (if desired) to Spring's custom exception
      hierarchies.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-jpa-tx"></a>12.7.&nbsp;Transaction Management</h2></div></div></div><p>To execute service operations within transactions, you can use
    Spring's common declarative transaction facilities. For example:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;

  &lt;bean id="myTxManager" class="org.springframework.orm.jpa.JpaTransactionManager"&gt;
    &lt;property name="entityManagerFactory" ref="myEmf"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="product.ProductServiceImpl"&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;
  
  &lt;aop:config&gt;
    &lt;aop:pointcut id="productServiceMethods" expression="execution(* product.ProductService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="productServiceMethods"/&gt;
  &lt;/aop:config&gt;

  &lt;tx:advice id="txAdvice" transaction-manager="myTxManager"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="increasePrice*" propagation="REQUIRED"/&gt;
      &lt;tx:method name="someOtherBusinessMethod" propagation="REQUIRES_NEW"/&gt;
      &lt;tx:method name="*" propagation="SUPPORTS" read-only="true"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

&lt;/beans&gt;</pre><p>Spring JPA allows a configured
    <code class="classname">JpaTransactionManager</code> to expose a JPA transaction
    to JDBC access code that accesses the same JDBC
    <code class="interfacename">DataSource</code>, provided that the registered
    <code class="interfacename">JpaDialect</code> supports retrieval of the
    underlying JDBC <code class="interfacename">Connection</code>. Out of the box,
    Spring provides dialects for the Toplink, Hibernate and OpenJPA JPA
    implementations. See the next section for details on the
    <code class="interfacename">JpaDialect</code> mechanism.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-jpa-dialect"></a>12.8.&nbsp;<code class="interfacename">JpaDialect</code></h2></div></div></div><p>As an advanced feature <code class="classname">JpaTemplate</code>,
    <code class="classname">JpaTransactionManager</code> and subclasses of
    <code class="classname">AbstractEntityManagerFactoryBean</code> support a custom
    <code class="interfacename">JpaDialect</code>, to be passed into the
    "jpaDialect" bean property. In such a scenario, the DAOs won't receive an
    <code class="interfacename">EntityManagerFactory</code> reference but rather a
    full <code class="classname">JpaTemplate</code> instance instead (for example,
    passed into <code class="classname">JpaDaoSupport</code>'s "jpaTemplate"
    property). A <code class="interfacename">JpaDialect</code> implementation can
    enable some advanced features supported by Spring, usually in a
    vendor-specific manner:</p><div class="itemizedlist"><ul type="disc"><li><p>applying specific transaction semantics (such as custom
        isolation level or transaction timeout)</p></li><li><p>retrieving the transactional JDBC
        <code class="interfacename">Connection</code> (for exposure to JDBC-based
        DAOs)</p></li><li><p>advanced translation of <code class="literal">PersistenceExceptions</code>
        to Spring <code class="literal">DataAccessExceptions</code></p></li></ul></div><p>This is particularly valuable for special transaction semantics and
    for advanced translation of exception. Note that the default
    implementation used (<code class="classname">DefaultJpaDialect</code>) doesn't
    provide any special capabilities and if the above features are required,
    the appropriate dialect has to be specified.</p><p>See the <code class="interfacename">JpaDialect</code> Javadoc for more
    details of its operations and how they are used within Spring's JPA support.</p></div></div></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="spring-web"></a>Part&nbsp;III.&nbsp;The Web</h1></div></div></div><div class="partintro" lang="en"><div></div><p>
				This part of the reference documentation covers the
				Spring Framework's support for the presentation tier
				(and specifically web-based presentation tiers).
			</p><p>
				The Spring Framework's own web framework,
				<a href="#mvc" title="Chapter&nbsp;13.&nbsp;Web MVC framework">Spring Web MVC</a>, is covered in
				the first couple of chapters. A number of the remaining
				chapters in this part of the reference documentation are
				concerned with the Spring Framework's integration with
				other web technologies, such as <a href="#struts" title="15.4.&nbsp;Struts">Struts</a>
				and <a href="#jsf" title="15.3.&nbsp;JavaServer Faces">JSF</a> (to name but two).
			</p><p>
				This section concludes with coverage of Spring's MVC
				<a href="#portlet" title="Chapter&nbsp;16.&nbsp;Portlet MVC Framework">portlet framework</a>.
			</p><div class="itemizedlist"><ul type="disc"><li><a href="#mvc" title="Chapter&nbsp;13.&nbsp;Web MVC framework">Chapter&nbsp;13, <i>Web MVC framework</i></a></li><li><a href="#view" title="Chapter&nbsp;14.&nbsp;Integrating view technologies">Chapter&nbsp;14, <i>Integrating view technologies</i></a></li><li><a href="#webintegration" title="Chapter&nbsp;15.&nbsp;Integrating with other web frameworks">Chapter&nbsp;15, <i>Integrating with other web frameworks</i></a></li><li><a href="#portlet" title="Chapter&nbsp;16.&nbsp;Portlet MVC Framework">Chapter&nbsp;16, <i>Portlet MVC Framework</i></a></li></ul></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="mvc"></a>Chapter&nbsp;13.&nbsp;Web MVC framework</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-introduction"></a>13.1.&nbsp;Introduction</h2></div></div></div><p>Spring's Web MVC framework is designed around a <code class="classname">DispatcherServlet</code>
    that dispatches requests to handlers, with configurable handler mappings,
    view resolution, locale and theme resolution as well as support for upload
    files. The default handler is a very simple <code class="interfacename">Controller</code> interface, just
    offering a <code class="literal">ModelAndView handleRequest(request,response)</code>
    method. This can already be used for application controllers, but you will
    prefer the included implementation hierarchy, consisting of, for example
    <code class="classname">AbstractController</code>,
    <code class="classname">AbstractCommandController</code> and
    <code class="classname">SimpleFormController</code>. Application controllers will
    typically be subclasses of those. Note that you can choose an appropriate
    base class: if you don't have a form, you don't need a form controller.
    This is a major difference to Struts.</p><div class="sidebar"><a name="mvc-open-for-extension"></a><p class="title"><b>&#8220;<span class="quote">Open for extension...</span>&#8221;</b></p><p>One of the overarching design principles in Spring Web MVC (and in Spring in general)
        is the &#8220;<span class="quote"><span class="emphasis"><em>Open for extension, closed for modification</em></span></span>&#8221;
        principle.</p><p>The reason that this principle is being mentioned here is because a number
        of methods in the core classes in Spring Web MVC are marked <code class="literal">final</code>.
        This means of course that you as a developer cannot override these methods to
        supply your own behavior... this is <span class="emphasis"><em>by design</em></span> and has not
        been done arbitrarily to annoy.</p><p>The book 'Expert Spring Web MVC and Web Flow' by Seth Ladd and others explains this
        principle and the reasons for adhering to it in some depth on page 117 (first edition)
        in the section entitled 'A Look At Design'.</p><p>If you don't have access to the aforementioned book, then the following article
        may be of interest the next time you find yourself going
        &#8220;<span class="quote">Gah! Why can't I override this method?</span>&#8221; (if indeed you ever do).</p><div class="orderedlist"><ol type="1"><li><p><a href="http://www.objectmentor.com/resources/articles/ocp.pdf" target="_top">Bob Martin, The Open-Closed Principle (PDF)</a></p></li></ol></div><p>Note that you cannot add advice to final methods using Spring MVC. This means it won't
        be possible to add advice to for example the <code class="literal">AbstractController.handleRequest()</code> method.
        Refer to <a href="#aop-understanding-aop-proxies" title="6.6.1.&nbsp;Understanding AOP proxies">Section&nbsp;6.6.1, &#8220;Understanding AOP proxies&#8221;</a> for more information on AOP proxies and
        why you cannot add advice to final methods.</p></div><p>Spring Web MVC allows you to use any object as a command or form object -
    there is no need to implement a framework-specific interface or base class.
    Spring's data binding is highly flexible: for example, it treats type mismatches
    as validation errors that can be evaluated by the application, not as system
    errors. All this means that you don't need to duplicate your business objects'
    properties as simple, untyped strings in your form objects just to be able to
    handle invalid submissions, or to convert the Strings properly. Instead, it is
    often preferable to bind directly to your business objects. This is another
    major difference to Struts which is built around required base classes such as
    <code class="classname">Action</code> and <code class="classname">ActionForm</code>.</p><p>Compared to WebWork, Spring has more differentiated object roles. It
    supports the notion of a <code class="interfacename">Controller</code>, an optional
    command or form object, and a model that gets passed to the view. The model will
    normally include the command or form object but also arbitrary reference data;
    instead, a WebWork <code class="interfacename">Action</code> combines all those
    roles into one single object. WebWork does allow you to use existing business objects
    as part of your form, but only by making them bean properties of the respective
    <code class="interfacename">Action</code> class. Finally, the same
    <code class="interfacename">Action</code> instance that handles the request is used for
    evaluation and form population in the view. Thus, reference data needs to
    be modeled as bean properties of the <code class="interfacename">Action</code> too.
    These are (arguably) too many roles for one object.</p><p>Spring's view resolution is extremely flexible. A
    <code class="interfacename">Controller</code> implementation can even write a view
    directly to the response (by returning <code class="literal">null</code> for the
    <code class="classname">ModelAndView</code>). In the normal case, a
    <code class="classname">ModelAndView</code> instance consists of a view name and a model
    <code class="interfacename">Map</code>, which contains bean names and corresponding
    objects (like a command or form, containing reference data). View name resolution
    is highly configurable, either via bean names, via a properties file, or via your
    own <code class="interfacename">ViewResolver</code> implementation. The fact that the
    model (the M in MVC) is based on the <code class="interfacename">Map</code> interface
    allows for the complete abstraction of the view technology. Any renderer can be
    integrated directly, whether JSP, Velocity, or any other rendering technology.
    The model <code class="interfacename">Map</code> is simply transformed into an
    appropriate format, such as JSP request attributes or a Velocity template model.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-introduction-pluggability"></a>13.1.1.&nbsp;Pluggability of other MVC implementations</h3></div></div></div><p>There are several reasons why some projects will prefer to use
      other MVC implementations. Many teams expect to leverage their existing
      investment in skills and tools. In addition, there is a large body of
      knowledge and experience avalailable for the Struts framework. Thus, if
      you can live with Struts' architectural flaws, it can still be a viable
      choice for the web layer; the same applies to WebWork and other web MVC
      frameworks.</p><p>If you don't want to use Spring's web MVC, but intend to leverage
      other solutions that Spring offers, you can integrate the web MVC
      framework of your choice with Spring easily. Simply start up a Spring
      root application context via its <code class="classname">ContextLoaderListener</code>,
      and access it via its <code class="interfacename">ServletContext</code> attribute
      (or Spring's respective helper method) from within a Struts or WebWork action.
      Note that there aren't any "plugins" involved, so no dedicated integration
      is necessary. From the web layer's point of view, you'll simply use Spring
      as a library, with the root application context instance as the entry point.</p><p>All your registered beans and all of Spring's services can be at
      your fingertips even without Spring's web MVC. Spring doesn't compete
      with Struts or WebWork in this scenario, it just addresses the many
      areas that the pure web MVC frameworks don't, from bean configuration to
      data access and transaction handling. So you are able to enrich your
      application with a Spring middle tier and/or data access tier, even if
      you just want to use, for example, the transaction abstraction with JDBC
      or Hibernate.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-features"></a>13.1.2.&nbsp;Features of Spring Web MVC</h3></div></div></div><div class="sidebar"><p class="title"><b>Spring WebFlow</b></p><p>Spring Web Flow (SWF) aims to be the best solution for the management of web application page flow.</p><p>SWF integrates with existing frameworks like Spring MVC, Struts, and JSF, in both servlet and
	portlet environments. If you have a business process (or processes) that would benefit from a
	conversational model as opposed to a purely request model, then SWF may be the solution.</p><p>SWF allows you to capture logical page flows as self-contained modules that are reusable in different
	situations, and as such is ideal for building web application modules that guide the user through controlled
	navigations that drive business processes.</p><p>For more information about SWF, consult the
    <a href="http://opensource.atlassian.com/confluence/spring/display/WEBFLOW/Home/" target="_top">Spring WebFlow site</a>.</p></div><p>Spring's web module provides a wealth of unique web support
      features, including:</p><div class="itemizedlist"><ul type="disc"><li><p>Clear separation of roles - controller, validator, command
          object, form object, model object, <code class="classname">DispatcherServlet</code>,
          handler mapping, view resolver, etc. Each role can be fulfilled by a
          specialized object.</p></li><li><p>Powerful and straightforward configuration of both framework
          and application classes as JavaBeans, including easy referencing
          across contexts, such as from web controllers to business objects
          and validators.</p></li><li><p>Adaptability, non-intrusiveness. Use whatever controller
          subclass you need (plain, command, form, wizard, multi-action, or a
          custom one) for a given scenario instead of deriving from a single
          controller for everything.</p></li><li><p>Reusable business code - no need for duplication. You can use
          existing business objects as command or form objects instead of
          mirroring them in order to extend a particular framework base
          class.</p></li><li><p>Customizable binding and validation - type mismatches as
          application-level validation errors that keep the offending value,
          localized date and number binding, etc instead of String-only form
          objects with manual parsing and conversion to business
          objects.</p></li><li><p>Customizable handler mapping and view resolution - handler
          mapping and view resolution strategies range from simple URL-based
          configuration, to sophisticated, purpose-built resolution
          strategies. This is more flexible than some web MVC frameworks which
          mandate a particular technique.</p></li><li><p>Flexible model transfer - model transfer via a name/value
          <code class="interfacename">Map</code> supports easy integration with
          any view technology.</p></li><li><p>Customizable locale and theme resolution, support for JSPs
          with or without Spring tag library, support for JSTL, support for
          Velocity without the need for extra bridges, etc.</p></li><li><p>A simple yet powerful JSP tag library known as the Spring tag library
          that provides support for features such as data binding and themes. The
          custom tags allow for maximum flexibility in terms of markup code.
          For information on the tag library descriptor, see the appendix entitled
          <a href="#spring.tld" title="Appendix&nbsp;D.&nbsp;spring.tld">Appendix&nbsp;D, <i>spring.tld</i></a></p></li><li><p>A JSP form tag library, introduced in Spring 2.0, that makes writing
          forms in JSP pages much easier. For information on the tag library descriptor,
          see the appendix entitled <a href="#spring-form.tld" title="Appendix&nbsp;E.&nbsp;spring-form.tld">Appendix&nbsp;E, <i>spring-form.tld</i></a></p></li><li><p>Beans whose lifecycle is scoped to the current HTTP request or HTTP
          <code class="interfacename">Session</code>. This is not a specific feature of
          Spring MVC itself, but rather of the <code class="interfacename">WebApplicationContext</code>
          container(s) that Spring MVC uses. These bean scopes are described in detail in
          the section entitled <a href="#beans-factory-scopes-other" title="3.4.4.&nbsp;The other scopes">Section&nbsp;3.4.4, &#8220;The other scopes&#8221;</a></p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-servlet"></a>13.2.&nbsp;The <code class="classname">DispatcherServlet</code></h2></div></div></div><p>Spring's web MVC framework is, like many other web MVC frameworks,
    request-driven, designed around a central servlet that dispatches requests
    to controllers and offers other functionality facilitating the development
    of web applications. Spring's <code class="classname">DispatcherServlet</code>
    however, does more than just that. It is completely integrated with the
    Spring IoC container and as such allows you to use every other feature that
    Spring has.</p><p>The request processing workflow of the Spring Web MVC
    <code class="classname">DispatcherServlet</code> is illustrated in the following diagram.
    The pattern-savvy reader will recognize that the <code class="classname">DispatcherServlet</code>
    is an expression of the &#8220;<span class="quote">Front Controller</span>&#8221; design pattern (this is a
    pattern that Spring Web MVC shares with many other leading web frameworks).</p><p>
		</p><div class="mediaobject" align="center"><img src="images/mvc.png" align="middle"><div class="caption"><p>The requesting processing workflow in Spring Web MVC (high level)</p></div></div><p>
	</p><p>The <code class="classname">DispatcherServlet</code> <span class="emphasis"><em>is</em></span> an
    actual <code class="interfacename">Servlet</code> (it inherits from the
    <code class="classname">HttpServlet</code> base class), and as such is declared in the
    <code class="literal">web.xml</code> of your web application. Requests that you want the
    <code class="classname">DispatcherServlet</code> to handle will have to be mapped using
    a URL mapping in the same <code class="literal">web.xml</code> file. This is standard J2EE
    servlet configuration; an example of such a <code class="classname">DispatcherServlet</code>
    declaration and mapping can be found below.</p><pre class="programlisting">&lt;web-app&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;example&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;example&lt;/servlet-name&gt;
        &lt;url-pattern&gt;*.form&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;</pre><p>In the example above, all requests ending with <code class="literal">.form</code>
    will be handled by the <code class="literal">'example'</code>
    <code class="classname">DispatcherServlet</code>. This is only the first step in
    setting up Spring Web MVC... the various beans used by the Spring Web MVC framework (over
    and above the <code class="classname">DispatcherServlet</code> itself) now need to be
    configured.</p><p>As detailed in the section entitled <a href="#context-introduction" title="3.8.&nbsp;The ApplicationContext">Section&nbsp;3.8, &#8220;The <code class="interfacename">ApplicationContext</code>&#8221;</a>,
    <code class="interfacename">ApplicationContext</code> instances in Spring can be scoped.
    In the web MVC framework, each <code class="classname">DispatcherServlet</code> has its own
    <code class="interfacename">WebApplicationContext</code>, which inherits all the beans
    already defined in the root <code class="interfacename">WebApplicationContext</code>.
	These inherited beans defined can be overridden in the servlet-specific scope,
    and new scope-specific beans can be defined local to a given servlet instance.</p><p>
		</p><div class="mediaobject" align="center"><img src="images/mvc-contexts.gif" align="middle"><div class="caption"><p>Context hierarchy in Spring Web MVC</p></div></div><p>
	</p><p>The framework will, on initialization of a <code class="classname">DispatcherServlet</code>,
    <span class="emphasis"><em>look for a file named <code class="literal">[servlet-name]-servlet.xml</code></em></span>
    in the <code class="literal">WEB-INF</code> directory of your web application and create the beans
    defined there (overriding the definitions of any beans defined with the same name in the
    global scope).</p><p>Consider the following <code class="classname">DispatcherServlet</code> servlet configuration
    (in the <code class="literal">'web.xml'</code> file.)</p><pre class="programlisting">&lt;web-app&gt;
    ...
    &lt;servlet&gt;
        &lt;servlet-name&gt;<span class="bold"><strong>golfing</strong></span>&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;<span class="bold"><strong>golfing</strong></span>&lt;/servlet-name&gt;
        &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</pre><p>With the above servlet configuration in place, you will need to have a file called
    <code class="literal">'/WEB-INF/<span class="bold"><strong>golfing</strong></span>-servlet.xml'</code> in your
    application; this file will contain all of your <span class="emphasis"><em>Spring Web MVC-specific</em></span>
    components (beans). The exact location of this configuration file can be changed via a
    servlet initialization parameter (see below for details).</p><p>The <code class="interfacename">WebApplicationContext</code> is an extension of the
    plain <code class="interfacename">ApplicationContext</code> that has some extra features
    necessary for web applications. It differs from a normal
    <code class="interfacename">ApplicationContext</code> in that it is capable of resolving
    themes (see <a href="#mvc-themeresolver" title="13.7.&nbsp;Using themes">Section&nbsp;13.7, &#8220;Using themes&#8221;</a>), and that it knows which servlet
    it is associated with (by having a link to the <code class="interfacename">ServletContext</code>).
    The <code class="interfacename">WebApplicationContext</code> is bound in the
    <code class="interfacename">ServletContext</code>, and by using static methods on the
    <code class="classname">RequestContextUtils</code> class you can always lookup the
    <code class="interfacename">WebApplicationContext</code> in case you need access to it.</p><p>The Spring <code class="classname">DispatcherServlet</code> has a couple of special beans
    it uses in order to be able to process requests and render the appropriate views.
    These beans are included in the Spring framework and can be configured in
    the <code class="interfacename">WebApplicationContext</code>, just as any other bean would
    be configured. Each of those beans is described in more detail below. Right now, we'll
    just mention them, just to let you know they exist and to enable us to go on talking
    about the <code class="classname">DispatcherServlet</code>. For most of the beans, sensible
    defaults are provided so you don't (initially) have to worry about configuring them.</p><div class="table"><a name="mvc-webappctx-special-beans-tbl"></a><p class="title"><b>Table&nbsp;13.1.&nbsp;Special beans in the <code class="interfacename">WebApplicationContext</code></b></p><div class="table-contents"><table summary="Special beans in the WebApplicationContext" border="1"><colgroup><col><col></colgroup><thead><tr><th>Bean type</th><th>Explanation</th></tr></thead><tbody><tr><td>Controllers</td><td><a href="#mvc-controller" title="13.3.&nbsp;Controllers">Controllers</a> are the
            components that form the <code class="literal">'C'</code> part of the MVC.</td></tr><tr><td>Handler mappings</td><td><a href="#mvc-handlermapping" title="13.4.&nbsp;Handler mappings">Handler mappings</a>
            handle the execution of a list of pre- and post-processors and controllers
            that will be executed if they match certain criteria (for instance a
            matching URL specified with the controller)</td></tr><tr><td>View resolvers</td><td><a href="#mvc-viewresolver" title="13.5.&nbsp;Views and resolving them">View resolvers</a> are components
            capable of resolving view names to views</td></tr><tr><td>Locale resolver</td><td>A <a href="#mvc-localeresolver" title="13.6.&nbsp;Using locales">locale resolver</a> is a
            component capable of resolving the locale a client is using, in order to be
            able to offer internationalized views</td></tr><tr><td>Theme resolver</td><td>A <a href="#mvc-themeresolver" title="13.7.&nbsp;Using themes">theme resolver</a> is capable
            of resolving themes your web application can use, for example, to offer
            personalized layouts</td></tr><tr><td>multipart file resolver</td><td>A <a href="#mvc-multipart" title="13.8.&nbsp;Spring's multipart (fileupload) support">multipart file resolver</a> offers
            the functionality to process file uploads from HTML forms</td></tr><tr><td>Handler exception resolver(s)</td><td><a href="#mvc-exceptionhandlers" title="13.10.&nbsp;Handling exceptions">Handler exception resolvers</a>
            offer functionality to map exceptions to views or implement other more
            complex exception handling code</td></tr></tbody></table></div></div><br class="table-break"><p>When a <code class="classname">DispatcherServlet</code> is set up for use and a
    request comes in for that specific <code class="classname">DispatcherServlet</code>, said
    <code class="classname">DispatcherServlet</code> starts processing the request. The list
    below describes the complete process a request goes through when handled by a
    <code class="classname">DispatcherServlet</code>:</p><div class="orderedlist"><ol type="1"><li><p>The <code class="interfacename">WebApplicationContext</code> is searched
          for and bound in the request as an attribute in order for the controller
          and other elements in the process to use. It is bound by default under the key
          <code class="literal">DispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE</code>.</p></li><li><p>The locale resolver is bound to the request to let elements in
          the process resolve the locale to use when processing the request
          (rendering the view, preparing data, etc.) If you don't use the
          resolver, it won't affect anything, so if you don't need locale
          resolving, you don't have to use it.</p></li><li><p>The theme resolver is bound to the request to let elements
          such as views determine which theme to use. The theme resolver does
          not affect anything if you don't use it, so if you don't need themes
          you can just ignore it.</p></li><li><p>If a multipart resolver is specified, the request is inspected
          for multiparts; if multiparts are found, the request is wrapped in a
          <code class="classname">MultipartHttpServletRequest</code> for further
          processing by other elements in the process. (See the section
          entitled <a href="#mvc-multipart-resolver" title="13.8.2.&nbsp;Using the MultipartResolver">Section&nbsp;13.8.2, &#8220;Using the <code class="interfacename">MultipartResolver</code>&#8221;</a> for further
          information about multipart handling).</p></li><li><p>An appropriate handler is searched for. If a handler is found,
          the execution chain associated with the handler (preprocessors,
          postprocessors, and controllers) will be executed in order to prepare
          a model (for rendering).</p></li><li><p>If a model is returned, the view is rendered. If no model is returned
          (which could be due to a pre- or postprocessor intercepting the request,
          for example, for security reasons), no view is rendered, since the request
          could already have been fulfilled.</p></li></ol></div><p>Exceptions that are thrown during processing of the request get
    picked up by any of the handler exception resolvers that are declared in
    the <code class="interfacename">WebApplicationContext</code>. Using these exception
    resolvers allows you to define custom behaviors in case such exceptions get
    thrown.</p><p>The Spring <code class="classname">DispatcherServlet</code> also has support for
    returning the <span class="emphasis"><em>last-modification-date</em></span>, as specified by the
    Servlet API. The process of determining the last modification date for a specific
    request is straightforward: the <code class="classname">DispatcherServlet</code> will first
    lookup an appropriate handler mapping and test if the handler that is found
    <span class="emphasis"><em>implements the interface <code class="interfacename">LastModified</code></em></span>
    interface. If so, the value of the <code class="literal">long getLastModified(request)</code> method
    of the <code class="interfacename">LastModified</code> interface is returned to the client.</p><p>You can customize Spring's <code class="classname">DispatcherServlet</code> by
    adding context parameters in the <code class="literal">web.xml</code> file or servlet
    initialization parameters. The possibilities are listed below.</p><div class="table"><a name="mvc-disp-servlet-init-params-tbl"></a><p class="title"><b>Table&nbsp;13.2.&nbsp;<code class="classname">DispatcherServlet</code> initialization parameters</b></p><div class="table-contents"><table summary="DispatcherServlet initialization parameters" border="1"><colgroup><col><col></colgroup><thead><tr><th>Parameter</th><th>Explanation</th></tr></thead><tbody><tr><td><code class="literal">contextClass</code></td><td>Class that implements <code class="interfacename">WebApplicationContext</code>,
            which will be used to instantiate the context used by this servlet. If this
            parameter isn't specified, the <code class="classname">XmlWebApplicationContext</code>
            will be used.</td></tr><tr><td><code class="literal">contextConfigLocation</code></td><td>String which is passed to the context instance (specified
            by <code class="literal">contextClass</code>) to indicate where context(s)
            can be found. The string is potentially split up into multiple
            strings (using a comma as a delimiter) to support multiple
            contexts (in case of multiple context locations, of beans that are
            defined twice, the latest takes precedence).</td></tr><tr><td><code class="literal">namespace</code></td><td>the namespace of the <code class="interfacename">WebApplicationContext</code>.
            Defaults to <code class="literal">[servlet-name]-servlet</code>.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-controller"></a>13.3.&nbsp;Controllers</h2></div></div></div><p>The notion of a controller is part of the MVC design pattern (more specifically
    it is the <span class="emphasis"><em>'C'</em></span> in MVC. Controllers provide access to the application
    behavior which is typically defined by a service interface. Controllers interpret user
    input and transform such input into a sensible model which will be represented to the
    user by the view. Spring has implemented the notion of a controller in a very abstract
    way enabling a wide variety of different kinds of controllers to be created. Spring
    contains form-specific controllers, command-based controllers, and controllers
    that execute wizard-style logic, to name but a few.</p><p>Spring's basis for the controller architecture is the
    <code class="interfacename">org.springframework.web.servlet.mvc.Controller</code>
    interface, the source code for which is listed below. </p><pre class="programlisting">public interface Controller {

    /**
     * Process the request and return a ModelAndView object which the DispatcherServlet
     * will render.
     */
    ModelAndView handleRequest(
        HttpServletRequest request,
        HttpServletResponse response) throws Exception;

}</pre><p>As you can see, the <code class="interfacename">Controller</code> interface
    defines a single method that is responsible for handling a request and returning
    an appropriate model and view. These three concepts are the basis for the Spring
    MVC implementation - <code class="classname">ModelAndView</code> and
    <code class="interfacename">Controller</code>. While the
    <code class="interfacename">Controller</code> interface is quite abstract,
    Spring offers a lot of <code class="interfacename">Controller</code> implementations
    out of the box that already contain a lot of the functionality you might need. The
    <code class="interfacename">Controller</code> interface just defines the most basic
    responsibility required of every controller; namely handling a request and returning
    a model and a view.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-controller-abstractcontroller"></a>13.3.1.&nbsp;<code class="classname">AbstractController</code> and <code class="classname">WebContentGenerator</code></h3></div></div></div><p>To provide a basic infrastructure, all of Spring's various
      <code class="interfacename">Controller</code> inherit from
      <code class="classname">AbstractController</code>, a class offering caching support
      and, for example, the setting of the mimetype.</p><div class="table"><a name="mvc-controller-abstract-features"></a><p class="title"><b>Table&nbsp;13.3.&nbsp;Features offered by the <code class="classname">AbstractController</code></b></p><div class="table-contents"><table summary="Features offered by the AbstractController" border="1"><colgroup><col><col></colgroup><thead><tr><th>Feature</th><th>Explanation</th></tr></thead><tbody><tr><td><code class="literal">supportedMethods</code></td><td>indicates what methods this controller should accept.
              Usually this is set to both <code class="literal">GET</code> and
              <code class="literal">POST</code>, but you can modify this to reflect the
              method you want to support. If a request is received with a
              method that is not supported by the controller, the client will
              be informed of this (expedited by the throwing of a
              <code class="classname">ServletException</code>).</td></tr><tr><td><code class="literal">requiresSession</code></td><td>indicates whether or not this controller requires a
              HTTP session to do its work. If a session is not present when
              such a controller receives a request, the user is informed
              of this by a <code class="classname">ServletException</code> being thrown.</td></tr><tr><td><code class="literal">synchronizeSession</code></td><td>use this if you want handling by this controller to be
              synchronized on the user's HTTP session.</td></tr><tr><td><code class="literal">cacheSeconds</code></td><td>when you want a controller to generate a caching
              directive in the HTTP response, specify a positive integer here.
              By default the value of this property is set to <span class="emphasis"><em>-1</em></span>
              so no caching directives will be included in the generated response.</td></tr><tr><td><code class="literal">useExpiresHeader</code></td><td>tweaks your controllers to specify the HTTP 1.0
              compatible <span class="emphasis"><em>"Expires"</em></span> header in the generated
              response. By default the value of this property is
              <code class="literal">true</code>.</td></tr><tr><td><code class="literal">useCacheHeader</code></td><td>tweaks your controllers to specify the HTTP 1.1
              compatible <span class="emphasis"><em>"Cache-Control"</em></span> header in the generated
              response. By default the value of this property is
              <code class="literal">true</code>.</td></tr></tbody></table></div></div><br class="table-break"><p>When using the <code class="classname">AbstractController</code> as the baseclass
      for your controllers you only have to override the
      <code class="literal">handleRequestInternal(HttpServletRequest, HttpServletResponse)</code>
      method, implement your logic, and return a <code class="classname">ModelAndView</code> object.
      Here is short example consisting of a class and a declaration in the web
      application context.</p><pre class="programlisting">package samples;

public class SampleController extends AbstractController {

    public ModelAndView handleRequestInternal(
        HttpServletRequest request,
        HttpServletResponse response) throws Exception {

        ModelAndView mav = new ModelAndView("hello");
        mav.addObject("message", "Hello World!");
        return mav;        
    }
}</pre><pre class="programlisting">&lt;bean id="sampleController" class="samples.SampleController"&gt;
    &lt;property name="cacheSeconds" value="120"/&gt;
&lt;/bean&gt;</pre><p>The above class and the declaration in the web application context is all
        you need besides setting up a handler mapping (see the section entitled
        <a href="#mvc-handlermapping" title="13.4.&nbsp;Handler mappings">Section&nbsp;13.4, &#8220;Handler mappings&#8221;</a>) to get this very simple controller working.
        This controller will generate caching directives telling the client to cache things
        for 2 minutes before rechecking. This controller also returns a hard-coded view
        (which is typically considered bad practice).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-controller-othersimplecontrollers"></a>13.3.2.&nbsp;Other simple controllers</h3></div></div></div><p>Although you can extend <code class="classname">AbstractController</code>, Spring
      provides a number of concrete implementations which offer functionality that is
      commonly used in simple MVC applications. The
      <code class="classname">ParameterizableViewController</code> is basically the same as
      the example above, except for the fact that you can specify the view name that it
      will return in the web application context (and thus remove the need to hard-code
      the viewname in the Java class).</p><p>The <code class="classname">UrlFilenameViewController</code> inspects the URL
      and retrieves the filename of the file request and uses that as a viewname.
      For example, the filename of <code class="literal">http://www.springframework.org/index.html</code>
      request is <code class="literal">index</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-controller-multiaction"></a>13.3.3.&nbsp;The <code class="classname">MultiActionController</code></h3></div></div></div><p>Spring offers a multi-action controller with which you aggregate
      multiple actions into one controller, thus grouping functionality together.
      The multi-action controller lives in a separate package -
      <code class="literal">org.springframework.web.servlet.mvc.multiaction</code> - and
      is capable of mapping requests to method names and then invoking the
      right method name. Using the multi-action controller is especially handy
      when you have a lot of common functionality in one controller, but want
      to have multiple entry points to the controller, for example, to tweak
      behavior.</p><div class="table"><a name="mvc-controller-multiaction-features"></a><p class="title"><b>Table&nbsp;13.4.&nbsp;Features offered by the <code class="classname">MultiActionController</code></b></p><div class="table-contents"><table summary="Features offered by the MultiActionController" border="1"><colgroup><col><col></colgroup><thead><tr><th>Feature</th><th>Explanation</th></tr></thead><tbody><tr><td><code class="literal">delegate</code></td><td>there are two usage-scenarios for the
              <code class="classname">MultiActionController</code>. Either you subclass the
              <code class="classname">MultiActionController</code> and specify the methods
              that will be resolved by the <code class="interfacename">MethodNameResolver</code>
              on the subclass (in which case you don't need to set the delegate),
              or you define a delegate object, on which methods resolved by the
              <code class="interfacename">MethodNameResolver</code> will be invoked.
              If you choose this scenario, you will have to define the delegate using
              this configuration parameter as a collaborator.</td></tr><tr><td><code class="literal">methodNameResolver</code></td><td>the <code class="classname">MultiActionController</code> needs a strategy
              to resolve the method it has to invoke, based on the incoming request. This
              strategy is defined by the <code class="interfacename">MethodNameResolver</code>
              interface; the <code class="classname">MultiActionController</code> exposes a
              property sp that you can supply a resolver that is capable of doing that.</td></tr></tbody></table></div></div><br class="table-break"><p>Methods defined for a multi-action controller need to conform to
      the following signature:</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// anyMeaningfulName can be replaced by any methodname</span></em>
public [ModelAndView | Map | void] anyMeaningfulName(HttpServletRequest, HttpServletResponse [, Exception | AnyObject]);</pre><p>Please note that method overloading is <span class="emphasis"><em>not</em></span>
      allowed since it would confuse the <code class="classname">MultiActionController</code>.
      Furthermore, you can define <span class="emphasis"><em>exception handlers</em></span> capable
      of handling exceptions that are thrown by the methods you specify.

      </p><p>The (optional) <code class="classname">Exception</code> argument can be <span class="emphasis"><em>any</em></span>
      exception, as long as it's a subclass of <code class="classname">java.lang.Exception</code> or
      <code class="classname">java.lang.RuntimeException</code>. The (optional) <code class="classname">AnyObject</code>
      argument can be <span class="emphasis"><em>any</em></span> class. Request parameters will be bound onto this
      object for convenient consumption.</p><p>
      
      </p><p>Find below some examples of valid <code class="classname">MultiActionController</code>
      method signatures.</p><p>
      
      </p><p>The standard signature (mirrors the <code class="interfacename">Controller</code> interface method).</p><p>
      </p><pre class="programlisting">public ModelAndView doRequest(HttpServletRequest, HttpServletResponse)</pre><p>
      </p><p>This signature accepts a <code class="classname">Login</code> argument that will be populated (bound) with parameters stripped from the request</p><p>
      </p><pre class="programlisting">public ModelAndView doLogin(HttpServletRequest, HttpServletResponse, Login)</pre><p>
      </p><p>The signature for an <code class="classname">Exception</code> handling method.</p><p>
      </p><pre class="programlisting">public ModelAndView processException(HttpServletRequest, HttpServletResponse, IllegalArgumentException)</pre><p>
      </p><p>This signature has a void return type (see the section entitled <a href="#mvc-coc" title="13.11.&nbsp;Convention over configuration">Section&nbsp;13.11, &#8220;Convention over configuration&#8221;</a> below).</p><p>
      </p><pre class="programlisting">public void goHome(HttpServletRequest, HttpServletResponse)</pre><p>
      </p><p>This signature has a <code class="interfacename">Map</code> return type (see the section entitled <a href="#mvc-coc" title="13.11.&nbsp;Convention over configuration">Section&nbsp;13.11, &#8220;Convention over configuration&#8221;</a> below).</p><p>
      </p><pre class="programlisting">public Map doRequest(HttpServletRequest, HttpServletResponse)</pre><p>

      </p><p>The <code class="interfacename">MethodNameResolver</code> is responsible for
      resolving method names based on the request coming in. Find below details about
      the three <code class="interfacename">MethodNameResolver</code> implementations
      that Spring provides out of the box.</p><p>
      
      </p><div class="itemizedlist"><ul type="disc" compact><li><p><code class="classname">ParameterMethodNameResolver</code> - capable of
            resolving a request parameter and using that as the method name
            (<code class="literal">http://www.sf.net/index.view?testParam=testIt</code>
            will result in a method <code class="literal">testIt(HttpServletRequest,
            HttpServletResponse)</code> being called). The <code class="literal">paramName</code>
            property specifies the request parameter that is to be inspected).</p></li><li><p><code class="classname">InternalPathMethodNameResolver</code> -
            retrieves the filename from the request path and uses that as the method
            name (<code class="literal">http://www.sf.net/testing.view</code> will
            result in a method <code class="literal">testing(HttpServletRequest,
            HttpServletResponse)</code> being called).</p></li><li><p><code class="classname">PropertiesMethodNameResolver</code> - uses a
            user-defined properties object with request URLs mapped to
            method names. When the properties contain
            <code class="literal">/index/welcome.html=doIt</code> and a request to
            <code class="literal">/index/welcome.html</code> comes in, the
            <code class="literal">doIt(HttpServletRequest, HttpServletResponse)</code>
            method is called. This method name resolver works with the
            <code class="literal">PathMatcher</code>, so if the properties contained
            <code class="literal">/**/welcom?.html</code>, it would also have
            worked!</p></li></ul></div><p>

      </p><p>Here are a couple of examples. First, an example showing the
      <code class="classname">ParameterMethodNameResolver</code> and the delegate
      property, which will accept requests to URLs with the parameter method
      included and set to <code class="literal">retrieveIndex</code>: </p><p>
      
      </p><pre class="programlisting">&lt;bean id="paramResolver" class="org....mvc.multiaction.ParameterMethodNameResolver"&gt;
  &lt;property name="paramName" value="method"/&gt;
&lt;/bean&gt;

&lt;bean id="paramMultiController" class="org....mvc.multiaction.MultiActionController"&gt;
  &lt;property name="methodNameResolver" ref="paramResolver"/&gt;
  &lt;property name="delegate" ref="sampleDelegate"/&gt;
&lt;/bean&gt;

&lt;bean id="sampleDelegate" class="samples.SampleDelegate"/&gt;

<em class="lineannotation"><span class="lineannotation">## together with</span></em>

public class SampleDelegate {

    public ModelAndView retrieveIndex(HttpServletRequest req, HttpServletResponse resp) {

        return new ModelAndView("index", "date", new Long(System.currentTimeMillis()));
    }
}</pre><p>

        </p><p>When using the delegates shown above, we could also use the
        <code class="classname">PropertiesMethodNameResolver</code> to match a couple of
        URLs to the method we defined: </p><p>
      
      </p><pre class="programlisting">&lt;bean id="propsResolver" class="org....mvc.multiaction.PropertiesMethodNameResolver"&gt;
  &lt;property name="mappings"&gt;
    &lt;value&gt;
        /index/welcome.html=retrieveIndex
        /**/notwelcome.html=retrieveIndex
        /*/user?.html=retrieveIndex
    &lt;/value&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="paramMultiController" class="org....mvc.multiaction.MultiActionController"&gt;
    &lt;property name="methodNameResolver" ref="propsResolver"/&gt;
    &lt;property name="delegate" ref="sampleDelegate"/&gt;
&lt;/bean&gt;</pre><p>
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-controller-command"></a>13.3.4.&nbsp;Command controllers</h3></div></div></div><p>Spring's <span class="emphasis"><em>command controllers</em></span> are a fundamental
      part of the Spring Web MVC package. Command controllers provide a way to
      interact with data objects and dynamically bind parameters from the
      <code class="interfacename">HttpServletRequest</code> to the data object specified.
      They perform a somewhat similar role to the Struts <code class="classname">ActionForm</code>,
      but in Spring, your data objects don't have to implement a framework-specific
      interface. First, lets examine what command controllers are available straight
      out of the box.</p><div class="itemizedlist"><ul type="disc" compact><li><p><code class="classname">AbstractCommandController</code> - a command
            controller you can use to create your own command controller,
            capable of binding request parameters to a data object you
            specify. This class does not offer form functionality; it does
            however offer validation features and lets you specify in the
            controller itself what to do with the command object that has been
            populated with request parameter values.</p></li><li><p><code class="classname">AbstractFormController</code> - an abstract
            controller offering form submission support. Using this controller
            you can model forms and populate them using a command object you
            retrieve in the controller. After a user has filled the form, the
            <code class="classname">AbstractFormController</code> binds the fields,
            validates the command object, and hands the object back to the
            controller to take the appropriate action. Supported features are:
            invalid form submission (resubmission), validation, and normal form
            workflow. You implement methods to determine which views are used
            for form presentation and success. Use this controller if you need
            forms, but don't want to specify what views you're going to show the
            user in the application context.</p></li><li><p><code class="classname">SimpleFormController</code> - a form controller
            that provides even more support when creating a form with a corresponding
            command object. The <code class="classname">SimpleFormController</code>
            let's you specify a command object, a viewname for the form, a
            viewname for page you want to show the user when form submission
            has succeeded, and more.</p></li><li><p><code class="classname">AbstractWizardFormController</code> - as the
            class name suggests, this is an abstract class - your
            wizard controller should extend it. This means you have to
            implement the <code class="literal">validatePage()</code>,
            <code class="literal">processFinish()</code> and
            <code class="literal">processCancel()</code> methods.</p><p>You probably also want to write a contractor, which should
            at the very least call <code class="literal">setPages()</code> and
            <code class="literal">setCommandName()</code>. The former takes as its
            argument an array of type String. This array is the list of views
            which comprise your wizard. The latter takes as its argument a
            String, which will be used to refer to your command object from
            within your views.</p><p>As with any instance of <code class="classname">AbstractFormController</code>, you are
            required to use a command object - a JavaBean which will be
            populated with the data from your forms. You can do this in one of
            two ways: either call <code class="literal">setCommandClass()</code> from
            the constructor with the class of your command object, or
            implement the <code class="literal">formBackingObject()</code>
            method.</p><p><code class="classname">AbstractWizardFormController</code> has a number of concrete
            methods that you may wish to override. Of these, the ones you are
            likely to find most useful are: <code class="literal">referenceData(..)</code>
            which you can use to pass model data to your view in the form of a
            <code class="interfacename">Map</code>; <code class="literal">getTargetPage()</code> if your wizard needs to
            change page order or omit pages dynamically; and
            <code class="literal">onBindAndValidate()</code> if you want to override the
            built-in binding and validation workflow.</p><p>Finally, it is worth pointing out the
            <code class="literal">setAllowDirtyBack()</code> and
            <code class="literal">setAllowDirtyForward()</code>, which you can call from
            <code class="literal">getTargetPage()</code> to allow users to move backwards
            and forwards in the wizard even if validation fails for the
            current page.</p><p>For a full list of methods, see the Javadoc for
            <code class="classname">AbstractWizardFormController</code>. There is an implemented example of
            this wizard in the jPetStore included in the Spring distribution:
            <code class="classname">org.springframework.samples.jpetstore.web.spring.OrderFormController</code>.</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-handlermapping"></a>13.4.&nbsp;Handler mappings</h2></div></div></div><p>Using a handler mapping you can map incoming web requests to
    appropriate handlers. There are some handler mappings you can use out of
    the box, for example, the <code class="classname">SimpleUrlHandlerMapping</code> or
    the <code class="classname">BeanNameUrlHandlerMapping</code>, but let's first examine
    the general concept of a <code class="interfacename">HandlerMapping</code>.</p><p>The functionality a basic <code class="interfacename">HandlerMapping</code> provides
    is the delivering of a <code class="literal">HandlerExecutionChain</code>, which
    must contain the handler that matches the incoming request, and may also
    contain a list of handler interceptors that are applied to the request.
    When a request comes in, the <code class="classname">DispatcherServlet</code> will
    hand it over to the handler mapping to let it inspect the request and come
    up with an appropriate HandlerExecutionChain. Then the <code class="classname">DispatcherServlet</code>
    will execute the handler and interceptors in the chain (if any).</p><p>The concept of configurable handler mappings that can optionally
    contain interceptors (executed before or after the actual handler was
    executed, or both) is extremely powerful. A lot of supporting
    functionality can be built into custom <code class="interfacename">HandlerMapping</code>s.
    Think of a custom handler mapping that chooses a handler not only based on
    the URL of the request coming in, but also on a specific state of the
    session associated with the request.</p><p>This section describes two of Spring's most commonly used handler
    mappings. They both extend the <code class="literal">AbstractHandlerMapping</code>
    and share the following properties: </p><div class="itemizedlist"><ul type="disc" compact><li><p><code class="literal">interceptors</code>: the list of interceptors to
          use. <code class="interfacename">HandlerInterceptor</code>s are discussed in <a href="#mvc-handlermapping-interceptor" title="13.4.3.&nbsp;Intercepting requests - the HandlerInterceptor interface">Section&nbsp;13.4.3, &#8220;Intercepting requests - the <code class="interfacename">HandlerInterceptor</code> interface&#8221;</a>.</p></li><li><p><code class="literal">defaultHandler</code>: the default handler to use,
          when this handler mapping does not result in a matching handler.</p></li><li><p><code class="literal">order</code>: based on the value of the order
          property (see the
          <code class="literal">org.springframework.core.Ordered</code> interface),
          Spring will sort all handler mappings available in the context and
          apply the first matching handler.</p></li><li><p><code class="literal">alwaysUseFullPath</code>: if this property is set
          to <code class="literal">true</code>, Spring will use the full path within the
          current servlet context to find an appropriate handler. If this
          property is set to <code class="literal">false</code> (the default), the path
          within the current servlet mapping will be used. For example, if a
          servlet is mapped using <code class="literal">/testing/*</code> and the
          <code class="literal">alwaysUseFullPath</code> property is set to true,
          <code class="literal">/testing/viewPage.html</code> would be used, whereas if
          the property is set to false, <code class="literal">/viewPage.html</code>
          would be used.</p></li><li><p><code class="literal">urlPathHelper</code>: using this property, you can
          tweak the UrlPathHelper used when inspecting URLs. Normally, you
          shouldn't have to change the default value.</p></li><li><p><code class="literal">urlDecode</code>: the default value for this
          property is <code class="literal">false</code>. The
          <code class="interfacename">HttpServletRequest</code> returns request URLs and URIs
          that are <span class="emphasis"><em>not</em></span> decoded. If you do want them to be
          decoded before a <code class="interfacename">HandlerMapping</code> uses them to find
          an appropriate handler, you have to set this to
          <code class="literal">true</code> (note that this requires JDK 1.4). The
          decoding method uses either the encoding specified by the request or
          the default ISO-8859-1 encoding scheme.</p></li><li><p><code class="literal">lazyInitHandlers</code>: allows for lazy
          initialization of <span class="emphasis"><em>singleton</em></span> handlers (prototype
          handlers are always lazily initialized). Default value is
          <code class="literal">false</code>.</p></li></ul></div><p>(<span class="emphasis"><em>Note: the last four properties are only available to subclasses of
        <code class="classname">org.springframework.web.servlet.handler.AbstractUrlHandlerMapping</code></em></span>).</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-handlermapping-beanname"></a>13.4.1.&nbsp;<code class="classname">BeanNameUrlHandlerMapping</code></h3></div></div></div><p>A very simple, but very powerful handler mapping is the
      <code class="classname">BeanNameUrlHandlerMapping</code>, which maps incoming HTTP
      requests to names of beans, defined in the web application context.
      Let's say we want to enable a user to insert an account and we've
      already provided an appropriate form controller (see
      <a href="#mvc-controller-command" title="13.3.4.&nbsp;Command controllers">Section&nbsp;13.3.4, &#8220;Command controllers&#8221;</a> for more information on command- and
      form controllers) and a JSP view (or Velocity template) that renders the
      form. When using the <code class="classname">BeanNameUrlHandlerMapping</code>, we
      could map the HTTP request with the URL
      <code class="literal">http://samples.com/editaccount.form</code> to the appropriate
      form <code class="interfacename">Controller</code> as follows:</p><pre class="programlisting">&lt;beans&gt;
  &lt;bean id="handlerMapping" class="org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping"/&gt;

  &lt;bean name="/editaccount.form" class="org.springframework.web.servlet.mvc.SimpleFormController"&gt;
    &lt;property name="formView" value="account"/&gt;
    &lt;property name="successView" value="account-created"/&gt;
    &lt;property name="commandName" value="account"/&gt;
    &lt;property name="commandClass" value="samples.Account"/&gt;
  &lt;/bean&gt;
&lt;beans&gt;</pre><p>All incoming requests for the URL
      <code class="literal">/editaccount.form</code> will now be handled by the
      form <code class="interfacename">Controller</code> in the source listing above.
      Of course we have to define a servlet-mapping in <code class="literal">web.xml</code>
      as well, to let through all the requests ending with <code class="literal">.form</code>.
      </p><pre class="programlisting">&lt;web-app&gt;
    ...
    &lt;servlet&gt;
        &lt;servlet-name&gt;sample&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

   <em class="lineannotation"><span class="lineannotation">&lt;!-- maps the sample dispatcher to <code class="literal">*.form</code> --&gt;</span></em>
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;sample&lt;/servlet-name&gt;
        &lt;url-pattern&gt;*.form&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
    ...
&lt;/web-app&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you want to use the <code class="classname">BeanNameUrlHandlerMapping</code>,
        you don't necessarily have to define it in the web application context (as
        indicated above). By default, if no handler mapping can be found in the context,
        the <code class="classname">DispatcherServlet</code> creates a
        <code class="classname">BeanNameUrlHandlerMapping</code> for you!</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-handlermapping-urlhandlermapping"></a>13.4.2.&nbsp;<code class="classname">SimpleUrlHandlerMapping</code></h3></div></div></div><p>A further - and much more powerful handler mapping - is the
      <code class="classname">SimpleUrlHandlerMapping</code>. This mapping is configurable
      in the application context and has Ant-style path matching capabilities
      (see the Javadoc for the <code class="classname">org.springframework.util.PathMatcher</code>
      class). Here is an example:</p><pre class="programlisting">&lt;web-app&gt;
    ...
    &lt;servlet&gt;
        &lt;servlet-name&gt;sample&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- maps the sample dispatcher to *.form --&gt;</span></em>
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;sample&lt;/servlet-name&gt;
        &lt;url-pattern&gt;*.form&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- maps the sample dispatcher to *.html --&gt;</span></em>
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;sample&lt;/servlet-name&gt;
        &lt;url-pattern&gt;*.html&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
    ...
&lt;/web-app&gt;</pre><p>The above <code class="literal">web.xml</code> configuration snippet enables all requests
        ending with .html and <code class="literal">.form</code> to be handled by the sample dispatcher 
        servlet.</p><pre class="programlisting">&lt;beans&gt;
        
    <em class="lineannotation"><span class="lineannotation">&lt;!-- no <code class="literal">'id'</code> required, <code class="interfacename">HandlerMapping</code> beans are automatically detected by the <code class="classname">DispatcherServlet</code> --&gt;</span></em>
    &lt;bean class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"&gt;
        &lt;property name="mappings"&gt;
            &lt;value&gt;
                /*/account.form=editAccountFormController
                /*/editaccount.form=editAccountFormController
                /ex/view*.html=helpController
                /**/help.html=helpController
            &lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="helpController"
          class="org.springframework.web.servlet.mvc.UrlFilenameViewController"/&gt;

    &lt;bean id="editAccountFormController"
          class="org.springframework.web.servlet.mvc.SimpleFormController"&gt;
        &lt;property name="formView" value="account"/&gt;
        &lt;property name="successView" value="account-created"/&gt;
        &lt;property name="commandName" value="Account"/&gt;
        &lt;property name="commandClass" value="samples.Account"/&gt;
    &lt;/bean&gt;
&lt;beans&gt;</pre><p>This handler mapping routes requests for <code class="literal">'help.html'</code>
        in any directory to the <code class="literal">'helpController'</code>, which is a
        <code class="classname">UrlFilenameViewController</code> (more about controllers
        can be found in the section entitled <a href="#mvc-controller" title="13.3.&nbsp;Controllers">Section&nbsp;13.3, &#8220;Controllers&#8221;</a>).
        Requests for a resource beginning with <code class="literal">'view'</code>, and ending
        with <code class="literal">'.html'</code> in the directory <code class="literal">'ex'</code> will
        be routed to the <code class="literal">'helpController'</code>. Two further mappings
        are also defined for <code class="literal">'editAccountFormController'</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-handlermapping-interceptor"></a>13.4.3.&nbsp;Intercepting requests - the <code class="interfacename">HandlerInterceptor</code> interface</h3></div></div></div><p>Spring's handler mapping mechanism has the notion of handler
      interceptors, that can be extremely useful when you want to apply
      specific functionality to certain requests, for example, checking for a
      principal.</p><p>Interceptors located in the handler mapping must implement
      <code class="interfacename">HandlerInterceptor</code> from the
      <code class="literal">org.springframework.web.servlet</code> package. This
      interface defines three methods, one that will be called
      <span class="emphasis"><em>before</em></span> the actual handler will be executed, one
      that will be called <span class="emphasis"><em>after</em></span> the handler is executed,
      and one that is called <span class="emphasis"><em>after the complete request has
      finished</em></span>. These three methods should provide enough
      flexibility to do all kinds of pre- and post-processing.</p><p>The <code class="literal">preHandle(..)</code> method returns a boolean value.
      You can use this method to break or continue the processing of the
      execution chain. When this method returns <code class="literal">true</code>, the
      handler execution chain will continue, when it returns false, the
      <code class="classname">DispatcherServlet</code> assumes the interceptor itself has
      taken care of requests (and, for example, rendered an appropriate view) and
      does not continue executing the other interceptors and the actual handler in
      the execution chain.</p><p>The following example provides an interceptor that intercepts all
      requests and reroutes the user to a specific page if the time is not
      between 9 a.m. and 6 p.m.
      </p><pre class="programlisting">&lt;beans&gt;
    &lt;bean id="handlerMapping"
          class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"&gt;
        &lt;property name="interceptors"&gt;
            &lt;list&gt;
                &lt;ref bean="officeHoursInterceptor"/&gt;
            &lt;/list&gt;
        &lt;/property&gt;
        &lt;property name="mappings"&gt;
            &lt;value&gt;
                /*.form=editAccountFormController
                /*.view=editAccountFormController
            &lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="officeHoursInterceptor"
          class="samples.TimeBasedAccessInterceptor"&gt;
        &lt;property name="openingTime" value="9"/&gt;
        &lt;property name="closingTime" value="18"/&gt;
    &lt;/bean&gt;
&lt;beans&gt;</pre><pre class="programlisting">package samples;

public class TimeBasedAccessInterceptor extends HandlerInterceptorAdapter {

    private int openingTime;
    private int closingTime;

    public void setOpeningTime(int openingTime) {
        this.openingTime = openingTime;
    }

    public void setClosingTime(int closingTime) {
        this.closingTime = closingTime;
    }

    public boolean preHandle(
            HttpServletRequest request,
            HttpServletResponse response,
            Object handler) throws Exception {

        Calendar cal = Calendar.getInstance();
        int hour = cal.get(HOUR_OF_DAY);
        if (openingTime &lt;= hour &lt; closingTime) {
            return true;
        } else {
            response.sendRedirect("http://host.com/outsideOfficeHours.html");
            return false;
        }
    }
}</pre><p>Any request coming in, will be intercepted by the
      <code class="classname">TimeBasedAccessInterceptor</code>, and if the current time
      is outside office hours, the user will be redirected to a static html
      file, saying, for example, he can only access the website during office
      hours.</p><p>As you can see, Spring has an adapter class (the cunningly named
      <code class="classname">HandlerInterceptorAdapter</code>) to make it easier to
      extend the <code class="interfacename">HandlerInterceptor</code> interface.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-viewresolver"></a>13.5.&nbsp;Views and resolving them</h2></div></div></div><p>All MVC frameworks for web applications provide a way to address
    views. Spring provides view resolvers, which enable you to render models
    in a browser without tying you to a specific view technology. Out of the
    box, Spring enables you to use JSPs, Velocity templates and
    XSLT views, for example. The section entitled <a href="#view" title="Chapter&nbsp;14.&nbsp;Integrating view technologies">Chapter&nbsp;14, <i>Integrating view technologies</i></a> has
    details of how to integrate and use a number of disparate view technologies.</p><p>The two interfaces which are important to the way Spring handles
    views are <code class="interfacename">ViewResolver</code> and
    <code class="interfacename">View</code>. The <code class="interfacename">ViewResolver</code>
    provides a mapping between view names and actual views. The
    <code class="interfacename">View</code> interface addresses the preparation of
    the request and hands the request over to one of the view technologies.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-viewresolver-resolver"></a>13.5.1.&nbsp;Resolving views - the <code class="interfacename">ViewResolver</code> interface</h3></div></div></div><p>As discussed in the section entitled <a href="#mvc-controller" title="13.3.&nbsp;Controllers">Section&nbsp;13.3, &#8220;Controllers&#8221;</a>,
      all controllers in the Spring Web MVC framework return a
      <code class="classname">ModelAndView</code> instance. Views in Spring are addressed
      by a view name and are resolved by a view resolver. Spring comes with
      quite a few view resolvers. We'll list most of them and then provide a
      couple of examples.</p><div class="table"><a name="mvc-view-resolvers-tbl"></a><p class="title"><b>Table&nbsp;13.5.&nbsp;View resolvers</b></p><div class="table-contents"><table summary="View resolvers" border="1"><colgroup><col><col></colgroup><thead><tr><th><code class="interfacename">ViewResolver</code></th><th>Description</th></tr></thead><tbody><tr><td><code class="classname">AbstractCachingViewResolver</code></td><td>An abstract view resolver which takes care of caching
              views. Often views need preparation before they can be used,
              extending this view resolver provides caching of views.</td></tr><tr><td><code class="classname">XmlViewResolver</code></td><td>An implementation of <code class="interfacename">ViewResolver</code>
              that accepts a configuration file written in XML with the same DTD
              as Spring's XML bean factories. The default configuration file is
              <code class="literal">/WEB-INF/views.xml</code>.</td></tr><tr><td><code class="classname">ResourceBundleViewResolver</code></td><td>An implementation of <code class="interfacename">ViewResolver</code>
              that uses bean definitions in a <code class="classname">ResourceBundle</code>,
              specified by the bundle basename. The bundle is typically defined in a
              properties file, located in the classpath. The default file name is
              <code class="literal">views.properties</code>.</td></tr><tr><td><code class="classname">UrlBasedViewResolver</code></td><td>A simple implementation of the <code class="interfacename">ViewResolver</code>
              interface that effects the direct resolution of symbolic view names to
              URLs, without an explicit mapping definition. This is appropriate if your
              symbolic names match the names of your view resources in a
              straightforward manner, without the need for arbitrary mappings.</td></tr><tr><td><code class="classname">InternalResourceViewResolver</code></td><td>A convenience subclass of <code class="classname">UrlBasedViewResolver</code>
              that supports <code class="classname">InternalResourceView</code> (i.e. Servlets and JSPs),
              and subclasses such as <code class="classname">JstlView</code> and
              <code class="classname">TilesView</code>. The view class for all views generated
              by this resolver can be specified via <code class="literal">setViewClass(..)</code>.
              See the Javadocs for the <code class="classname">UrlBasedViewResolver</code> class
              for details.</td></tr><tr><td><code class="classname">VelocityViewResolver</code> / <code class="classname">FreeMarkerViewResolver</code></td><td>A convenience subclass of <code class="classname">UrlBasedViewResolver</code> that
              supports <code class="classname">VelocityView</code> (i.e. Velocity templates) or
              <code class="classname">FreeMarkerView</code> respectively and custom subclasses of
              them.</td></tr></tbody></table></div></div><br class="table-break"><p>As an example, when using JSP for a view technology you can use
      the <code class="classname">UrlBasedViewResolver</code>. This view resolver
      translates a view name to a URL and hands the request over the
      RequestDispatcher to render the view.</p><pre class="programlisting">&lt;bean id="viewResolver"
      class="org.springframework.web.servlet.view.UrlBasedViewResolver"&gt;
    &lt;property name="prefix" value="/WEB-INF/jsp/"/&gt;
    &lt;property name="suffix" value=".jsp"/&gt;
&lt;/bean&gt;</pre><p>When returning <code class="literal">test</code> as a
      viewname, this view resolver will hand the request over to the
      <code class="classname">RequestDispatcher</code> that will send the request to
      <code class="literal">/WEB-INF/jsp/test.jsp</code>.</p><p>When mixing different view technologies in a web application, you
      can use the <code class="classname">ResourceBundleViewResolver</code>:</p><pre class="programlisting">&lt;bean id="viewResolver"
      class="org.springframework.web.servlet.view.ResourceBundleViewResolver"&gt;
    &lt;property name="basename" value="views"/&gt;
    &lt;property name="defaultParentView" value="parentView"/&gt;
&lt;/bean&gt;</pre><p>The <code class="classname">ResourceBundleViewResolver</code> inspects the
      <code class="classname">ResourceBundle</code> identified by the basename, and for
      each view it is supposed to resolve,
      it uses the value of the property <code class="literal">[viewname].class</code> as
      the view class and the value of the property
      <code class="literal">[viewname].url</code> as the view url. As you can see, you
      can identify a parent view, from which all views in the properties file
      sort of extend. This way you can specify a default view class, for
      example.</p><p><span class="emphasis"><em>A note on caching</em></span> - subclasses of
      <code class="classname">AbstractCachingViewResolver</code> cache view instances they
      have resolved. This greatly improves performance when using certain view
      technologies. It's possible to turn off the cache, by setting the
      <code class="literal">cache</code> property to <code class="literal">false</code>. Furthermore,
      if you have the requirement to be able to refresh a certain view at
      runtime (for example when a Velocity template has been modified), you can
      use the <code class="literal">removeFromCache(String viewName, Locale loc)</code> method.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-viewresolver-chaining"></a>13.5.2.&nbsp;Chaining ViewResolvers</h3></div></div></div><p>Spring supports more than just one view resolver. This allows you
      to chain resolvers and, for example, override specific views in certain
      circumstances. Chaining view resolvers is pretty straightforward - just
      add more than one resolver to your application context and, if
      necessary, set the <code class="literal">order</code> property to specify an
      order. Remember, the higher the order property, the later the view
      resolver will be positioned in the chain.</p><p>In the following example, the chain of view resolvers consists of
      two resolvers, a <code class="classname">InternalResourceViewResolver</code> (which
      is always automatically positioned as the last resolver in the chain)
      and an <code class="classname">XmlViewResolver</code> for specifying Excel views
      (which are not supported by the <code class="classname">InternalResourceViewResolver</code>):</p><pre class="programlisting">&lt;bean id="jspViewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
  &lt;property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/&gt;
  &lt;property name="prefix" value="/WEB-INF/jsp/"/&gt;
  &lt;property name="suffix" value=".jsp"/&gt;
&lt;/bean&gt;

&lt;bean id="excelViewResolver" class="org.springframework.web.servlet.view.XmlViewResolver"&gt;
  &lt;property name="order" value="1"/&gt;
  &lt;property name="location" value="/WEB-INF/views.xml"/&gt;
&lt;/bean&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- in <code class="literal">views.xml</code> --&gt;</span></em>

&lt;beans&gt;
  &lt;bean name="report" class="org.springframework.example.ReportExcelView"/&gt;
&lt;/beans&gt;</pre><p>If a specific view resolver does not result in a view, Spring will
      inspect the context to see if other view resolvers are configured. If
      there are additional view resolvers, it will continue to inspect them.
      If not, it will throw an <code class="classname">Exception</code>.</p><p>You have to keep something else in mind - the contract of a view
      resolver mentions that a view resolver <span class="emphasis"><em>can</em></span> return
      null to indicate the view could not be found. Not all view resolvers do
      this however! This is because in some cases, the resolver simply cannot
      detect whether or not the view exists. For example, the
      <code class="classname">InternalResourceViewResolver</code> uses the
      <code class="classname">RequestDispatcher</code> internally, and dispatching is the only way to figure
      out if a JSP exists - this can only be done once. The same holds for the
      <code class="classname">VelocityViewResolver</code> and some others. Check the Javadoc for the view
      resolver to see if you're dealing with a view resolver that does not
      report non-existing views. As a result of this, putting an
      <code class="classname">InternalResourceViewResolver</code> in the chain in a place
      other than the last, will result in the chain not being fully inspected,
      since the <code class="classname">InternalResourceViewResolver</code> will
      <span class="emphasis"><em>always</em></span> return a view!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-redirecting"></a>13.5.3.&nbsp;Redirecting to views</h3></div></div></div><p>As has been mentioned, a controller normally returns a logical
      view name, which a view resolver resolves to a particular view
      technology. For view technologies such as JSPs that are actually
      processed via the Servlet/JSP engine, this is normally handled via
      <code class="classname">InternalResourceViewResolver</code> / <code class="classname">InternalResourceView</code>
      which will ultimately end up issuing an internal forward or include, via
      the Servlet API's <code class="literal">RequestDispatcher.forward(..)</code> or
      <code class="literal">RequestDispatcher.include()</code>. For other view
      technologies, such as Velocity, XSLT, etc., the view itself produces the
      content on the response stream.</p><p>It is sometimes desirable to issue an HTTP redirect back to the
      client, before the view is rendered. This is desirable for example when
      one controller has been called with <code class="literal">POST</code>ed data, and the response is
      actually a delegation to another controller (for example on a successful
      form submission). In this case, a normal internal forward will mean the
      other controller will also see the same <code class="literal">POST</code> data, which is potentially
      problematic if it can confuse it with other expected data. Another reason
      to do a redirect before displaying the result is that this will
      eliminate the possibility of the user doing a double submission of form
      data. The browser will have sent the initial <code class="literal">POST</code>, will have seen a
      redirect back and done a subsequent <code class="literal">GET</code> because of that, and thus as far
      as it is concerned, the current page does not reflect the result of a
      <code class="literal">POST</code>, but rather of a <code class="literal">GET</code>, so there is no way the user can accidentally
      re-<code class="literal">POST</code> the same data by doing a refresh. The refresh would just force a
      <code class="literal">GET</code> of the result page, not a resend of the initial <code class="literal">POST</code> data.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-redirecting-redirect-view"></a>13.5.3.1.&nbsp;<code class="classname">RedirectView</code></h4></div></div></div><p>One way to force a redirect as the result of a controller
        response is for the controller to create and return an instance of
        Spring's <code class="classname">RedirectView</code>. In this case,
        <code class="classname">DispatcherServlet</code> will not use the normal view
        resolution mechanism, but rather as it has been given the (redirect)
        view already, will just ask it to do its work.</p><p>The <code class="classname">RedirectView</code> simply ends up issuing an
        <code class="literal">HttpServletResponse.sendRedirect()</code> call, which will
        come back to the client browser as an HTTP redirect. All model
        attributes are simply exposed as HTTP query parameters. This does mean
        that the model must contain only objects (generally Strings or
        convertible to Strings) which can be readily converted to a
        string-form HTTP query parameter.</p><p>If using <code class="classname">RedirectView</code> and the view is created
        by the controller itself, it is preferable for the redirect URL to be injected
        into the controller so that it is not baked into the controller but configured
        in the context along with the view names.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-redirecting-redirect-prefix"></a>13.5.3.2.&nbsp;The <code class="literal">redirect:</code> prefix</h4></div></div></div><p>While the use of <code class="classname">RedirectView</code> works fine, if
        the controller itself is creating the <code class="classname">RedirectView</code>,
        there is no getting around the fact that the controller is aware that
        a redirection is happening. This is really suboptimal and couples
        things too tightly. The controller should not really care about how
        the response gets handled... it should generally think only in terms of
        view names that have been injected into it.</p><p>The special <code class="literal">redirect:</code> prefix allows this to be achieved. If a
        view name is returned which has the prefix redirect:, then
        <code class="classname">UrlBasedViewResolver</code> (and all subclasses) will
        recognize this as a special indication that a redirect is needed. The
        rest of the view name will be treated as the redirect URL.</p><p>The net effect is the same as if the controller had returned a
        <code class="classname">RedirectView</code>, but now the controller itself can
        deal just in terms of logical view names. A logical view name such as
        <code class="literal">redirect:/my/response/controller.html</code> will redirect
        relative to the current servlet context, while a name such as
        <code class="literal">redirect:http://myhost.com/some/arbitrary/path.html</code>
        will redirect to an absolute URL. The important thing is that as long
        is this redirect view name is injected into the controller like any
        other logical view name, the controller is not even aware that
        redirection is happening.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-redirecting-forward-prefix"></a>13.5.3.3.&nbsp;The <code class="literal">forward:</code> prefix</h4></div></div></div><p>It is also possible to use a special <code class="literal">forward:</code> prefix for view
        names that will ultimately be resolved by
        <code class="classname">UrlBasedViewResolver</code> and subclasses. All this does
        is create an <code class="classname">InternalResourceView</code> (which ultimately
        does a <code class="literal">RequestDispatcher.forward()</code>) around the rest
        of the view name, which is considered a URL. Therefore, there is never
        any use in using this prefix when using
        <code class="classname">InternalResourceViewResolver</code> / <code class="classname">InternalResourceView</code>
        anyway (for JSPs for example), but it's of potential use when you are
        primarily using another view technology, but still want to force
        a forward to happen to a resource to be handled by
        the Servlet/JSP engine. (Note that you may also chain multiple view
        resolvers, instead.)</p><p>As with the <code class="literal">redirect:</code> prefix, if the view
        name with the prefix is just injected into the controller, the
        controller does not have to be aware that anything special is
        happening in terms of handling the response.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-localeresolver"></a>13.6.&nbsp;Using locales</h2></div></div></div><p>Most parts of Spring's architecture support internationalization,
    just as the Spring web MVC framework does. <code class="classname">DispatcherServlet</code> enables you
    to automatically resolve messages using the client's locale. This is done
    with <code class="interfacename">LocaleResolver</code> objects.</p><p>When a request comes in, the <code class="classname">DispatcherServlet</code> looks for a locale
    resolver and if it finds one it tries to use it to set the locale. Using
    the <code class="literal">RequestContext.getLocale()</code> method, you can always
    retrieve the locale that was resolved by the locale resolver.</p><p>Besides the automatic locale resolution, you can also attach an
    interceptor to the handler mapping (see <a href="#mvc-handlermapping-interceptor" title="13.4.3.&nbsp;Intercepting requests - the HandlerInterceptor interface">Section&nbsp;13.4.3, &#8220;Intercepting requests - the <code class="interfacename">HandlerInterceptor</code> interface&#8221;</a> for more information on
    handler mapping interceptors), to change the locale under specific
    circumstances, based on a parameter in the request, for example.</p><p>Locale resolvers and interceptors are all defined in the
    <code class="literal">org.springframework.web.servlet.i18n</code> package, and are
    configured in your application context in the normal way. Here is a
    selection of the locale resolvers included in Spring.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-localeresolver-acceptheader"></a>13.6.1.&nbsp;<code class="classname">AcceptHeaderLocaleResolver</code></h3></div></div></div><p>This locale resolver inspects the
      <code class="literal">accept-language</code> header in the request that was sent
      by the browser of the client. Usually this header field contains the
      locale of the client's operating system.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-localeresolver-cookie"></a>13.6.2.&nbsp;<code class="classname">CookieLocaleResolver</code></h3></div></div></div><p>This locale resolver inspects a <code class="classname">Cookie</code> that might
      exist on the client, to see if a locale is specified. If so, it uses that specific
      locale. Using the properties of this locale resolver, you can specify
      the name of the cookie, as well as the maximum age. Find below an example of
      defining a <code class="classname">CookieLocaleResolver</code>.</p><pre class="programlisting">&lt;bean id="localeResolver" class="org.springframework.web.servlet.i18n.CookieLocaleResolver"&gt;

    &lt;property name="cookieName" value="clientlanguage"/&gt;
    
    <em class="lineannotation"><span class="lineannotation">&lt;!-- in seconds. If set to <code class="literal">-1</code>, the cookie is not persisted (deleted when browser shuts down) --&gt;</span></em>
    &lt;property name="cookieMaxAge" value="100000"&gt;

&lt;/bean&gt;</pre><div class="table"><a name="mvc-cookie-locale-resolver-props-tbl"></a><p class="title"><b>Table&nbsp;13.6.&nbsp;<code class="classname">CookieLocaleResolver</code> properties</b></p><div class="table-contents"><table summary="CookieLocaleResolver properties" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Property</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>cookieName</td><td>classname + LOCALE</td><td>The name of the cookie</td></tr><tr><td>cookieMaxAge</td><td>Integer.MAX_INT</td><td>The maximum time a cookie will stay persistent on the
              client. If -1 is specified, the cookie will not be persisted. It
              will only be available until the client shuts down his or her
              browser.</td></tr><tr><td>cookiePath</td><td>/</td><td>Using this parameter, you can limit the visibility of the
              cookie to a certain part of your site. When cookiePath is
              specified, the cookie will only be visible to that path, and the
              paths below it.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-localeresolver-session"></a>13.6.3.&nbsp;<code class="classname">SessionLocaleResolver</code></h3></div></div></div><p>The <code class="classname">SessionLocaleResolver</code> allows you to
      retrieve locales from the session that might be associated with the
      user's request.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-localeresolver-interceptor"></a>13.6.4.&nbsp;<code class="classname">LocaleChangeInterceptor</code></h3></div></div></div><p>You can build in changing of locales using the
      <code class="classname">LocaleChangeInterceptor</code>. This interceptor needs to be
      added to one of the handler mappings (see <a href="#mvc-handlermapping" title="13.4.&nbsp;Handler mappings">Section&nbsp;13.4, &#8220;Handler mappings&#8221;</a>).
      It will detect a parameter in the  request and change the locale
      (it calls <code class="literal">setLocale()</code> on the <code class="interfacename">LocaleResolver</code>
      that also exists in the context).</p><pre class="programlisting">&lt;bean id="localeChangeInterceptor"
      class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor"&gt;
    &lt;property name="paramName" value="siteLanguage"/&gt;
&lt;/bean&gt;

&lt;bean id="localeResolver"
      class="org.springframework.web.servlet.i18n.CookieLocaleResolver"/&gt;

&lt;bean id="urlMapping"
      class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"&gt;
    &lt;property name="interceptors"&gt;
        &lt;list&gt;
            &lt;ref bean="localeChangeInterceptor"/&gt;
        &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="mappings"&gt;
        &lt;value&gt;/**/*.view=someController&lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>All calls to all <code class="literal">*.view</code> resources containing a
        parameter named <code class="literal">siteLanguage</code> will now change the
        locale. So a request for the following URL,
        <code class="literal">http://www.sf.net/home.view?siteLanguage=nl</code> will change
        the site language to Dutch.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-themeresolver"></a>13.7.&nbsp;Using themes</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-themeresolver-introduction"></a>13.7.1.&nbsp;Introduction</h3></div></div></div><p>The <span class="emphasis"><em>theme</em></span> support provided by the Spring web
      MVC framework enables you to further enhance the user experience by
      allowing the look and feel of your application to be
      <span class="emphasis"><em>themed</em></span>. A theme is basically a collection of static
      resources affecting the visual style of the application, typically style
      sheets and images.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-themeresolver-defining"></a>13.7.2.&nbsp;Defining themes</h3></div></div></div><p>When you want to use themes in your web application you'll have to
      set up a <code class="interfacename">org.springframework.ui.context.ThemeSource</code>.
      The <code class="interfacename">WebApplicationContext</code> interface extends
      <code class="interfacename">ThemeSource</code> but delegates its responsibilities to a
      dedicated implementation. By default the delegate will be a
      <code class="classname">org.springframework.ui.context.support.ResourceBundleThemeSource</code>
      that loads properties files from the root of the classpath. If you want
      to use a custom <code class="interfacename">ThemeSource</code> implementation or if you
      need to configure the basename prefix of the
      <code class="classname">ResourceBundleThemeSource</code>, you can register a bean in
      the application context with the reserved name "themeSource". The web
      application context will automatically detect that bean and start using
      it.</p><p>When using the <code class="classname">ResourceBundleThemeSource</code>, a
      theme is defined in a simple properties file. The properties file lists
      the resources that make up the theme. Here is an example:</p><pre class="programlisting">styleSheet=/themes/cool/style.css
background=/themes/cool/img/coolBg.jpg</pre><p>The keys of the properties are the names used to refer to
      the themed elements from view code. For a JSP this would typically be
      done using the <code class="literal">spring:theme</code> custom tag, which is very
      similar to the <code class="literal">spring:message</code> tag. The following JSP
      fragment uses the theme defined above to customize the look and feel:</p><pre class="programlisting">&lt;%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%&gt;
&lt;html&gt;
   &lt;head&gt;
      &lt;link rel="stylesheet" href="&lt;spring:theme code="styleSheet"/&gt;" type="text/css"/&gt;
   &lt;/head&gt;
   &lt;body background="&lt;spring:theme code="background"/&gt;"&gt;
      ...
   &lt;/body&gt;
&lt;/html&gt;</pre><p>By default, the <code class="classname">ResourceBundleThemeSource</code> uses
      an empty basename prefix. As a result the properties files will be
      loaded from the root of the classpath, so we'll have to put our
      <code class="literal">cool.properties</code> theme definition in a directory at
      the root of the classpath, e.g. in <code class="literal">/WEB-INF/classes</code>.
      Note that the <code class="classname">ResourceBundleThemeSource</code> uses the
      standard Java resource bundle loading mechanism, allowing for full
      internationalization of themes. For instance, we could have a
      <code class="literal">/WEB-INF/classes/cool_nl.properties</code> that references a
      special background image, e.g. with Dutch text on it.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-themeresolver-resolving"></a>13.7.3.&nbsp;Theme resolvers</h3></div></div></div><p>Now that we have our themes defined, the only thing left to do is
      decide which theme to use. The <code class="classname">DispatcherServlet</code> will
      look for a bean named "themeResolver" to find out which
      <code class="interfacename">ThemeResolver</code> implementation to use. A theme resolver
      works in much the same way as a <code class="interfacename">LocaleResolver</code>. It can
      detect the theme that should be used for a particular request and can
      also alter the request's theme. The following theme resolvers are
      provided by Spring:</p><div class="table"><a name="mvc-theme-resolver-impls-tbl"></a><p class="title"><b>Table&nbsp;13.7.&nbsp;<code class="interfacename">ThemeResolver</code> implementations</b></p><div class="table-contents"><table summary="ThemeResolver implementations" border="1"><colgroup><col><col></colgroup><thead><tr><th>Class</th><th>Description</th></tr></thead><tbody><tr><td><code class="classname">FixedThemeResolver</code></td><td>Selects a fixed theme, set using the "defaultThemeName" property.</td></tr><tr><td><code class="classname">SessionThemeResolver</code></td><td>The theme is maintained in the users HTTP session. It
              only needs to be set once for each session, but is not persisted
              between sessions.</td></tr><tr><td><code class="classname">CookieThemeResolver</code></td><td>The selected theme is stored in a cookie on the user-agent's machine.</td></tr></tbody></table></div></div><br class="table-break"><p>Spring also provides a <code class="classname">ThemeChangeInterceptor</code>,
      which allows changing the theme on every request by including a simple
      request parameter.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-multipart"></a>13.8.&nbsp;Spring's multipart (fileupload) support</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multipart-introduction"></a>13.8.1.&nbsp;Introduction</h3></div></div></div><p>
			Spring has built-in multipart support to handle fileuploads in web
			applications. The design for the multipart support is done with
			pluggable <code class="interfacename">MultipartResolver</code> objects,
			defined in the <code class="literal">org.springframework.web.multipart</code>
			package. Out of the	box, Spring provides
			<code class="interfacename">MultipartResolver</code>s for use with
			<span class="emphasis"><em>Commons FileUpload</em></span>
			(<a href="http://jakarta.apache.org/commons/fileupload" target="_top">http://jakarta.apache.org/commons/fileupload</a>) and
			<span class="emphasis"><em>COS FileUpload</em></span>
			(<a href="http://www.servlets.com/cos" target="_top">http://www.servlets.com/cos</a>). How uploading
			files is supported will be described in the rest of this chapter.
      </p><p>
			By default, no multipart handling will be done by Spring, as some
			developers will want to handle multiparts themselves. You will have to
			enable it yourself by adding a multipart resolver to the web
			application's context. After you have done that, each request will be
			inspected to see if it contains a multipart. If no multipart is found,
			the request will continue as expected. However, if a multipart is found
			in the request, the <code class="classname">MultipartResolver</code> that has
			been declared in your context will be used. After that, the multipart
			attribute in your request will be treated like any other attribute.
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multipart-resolver"></a>13.8.2.&nbsp;Using the <code class="interfacename">MultipartResolver</code></h3></div></div></div><p>
			The following example shows how to use the <code class="classname">CommonsMultipartResolver</code>:
      </p><pre class="programlisting">&lt;bean id="multipartResolver"
    class="org.springframework.web.multipart.commons.CommonsMultipartResolver"&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- one of the properties available; the maximum file size in bytes --&gt;</span></em>
    &lt;property name="maxUploadSize" value="100000"/&gt;
&lt;/bean&gt;</pre><p>
			This is an example using the <code class="classname">CosMultipartResolver</code>:
	  </p><pre class="programlisting">&lt;bean id="multipartResolver" class="org.springframework.web.multipart.cos.CosMultipartResolver"&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- one of the properties available; the maximum file size in bytes --&gt;</span></em>
    &lt;property name="maxUploadSize" value="100000"/&gt;
&lt;/bean&gt;</pre><p>
			Of course you also need to put the appropriate jars in your classpath
			for the multipart resolver to work. In the case of the
			<code class="classname">CommonsMultipartResolver</code>, you need to use
			<code class="literal">commons-fileupload.jar</code>; in the case of the
			<code class="classname">CosMultipartResolver</code>, use <code class="literal">cos.jar</code>.
	  </p><p>
			Now that you have seen how to set Spring up to handle multipart
			requests, let's talk about how to actually use it. When the Spring
			<code class="classname">DispatcherServlet</code> detects a multi-part request,
			it activates the resolver that has been declared in your context and
			hands over the request. What the resolver then does is wrap the current
			<code class="classname">HttpServletRequest</code> into a
			<code class="classname">MultipartHttpServletRequest</code> that has support for
			multipart file uploads. Using the <code class="classname">MultipartHttpServletRequest</code>
			you can get information about the multiparts contained by this request
			and actually get access to the multipart files themselves in your controllers.
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multipart-forms"></a>13.8.3.&nbsp;Handling a file upload in a form</h3></div></div></div><p>
			After the <code class="classname">MultipartResolver</code> has finished doing its
			job, the request will be processed like any other. To use it, you create a form
			with an upload field (see immediately below), then let Spring bind the file
			onto your form (backing object). To actually let the user upload a file, we
			have to create a (HTML) form:
      </p><pre class="programlisting">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Upload a file please&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Please upload a file&lt;/h1&gt;
        &lt;form method="post" action="upload.form" enctype="multipart/form-data"&gt;
            &lt;input type="file" name="file"/&gt;
            &lt;input type="submit"/&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
			As you can see, we've created a field named after the property of the bean
			that holds the <code class="literal">byte[]</code>. Furthermore we've added the
			encoding attribute (<code class="literal">enctype="multipart/form-data"</code>) which is
			necessary to let the browser know how to encode the multipart fields (do not
			forget this!).
		</p><p>
			Just as with any other property that's not automagically convertible to a
			string or primitive type, to be able to put binary data in your objects
			you have to register a custom editor with the
			<code class="classname">ServletRequestDatabinder</code>. There are a couple of
			editors available for handling files and setting the results on an object.
			There's a <code class="classname">StringMultipartEditor</code> capable of converting
			files to Strings (using a user-defined character set) and there is a
			<code class="classname">ByteArrayMultipartEditor</code> which converts files to byte
			arrays. They function just as the <code class="classname">CustomDateEditor</code>
			does.
      </p><p>
			So, to be able to upload files using a (HTML) form, declare the resolver,
			a url mapping to a controller that will process the bean, and the controller
			itself.
	  </p><pre class="programlisting">&lt;beans&gt;
	<em class="lineannotation"><span class="lineannotation">&lt;!-- lets use the Commons-based implementation of the MultipartResolver interface --&gt;</span></em>
    &lt;bean id="multipartResolver"
        class="org.springframework.web.multipart.commons.CommonsMultipartResolver"/&gt;

    &lt;bean id="urlMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"&gt;
        &lt;property name="mappings"&gt;
            &lt;value&gt;
                /upload.form=fileUploadController
            &lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="fileUploadController" class="examples.FileUploadController"&gt;
        &lt;property name="commandClass" value="examples.FileUploadBean"/&gt;
        &lt;property name="formView" value="fileuploadform"/&gt;
        &lt;property name="successView" value="confirmation"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre><p>
			After that, create the controller and the actual class to hold the file property.
	  </p><pre class="programlisting">public class FileUploadController extends SimpleFormController {

    protected ModelAndView onSubmit(
        HttpServletRequest request,
        HttpServletResponse response,
        Object command,
        BindException errors) throws ServletException, IOException {

        <em class="lineannotation"><span class="lineannotation"> // cast the bean</span></em>
        FileUploadBean bean = (FileUploadBean) command;

        <em class="lineannotation"><span class="lineannotation"> let's see if there's content there</span></em>
        byte[] file = bean.getFile();
        if (file == null) {
            <em class="lineannotation"><span class="lineannotation"> // hmm, that's strange, the user did not upload anything</span></em>
        }

        <em class="lineannotation"><span class="lineannotation"> // well, let's do nothing with the bean for now and return</span></em>
        return super.onSubmit(request, response, command, errors);
    }

    protected void initBinder(HttpServletRequest request, ServletRequestDataBinder binder)
        throws ServletException {
        // to actually be able to convert Multipart instance to byte[]
        // we have to register a custom editor
        binder.registerCustomEditor(byte[].class, new ByteArrayMultipartFileEditor());
        // now Spring knows how to handle multipart object and convert them
    }

}

public class FileUploadBean {

    private byte[] file;

    public void setFile(byte[] file) {
        this.file = file;
    }

    public byte[] getFile() {
        return file;
    }
}</pre><p>
			As you can see, the <code class="classname">FileUploadBean</code> has a property typed
			<code class="literal">byte[]</code> that holds the file. The controller registers
			a custom editor to let Spring know how to actually convert the multipart
			objects the resolver has found to properties specified by the bean. In
			this example, nothing is done with the <code class="literal">byte[]</code>
			property of the bean itself, but in practice you can do whatever you
			want (save it in a database, mail it to somebody, etc).
      </p><p>
			An equivalent example in which a file is bound straight to a String-typed
			property on a (form backing) object might look like:
      </p><pre class="programlisting">public class FileUploadController extends SimpleFormController {

    protected ModelAndView onSubmit(
        HttpServletRequest request,
        HttpServletResponse response,
        Object command,
        BindException errors) throws ServletException, IOException {

        <em class="lineannotation"><span class="lineannotation"> // cast the bean</span></em>
        FileUploadBean bean = (FileUploadBean) command;

        <em class="lineannotation"><span class="lineannotation"> let's see if there's content there</span></em>
        String file = bean.getFile();
        if (file == null) {
            <em class="lineannotation"><span class="lineannotation"> // hmm, that's strange, the user did not upload anything</span></em>
        }

        <em class="lineannotation"><span class="lineannotation"> // well, let's do nothing with the bean for now and return</span></em>
        return super.onSubmit(request, response, command, errors);
    }

    protected void initBinder(HttpServletRequest request, ServletRequestDataBinder binder)
        throws ServletException {
        // to actually be able to convert Multipart instance to a String
        // we have to register a custom editor
        binder.registerCustomEditor(String.class, new StringMultipartFileEditor());
        // now Spring knows how to handle multipart object and convert them
    }

}

public class FileUploadBean {

    private String file;

    public void setFile(String file) {
        this.file = file;
    }

    public String getFile() {
        return file;
    }
}</pre><p>
            Of course, this last example only makes (logical) sense in the context of uploading
            a plain text file (it wouldn't work so well in the case of uploading an image file).
        </p><p>
            The third (and final) option is where one binds directly to a 
            <code class="interfacename">MultipartFile</code> property declared on the
            (form backing) object's class. In this case one does not need to register any
            custom <code class="interfacename">PropertyEditor</code> because there is no
            type conversion to be performed.
        </p><pre class="programlisting">public class FileUploadController extends SimpleFormController {

    protected ModelAndView onSubmit(
        HttpServletRequest request,
        HttpServletResponse response,
        Object command,
        BindException errors) throws ServletException, IOException {

        <em class="lineannotation"><span class="lineannotation"> // cast the bean</span></em>
        FileUploadBean bean = (FileUploadBean) command;

        <em class="lineannotation"><span class="lineannotation"> let's see if there's content there</span></em>
        MultipartFile file = bean.getFile();
        if (file == null) {
            <em class="lineannotation"><span class="lineannotation"> // hmm, that's strange, the user did not upload anything</span></em>
        }

        <em class="lineannotation"><span class="lineannotation"> // well, let's do nothing with the bean for now and return</span></em>
        return super.onSubmit(request, response, command, errors);
    }
}

public class FileUploadBean {

    private MultipartFile file;

    public void setFile(MultipartFile file) {
        this.file = file;
    }

    public MultipartFile getFile() {
        return file;
    }
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-formtaglib"></a>13.9.&nbsp;Using Spring's form tag library</h2></div></div></div><p>As of version 2.0, Spring provides a comprehensive set of data binding-aware tags for handling
    form elements when using JSP and Spring Web MVC. Each tag provides support for the set of attributes
    of its corresponding HTML tag counterpart, making the tags familiar and intuitive to use. The
    tag-generated HTML is HTML 4.01/XHTML 1.0 compliant.</p><p>Unlike other form/input tag libraries, Spring's form tag library is integrated with Spring
    Web MVC, giving the tags access to the command object and reference data your controller deals
    with. As you will see in the following examples, the form tags make JSPs easier to develop, read
    and maintain. </p><p>Let's go through the form tags and look at an example of how each tag is used.
    We have included generated HTML snippets where certain tags require further commentary.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-formtaglib-configuration"></a>13.9.1.&nbsp;Configuration</h3></div></div></div><p>The form tag library comes bundled in <code class="literal">spring.jar</code>. The library descriptor is called
    <code class="literal">spring-form.tld</code>.</p><p>To use the tags from this library, add the following directive to the top of your JSP page:</p><pre class="programlisting">&lt;%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %&gt;</pre><p>... where <code class="literal">form</code> is the tag name prefix you want to use for the tags from this library.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-formtaglib-formtag"></a>13.9.2.&nbsp;The <code class="literal">form</code> tag</h3></div></div></div><p>
        This tag renders an HTML 'form' tag and exposes a binding path to inner tags for binding.
        It puts the command object in the <code class="literal">PageContext</code> so that the command object
        can be accessed by inner tags. <span class="emphasis"><em>All the other tags in this library are nested tags
        of the <code class="literal">form</code> tag</em></span>.
    </p><p>
        Let's assume we have a domain object called <code class="classname">User</code>. It is a JavaBean with
        properties such as <code class="literal">firstName</code> and <code class="literal">lastName</code>. We will
        use it as the form backing object of our form controller which returns
        <code class="literal">form.jsp</code>. Below is an example of what <code class="literal">form.jsp</code> would
        look like:
    </p><pre class="programlisting">&lt;form:form&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;First Name:&lt;/td&gt;
            &lt;td&gt;&lt;form:input path="firstName" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;Last Name:&lt;/td&gt;
            &lt;td&gt;&lt;form:input path="lastName" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td colspan="3"&gt;
                &lt;input type="submit" value="Save Changes" /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/form:form&gt;</pre><p>
        The <code class="literal">firstName</code> and <code class="literal">lastName</code> values are
        retrieved from the command object placed in the <code class="interfacename">PageContext</code>
        by the page controller. Keep reading to see more complex examples of how inner
        tags are used with the <code class="literal">form</code> tag.
    </p><p>The generated HTML looks like a standard form:</p><pre class="programlisting">&lt;form method="POST"&gt;
    &lt;table&gt;
      &lt;tr&gt;
          &lt;td&gt;First Name:&lt;/td&gt;
          &lt;td&gt;&lt;input name="firstName" type="text" value="Harry"/&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Last Name:&lt;/td&gt;
          &lt;td&gt;&lt;input name="lastName" type="text" value="Potter"/&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td colspan="3"&gt;
            &lt;input type="submit" value="Save Changes" /&gt;
          &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
&lt;/form&gt;</pre><p>The preceding JSP assumes that the variable name of the form backing object is 
    <code class="literal">'command'</code>. If you have put the form backing object into the model
    under another name (definitely a best practice), then you can bind the form to the
    named variable like so:</p><pre class="programlisting">&lt;form:form <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>commandName="user"</strong></span></span></em>&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;First Name:&lt;/td&gt;
            &lt;td&gt;&lt;form:input path="firstName" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;Last Name:&lt;/td&gt;
            &lt;td&gt;&lt;form:input path="lastName" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td colspan="3"&gt;
                &lt;input type="submit" value="Save Changes" /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/form:form&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-formtaglib-inputtag"></a>13.9.3.&nbsp;The <code class="literal">input</code> tag</h3></div></div></div><p>This tag renders an HTML 'input' tag with type 'text' using the bound value.
    For an example of this tag, see <a href="#mvc-formtaglib-formtag" title="13.9.2.&nbsp;The form tag">Section&nbsp;13.9.2, &#8220;The <code class="literal">form</code> tag&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-formtaglib-checkboxtag"></a>13.9.4.&nbsp;The <code class="literal">checkbox</code> tag</h3></div></div></div><p>This tag renders an HTML 'input' tag with type 'checkbox'.</p><p>Let's assume our <code class="classname">User</code> has preferences such as newsletter subscription
      and a list of hobbies. Below is an example of the <code class="classname">Preferences</code> class:</p></div><pre class="programlisting">public class Preferences {

    private boolean receiveNewsletter;

    private String[] interests;

    private String favouriteWord;

    public boolean isReceiveNewsletter() {
        return receiveNewsletter;
    }

    public void setReceiveNewsletter(boolean receiveNewsletter) {
        this.receiveNewsletter = receiveNewsletter;
    }

    public String[] getInterests() {
        return interests;
    }

    public void setInterests(String[] interests) {
        this.interests = interests;
    }

    public String getFavouriteWord() {
        return favouriteWord;
    }

    public void setFavouriteWord(String favouriteWord) {
        this.favouriteWord = favouriteWord;
    }
}</pre><p>The <code class="literal">form.jsp</code> would look like:</p><pre class="programlisting">&lt;form:form&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;Subscribe to newsletter?:&lt;/td&gt;
            <em class="lineannotation"><span class="lineannotation">&lt;%-- Approach 1: Property is of type <code class="classname">java.lang.Boolean</code> --%&gt;</span></em>
            &lt;td&gt;&lt;form:checkbox path="preferences.receiveNewsletter"/&gt;&lt;/td&gt;
            &lt;td&gt;&amp;nbsp;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;
            &lt;td&gt;Interests:&lt;/td&gt;
            &lt;td&gt;
                <em class="lineannotation"><span class="lineannotation">&lt;%-- Approach 2: Property is of an array or of type <code class="interfacename">java.util.Collection</code> --%&gt;</span></em>
                Quidditch: &lt;form:checkbox path="preferences.interests" value="Quidditch"/&gt;
                Herbology: &lt;form:checkbox path="preferences.interests" value="Herbology"/&gt;
                Defence Against the Dark Arts: &lt;form:checkbox path="preferences.interests"
                    value="Defence Against the Dark Arts"/&gt;
            &lt;/td&gt;
            &lt;td&gt;&amp;nbsp;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;Favourite Word:&lt;/td&gt;
            &lt;td&gt;
                <em class="lineannotation"><span class="lineannotation">&lt;%-- Approach 3: Property is of type <code class="classname">java.lang.Object</code> --%&gt;</span></em>
                Magic: &lt;form:checkbox path="preferences.favouriteWord" value="Magic"/&gt;
            &lt;/td&gt;
            &lt;td&gt;&amp;nbsp;&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/form:form&gt;</pre><p>There are 3 approaches to the <code class="literal">checkbox</code> tag which should meet all your checkbox needs.

          </p><div class="itemizedlist"><ul type="disc"><li><p>Approach One  -  When the bound value is of type <code class="literal">java.lang.Boolean</code>,
            the <code class="literal">input(checkbox)</code> is marked as 'checked' if the bound value is
            <code class="literal">true</code>. The <code class="literal">value</code> attribute corresponds to the
            resolved value of the <code class="literal">setValue(Object)</code> value property.</p></li><li><p>Approach Two - When the bound value is of type <code class="literal">array</code> or
            <code class="interfacename">java.util.Collection</code>, the <code class="literal">input(checkbox)</code> is marked as 'checked'
            if the configured <code class="literal">setValue(Object)</code> value is present in the bound
            <code class="interfacename">Collection</code>.</p></li><li><p>Approach Three - For any other bound value type, the <code class="literal">input(checkbox)</code>
            is marked as 'checked' if the configured <code class="literal">setValue(Object)</code> is equal to the
            bound value.</p></li></ul></div><p>
      </p><p>Note that regardless of the approach, the same HTML structure is generated.
      Below is an HTML snippet of some checkboxes:</p><pre class="programlisting">&lt;tr&gt;
    &lt;td&gt;Interests:&lt;/td&gt;
    &lt;td&gt;
        Quidditch: &lt;input name="preferences.interests" type="checkbox" value="Quidditch"/&gt;
        &lt;input type="hidden" value="1" name="_preferences.interests"/&gt;
        Herbology: &lt;input name="preferences.interests" type="checkbox" value="Herbology"/&gt;
        &lt;input type="hidden" value="1" name="_preferences.interests"/&gt;
        Defence Against the Dark Arts: &lt;input name="preferences.interests" type="checkbox"
            value="Defence Against the Dark Arts"/&gt;
        &lt;input type="hidden" value="1" name="_preferences.interests"/&gt;
    &lt;/td&gt;
    &lt;td&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;</pre><p>What you might not expect to see is the additional hidden field after each checkbox.
    When a checkbox in an HTML page is <span class="emphasis"><em>not</em></span> checked, its value will not be
    sent to the server as part of the HTTP request parameters once the form is submitted, so we
    need a workaround for this quirk in HTML in order for Spring form data binding to work. The
    <code class="literal">checkbox</code> tag follows the existing Spring convention of including a hidden
    parameter prefixed by an underscore ("_") for each checkbox. By doing this, you are
    effectively telling Spring that &#8220;<span class="quote"><span class="emphasis"><em>the checkbox was visible in the form and I
    want my object to which the form data will be bound to reflect the state of the checkbox no
    matter what</em></span></span>&#8221;.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-formtaglib-radiobuttontag"></a>13.9.5.&nbsp;The <code class="literal">radiobutton</code> tag</h3></div></div></div><p>This tag renders an HTML 'input' tag with type 'radio'.</p><p>A typical usage pattern will involve multiple tag instances bound to the same property but with different
    values.</p><pre class="programlisting">&lt;tr&gt;
    &lt;td&gt;Sex:&lt;/td&gt;
    &lt;td&gt;Male: &lt;form:radiobutton path="sex" value="M"/&gt; &lt;br/&gt;
        Female: &lt;form:radiobutton path="sex" value="F"/&gt; &lt;/td&gt;
    &lt;td&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-formtaglib-passwordtag"></a>13.9.6.&nbsp;The <code class="literal">password</code> tag</h3></div></div></div><p>This tag renders an HTML 'input' tag with type 'password' using the bound value.</p><pre class="programlisting">&lt;tr&gt;
    &lt;td&gt;Password:&lt;/td&gt;
    &lt;td&gt;
        &lt;form:password path="password" /&gt;
    &lt;/td&gt;
&lt;/tr&gt;</pre><p>Please note that by default, the password value is <span class="emphasis"><em>not</em></span>
	  shown. If you do want the password value to be shown, then set the value of
	  the <code class="literal">'showPassword'</code> attribute to true, like so.
	  </p><pre class="programlisting">&lt;tr&gt;
    &lt;td&gt;Password:&lt;/td&gt;
    &lt;td&gt;
        &lt;form:password path="password" value="^76525bvHGq" showPassword="true" /&gt;
    &lt;/td&gt;
&lt;/tr&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-formtaglib-selecttag"></a>13.9.7.&nbsp;The <code class="literal">select</code> tag</h3></div></div></div><p>This tag renders an HTML 'select' element. It supports data binding to the selected
    option as well as the use of nested <code class="literal">option</code> and <code class="literal">options</code>
    tags.</p><p>Let's assume a <code class="classname">User</code> has a list of skills.</p><pre class="programlisting">&lt;tr&gt;
    &lt;td&gt;Skills:&lt;/td&gt;
    &lt;td&gt;&lt;form:select path="skills" items="${skills}"/&gt;&lt;/td&gt;
    &lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;</pre><p>If the <code class="literal">User's</code> skill were in Herbology, the HTML source of the 'Skills'
    row would look like:</p><pre class="programlisting">&lt;tr&gt;
    &lt;td&gt;Skills:&lt;/td&gt;
    &lt;td&gt;&lt;select name="skills" multiple="true"&gt;
        &lt;option value="Potions"&gt;Potions&lt;/option&gt;
        &lt;option value="Herbology" selected="true"&gt;Herbology&lt;/option&gt;
        &lt;option value="Quidditch"&gt;Quidditch&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
    &lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-formtaglib-optiontag"></a>13.9.8.&nbsp;The <code class="literal">option</code> tag</h3></div></div></div><p>This tag renders an HTML 'option'. It sets 'selected' as appropriate based on the bound value.</p><pre class="programlisting">&lt;tr&gt;
    &lt;td&gt;House:&lt;/td&gt;
    &lt;td&gt;
        &lt;form:select path="house"&gt;
            &lt;form:option value="Gryffindor"/&gt;
            &lt;form:option value="Hufflepuff"/&gt;
            &lt;form:option value="Ravenclaw"/&gt;
            &lt;form:option value="Slytherin"/&gt;
        &lt;/form:select&gt;
    &lt;/td&gt;
&lt;/tr&gt;</pre><p>If the <code class="literal">User's</code> house was in Gryffindor, the HTML source of the 'House'
    row would look like:</p><pre class="programlisting">&lt;tr&gt;
    &lt;td&gt;House:&lt;/td&gt;
    &lt;td&gt;
        &lt;select name="house"&gt;
            &lt;option value="Gryffindor" selected="true"&gt;Gryffindor&lt;/option&gt;
            &lt;option value="Hufflepuff"&gt;Hufflepuff&lt;/option&gt;
            &lt;option value="Ravenclaw"&gt;Ravenclaw&lt;/option&gt;
            &lt;option value="Slytherin"&gt;Slytherin&lt;/option&gt;
        &lt;/select&gt;
    &lt;/td&gt;
 &lt;/tr&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-formtaglib-optionstag"></a>13.9.9.&nbsp;The <code class="literal">options</code> tag</h3></div></div></div><p>This tag renders a list of HTML 'option' tags. It sets the 'selected' attribute
    as appropriate based on the bound value.</p><pre class="programlisting">&lt;tr&gt;
    &lt;td&gt;Country:&lt;/td&gt;
    &lt;td&gt;
        &lt;form:select path="country"&gt;
            &lt;form:option value="-" label="--Please Select"/&gt;
            &lt;form:options items="${countryList}" itemValue="code" itemLabel="name"/&gt;
        &lt;/form:select&gt;
    &lt;/td&gt;
    &lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;</pre><p>If the <code class="classname">User</code> lived in the UK, the HTML source of the 'Country'
    row would look like:</p><pre class="programlisting"> &lt;tr&gt;
    &lt;td&gt;Country:&lt;/td&gt;
    &lt;tr&gt;
        &lt;td&gt;Country:&lt;/td&gt;
        &lt;td&gt;
            &lt;select name="country"&gt;
                &lt;option value="-"&gt;--Please Select&lt;/option&gt;
                &lt;option value="AT"&gt;Austria&lt;/option&gt;
                &lt;option value="UK" selected="true"&gt;United Kingdom&lt;/option&gt;
                &lt;option value="US"&gt;United States&lt;/option&gt;
            &lt;/select&gt;
        &lt;/td&gt;
        &lt;td&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;</pre><p>As the example shows, the combined usage of an <code class="literal">option</code> tag with the
      <code class="literal">options</code> tag generates the same standard HTML, but allows you to explicitly
      specify a value in the JSP that is for display only (where it belongs) such as the default string in
      the example: "-- Please Select".
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-formtaglib-textAreatag"></a>13.9.10.&nbsp;The <code class="literal">textarea</code> tag</h3></div></div></div><p>This tag renders an HTML 'textarea'.</p><pre class="programlisting">&lt;tr&gt;
    &lt;td&gt;Notes:&lt;/td&gt;
    &lt;td&gt;&lt;form:textarea path="notes" rows="3" cols="20" /&gt;&lt;/td&gt;
    &lt;td&gt;&lt;form:errors path="notes" /&gt;&lt;/td&gt;
&lt;/tr&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-formtaglib-hiddeninputtag"></a>13.9.11.&nbsp;The <code class="literal">hidden</code> tag</h3></div></div></div><p>This tag renders an HTML 'input' tag with type 'hidden' using the bound value.
    To submit an unbound hidden value, use the HTML <code class="literal">input</code> tag with
    type 'hidden'.</p><pre class="programlisting">&lt;form:hidden path="house" /&gt;
</pre><p>If we choose to submit the 'house' value as a hidden one, the HTML would look like:</p><pre class="programlisting">&lt;input name="house" type="hidden" value="Gryffindor"/&gt;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-formtaglib-errorstag"></a>13.9.12.&nbsp;The <code class="literal">errors</code> tag</h3></div></div></div><p>This tag renders field errors in an HTML 'span' tag. It provides access to the errors created in your
    controller or those that were created by any validators associated with your controller.</p><p>Let's assume we want to display all error messages for the <code class="literal">firstName</code> and
    <code class="literal">lastName</code> fields once we submit the form. We have a validator for instances of the
    <code class="classname">User</code> class called <code class="classname">UserValidator</code>.</p><pre class="programlisting">public class UserValidator implements Validator {

    public boolean supports(Class candidate) {
        return User.class.isAssignableFrom(candidate);
    }

    public void validate(Object obj, Errors errors) {
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, "firstName", "required", "Field is required.");
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, "lastName", "required", "Field is required.");
    }
}</pre><p>The <code class="literal">form.jsp</code> would look like:</p><pre class="programlisting">&lt;form:form&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;First Name:&lt;/td&gt;
            &lt;td&gt;&lt;form:input path="firstName" /&gt;&lt;/td&gt;
            <em class="lineannotation"><span class="lineannotation">&lt;%-- Show errors for firstName field --%&gt;</span></em>
            &lt;td&gt;&lt;form:errors path="firstName" /&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;
            &lt;td&gt;Last Name:&lt;/td&gt;
            &lt;td&gt;&lt;form:input path="lastName" /&gt;&lt;/td&gt;
            <em class="lineannotation"><span class="lineannotation">&lt;%-- Show errors for lastName field --%&gt;</span></em>
            &lt;td&gt;&lt;form:errors path="lastName"  /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td colspan="3"&gt;
                &lt;input type="submit" value="Save Changes" /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/form:form&gt;</pre><p>If we submit a form with empty values in the <code class="literal">firstHame</code> and
    <code class="literal">lastName</code> fields, this is what the HTML would look like:</p><pre class="programlisting">&lt;form method="POST"&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;First Name:&lt;/td&gt;
            &lt;td&gt;&lt;input name="firstName" type="text" value=""/&gt;&lt;/td&gt;
            <em class="lineannotation"><span class="lineannotation">&lt;%-- Associated errors to firstName field displayed --%&gt;</span></em>
            &lt;td&gt;&lt;span name="firstName.errors"&gt;Field is required.&lt;/span&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;
            &lt;td&gt;Last Name:&lt;/td&gt;
            &lt;td&gt;&lt;input name="lastName" type="text" value=""/&gt;&lt;/td&gt;
            <em class="lineannotation"><span class="lineannotation">&lt;%-- Associated errors to lastName field displayed --%&gt;</span></em>
            &lt;td&gt;&lt;span name="lastName.errors"&gt;Field is required.&lt;/span&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td colspan="3"&gt;
                &lt;input type="submit" value="Save Changes" /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/form&gt;</pre><p>What if we want to display the entire list of errors for a given page? The example
    below shows that the <code class="literal">errors</code> tag also supports some basic wildcarding
    functionality.</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">path="*"</code> - displays all errors</p></li><li><p><code class="literal">path="lastName*"</code> - displays all errors associated with
            the <code class="literal">lastName</code> field</p></li></ul></div><p>The example below will display a list of errors at the top of the page, followed by
    field-specific errors next to the fields:</p><pre class="programlisting">&lt;form:form&gt;
    &lt;form:errors path="*" cssClass="errorBox" /&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;First Name:&lt;/td&gt;
            &lt;td&gt;&lt;form:input path="firstName" /&gt;&lt;/td&gt;
            &lt;td&gt;&lt;form:errors path="firstName" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;Last Name:&lt;/td&gt;
            &lt;td&gt;&lt;form:input path="lastName" /&gt;&lt;/td&gt;
            &lt;td&gt;&lt;form:errors path="lastName"  /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td colspan="3"&gt;
                &lt;input type="submit" value="Save Changes" /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/form:form&gt;</pre><p>The HTML would look like:</p><pre class="programlisting">&lt;form method="POST"&gt;
    &lt;span name="*.errors" class="errorBox"&gt;Field is required.&lt;br/&gt;Field is required.&lt;/span&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;First Name:&lt;/td&gt;
            &lt;td&gt;&lt;input name="firstName" type="text" value=""/&gt;&lt;/td&gt;
            &lt;td&gt;&lt;span name="firstName.errors"&gt;Field is required.&lt;/span&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;
            &lt;td&gt;Last Name:&lt;/td&gt;
            &lt;td&gt;&lt;input name="lastName" type="text" value=""/&gt;&lt;/td&gt;
            &lt;td&gt;&lt;span name="lastName.errors"&gt;Field is required.&lt;/span&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td colspan="3"&gt;
                &lt;input type="submit" value="Save Changes" /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
&lt;/form&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-exceptionhandlers"></a>13.10.&nbsp;Handling exceptions</h2></div></div></div><p>Spring provides <code class="literal">HandlerExceptionResolvers</code> to ease
    the pain of unexpected exceptions occurring while your request is being
    handled by a controller which matched the request.
    <code class="literal">HandlerExceptionResolvers</code> somewhat resemble the
    exception mappings you can define in the web application descriptor
    <code class="literal">web.xml</code>. However, they provide a more flexible way to
    handle exceptions. They provide information about what handler was
    executing when the exception was thrown. Furthermore, a programmatic way
    of handling exception gives you many more options for how to respond
    appropriately before the request is forwarded to another URL (the same end
    result as when using the servlet specific exception mappings).</p><p>Besides implementing the <code class="interfacename">HandlerExceptionResolver</code>
    interface, which is only a matter of implementing the
    <code class="literal">resolveException(Exception, Handler)</code> method and returning a
    <code class="classname">ModelAndView</code>, you may also use the
    <code class="classname">SimpleMappingExceptionResolver</code>. This resolver enables you
    to take the class name of any exception that might be thrown and map it to a view
    name. This is functionally equivalent to the exception mapping feature from the
    Servlet API, but it's also possible to implement more fine grained mappings of
    exceptions from different handlers.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-coc"></a>13.11.&nbsp;Convention over configuration</h2></div></div></div><p>For a lot of projects, sticking to established conventions and
        having reasonable defaults is just what they (the projects) need...
        this theme of convention-over-configuration now has explicit support in
        Spring Web MVC. What this means is that if you establish a set of naming
        conventions and suchlike, you can <span class="emphasis"><em>substantially</em></span>
        cut down on the amount of configuration that is required to set up handler
        mappings, view resolvers, <code class="classname">ModelAndView</code> instances,
        etc. This is a great boon with regards to rapid prototyping, and can also
        lend a degree of (always good-to-have) consistency across a codebase should
        you choose to move forward with it into production.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The Spring distribution ships with a web application that
            showcases the convention over configuration support described in
            this section. The application can be found in the
            <code class="literal">'samples/showcases/mvc-convention'</code> directory.</p></td></tr></table></div><p>This convention over configuration support address the three core areas
        of MVC - namely, the models, views, and controllers.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-coc-ccnhm"></a>13.11.1.&nbsp;The Controller - <code class="classname">ControllerClassNameHandlerMapping</code></h3></div></div></div><p>The <code class="classname">ControllerClassNameHandlerMapping</code> class
            is a <code class="interfacename">HandlerMapping</code> implementation that
            uses a convention to determine the mapping between request URLs and
            the <code class="interfacename">Controller</code> instances that are to handle
            those requests.</p><p>An example; consider the following (simplistic)
            <code class="interfacename">Controller</code> implementation. Take especial
            notice of the <span class="emphasis"><em>name</em></span> of the class.</p><pre class="programlisting">public class <span class="bold"><strong>ViewShoppingCartController</strong></span> implements Controller {

    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        <em class="lineannotation"><span class="lineannotation">// the implementation is not hugely important for this example...</span></em>
    }
}</pre><p>Here is a snippet from the attendent Spring Web MVC configuration file...</p><pre class="programlisting">&lt;bean class="org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping"/&gt;
                
&lt;bean id="<span class="bold"><strong>viewShoppingCart</strong></span>" class="x.y.z.ViewShoppingCartController"&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- inject dependencies as required... --&gt;</span></em>
&lt;/bean&gt;</pre><p>The <code class="classname">ControllerClassNameHandlerMapping</code> finds all of the
            various handler (or <code class="interfacename">Controller</code>) beans defined in its
            application context and strips <code class="literal">'Controller'</code> off the name to
            define its handler mappings.</p><p>Let's look at some more examples so that the central idea becomes immediately
            familiar.</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">WelcomeController</code> maps to the <code class="literal">'/welcome*'</code> request URL</p></li><li><p><code class="classname">HomeController</code> maps to the <code class="literal">'/home*'</code> request URL</p></li><li><p><code class="classname">IndexController</code> maps to the <code class="literal">'/index*'</code> request URL</p></li><li><p><code class="classname">RegisterController</code> maps to the <code class="literal">'/register*'</code> request URL</p></li><li><p><code class="classname">DisplayShoppingCartController</code> maps to the <code class="literal">'/displayshoppingcart*'</code> request URL</p><p><span class="emphasis"><em>(Notice the casing - all lowercase - in the case of camel-cased <code class="interfacename">Controller</code> class names.)</em></span></p></li></ul></div><p>In the case of <code class="classname">MultiActionController</code> handler classes, the
            mappings generated are (ever so slightly) more complex, but hopefully no less
            understandable. Some examples (all of the <code class="interfacename">Controller</code>
            names in this next bit are assumed to be <code class="classname">MultiActionController</code>
            implementations).</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">AdminController</code> maps to the
                    <code class="literal">'/admin<span class="bold"><strong>/*</strong></span>'</code> request URL</p></li><li><p><code class="classname">CatalogController</code> maps to the
                    <code class="literal">'/catalog<span class="bold"><strong>/*</strong></span>'</code> request URL</p></li></ul></div><p>If you follow the pretty standard convention of naming your
            <code class="interfacename">Controller</code> implementations as
            <code class="literal">xxx<span class="bold"><strong>Controller</strong></span></code>,
            then the <code class="classname">ControllerClassNameHandlerMapping</code> will save you the
            tedium of having to firstly define and then having to maintain a potentially
            <span class="emphasis"><em>looooong</em></span> <code class="classname">SimpleUrlHandlerMapping</code>
            (or suchlike).</p><p>The <code class="classname">ControllerClassNameHandlerMapping</code> class extends
            the <code class="classname">AbstractHandlerMapping</code> base class so you can define
            <code class="interfacename">HandlerInterceptor</code> instances and everything else
            just like you would with many other <code class="interfacename">HandlerMapping</code>
            implementations.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-coc-modelmap"></a>13.11.2.&nbsp;The Model - <code class="classname">ModelMap</code> (<code class="classname">ModelAndView</code>)</h3></div></div></div><p>The <code class="classname">ModelMap</code> class is an essentially glorified
            <code class="interfacename">Map</code> that can make adding objects that are
            to be displayed in (or on) a <code class="interfacename">View</code> adhere to
            a common naming convention. Consider the following <code class="interfacename">Controller</code>
            implementation; notice that objects are added to the <code class="classname">ModelAndView</code>
			without any associated name being specified.</p><pre class="programlisting">public class DisplayShoppingCartController implements Controller {

    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        
        List cartItems = <em class="lineannotation"><span class="lineannotation">// get a <code class="interfacename">List</code> of <code class="classname">CartItem</code> objects</span></em>
        User user = <em class="lineannotation"><span class="lineannotation">// get the <code class="classname">User</code> doing the shopping</span></em>
        
        ModelAndView mav = new ModelAndView("displayShoppingCart"); <em class="lineannotation"><span class="lineannotation">&lt;-- the logical view name</span></em>

        mav.addObject(cartItems); <em class="lineannotation"><span class="lineannotation">&lt;-- look ma, no name, just the object</span></em>
        mav.addObject(user); <em class="lineannotation"><span class="lineannotation">&lt;-- and again ma!</span></em>

        return mav;
    }
}</pre><p>The <code class="classname">ModelAndView</code> class uses a
            <code class="classname">ModelMap</code> class that is a custom
            <code class="interfacename">Map</code> implementation that automatically generates
            a key for an object when an object is added to it. The strategy for determining
            the name for an added object is, in the case of a scalar object such as
            <code class="classname">User</code>, to use the short class name of the object's class.
            Find below some examples of the names that are generated for scalar objects
            put into a <code class="classname">ModelMap</code> instance.</p><div class="itemizedlist"><ul type="disc"><li><p>An <code class="classname">x.y.User</code> instance added will have the name
                    <code class="literal">'user'</code> generated</p></li><li><p>An <code class="classname">x.y.Registration</code> instance added will have the
                    name <code class="literal">'registration'</code> generated</p></li><li><p>An <code class="classname">x.y.Foo</code> instance added will have the name
                    <code class="literal">'foo'</code> generated</p></li><li><p>A <code class="classname">java.util.HashMap</code> instance added will have the
                    name <code class="literal">'hashMap'</code> generated (you'll probably want
                    to be explicit about the name in this case because <code class="literal">'hashMap'</code>
                    is less than intuitive).</p></li><li><p>Adding <code class="literal">null</code> will result in an
                    <code class="classname">IllegalArgumentException</code> being thrown. If the object
                    (or objects) that you are adding could potentially be <code class="literal">null</code>,
                    then you will also want to be explicit about the name).</p></li></ul></div><div class="sidebar"><p class="title"><b>What, no automatic pluralisation?</b></p><p>Spring Web MVC's convention over configuration support does not
                support automatic pluralisation. That is to say, you cannot add a
                <code class="interfacename">List</code> of
                <code class="classname">Person</code> objects to a
                <code class="classname">ModelAndView</code> and have the generated name
                be 'people'.</p><p>This decision was taken after some debate, with
                the &#8220;<span class="quote">Principle of Least Surprise</span>&#8221; winning out in the end.</p></div><p>The strategy for generating a name after adding a
            <code class="interfacename">Set</code>, <code class="interfacename">List</code> or
            array object is to peek into the collection, take the short class name of
            the first object in the collection, and use that with <code class="literal">'List'</code>
            appended to the name. Some examples will make the semantics of name generation
            for collections clearer...</p><div class="itemizedlist"><ul type="disc"><li><p>An <code class="classname">x.y.User[]</code> array with one or more
                    <code class="classname">x.y.User</code> elements added will have the name
                    <code class="literal">'userList'</code> generated</p></li><li><p>An <code class="classname">x.y.Foo[]</code> array with one or more
                    <code class="classname">x.y.User</code> elements added will have the name
                    <code class="literal">'fooList'</code> generated</p></li><li><p>A <code class="classname">java.util.ArrayList</code> with one or more
                    <code class="classname">x.y.User</code> elements added will have the name
                    <code class="literal">'userList'</code> generated</p></li><li><p>A <code class="classname">java.util.HashSet</code> with one or more
                    <code class="classname">x.y.Foo</code> elements added will have the name
                    <code class="literal">'fooList'</code> generated</p></li><li><p>An <span class="bold"><strong>empty</strong></span> <code class="classname">java.util.ArrayList</code>
                    will not be added at all (i.e. the <code class="methodname">addObject(..)</code> call will
                    essentially be a no-op).</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-coc-r2vnt"></a>13.11.3.&nbsp;The View - <code class="interfacename">RequestToViewNameTranslator</code></h3></div></div></div><p>The <code class="interfacename">RequestToViewNameTranslator</code> interface
            is responsible for determining a logical <code class="interfacename">View</code> name
            when no such logical view name is explicitly supplied. It has just one implementation,
            the rather cunningly named <code class="classname">DefaultRequestToViewNameTranslator</code>
            class.</p><p>The <code class="classname">DefaultRequestToViewNameTranslator</code> maps request
            URLs to logical view names in a fashion that is probably best explained by recourse
            to an example.</p><pre class="programlisting">public class RegistrationController implements Controller {
                
    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        <em class="lineannotation"><span class="lineannotation">// process the request...</span></em>
        ModelAndView mav = new ModelAndView();
        <em class="lineannotation"><span class="lineannotation">// add <span class="bold"><strong>data</strong></span> as necessary to the model...</span></em>
        return mav;
        <em class="lineannotation"><span class="lineannotation">// notice that no <code class="interfacename">View</code> or logical view name has been set</span></em>
    }
}</pre><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN"
        "http://www.springframework.org/dtd/spring-beans-2.0.dtd"&gt;
&lt;beans&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- this bean with the well known name generates view names for us --&gt;</span></em>
    &lt;bean id="viewNameTranslator" class="org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator"/&gt;

    &lt;bean class="x.y.RegistrationController"&gt;
        <em class="lineannotation"><span class="lineannotation">&lt;!-- inject dependencies as necessary --&gt;</span></em>
    &lt;/bean&gt;
    
    <em class="lineannotation"><span class="lineannotation">&lt;!-- maps request URLs to Controller names --&gt;</span></em>
    &lt;bean class="org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping"/&gt;

    &lt;bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
        &lt;property name="prefix" value="/WEB-INF/jsp/"/&gt;
        &lt;property name="suffix" value=".jsp"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;
</pre><p>Notice how in the implementation of the <code class="literal">handleRequest(..)</code>
            method no <code class="interfacename">View</code> or logical view name is ever
            set on the <code class="classname">ModelAndView</code> that is returned. It is the
            <code class="classname">DefaultRequestToViewNameTranslator</code> that will be tasked
            with generating a <span class="emphasis"><em>logical view name</em></span> from the URL
            of the request. In the case of the above
            <code class="classname">RegistrationController</code>, which is being
            used in conjunction with the <code class="classname">ControllerClassNameHandlerMapping</code>,
            a request URL of <code class="literal">'http://localhost/registration.html'</code> will
            result in a logical view name of <code class="literal">'registration'</code> being
            generated by the <code class="classname">DefaultRequestToViewNameTranslator</code>.
            This logical view name will then be resolved into the
            <code class="literal">'/WEB-INF/jsp/registration.jsp'</code> view by the
            <code class="classname">InternalResourceViewResolver</code> bean.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You don't even need to define a <code class="classname">DefaultRequestToViewNameTranslator</code>
                bean explicitly. If you are okay with the default settings of the
                <code class="classname">DefaultRequestToViewNameTranslator</code>, then you can
                rely on the fact that the Spring Web MVC <code class="classname">DispatcherServlet</code>
                will actually instantiate an instance of this class if one is not
                explicitly configured.</p></td></tr></table></div><p>Of course, if you need to change the default settings, then you do need to
            configure your own <code class="classname">DefaultRequestToViewNameTranslator</code> bean
            explicitly. Please do consult the quite comprehensive Javadoc for the
            <code class="classname">DefaultRequestToViewNameTranslator</code> class for details of the
            various properties that can be configured.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-resources"></a>13.12.&nbsp;Further Resources</h2></div></div></div><p>Find below links and pointers to further resources about Spring Web MVC.</p><div class="itemizedlist"><ul type="disc"><li><p>The Spring distribution ships with a Spring Web MVC tutorial that
				guides the reader through building a complete Spring Web MVC-based application
				using a step-by-step approach. This tutorial is available in the
				<code class="literal">'docs'</code> directory of the Spring distribution. An
				online version can also be found on the
				<a href="http://springframework.org/" target="_top">Spring Framework website</a>.</p></li><li><p>The book entitled &#8220;<span class="quote">Expert Spring Web MVC and WebFlow</span>&#8221; by
				Seth Ladd and others (published by Apress) is an excellent hardcopy
				source of Spring Web MVC goodness.</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="view"></a>Chapter&nbsp;14.&nbsp;Integrating view technologies</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-introduction"></a>14.1.&nbsp;Introduction</h2></div></div></div><p>One of the areas in which Spring excels is in the separation of view
    technologies from the rest of the MVC framework. For example, deciding to
    use Velocity or XSLT in place of an existing JSP is primarily a matter of
    configuration. This chapter covers the major view technologies that work
    with Spring and touches briefly on how to add new ones. This chapter
    assumes you are already familiar with <a href="#mvc-viewresolver" title="13.5.&nbsp;Views and resolving them">Section&nbsp;13.5, &#8220;Views and resolving them&#8221;</a>
    which covers the basics of how views in general are coupled to the MVC
    framework.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-jsp"></a>14.2.&nbsp;JSP &amp; JSTL</h2></div></div></div><p>Spring provides a couple of out-of-the-box solutions for JSP and
    JSTL views. Using JSP or JSTL is done using a normal view resolver defined
    in the <code class="interfacename">WebApplicationContext</code>. Furthermore,
    of course you need to write some JSPs that will actually render the view.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jsp-resolver"></a>14.2.1.&nbsp;View resolvers</h3></div></div></div><p>Just as with any other view technology you're integrating with
      Spring, for JSPs you'll need a view resolver that will resolve your
      views. The most commonly used view resolvers when developing with JSPs
      are the <code class="classname">InternalResourceViewResolver</code> and the
      <code class="classname">ResourceBundleViewResolver</code>. Both are declared in the
      <code class="interfacename">WebApplicationContext</code>:</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- the <code class="classname">ResourceBundleViewResolver</code> --&gt;</span></em>
&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.ResourceBundleViewResolver"&gt;
  &lt;property name="basename" value="views"/&gt;
&lt;/bean&gt;

<em class="lineannotation"><span class="lineannotation"># And a sample properties file is uses (views.properties in WEB-INF/classes):</span></em>
welcome.class=org.springframework.web.servlet.view.JstlView
welcome.url=/WEB-INF/jsp/welcome.jsp

productList.class=org.springframework.web.servlet.view.JstlView
productList.url=/WEB-INF/jsp/productlist.jsp</pre><p>As you can see, the <code class="classname">ResourceBundleViewResolver</code> needs
      a properties file defining the view names mapped to 1) a class and 2) a URL. With a
      <code class="classname">ResourceBundleViewResolver</code> you can mix different types of views using
      only one resolver.</p><pre class="programlisting">&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
  &lt;property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/&gt;
  &lt;property name="prefix" value="/WEB-INF/jsp/"/&gt;
  &lt;property name="suffix" value=".jsp"/&gt;
&lt;/bean&gt;</pre><p>The <code class="classname">InternalResourceBundleViewResolver</code> can be configured for using
      JSPs as described above. As a best practice, we strongly encourage
      placing your JSP files in a directory under the <code class="filename">'WEB-INF'</code> directory, so
      there can be no direct access by clients.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jsp-jstl"></a>14.2.2.&nbsp;'Plain-old' JSPs versus JSTL</h3></div></div></div><p>When using the Java Standard Tag Library you must use a special view
      class, the <code class="classname">JstlView</code>, as JSTL needs some preparation
      before things such as the i18N features will work.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jsp-tags"></a>14.2.3.&nbsp;Additional tags facilitating development</h3></div></div></div><p>Spring provides data binding of request parameters to command
      objects as described in earlier chapters. To facilitate the development
      of JSP pages in combination with those data binding features, Spring
      provides a few tags that make things even easier. All Spring tags have
      <span class="emphasis"><em>html escaping</em></span> features to enable or disable
      escaping of characters.</p><p>The tag library descriptor (TLD) is included in the
      <code class="filename">spring.jar</code> as well in the distribution itself.
      Further information about the individual tags can be found in the appendix entitled
      <a href="#spring.tld" title="Appendix&nbsp;D.&nbsp;spring.tld">Appendix&nbsp;D, <i>spring.tld</i></a>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-tiles"></a>14.3.&nbsp;Tiles</h2></div></div></div><p>It is possible to integrate Tiles - just as any other view
    technology - in web applications using Spring. The following describes in
    a broad way how to do this.</p><p><span class="emphasis"><em>NOTE:</em></span> Spring 2.0 supports Tiles 1.x (a.k.a. "Struts Tiles",
    as shipped with Struts 1.1+). There is no out of the box support for Tiles 2 yet.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-tiles-dependencies"></a>14.3.1.&nbsp;Dependencies</h3></div></div></div><p>To be able to use Tiles you have to have a couple of additional
      dependencies included in your project. The following is the list of
      dependencies you need.</p><div class="itemizedlist"><ul type="disc" compact><li><p><code class="literal">Struts version 1.1 or higher</code></p></li><li><p><code class="literal">Commons BeanUtils</code></p></li><li><p><code class="literal">Commons Digester</code></p></li><li><p><code class="literal">Commons Logging</code></p></li></ul></div><p>These dependencies are all available in the Spring distribution.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-tiles-integrate"></a>14.3.2.&nbsp;How to integrate Tiles</h3></div></div></div><p>To be able to use Tiles, you have to configure it using files
      containing definitions (for basic information on definitions and other
      Tiles concepts, please have a look at <a href="http://struts.apache.org" target="_top">http://struts.apache.org</a>). In Spring this is done
      using the <code class="classname">TilesConfigurer</code>. Have a look at the
      following piece of example ApplicationContext configuration:</p><pre class="programlisting">&lt;bean id="tilesConfigurer" class="org.springframework.web.servlet.view.tiles.TilesConfigurer"&gt;
  &lt;property name="definitions"&gt;
    &lt;list&gt;
      &lt;value&gt;/WEB-INF/defs/general.xml&lt;/value&gt;
      &lt;value&gt;/WEB-INF/defs/widgets.xml&lt;/value&gt;
      &lt;value&gt;/WEB-INF/defs/administrator.xml&lt;/value&gt;
      &lt;value&gt;/WEB-INF/defs/customer.xml&lt;/value&gt;
      &lt;value&gt;/WEB-INF/defs/templates.xml&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>As you can see, there are five files containing definitions, which
      are all located in the <code class="filename">'WEB-INF/defs'</code> directory.
      At initialization of the <code class="interfacename">WebApplicationContext</code>,
      the files will be loaded and the definitions factory will be initialized.
      After that has been done, the Tiles includes in the definition files can be used
      as views within your Spring web application. To be able to use the views
      you have to have a <code class="interfacename">ViewResolver</code> just as with any
      other view technology used with Spring. Below you can find two
      possibilities, the <code class="classname">UrlBasedViewResolver</code> and
      the <code class="classname">ResourceBundleViewResolver</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-tiles-url"></a>14.3.2.1.&nbsp;<code class="classname">UrlBasedViewResolver</code></h4></div></div></div><p>The <code class="classname">UrlBasedViewResolver</code> instantiates the given
        <code class="literal">viewClass</code> for each view it has to resolve.</p><pre class="programlisting">&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.UrlBasedViewResolver"&gt;
  &lt;property name="viewClass" value="org.springframework.web.servlet.view.tiles.TilesView"/&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-tiles-resource"></a>14.3.2.2.&nbsp;<code class="classname">ResourceBundleViewResolver</code></h4></div></div></div><p>The <code class="classname">ResourceBundleViewResolver</code> has to be provided with a
        property file containing viewnames and viewclasses the resolver can
        use:</p><pre class="programlisting">&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.ResourceBundleViewResolver"&gt;
  &lt;property name="basename" value="views"/&gt;
&lt;/bean&gt;</pre><pre class="programlisting">...
welcomeView.class=org.springframework.web.servlet.view.tiles.TilesView
welcomeView.url=welcome <em class="lineannotation"><span class="lineannotation">(this is the name of a Tiles definition)</span></em>

vetsView.class=org.springframework.web.servlet.view.tiles.TilesView
vetsView.url=vetsView <em class="lineannotation"><span class="lineannotation">(again, this is the name of a Tiles definition)</span></em>

findOwnersForm.class=org.springframework.web.servlet.view.JstlView
findOwnersForm.url=/WEB-INF/jsp/findOwners.jsp
...</pre><p>As you can see, when using the <code class="classname">ResourceBundleViewResolver</code>,
        you can easily mix different view technologies.</p></div><p>Note that the <code class="classname">TilesView</code> class does <span class="emphasis"><em>not</em></span>
      support JSTL (the JSP Standard Tag Library) out of the box. There is a separate
      <code class="classname">TilesJstlView</code> subclass for JSTL-enabled templates.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-velocity"></a>14.4.&nbsp;Velocity &amp; FreeMarker</h2></div></div></div><p><a href="http://jakarta.apache.org/velocity" target="_top">Velocity</a> and
    <a href="http://www.freemarker.org" target="_top">FreeMarker</a> are two
    templating languages that can both be used as view technologies within
    Spring MVC applications. The languages are quite similar and serve similar
    needs and so are considered together in this section. For semantic and
    syntactic differences between the two languages, see the <a href="http://www.freemarker.org" target="_top">FreeMarker</a> web site.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-velocity-dependencies"></a>14.4.1.&nbsp;Dependencies</h3></div></div></div><p>Your web application will need to include
      <code class="filename">velocity-1.x.x.jar</code> or
      <code class="filename">freemarker-2.x.jar</code> in order to
      work with Velocity or FreeMarker respectively and
      <code class="filename">commons-collections.jar</code>
      needs also to be available for Velocity. Typically they are included in
      the <code class="literal">WEB-INF/lib</code> folder where they are guaranteed to
      be found by a J2EE server and added to the classpath for your
      application. It is of course assumed that you already have the
      <code class="filename">spring.jar</code> in your
      <code class="filename">'WEB-INF/lib'</code> directory too!
      The latest stable velocity, freemarker and commons
      collections jars are supplied with the Spring framework and can be
      copied from the relevant <code class="filename">/lib/</code>
      sub-directories. If you make use of Spring's dateToolAttribute or
      numberToolAttribute in your Velocity views, you will also need to include the
      <code class="filename">velocity-tools-generic-1.x.jar</code></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-velocity-contextconfig"></a>14.4.2.&nbsp;Context configuration</h3></div></div></div><p>A suitable configuration is initialized by adding the relevant
      configurer bean definition to your <code class="filename">'*-servlet.xml'</code> as shown below:</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- 
  This bean sets up the Velocity environment for us based on a root path for templates.
  Optionally, a properties file can be specified for more control over the Velocity
  environment, but the defaults are pretty sane for file based template loading.
--&gt;</span></em>
&lt;bean id="velocityConfig" class="org.springframework.web.servlet.view.velocity.VelocityConfigurer"&gt;
  &lt;property name="resourceLoaderPath" value="/WEB-INF/velocity/"/&gt;
&lt;/bean&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- 

  View resolvers can also be configured with ResourceBundles or XML files. If you need
  different view resolving based on Locale, you have to use the resource bundle resolver.

--&gt;</span></em>
&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.velocity.VelocityViewResolver"&gt;
  &lt;property name="cache" value="true"/&gt;
  &lt;property name="prefix" value=""/&gt;
  &lt;property name="suffix" value=".vm"/&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- if you want to use the Spring Velocity macros, set this property to true --&gt;</span></em>
  &lt;property name="exposeSpringMacroHelpers" value="true"/&gt;

&lt;/bean&gt;</pre><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- freemarker config --&gt;</span></em>
&lt;bean id="freemarkerConfig" class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer"&gt;
  &lt;property name="templateLoaderPath" value="/WEB-INF/freemarker/"/&gt;
&lt;/bean&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- 

  View resolvers can also be configured with ResourceBundles or XML files. If you need
  different view resolving based on Locale, you have to use the resource bundle resolver.

--&gt;</span></em>
&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver"&gt;
  &lt;property name="cache" value="true"/&gt;
  &lt;property name="prefix" value=""/&gt;
  &lt;property name="suffix" value=".ftl"/&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- if you want to use the Spring FreeMarker macros, set this property to true --&gt;</span></em>
  &lt;property name="exposeSpringMacroHelpers" value="true"/&gt;

&lt;/bean&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>For non web-apps add a <code class="classname">VelocityConfigurationFactoryBean</code> or a
      <code class="classname">FreeMarkerConfigurationFactoryBean</code> to your application context definition file.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-velocity-createtemplates"></a>14.4.3.&nbsp;Creating templates</h3></div></div></div><p>Your templates need to be stored in the directory specified by the
      <code class="literal">*Configurer</code> bean shown above. This document does not cover
      details of creating templates for the two languages - please see their
      relevant websites for information. If you use the view resolvers
      highlighted, then the logical view names relate to the template file
      names in similar fashion to
      <code class="classname">InternalResourceViewResolver</code> for JSP's. So if your
      controller returns a ModelAndView object containing a view name of
      "welcome" then the resolvers will look for the
      <code class="literal">/WEB-INF/freemarker/welcome.ftl</code> or
      <code class="literal">/WEB-INF/velocity/welcome.vm</code> template as
      appropriate.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-velocity-advancedconfig"></a>14.4.4.&nbsp;Advanced configuration</h3></div></div></div><p>The basic configurations highlighted above will be suitable for
      most application requirements, however additional configuration options
      are available for when unusual or advanced requirements dictate.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-velocity-example-velocityproperties"></a>14.4.4.1.&nbsp;velocity.properties</h4></div></div></div><p>This file is completely optional, but if specified, contains the
        values that are passed to the Velocity runtime in order to configure
        velocity itself. Only required for advanced configurations, if you
        need this file, specify its location on the
        <code class="literal">VelocityConfigurer</code> bean definition above.</p><pre class="programlisting">&lt;bean id="velocityConfig" class="org.springframework.web.servlet.view.velocity.VelocityConfigurer"&gt;
  &lt;property name="configLocation value="/WEB-INF/velocity.properties"/&gt;
&lt;/bean&gt;</pre><p>Alternatively, you can specify velocity properties directly in
        the bean definition for the Velocity config bean by replacing the
        "configLocation" property with the following inline properties.</p><pre class="programlisting">&lt;bean id="velocityConfig" class="org.springframework.web.servlet.view.velocity.VelocityConfigurer"&gt;
  &lt;property name="velocityProperties"&gt;
    &lt;props&gt;
      &lt;prop key="resource.loader"&gt;file&lt;/prop&gt;
      &lt;prop key="file.resource.loader.class"&gt;
        org.apache.velocity.runtime.resource.loader.FileResourceLoader
      &lt;/prop&gt;
      &lt;prop key="file.resource.loader.path"&gt;${webapp.root}/WEB-INF/velocity&lt;/prop&gt;
      &lt;prop key="file.resource.loader.cache"&gt;false&lt;/prop&gt;
    &lt;/props&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>Refer to the <a href="http://www.springframework.org/docs/api/org/springframework/ui/velocity/VelocityEngineFactory.html" target="_top">API
        documentation</a> for Spring configuration of Velocity, or the
        Velocity documentation for examples and definitions of the
        <code class="filename">'velocity.properties'</code> file itself.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="views-freemarker"></a>14.4.4.2.&nbsp;FreeMarker</h4></div></div></div><p>FreeMarker 'Settings' and 'SharedVariables' can be passed
        directly to the FreeMarker <code class="literal">Configuration</code> object
        managed by Spring by setting the appropriate bean properties on the
        <code class="literal">FreeMarkerConfigurer</code> bean. The
        <code class="literal">freemarkerSettings</code> property requires a
        <code class="literal">java.util.Properties</code> object and the
        <code class="literal">freemarkerVariables</code> property requires a
        <code class="literal">java.util.Map</code>.</p><pre class="programlisting">&lt;bean id="freemarkerConfig" class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer"&gt;
  &lt;property name="templateLoaderPath" value="/WEB-INF/freemarker/"/&gt;
  &lt;property name="freemarkerVariables"&gt;
    &lt;map&gt;
      &lt;entry key="xml_escape" value-ref="fmXmlEscape"/&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="fmXmlEscape" class="freemarker.template.utility.XmlEscape"/&gt;</pre><p>See the FreeMarker documentation for details of settings and
        variables as they apply to the <code class="classname">Configuration</code>
        object.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-velocity-forms"></a>14.4.5.&nbsp;Bind support and form handling</h3></div></div></div><p>Spring provides a tag library for use in JSP's that contains
      (amongst other things) a <code class="literal">&lt;spring:bind/&gt;</code> tag.
      This tag primarily enables forms to display values from form backing
      objects and to show the results of failed validations from a
      <code class="literal">Validator</code> in the web or business tier. From version
      1.1, Spring now has support for the same functionality in both Velocity
      and FreeMarker, with additional convenience macros for generating form
      input elements themselves.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-velocity-validation"></a>14.4.5.1.&nbsp;The bind macros</h4></div></div></div><p>A standard set of macros are maintained within the
        <code class="literal">spring.jar</code> file for both languages, so they are
        always available to a suitably configured application. However they
        can only be used if your view sets the bean property
        <code class="literal">exposeSpringMacroHelpers</code> to <code class="literal">'true'</code>
        on your <code class="classname">VelocityView</code> / <code class="classname">FreeMarkerView</code>
        beans. By way of a shortcut, you can also configure this property on
        <code class="classname">VelocityViewResolver</code> or
        <code class="classname">FreeMarkerViewResolver</code> too if you happen to be
        using it, in which case all of your views will inherit the value from
        it. Note that this property is <span class="bold"><strong>not
        required</strong></span> for any aspect of HTML form handling <span class="bold"><strong>except</strong></span> where you wish to take advantage of the
        Spring macros. Below is an example of a view.properties file showing
        correct configuration of such a view for either language;</p><pre class="programlisting">personFormV.class=org.springframework.web.servlet.view.velocity.VelocityView
personFormV.url=personForm.vm
personFormV.exposeSpringMacroHelpers=true</pre><pre class="programlisting">personFormF.class=org.springframework.web.servlet.view.freemarker.FreeMarkerView
personFormF.url=personForm.ftl
personFormF.exposeSpringMacroHelpers=true</pre><p>Find below an example of a complete (albeit trivial) Spring Web MVC
        configuration file that exposes the Velocity macros to every (Velocity) view.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" "http://www.springframework.org/dtd/spring-beans-2.0.dtd"&gt;

&lt;beans&gt;

    &lt;bean name="helloController" class="info.wilhelms.springwebapp.SampleController"&gt;
        &lt;property name="commandName" value="command"/&gt;
        &lt;property name="commandClass" value="info.wilhelms.springwebapp.Message"/&gt;
        &lt;property name="formView" value="foo"/&gt;
        &lt;property name="successView" value="banjo"/&gt;
        &lt;property name="bindOnNewForm" value="true"/&gt;
        &lt;property name="sessionForm" value="true"/&gt;
    &lt;/bean&gt;

    &lt;bean id="velocityConfig"
          class="org.springframework.web.servlet.view.velocity.VelocityConfigurer"&gt;
        &lt;property name="resourceLoaderPath" value="/WEB-INF/velocity/"/&gt;
    &lt;/bean&gt;

    &lt;bean id="viewResolver" class="org.springframework.web.servlet.view.velocity.VelocityViewResolver"&gt;
        &lt;property name="cache" value="false"/&gt;
        &lt;property name="prefix" value=""/&gt;
        &lt;property name="suffix" value=".vm"/&gt;
        <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>&lt;property name="exposeSpringMacroHelpers" value="true"/&gt;</strong></span></span></em>
    &lt;/bean&gt;

    &lt;bean class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"&gt;
        &lt;property name="mappings"&gt;
            &lt;value&gt;
                **/hello.htm=helloController
            &lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre><p>Some of the macros defined in the Spring libraries are
        considered internal (private) but no such scoping exists in the macro
        definitions making all macros visible to calling code and user
        templates. The following sections concentrate only on the macros you
        need to be directly calling from within your templates. If you wish to
        view the macro code directly, the files are called spring.vm /
        spring.ftl and are in the packages
        <code class="literal">org.springframework.web.servlet.view.velocity</code> or
        <code class="literal">org.springframework.web.servlet.view.freemarker</code>
        respectively.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-velocity-validationmessages"></a>14.4.5.2.&nbsp;simple binding</h4></div></div></div><p>In your html forms (vm / ftl templates) that act as the
        'formView' for a Spring form controller, you can use code similar to
        the following to bind to field values and display error messages for
        each input field in similar fashion to the JSP equivalent. Note that
        the name of the command object is "command" by default, but can be
        overridden in your MVC configuration by setting the 'commandName' bean
        property on your form controller. Example code is shown below for the
        <code class="literal">personFormV</code> and <code class="literal">personFormF</code>
        views configured earlier;</p><pre class="programlisting">&lt;!-- velocity macros are automatically available --&gt;
&lt;html&gt;
...
&lt;form action="" method="POST"&gt;
  Name: 
  #springBind( "command.name" )
  &lt;input type="text" 
    name="${status.expression}" 
    value="$!status.value" /&gt;&lt;br&gt;
  #foreach($error in $status.errorMessages) &lt;b&gt;$error&lt;/b&gt; &lt;br&gt; #end
  &lt;br&gt;
  ... 
  &lt;input type="submit" value="submit"/&gt;
&lt;/form&gt;
...
&lt;/html&gt;</pre><pre class="programlisting">&lt;!-- freemarker macros have to be imported into a namespace.  We strongly
recommend sticking to 'spring' --&gt;
&lt;#import "spring.ftl" as spring /&gt;
&lt;html&gt;
...
&lt;form action="" method="POST"&gt;
  Name: 
  &lt;@spring.bind "command.name" /&gt; 
  &lt;input type="text" 
    name="${spring.status.expression}" 
    value="${spring.status.value?default("")}" /&gt;&lt;br&gt;
  &lt;#list spring.status.errorMessages as error&gt; &lt;b&gt;${error}&lt;/b&gt; &lt;br&gt; &lt;/#list&gt;
  &lt;br&gt;
  ... 
  &lt;input type="submit" value="submit"/&gt;
&lt;/form&gt;
...
&lt;/html&gt;</pre><p><code class="literal">#springBind</code> /
        <code class="literal">&lt;@spring.bind&gt;</code> requires a 'path' argument
        which consists of the name of your command object (it will be
        'command' unless you changed it in your FormController properties)
        followed by a period and the name of the field on the command object
        you wish to bind to. Nested fields can be used too such as
        "command.address.street". The <code class="literal">bind</code> macro assumes
        the default HTML escaping behavior specified by the ServletContext
        parameter <code class="literal">defaultHtmlEscape</code> in web.xml</p><p>The optional form of the macro called
        <code class="literal">#springBindEscaped</code> /
        <code class="literal">&lt;@spring.bindEscaped&gt;</code> takes a second argument
        and explicitly specifies whether HTML escaping should be used in the
        status error messages or values. Set to true or false as required.
        Additional form handling macros simplify the use of HTML escaping and
        these macros should be used wherever possible. They are explained in
        the next section.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="views-form-macros"></a>14.4.5.3.&nbsp;form input generation macros</h4></div></div></div><p>Additional convenience macros for both languages simplify both
        binding and form generation (including validation error display). It
        is never necessary to use these macros to generate form input fields,
        and they can be mixed and matched with simple HTML or calls direct to
        the spring bind macros highlighted previously.</p><p>The following table of available macros show the VTL and FTL
        definitions and the parameter list that each takes.</p><div class="table"><a name="views-macros-defs-tbl"></a><p class="title"><b>Table&nbsp;14.1.&nbsp;Table of macro definitions</b></p><div class="table-contents"><table summary="Table of macro definitions" border="1"><colgroup><col align="left"><col><col></colgroup><thead><tr><th align="center">macro</th><th align="center">VTL definition</th><th align="center">FTL definition</th></tr></thead><tbody><tr><td align="left"><span class="bold"><strong>message</strong></span> (output a
                string from a resource bundle based on the code
                parameter)</td><td><code class="literal">#springMessage($code)</code></td><td><code class="literal">&lt;@spring.message
                code/&gt;</code></td></tr><tr><td align="left"><span class="bold"><strong>messageText</strong></span> (output a
                string from a resource bundle based on the code parameter,
                falling back to the value of the default parameter)</td><td><code class="literal">#springMessageText($code
                $text)</code></td><td><code class="literal">&lt;@spring.messageText code,
                text/&gt;</code></td></tr><tr><td align="left"><span class="bold"><strong>url</strong></span> (prefix a relative
                URL with the application's context root)</td><td><code class="literal">#springUrl($relativeUrl)</code></td><td><code class="literal">&lt;@spring.url
                relativeUrl/&gt;</code></td></tr><tr><td align="left"><span class="bold"><strong>formInput</strong></span> (standard
                input field for gathering user input)</td><td><code class="literal">#springFormInput($path
                $attributes)</code></td><td><code class="literal">&lt;@spring.formInput path, attributes,
                fieldType/&gt;</code></td></tr><tr><td align="left"><span class="bold"><strong>formHiddenInput *</strong></span>
                (hidden input field for submitting non-user input)</td><td><code class="literal">#springFormHiddenInput($path
                $attributes)</code></td><td><code class="literal">&lt;@spring.formHiddenInput path,
                attributes/&gt;</code></td></tr><tr><td align="left"><span class="bold"><strong>formPasswordInput</strong></span> *
                (standard input field for gathering passwords. Note that no
                value will ever be populated in fields of this type)</td><td><code class="literal">#springFormPasswordInput($path
                $attributes)</code></td><td><code class="literal">&lt;@spring.formPasswordInput path,
                attributes/&gt;</code></td></tr><tr><td align="left"><span class="bold"><strong>formTextarea</strong></span> (large
                text field for gathering long, freeform text input)</td><td><code class="literal">#springFormTextarea($path
                $attributes)</code></td><td><code class="literal">&lt;@spring.formTextarea path,
                attributes/&gt;</code></td></tr><tr><td align="left"><span class="bold"><strong>formSingleSelect</strong></span> (drop
                down box of options allowing a single required value to be
                selected)</td><td><code class="literal">#springFormSingleSelect( $path $options
                $attributes)</code></td><td><code class="literal">&lt;@spring.formSingleSelect path, options,
                attributes/&gt;</code></td></tr><tr><td align="left"><span class="bold"><strong>formMultiSelect</strong></span> (a
                list box of options allowing the user to select 0 or more
                values)</td><td><code class="literal">#springFormMultiSelect($path $options
                $attributes)</code></td><td><code class="literal">&lt;@spring.formMultiSelect path, options,
                attributes/&gt;</code></td></tr><tr><td align="left"><span class="bold"><strong>formRadioButtons</strong></span> (a
                set of radio buttons allowing a single selection to be made
                from the available choices)</td><td><code class="literal">#springFormRadioButtons($path $options
                $separator $attributes)</code></td><td><code class="literal">&lt;@spring.formRadioButtons path, options
                separator, attributes/&gt;</code></td></tr><tr><td align="left"><span class="bold"><strong>formCheckboxes</strong></span> (a set
                of checkboxes allowing 0 or more values to be
                selected)</td><td><code class="literal">#springFormCheckboxes($path $options
                $separator $attributes)</code></td><td><code class="literal">&lt;@spring.formCheckboxes path, options,
                separator, attributes/&gt;</code></td></tr><tr><td align="left"><span class="bold"><strong>showErrors</strong></span> (simplify
                display of validation errors for the bound field)</td><td><code class="literal">#springShowErrors($separator
                $classOrStyle)</code></td><td><code class="literal">&lt;@spring.showErrors separator,
                classOrStyle/&gt;</code></td></tr></tbody></table></div></div><br class="table-break"><p>* In FTL (FreeMarker), these two macros are not actually
        required as you can use the normal <code class="literal">formInput</code> macro,
        specifying '<code class="literal">hidden</code>' or
        '<code class="literal">password</code>' as the value for the
        <code class="literal">fieldType</code> parameter.</p><p>The parameters to any of the above macros have consistent
        meanings:</p><div class="itemizedlist"><ul type="disc"><li><p>path: the name of the field to bind to (ie
            "command.name")</p></li><li><p>options: a Map of all the available values that can be
            selected from in the input field. The keys to the map represent
            the values that will be POSTed back from the form and bound to the
            command object. Map objects stored against the keys are the labels
            displayed on the form to the user and may be different from the
            corresponding values posted back by the form. Usually such a map
            is supplied as reference data by the controller. Any Map
            implementation can be used depending on required behavior. For
            strictly sorted maps, a <code class="literal">SortedMap</code> such as a
            <code class="literal">TreeMap</code> with a suitable Comparator may be used
            and for arbitrary Maps that should return values in insertion
            order, use a <code class="literal">LinkedHashMap</code> or a
            <code class="literal">LinkedMap</code> from commons-collections.</p></li><li><p>separator: where multiple options are available as discreet
            elements (radio buttons or checkboxes), the sequence of characters
            used to separate each one in the list (ie "&lt;br&gt;").</p></li><li><p>attributes: an additional string of arbitrary tags or text
            to be included within the HTML tag itself. This string is echoed
            literally by the macro. For example, in a textarea field you may
            supply attributes as 'rows="5" cols="60"' or you could pass style
            information such as 'style="border:1px solid silver"'.</p></li><li><p>classOrStyle: for the showErrors macro, the name of the CSS
            class that the span tag wrapping each error will use. If no
            information is supplied (or the value is empty) then the errors
            will be wrapped in &lt;b&gt;&lt;/b&gt; tags.</p></li></ul></div><p>Examples of the macros are outlined below some in FTL and some
        in VTL. Where usage differences exist between the two languages, they
        are explained in the notes.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="views-form-macros-input"></a>14.4.5.3.1.&nbsp;Input Fields</h5></div></div></div><pre class="programlisting">&lt;!-- the Name field example from above using form macros in VTL --&gt;
...
    Name:
    #springFormInput("command.name" "")&lt;br&gt;
    #springShowErrors("&lt;br&gt;" "")&lt;br&gt;</pre><p>The formInput macro takes the path parameter (command.name)
          and an additional attributes parameter which is empty in the example
          above. The macro, along with all other form generation macros,
          performs an implicit spring bind on the path parameter. The binding
          remains valid until a new bind occurs so the showErrors macro
          doesn't need to pass the path parameter again - it simply operates
          on whichever field a bind was last created for.</p><p>The showErrors macro takes a separator parameter (the
          characters that will be used to separate multiple errors on a given
          field) and also accepts a second parameter, this time a class name
          or style attribute. Note that FreeMarker is able to specify default
          values for the attributes parameter, unlike Velocity, and the two
          macro calls above could be expressed as follows in FTL:</p><pre class="programlisting">&lt;@spring.formInput "command.name"/&gt;
&lt;@spring.showErrors "&lt;br&gt;"/&gt;</pre><p>Output is shown below of the form fragment generating the name
          field, and displaying a validation error after the form was
          submitted with no value in the field. Validation occurs through
          Spring's Validation framework.</p><p>The generated HTML looks like this:</p><pre class="programlisting">Name:
  &lt;input type="text" name="name" value=""     
&gt;
&lt;br&gt;
  &lt;b&gt;required&lt;/b&gt;
&lt;br&gt;
&lt;br&gt;</pre><p>The formTextarea macro works the same way as the formInput
          macro and accepts the same parameter list. Commonly, the second
          parameter (attributes) will be used to pass style information or
          rows and cols attributes for the textarea.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="views-form-macros-select"></a>14.4.5.3.2.&nbsp;Selection Fields</h5></div></div></div><p>Four selection field macros can be used to generate common UI
          value selection inputs in your HTML forms.</p><div class="itemizedlist"><ul type="disc"><li><p>formSingleSelect</p></li><li><p>formMultiSelect</p></li><li><p>formRadioButtons</p></li><li><p>formCheckboxes</p></li></ul></div><p>Each of the four macros accepts a Map of options containing
          the value for the form field, and the label corresponding to that
          value. The value and the label can be the same.</p><p>An example of radio buttons in FTL is below. The form backing
          object specifies a default value of 'London' for this field and so
          no validation is necessary. When the form is rendered, the entire
          list of cities to choose from is supplied as reference data in the
          model under the name 'cityMap'.</p><pre class="programlisting">...
  Town:
  &lt;@spring.formRadioButtons "command.address.town", cityMap, "" /&gt;&lt;br&gt;&lt;br&gt;</pre><p>This renders a line of radio buttons, one for each value in
          <code class="literal">cityMap</code> using the separator "". No additional
          attributes are supplied (the last parameter to the macro is
          missing). The cityMap uses the same String for each key-value pair
          in the map. The map's keys are what the form actually submits as
          POSTed request parameters, map values are the labels that the user
          sees. In the example above, given a list of three well known cities
          and a default value in the form backing object, the HTML would
          be</p><pre class="programlisting">Town:
&lt;input type="radio" name="address.town" value="London"
   
&gt;
London
&lt;input type="radio" name="address.town" value="Paris"
  checked="checked" 
&gt;
Paris
&lt;input type="radio" name="address.town" value="New York"
   
&gt;
New York</pre><p>If your application expects to handle cities by internal codes
          for example, the map of codes would be created with suitable keys
          like the example below.</p><pre class="programlisting">protected Map referenceData(HttpServletRequest request) throws Exception {
  Map cityMap = new LinkedHashMap();
  cityMap.put("LDN", "London");
  cityMap.put("PRS", "Paris");
  cityMap.put("NYC", "New York");
  
  Map m = new HashMap();
  m.put("cityMap", cityMap);
  return m;
}</pre><p>The code would now produce output where the radio values are
          the relevant codes but the user still sees the more user friendly
          city names.</p><pre class="programlisting">Town:
&lt;input type="radio" name="address.town" value="LDN"
   
&gt;
London
&lt;input type="radio" name="address.town" value="PRS"
  checked="checked" 
&gt;
Paris
&lt;input type="radio" name="address.town" value="NYC"
   
&gt;
New York</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="views-form-macros-html-escaping"></a>14.4.5.4.&nbsp;HTML escaping and XHTML compliance</h4></div></div></div><p>Default usage of the form macros above will result in HTML tags
        that are HTML 4.01 compliant and that use the default value for HTML
        escaping defined in your web.xml as used by Spring's bind support. In
        order to make the tags XHTML compliant or to override the default HTML
        escaping value, you can specify two variables in your template (or in
        your model where they will be visible to your templates). The
        advantage of specifying them in the templates is that they can be
        changed to different values later in the template processing to
        provide different behavior for different fields in your form.</p><p>To switch to XHTML compliance for your tags, specify a value of
        'true' for a model/context variable named xhtmlCompliant:</p><pre class="programlisting">## for Velocity..
#set($springXhtmlCompliant = true)

&lt;#-- for FreeMarker --&gt;
&lt;#assign xhtmlCompliant = true in spring&gt;</pre><p>Any tags generated by the Spring macros will now be XHTML
        compliant after processing this directive.</p><p>In similar fashion, HTML escaping can be specified per
        field:</p><pre class="programlisting">&lt;#-- until this point, default HTML escaping is used --&gt;

&lt;#assign htmlEscape = true in spring&gt;
&lt;#-- next field will use HTML escaping --&gt;
&lt;@spring.formInput "command.name" /&gt;

&lt;#assign htmlEscape = false in spring&gt;
&lt;#-- all future fields will be bound with HTML escaping off --&gt;</pre></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-xslt"></a>14.5.&nbsp;XSLT</h2></div></div></div><p>XSLT is a transformation language for XML and is popular as a view
    technology within web applications. XSLT can be a good choice as a view
    technology if your application naturally deals with XML, or if your model
    can easily be converted to XML. The following section shows how to produce
    an XML document as model data and have it transformed with XSLT in a
    Spring Web MVC application.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-xslt-firstwords"></a>14.5.1.&nbsp;My First Words</h3></div></div></div><p>This example is a trivial Spring application that creates a list
      of words in the <code class="interfacename">Controller</code> and adds them to the model
      map. The map is  returned along with the view name of our XSLT view. See the section
      entitled <a href="#mvc-controller" title="13.3.&nbsp;Controllers">Section&nbsp;13.3, &#8220;Controllers&#8221;</a> for details of Spring Web MVC's
      <code class="interfacename">Controller</code> interface. The XSLT view will turn the list of
      words into a simple XML document ready for transformation.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-xslt-beandefs"></a>14.5.1.1.&nbsp;Bean definitions</h4></div></div></div><p>Configuration is standard for a simple Spring application. The
        dispatcher servlet config file contains a reference to a
        <code class="interfacename">ViewResolver</code>, URL mappings and a single controller
        bean...</p><pre class="programlisting">&lt;bean id="homeController"class="xslt.HomeController"/&gt;</pre><p>... that encapsulates our word generation logic.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-xslt-controllercode"></a>14.5.1.2.&nbsp;Standard MVC controller code</h4></div></div></div><p>The controller logic is encapsulated in a subclass of
        <code class="classname">AbstractController</code>, with the handler method being defined like so...</p><pre class="programlisting">protected ModelAndView handleRequestInternal(
    HttpServletRequest request,
    HttpServletResponse response) throws Exception {
        
    Map map = new HashMap();
    List wordList = new ArrayList();
        
    wordList.add("hello");
    wordList.add("world");
       
    map.put("wordList", wordList);
      
    return new ModelAndView("home", map);
}</pre><p>So far we've done nothing that's XSLT specific. The model data
        has been created in the same way as you would for any other Spring MVC
        application. Depending on the configuration of the application now,
        that list of words could be rendered by JSP/JSTL by having them added
        as request attributes, or they could be handled by Velocity by adding
        the object to the <code class="classname">VelocityContext</code>. In
        order to have XSLT render them, they of course have to be converted into
        an XML document somehow.
        There are software packages available that will automatically 'domify'
        an object graph, but within Spring, you have complete flexibility to
        create the DOM from your model in any way you choose. This prevents
        the transformation of XML playing too great a part in the structure of
        your model data which is a danger when using tools to manage the
        domification process.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-xslt-subclassing"></a>14.5.1.3.&nbsp;Convert the model data to XML</h4></div></div></div><p>In order to create a DOM document from our list of words or any
        other model data, we must subclass the (provided)
        <code class="classname">org.springframework.web.servlet.view.xslt.AbstractXsltView</code>
        class. In doing so, we must also typically implement the abstract method
        <code class="methodname">createXsltSource(..)</code> method. The first parameter passed
        to this method is our model map. Here's the complete listing of the
        <code class="classname">HomePage</code> class in our trivial word application:</p><pre class="programlisting">
package xslt;

<em class="lineannotation"><span class="lineannotation">// imports omitted for brevity</span></em>

public class HomePage extends AbstractXsltView {

    protected Source createXsltSource(Map model, String rootName, HttpServletRequest
        request, HttpServletResponse response) throws Exception {

        Document document = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();
        Element root = document.createElement(rootName);

        List words = (List) model.get("wordList");
        for (Iterator it = words.iterator(); it.hasNext();) {
            String nextWord = (String) it.next();
            Element wordNode = document.createElement("word");
            Text textNode = document.createTextNode(nextWord);
            wordNode.appendChild(textNode);
            root.appendChild(wordNode);
        }
        return new DOMSource(root);
    }

}</pre><p>A series of parameter name/value pairs can optionally be
        defined by your subclass which will be added to the transformation
        object. The parameter names must match those defined in your XSLT
        template declared with
        <code class="literal">&lt;xsl:param name="myParam"&gt;defaultValue&lt;/xsl:param&gt;</code>.
        To  specify the parameters, override the
        <code class="methodname">getParameters()</code> method of the
        <code class="classname">AbstractXsltView</code> class and return a
        <code class="interfacename">Map</code> of the name/value pairs. If your parameters
        need to derive information from the current request, you can (from Spring version
        1.1) override the
        <code class="methodname">getParameters(HttpServletRequest request)</code> method instead.</p><p>Unlike JSTL and Velocity, XSLT has relatively poor support for
        locale based currency and date formatting. In recognition of the
        fact, Spring provides a helper class that you can use from within
        your <code class="methodname">createXsltSource(..)</code> method(s) to get such
        support. See the Javadocs for the
        <code class="classname">org.springframework.web.servlet.view.xslt.FormatHelper</code>
        class.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-xslt-viewdefinitions"></a>14.5.1.4.&nbsp;Defining the view properties</h4></div></div></div><p>The views.properties file (or equivalent xml definition if
        you're using an XML based view resolver as we did in the Velocity
        examples above) looks like this for the one-view application that is
        'My First Words':</p><pre class="programlisting">home.class=xslt.HomePage
home.stylesheetLocation=/WEB-INF/xsl/home.xslt
home.root=words</pre><p>Here, you can see how the view is tied in
        with the <code class="classname">HomePage</code> class just written which handles the model
        domification in the first property <code class="literal">'.class'</code>. The <code class="literal">'stylesheetLocation'</code>
        property points to the XSLT file which will handle the XML
        transformation into HTML for us and the final property <code class="literal">'.root'</code> is the
        name that will be used as the root of the XML document. This gets
        passed to the <code class="classname">HomePage</code> class above in the second parameter to the
        <code class="methodname">createXsltSource(..)</code> method(s).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-xslt-transforming"></a>14.5.1.5.&nbsp;Document transformation</h4></div></div></div><p>Finally, we have the XSLT code used for transforming the above
        document. As shown in the above <code class="filename">'views.properties'</code> file, the stylesheet is called
        <code class="filename">'home.xslt'</code> and it lives in the war file in the
        <code class="filename">'WEB-INF/xsl'</code> directory.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;

    &lt;xsl:output method="html" omit-xml-declaration="yes"/&gt;

    &lt;xsl:template match="/"&gt;
        &lt;html&gt;
            &lt;head&gt;&lt;title&gt;Hello!&lt;/title&gt;&lt;/head&gt;
            &lt;body&gt;
                &lt;h1&gt;My First Words&lt;/h1&gt;
                &lt;xsl:apply-templates/&gt;
            &lt;/body&gt;
        &lt;/html&gt;
    &lt;/xsl:template&gt;

    &lt;xsl:template match="word"&gt;
        &lt;xsl:value-of select="."/&gt;&lt;br/&gt;
    &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-xslt-summary"></a>14.5.2.&nbsp;Summary</h3></div></div></div><p>A summary of the files discussed and their location in the WAR
      file is shown in the simplified WAR structure below.</p><pre class="programlisting">ProjectRoot
  |
  +- WebContent
      |
      +- WEB-INF
          |
          +- classes
          |    |
          |    +- xslt
          |    |   |
          |    |   +- HomePageController.class 
          |    |   +- HomePage.class
          |    |
          |    +- views.properties
          |
          +- lib
          |   |
          |   +- spring.jar
          |
          +- xsl
          |   |
          |   +- home.xslt
          |
          +- frontcontroller-servlet.xml</pre><p>You will also need to ensure that an XML parser and an XSLT engine are available on the
            classpath. JDK 1.4 provides them by default, and most J2EE containers
            will also make them available by default, but it's a possible source of
            errors to be aware of.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-document"></a>14.6.&nbsp;Document views (PDF/Excel)</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-document-intro"></a>14.6.1.&nbsp;Introduction</h3></div></div></div><p>Returning an HTML page isn't always the best way for the user to
      view the model output, and Spring makes it simple to generate a PDF
      document or an Excel spreadsheet dynamically from the model data. The
      document is the view and will be streamed from the server with the
      correct content type to (hopefully) enable the client PC to run their
      spreadsheet or PDF viewer application in response.</p><p>In order to use Excel views, you need to add the 'poi' library to
      your classpath, and for PDF generation, the iText.jar. Both are included
      in the main Spring distribution.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-document-config"></a>14.6.2.&nbsp;Configuration and setup</h3></div></div></div><p>Document based views are handled in an almost identical fashion to
      XSLT views, and the following sections build upon the previous one by
      demonstrating how the same controller used in the XSLT example is
      invoked to render the same model as both a PDF document and an Excel
      spreadsheet (which can also be viewed or manipulated in Open
      Office).</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-document-configviews"></a>14.6.2.1.&nbsp;Document view definitions</h4></div></div></div><p>Firstly, let's amend the views.properties file (or xml
        equivalent) and add a simple view definition for both document types.
        The entire file now looks like this with the XSLT view shown from
        earlier.. </p><pre class="programlisting">home.class=xslt.HomePage
home.stylesheetLocation=/WEB-INF/xsl/home.xslt
home.root=words

xl.class=excel.HomePage

pdf.class=pdf.HomePage</pre><p> <span class="emphasis"><em>If you want to start with a
        template spreadsheet to add your model data to, specify the location
        as the 'url' property in the view definition</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-document-configcontroller"></a>14.6.2.2.&nbsp;Controller code</h4></div></div></div><p>The controller code we'll use remains exactly the same from the
        XSLT example earlier other than to change the name of the view to use.
        Of course, you could be clever and have this selected based on a URL
        parameter or some other logic - proof that Spring really is very good
        at decoupling the views from the controllers!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-document-configsubclasses"></a>14.6.2.3.&nbsp;Subclassing for Excel views</h4></div></div></div><p>Exactly as we did for the XSLT example, we'll subclass suitable
        abstract classes in order to implement custom behavior in generating
        our output documents. For Excel, this involves writing a subclass of
        <code class="literal">org.springframework.web.servlet.view.document.AbstractExcelView</code>
		(for Excel files generated by POI)
			or <code class="literal">org.springframework.web.servlet.view.document.AbstractJExcelView</code>
		(for JExcelApi-generated Excel files).
        and implementing the <code class="literal">buildExcelDocument</code></p><p>Here's the complete listing for our POI Excel view which displays
        the word list from the model map in consecutive rows of the first
        column of a new spreadsheet.. </p><pre class="programlisting">package excel;

// imports omitted for brevity

public class HomePage extends AbstractExcelView {

    protected void buildExcelDocument(
        Map model,
        HSSFWorkbook wb,
        HttpServletRequest req,
        HttpServletResponse resp)
        throws Exception {
    
        HSSFSheet sheet;
        HSSFRow sheetRow;
        HSSFCell cell;

        // Go to the first sheet
        // getSheetAt: only if wb is created from an existing document
        //sheet = wb.getSheetAt( 0 );
        sheet = wb.createSheet("Spring");
        sheet.setDefaultColumnWidth((short)12);

        // write a text at A1
        cell = getCell( sheet, 0, 0 );
        setText(cell,"Spring-Excel test");

        List words = (List ) model.get("wordList");
        for (int i=0; i &lt; words.size(); i++) {
            cell = getCell( sheet, 2+i, 0 );
            setText(cell, (String) words.get(i));

        }
    }
}</pre><p>And this a view generating the same Excel file, now using JExcelApi: </p><pre class="programlisting">package excel;
			
// imports omitted for brevity

public class HomePage extends AbstractExcelView {

    protected void buildExcelDocument(Map model,
        WritableWorkbook wb,
        HttpServletRequest request,
        HttpServletResponse response)
    throws Exception {
			
        WritableSheet sheet = wb.createSheet("Spring");

        sheet.addCell(new Label(0, 0, "Spring-Excel test");
		
        List words  = (List)model.get("wordList");
        for (int i = -; i &lt; words.size(); i++) {
            sheet.addCell(new Label(2+i, 0, (String)words.get(i));
        }
    }
}
</pre><p>			
		</p><p>Note the differences between the APIs. We've found that the
		JExcelApi is somewhat more intuitive and furthermore, JExcelApi
		has a bit better image-handling capabilities. There have been 
		memory problems with large Excel file when using JExcelApi however.</p><p>If you now amend the controller such that it returns
        <code class="literal">xl</code> as the name of the view (<code class="literal">return new
        ModelAndView("xl", map);</code>) and run your application again,
        you should find that the Excel spreadsheet is created and downloaded
        automatically when you request the same page as before.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-document-configsubclasspdf"></a>14.6.2.4.&nbsp;Subclassing for PDF views</h4></div></div></div><p>The PDF version of the word list is even simpler. This time, the
        class extends
        <code class="literal">org.springframework.web.servlet.view.document.AbstractPdfView</code>
        and implements the <code class="literal">buildPdfDocument()</code> method as
        follows.. </p><pre class="programlisting">package pdf;

// imports omitted for brevity

public class PDFPage extends AbstractPdfView {

    protected void buildPdfDocument(
        Map model,
        Document doc,
        PdfWriter writer,
        HttpServletRequest req,
        HttpServletResponse resp)
        throws Exception {
        
        List words = (List) model.get("wordList");
        
        for (int i=0; i&lt;words.size(); i++)
            doc.add( new Paragraph((String) words.get(i)));
    
    }
}</pre><p> Once again, amend the controller to return the
        <code class="literal">pdf</code> view with a <code class="literal">return new
        ModelAndView("pdf", map);</code> and reload the URL in your
        application. This time a PDF document should appear listing each of
        the words in the model map.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-jasper-reports"></a>14.7.&nbsp;JasperReports</h2></div></div></div><p>JasperReports (<a href="http://jasperreports.sourceforge.net" target="_top">http://jasperreports.sourceforge.net</a>)
    is a powerful open-source reporting engine that supports the creation of report
    designs using an easily understood XML file format. JasperReports is capable of
    rendering reports output into four different formats: CSV, Excel, HTML and PDF.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jasper-reports-dependencies"></a>14.7.1.&nbsp;Dependencies</h3></div></div></div><p>Your application will need to include the latest release of
      JasperReports, which at the time of writing was 0.6.1. JasperReports
      itself depends on the following projects:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>BeanShell</p></li><li style="list-style-type: disc"><p>Commons BeanUtils</p></li><li style="list-style-type: disc"><p>Commons Collections</p></li><li style="list-style-type: disc"><p>Commons Digester</p></li><li style="list-style-type: disc"><p>Commons Logging</p></li><li style="list-style-type: disc"><p>iText</p></li><li style="list-style-type: disc"><p>POI</p></li></ul></div><p>JasperReports also requires a JAXP compliant XML parser.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jasper-reports-configuration"></a>14.7.2.&nbsp;Configuration</h3></div></div></div><p>To configure JasperReports views in your Spring container configuration
      you need to define a <code class="interfacename">ViewResolver</code> to map view
      names to the appropriate view class depending on which format you want your
      report rendered in.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jasper-reports-configuration-resolver"></a>14.7.2.1.&nbsp;Configuring the <code class="interfacename">ViewResolver</code></h4></div></div></div><p>Typically, you will use the <code class="classname">ResourceBundleViewResolver</code>
        to map view names to view classes and files in a properties file.</p><pre class="programlisting">&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.ResourceBundleViewResolver"&gt;
    &lt;property name="basename" value="views"/&gt;
&lt;/bean&gt;</pre><p>Here we've configured an instance of the <code class="classname">ResourceBundleViewResolver</code>
        class that will look for view  mappings in the resource bundle with base name
        <code class="literal">views</code>. (The content of this file is described in the next section.)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jasper-reports-configuration-views"></a>14.7.2.2.&nbsp;Configuring the <code class="literal">View</code>s</h4></div></div></div><p>The Spring Framework contains five different <code class="interfacename">View</code>
        implementations for JasperReports, four of which correspond to one of the four output
        formats supported by JasperReports, and one that allows for the format to be determined at runtime:</p><div class="table"><a name="view-jasper-reports-configuration-views-classes"></a><p class="title"><b>Table&nbsp;14.2.&nbsp;JasperReports <code class="interfacename">View</code> classes</b></p><div class="table-contents"><table summary="JasperReports View classes" border="1"><colgroup><col><col></colgroup><thead><tr><th>Class Name</th><th>Render Format</th></tr></thead><tbody><tr><td><code class="classname">JasperReportsCsvView</code></td><td>CSV</td></tr><tr><td><code class="classname">JasperReportsHtmlView</code></td><td>HTML</td></tr><tr><td><code class="classname">JasperReportsPdfView</code></td><td>PDF</td></tr><tr><td><code class="classname">JasperReportsXlsView</code></td><td>Microsoft Excel</td></tr><tr><td><code class="classname">JasperReportsMultiFormatView</code></td><td>The view is <a href="#view-jasper-reports-configuration-multiformat-view" title="14.7.2.4.&nbsp;Using JasperReportsMultiFormatView">decided upon at runtime</a></td></tr></tbody></table></div></div><br class="table-break"><p>Mapping one of these classes to a view name and a report file is a matter of
        adding the appropriate entries into the resource bundle configured in the previous
        section as shown here:</p><pre class="programlisting">simpleReport.class=org.springframework.web.servlet.view.jasperreports.JasperReportsPdfView
simpleReport.url=/WEB-INF/reports/DataSourceReport.jasper</pre><p>Here you can see that the view with name <code class="literal">simpleReport</code>
        is mapped to the <code class="classname">JasperReportsPdfView</code> class, causing the
        output of this report to be rendered in PDF format. The <code class="literal">url</code>
        property of the view is set to the location of the underlying report file.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jasper-reports-configuration-report-files"></a>14.7.2.3.&nbsp;About Report Files</h4></div></div></div><p>JasperReports has two distinct types of report file: the design
        file, which has a <code class="literal">.jrxml</code> extension, and the
        compiled report file, which has a <code class="literal">.jasper</code>
        extension. Typically, you use the JasperReports Ant task to compile
        your <code class="literal">.jrxml</code> design file into a
        <code class="literal">.jasper</code> file before deploying it into your
        application. With the Spring Framework you can map either of these files to your
        report file and the framework will take care of compiling the
        <code class="literal">.jrxml</code> file on the fly for you. You should note
        that after a <code class="literal">.jrxml</code> file is compiled by the Spring Framework,
        the compiled report is cached for the lifetime of the application. To make
        changes to the file you will need to restart your application.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jasper-reports-configuration-multiformat-view"></a>14.7.2.4.&nbsp;Using <code class="classname">JasperReportsMultiFormatView</code></h4></div></div></div><p>The <code class="classname">JasperReportsMultiFormatView</code> allows for
        report format to be specified at runtime. The actual rendering of the
        report is delegated to one of the other JasperReports view classes -
        the <code class="classname">JasperReportsMultiFormatView</code> class simply adds
        a wrapper layer that allows for the exact implementation to be
        specified at runtime.</p><p>The <code class="classname">JasperReportsMultiFormatView</code> class
        introduces two concepts: the format key and the discriminator key. The
        <code class="classname">JasperReportsMultiFormatView</code> class uses the mapping
        key to lookup the actual view implementation class and uses the format
        key to lookup up the mapping key. From a coding perspective you add an
        entry to your model with the formay key as the key and the mapping key
        as the value, for example:</p><pre class="programlisting">public ModelAndView handleSimpleReportMulti(HttpServletRequest request,
HttpServletResponse response) throws Exception {

  String uri = request.getRequestURI();
  String format = uri.substring(uri.lastIndexOf(".") + 1);

  Map model = getModel();
  model.put("format", format);

  return new ModelAndView("simpleReportMulti", model);
}</pre><p>In this example, the mapping key is determined from the
        extension of the request URI and is added to the model under the
        default format key: <code class="literal">format</code>. If you wish to use a
        different format key then you can configure this using the
        <code class="literal">formatKey</code> property of the
        <code class="classname">JasperReportsMultiFormatView</code> class.</p><p>By default the following mapping key mappings are configured in
        <code class="classname">JasperReportsMultiFormatView</code>:</p><div class="table"><a name="view-jasper-reports-configuration-multiformat-view-mappings"></a><p class="title"><b>Table&nbsp;14.3.&nbsp;<code class="classname">JasperReportsMultiFormatView</code> Default Mapping Key Mappings</b></p><div class="table-contents"><table summary="JasperReportsMultiFormatView Default Mapping Key Mappings" border="1"><colgroup><col><col></colgroup><thead><tr><th>Mapping Key</th><th>View Class</th></tr></thead><tbody><tr><td>csv</td><td><code class="classname">JasperReportsCsvView</code></td></tr><tr><td>html</td><td><code class="classname">JasperReportsHtmlView</code></td></tr><tr><td>pdf</td><td><code class="classname">JasperReportsPdfView</code></td></tr><tr><td>xls</td><td><code class="classname">JasperReportsXlsView</code></td></tr></tbody></table></div></div><br class="table-break"><p>So in the example above a request to URI /foo/myReport.pdf
            would be mapped to the <code class="literal">JasperReportsPdfView</code> class.
            You can override the mapping key to view class mappings using the
            <code class="literal">formatMappings</code> property of
            <code class="classname">JasperReportsMultiFormatView</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jasper-reports-model"></a>14.7.3.&nbsp;Populating the <code class="classname">ModelAndView</code></h3></div></div></div><p>In order to render your report correctly in the format you have
      chosen, you must supply Spring with all of the data needed to populate
      your report. For JasperReports this means you must pass in all report
      parameters along with the report datasource. Report parameters are
      simple name/value pairs and can be added be to the
      <code class="interfacename">Map</code> for your model as you would add any name/value
      pair.</p><p>When adding the datasource to the model you have two approaches to
      choose from. The first approach is to add an instance of
      <code class="classname">JRDataSource</code> or a <code class="interfacename">Collection</code> type to the
      model <code class="interfacename">Map</code> under any arbitrary key. Spring will then
      locate this object in the model and treat it as the report datasource.
      For example, you may populate your model like so:</p><pre class="programlisting">private Map getModel() {
  Map model = new HashMap();
  Collection beanData = getBeanData();
  model.put("myBeanData", beanData);
  return model;
}</pre><p>The second approach is to add the instance of
      <code class="literal">JRDataSource</code> or <code class="literal">Collection</code> under a
      specific key and then configure this key using the
      <code class="literal">reportDataKey</code> property of the view class. In both
      cases Spring will instances of <code class="literal">Collection</code> in a
      <code class="literal">JRBeanCollectionDataSource</code> instance. For example:</p><pre class="programlisting">private Map getModel() {
  Map model = new HashMap();
  Collection beanData = getBeanData();
  Collection someData = getSomeData();
  model.put("myBeanData", beanData);
  model.put("someData", someData);
  return model;
}</pre><p>Here you can see that two <code class="literal">Collection</code>
      instances are being added to the model. To ensure that the correct one
      is used, we simply modify our view configuration as appropriate:</p><pre class="programlisting">simpleReport.class=org.springframework.web.servlet.view.jasperreports.JasperReportsPdfView
simpleReport.url=/WEB-INF/reports/DataSourceReport.jasper
simpleReport.reportDataKey=myBeanData</pre><p>Be aware that when using the first approach, Spring will use the
      first instance of <code class="literal">JRDataSource</code> or
      <code class="literal">Collection</code> that it encounters. If you need to place
      multiple instances of <code class="literal">JRDataSource</code> or
      <code class="literal">Collection</code> into the model then you need to use the
      second approach.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jasper-reports-subreports"></a>14.7.4.&nbsp;Working with Sub-Reports</h3></div></div></div><p>JasperReports provides support for embedded sub-reports within
      your master report files. There are a wide variety of mechanisms for
      including sub-reports in your report files. The easiest way is to hard
      code the report path and the SQL query for the sub report into your
      design files. The drawback of this approach is obvious - the values are
      hard-coded into your report files reducing reusability and making it
      harder to modify and update report designs. To overcome this you can
      configure sub-reports declaratively and you can include additional data
      for these sub-reports directly from your controllers.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jasper-reports-subreports-config-reports"></a>14.7.4.1.&nbsp;Configuring Sub-Report Files</h4></div></div></div><p>To control which sub-report files are included in a master
        report using Spring, your report file must be configured to accept
        sub-reports from an external source. To do this you declare a
        parameter in your report file like so:</p><pre class="programlisting">&lt;parameter name="ProductsSubReport" class="net.sf.jasperreports.engine.JasperReport"/&gt;</pre><p>Then, you define your sub-report to use this sub-report parameter:</p><pre class="programlisting">&lt;subreport&gt;
    &lt;reportElement isPrintRepeatedValues="false" x="5" y="25" width="325"
        height="20" isRemoveLineWhenBlank="true" backcolor="#ffcc99"/&gt;
    &lt;subreportParameter name="City"&gt;
        &lt;subreportParameterExpression&gt;&lt;![CDATA[$F{city}]]&gt;&lt;/subreportParameterExpression&gt;
    &lt;/subreportParameter&gt;
    &lt;dataSourceExpression&gt;&lt;![CDATA[$P{SubReportData}]]&gt;&lt;/dataSourceExpression&gt;
    &lt;subreportExpression class="net.sf.jasperreports.engine.JasperReport"&gt;
                  &lt;![CDATA[$P{ProductsSubReport}]]&gt;&lt;/subreportExpression&gt;
&lt;/subreport&gt;</pre><p>This defines a master report file that
        expects the sub-report to be passed in as an instance of
        <code class="literal">net.sf.jasperreports.engine.JasperReports</code> under the
        parameter <code class="literal">ProductsSubReport</code>. When configuring your
        Jasper view class, you can instruct Spring to load a report file and
        pass into the JasperReports engine as a sub-report using the
        <code class="literal">subReportUrls</code> property:</p><pre class="programlisting">&lt;property name="subReportUrls"&gt;
    &lt;map&gt;
        &lt;entry key="ProductsSubReport" value="/WEB-INF/reports/subReportChild.jrxml"/&gt;
    &lt;/map&gt;
&lt;/property&gt;</pre><p>Here, the key of the <code class="interfacename">Map</code>
        corresponds to the name of the sub-report parameter in th report
        design file, and the entry is the URL of the report file. Spring will
        load this report file, compiling it if necessary, and will pass into
        the JasperReports engine under the given key.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jasper-reports-subreports-config-datasources"></a>14.7.4.2.&nbsp;Configuring Sub-Report Data Sources</h4></div></div></div><p>This step is entirely optional when using Spring configure your
        sub-reports. If you wish, you can still configure the data source for
        your sub-reports using static queries. However, if you want Spring to
        convert data returned in your <code class="literal">ModelAndView</code> into
        instances of <code class="literal">JRDataSource</code> then you need to specify
        which of the parameters in your <code class="literal">ModelAndView</code> Spring
        should convert. To do this configure the list of parameter names using
        the <code class="literal">subReportDataKeys</code> property of the your chosen
        view class: </p><pre class="programlisting">&lt;property name="subReportDataKeys"
    value="SubReportData"/&gt;</pre><p> Here, the key you supply MUST
        correspond to both the key used in your <code class="literal">ModelAndView</code>
        and the key used in your report design file.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jasper-reports-exporter-parameters"></a>14.7.5.&nbsp;Configuring Exporter Parameters</h3></div></div></div><p>If you have special requirements for exporter configuration -
      perhaps you want a specific page size for your PDF report, then you can
      configure these exporter parameters declaratively in your Spring
      configuration file using the <code class="literal">exporterParameters</code>
      property of the view class. The <code class="literal">exporterParameters</code>
      property is typed as <code class="interfacename">Map</code> and in your configuration
      the key of an entry should be the fully-qualified name of a static field
      that contains the exporter parameter definition and the value of an
      entry should be the value you want to assign to the parameter. An
      example of this is shown below:</p><pre class="programlisting">&lt;bean id="htmlReport" class="org.springframework.web.servlet.view.jasperreports.JasperReportsHtmlView"&gt;
  &lt;property name="url" value="/WEB-INF/reports/simpleReport.jrxml"/&gt;
  &lt;property name="exporterParameters"&gt;
    &lt;map&gt;
      &lt;entry key="net.sf.jasperreports.engine.export.JRHtmlExporterParameter.HTML_FOOTER"&gt;
        &lt;value&gt;Footer by Spring!
          &amp;lt;/td&amp;gt;&amp;lt;td width="50%"&amp;gt;&amp;amp;nbsp; &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
          &amp;lt;/table&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;
        &lt;/value&gt;
      &lt;/entry&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>Here you can see that the <code class="classname">JasperReportsHtmlView</code> is
      being configured with an exporter parameter for
      <code class="literal">net.sf.jasperreports.engine.export.JRHtmlExporterParameter.HTML_FOOTER</code>
      which will output a footer in the resulting HTML.</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="webintegration"></a>Chapter&nbsp;15.&nbsp;Integrating with other web frameworks</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="intro"></a>15.1.&nbsp;Introduction</h2></div></div></div><p>
            This chapter details Spring's integration with third party web frameworks
            such as <a href="http://struts.apache.org/" target="_top">Struts</a>,
            <a href="http://java.sun.com/javaee/javaserverfaces/" target="_top">JSF</a>,
            <a href="http://jakarta.apache.org/tapestry/" target="_top">Tapestry</a>, and
            <a href="http://www.opensymphony.com/webwork/" target="_top">WebWork</a>.
        </p><div class="sidebar"><p class="title"><b>Spring WebFlow</b></p><p>Spring Web Flow (SWF) aims to be the best solution for the management of web application page flow.</p><p>SWF integrates with existing frameworks like Spring MVC, Struts, and JSF, in both servlet and
	portlet environments. If you have a business process (or processes) that would benefit from a
	conversational model as opposed to a purely request model, then SWF may be the solution.</p><p>SWF allows you to capture logical page flows as self-contained modules that are reusable in different
	situations, and as such is ideal for building web application modules that guide the user through controlled
	navigations that drive business processes.</p><p>For more information about SWF, consult the
    <a href="http://opensource.atlassian.com/confluence/spring/display/WEBFLOW/Home/" target="_top">Spring WebFlow site</a>.</p></div><p>
            One of the core value propositions of the Spring Framework is that of
            enabling <span class="emphasis"><em>choice</em></span>. In a general sense, Spring does not
            force one to use or buy into any particular architecture, technology, or
            methodology (although it certainly recommends some over others). This freedom
            to pick and choose the architecture, technology, or methodology that is most
            relevant to a developer and his or her development team is arguably most evident
            in the web area, where Spring provides its own web framework
            (<a href="#mvc" title="Chapter&nbsp;13.&nbsp;Web MVC framework">SpringMVC</a>), while at the same time providing integration
            with a number of popular third party web frameworks. This allows one to continue
            to leverage any and all of the skills one may have acquired in a
            particular web framework such as Struts, while at the same time being able to
            enjoy the benefits afforded by Spring in other areas such as data access,
            declarative transaction management, and flexible configuration and application
            assembly.
        </p><p>
            Having dispensed with the woolly sales patter (c.f. the previous paragraph),
            the remainder of this chapter will concentrate upon the meaty details of
            integrating your favourite web framework with Spring. One thing that is often
            commented upon by developers coming to Java from other languages is the seeming
            super-abundance of web frameworks available in Java... there are indeed a great
            number of web frameworks in the Java space; in fact there are far too many to
            cover with any semblance of detail in a single chapter. This chapter thus picks
            four of the more popular web frameworks in Java, starting with the Spring
            configuration that is common to all of the supported web frameworks, and then
            detailing the specific integration options for each supported web framework.
        </p><p>
			<span class="emphasis"><em>
				Please note that this chapter does not attempt to explain how to use any
				of the supported web frameworks. For example, if you want to use Struts for
				the presentation layer of your web application, the assumption is that you
				are already familiar with Struts. If you need further details about any of
				the supported web frameworks themselves, please do consult the section
				entitled <a href="#webintegration-resources" title="15.7.&nbsp;Further Resources">Section&nbsp;15.7, &#8220;Further Resources&#8221;</a> at the end of this chapter.
            </em></span>
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="webintegration-common"></a>15.2.&nbsp;Common configuration</h2></div></div></div><p>
            Before diving into the integration specifics of each supported web framework, let
            us first take a look at the Spring configuration that <span class="emphasis"><em>not</em></span>
            specific to any one web framework. (This section is equally applicable to Spring's
            own web framework, SpringMVC.)
        </p><p>
            One of the concepts (for want of a better word) espoused by (Spring's) lightweight
            application model is that of a layered architecture. Remember that in a 'classic'
            layered architecture, the web layer is but one of many layers... it serves as one
            of the entry points into a server side application, and it delegates to service
            objects (facades) defined in a service layer to satisfy business specific (and
            presentation-technology agnostic) use cases. In Spring, these service objects,
            any other business-specific objects, data access objects, etc. exist in a
            distinct 'business context', which contains <span class="emphasis"><em>no</em></span> web or
            presentation layer objects (presentation objects such as Spring MVC controllers
            are typically configured in a distinct 'presentation context'). This section
            details how one configures a Spring container (a
            <code class="classname">WebApplicationContext</code>) that contains all of the
            'business beans' in one's application.
        </p><p>
			Onto specifics... all that one need do is to declare a
			<a href="http://www.springframework.org/docs/api/org/springframework/web/context/ContextLoaderListener.html" target="_top"><code class="classname">ContextLoaderListener</code></a>
			in the standard J2EE servlet <code class="literal">web.xml</code> file of one's web application,
			and add a <code class="literal">contextConfigLocation</code> &lt;context-param/&gt; section
			(in the same file) that defines which set of Spring XML cpnfiguration files to load.
		</p><p>
			Find below the &lt;listener/&gt; configuration:
		</p><pre class="programlisting">&lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
&lt;/listener&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
				Listeners were added to the Servlet API in version 2.3. If you have a Servlet 2.2
				container, you can use the
				<a href="http://www.springframework.org/docs/api/org/springframework/web/context/ContextLoaderServlet.html" target="_top"><code class="classname">ContextLoaderServlet</code></a>
				to achieve this same functionality.
			</p></td></tr></table></div><p>
			Find below the &lt;context-param/&gt; configuration:
		</p><pre class="programlisting">&lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;/WEB-INF/applicationContext*.xml&lt;/param-value&gt;
&lt;/context-param&gt;</pre><p>
			If you don't specify the <code class="literal">contextConfigLocation</code> 
			context parameter, the <code class="classname">ContextLoaderListener</code> will look 
			for a file called <code class="literal">/WEB-INF/applicationContext.xml</code> to load. 
			Once the context files are loaded, Spring creates a
			<a href="http://www.springframework.org/docs/api/org/springframework/web/context/WebApplicationContext.html" target="_top"><code class="classname">WebApplicationContext</code></a>
			object based on the bean definitions and stores it in the
			<span class="interface">ServletContext</span> of one's web application.
		</p><p>
			All Java web frameworks are built on top of the Servlet API, and so one can
			use the following code snippet to get access to this 'business context'
			<span class="interface">ApplicationContext</span> created by the
			<code class="classname">ContextLoaderListener</code>.
		</p><pre class="programlisting">WebApplicationContext ctx = WebApplicationContextUtils.getWebApplicationContext(servletContext);</pre><p>
			The <a href="http://www.springframework.org/docs/api/org/springframework/web/context/support/WebApplicationContextUtils.html" target="_top"><code class="classname">WebApplicationContextUtils</code></a>
			class is for convenience, so you don't have to remember the name of the
			<span class="interface">ServletContext</span> attribute. Its <span class="emphasis"><em>getWebApplicationContext()</em></span>
			method will return <code class="literal">null</code> if an object doesn't exist under the
			<code class="literal">WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE</code> key. Rather
			than risk getting <code class="classname">NullPointerExceptions</code> in your application, it's
			better to use the <code class="literal">getRequiredWebApplicationContext()</code> method. This
			method throws an exception when the <span class="interface">ApplicationContext</span> is missing.
		</p><p>
			Once you have a reference to the <code class="classname">WebApplicationContext</code>, 
			you can retrieve beans by their name or type. Most developers retrieve beans 
			by name, then cast them to one of their implemented interfaces.
		</p><p>
			Fortunately, most of the frameworks in this section have simpler ways of looking up
			beans. Not only do they make it easy to get beans from a Spring container, but they
			also allow you to use dependency injection on their controllers. Each web framework
			section has more detail on its specific integration strategies.
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jsf"></a>15.3.&nbsp;JavaServer Faces</h2></div></div></div><p>
			JavaServer Faces (JSF) is an increasingly popular component-based, event-driven
			web framework. The key class in Spring's JSF integration is the
			<code class="classname">DelegatingVariableResolver</code> class.
		</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jsf-delegatingvariableresolver"></a>15.3.1.&nbsp;DelegatingVariableResolver</h3></div></div></div><p>
				The easiest way to integrate one's Spring middle-tier with one's JSF 
				web layer is to use the 
				<a href="http://www.springframework.org/docs/api/org/springframework/web/jsf/DelegatingVariableResolver.html" target="_top">
				<code class="classname">DelegatingVariableResolver</code></a> class. To configure 
				this variable resolver in one's application, one will need to edit one's 
				<span class="emphasis"><em>faces-context.xml</em></span> file. After the opening
				<code class="literal">&lt;faces-config/&gt;</code> element, add an <code class="literal">&lt;application/&gt;</code> 
				element and a <code class="literal">&lt;variable-resolver/&gt;</code> element within it.  
				The value of the variable resolver should reference Spring's 
				<code class="classname">DelegatingVariableResolver</code>; for example:	</p><pre class="programlisting">&lt;faces-config&gt;
  &lt;application&gt;
    &lt;variable-resolver&gt;org.springframework.web.jsf.DelegatingVariableResolver&lt;/variable-resolver&gt;
      &lt;locale-config&gt;
        &lt;default-locale&gt;en&lt;/default-locale&gt;
        &lt;supported-locale&gt;en&lt;/supported-locale&gt;
        &lt;supported-locale&gt;es&lt;/supported-locale&gt;
      &lt;/locale-config&gt;
      &lt;message-bundle&gt;messages&lt;/message-bundle&gt;
    &lt;/application&gt;
&lt;/faces-config&gt;</pre><p>
				The <code class="classname">DelegatingVariableResolver</code> will first delegate value
				lookups to the default resolver of the underlying JSF implementation, and
				then to Spring's 'business context' <code class="classname">WebApplicationContext</code>.
				This allows one to easily inject dependencies into one's JSF-managed beans.
			</p><p>
				Managed beans are defined in one's <code class="literal">faces-config.xml</code> 
				file. Find below an example where <code class="literal">#{userManager}</code> is a bean
				that is retrieved from the Spring 'business context'.
			</p><pre class="programlisting">&lt;managed-bean&gt;
  &lt;managed-bean-name&gt;userList&lt;/managed-bean-name&gt;
	&lt;managed-bean-class&gt;com.whatever.jsf.UserList&lt;/managed-bean-class&gt;
  &lt;managed-bean-scope&gt;request&lt;/managed-bean-scope&gt;
  &lt;managed-property&gt;
    &lt;property-name&gt;userManager&lt;/property-name&gt;
    &lt;value&gt;#{userManager}&lt;/value&gt;
  &lt;/managed-property&gt;
&lt;/managed-bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jsf-facescontextutils"></a>15.3.2.&nbsp;FacesContextUtils</h3></div></div></div><p>
				A custom <code class="interfacename">VariableResolver</code> works well when mapping
				one's properties to beans in <span class="emphasis"><em>faces-config.xml</em></span>, but at times
				one may need to grab a bean explicitly.  The
				<a href="http://www.springframework.org/docs/api/org/springframework/web/jsf/FacesContextUtils.html" target="_top">
				<code class="classname">FacesContextUtils</code></a> class makes this easy. It is
				similar to <code class="classname">WebApplicationContextUtils</code>, except that it
				takes a <code class="classname">FacesContext</code> parameter rather than a
				<span class="interface">ServletContext</span> parameter.
			</p><pre class="programlisting">ApplicationContext ctx = FacesContextUtils.getWebApplicationContext(FacesContext.getCurrentInstance());</pre><p>
				The <code class="classname">DelegatingVariableResolver</code> is the recommended 
				strategy for integrating JSF and Spring. If one is looking for more robust 
				integration features, one might want take a look at the 
				<a href="http://jsf-spring.sourceforge.net/" target="_top">JSF-Spring</a> project.
			</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="struts"></a>15.4.&nbsp;Struts</h2></div></div></div><p>
			<a href="http://struts.apache.org" target="_top">Struts</a> is the
			<span class="emphasis"><em>de facto</em></span> web framework for Java applications, mainly 
			because it was one of the first to be released (June 2001). Invented by 
			Craig McClanahan, Struts is an open source project hosted by the Apache 
			Software Foundation. At the time, it greatly simplified the JSP/Servlet 
			programming paradigm and won over many developers who were using 
			proprietary frameworks. It simplified the programming model, it was open 
			source (and thus free as in beer), and it had a large community, which allowed
			the project to grow and become popular among Java web developers.
		</p><p>
			To integrate your Struts application with Spring, you have two options:
		</p><div class="itemizedlist"><ul type="disc"><li><p>
   					Configure Spring to manage your Actions as beans, using the 
					<code class="classname">ContextLoaderPlugin</code>, and set their 
					dependencies in a Spring context file.
				</p></li><li><p>
   					Subclass Spring's <code class="classname">ActionSupport</code> 
					classes and grab your Spring-managed beans explicitly using 
					a <span class="emphasis"><em>getWebApplicationContext()</em></span> method.
				</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="struts-contextloaderplugin"></a>15.4.1.&nbsp;ContextLoaderPlugin</h3></div></div></div><p>
				The <a href="http://www.springframework.org/docs/api/org/springframework/web/struts/ContextLoaderPlugIn.html" target="_top"><code class="classname">ContextLoaderPlugin</code></a>
				is a Struts 1.1+ plug-in that loads a Spring context file for the Struts 
				<code class="classname">ActionServlet</code>. This context refers to the root 
				<code class="classname">WebApplicationContext</code> (loaded by the 
				<code class="classname">ContextLoaderListener</code>) as its parent. The default 
				name of the context file is the name of the mapped servlet, plus 
				<span class="emphasis"><em>-servlet.xml</em></span>. If <code class="classname">ActionServlet</code> 
				is defined in web.xml as 
				<code class="literal">&lt;servlet-name&gt;action&lt;/servlet-name&gt;</code>, the 
				default is <span class="emphasis"><em>/WEB-INF/action-servlet.xml</em></span>.
			</p><p>
				To configure this plug-in, add the following XML to the plug-ins section near
				the bottom of your <span class="emphasis"><em>struts-config.xml</em></span> file:
			</p><pre class="programlisting">&lt;plug-in className="org.springframework.web.struts.ContextLoaderPlugIn"/&gt;</pre><p>
				The location of the context configuration files can be customized using the
				'<code class="literal">contextConfigLocation</code>' property.
            </p><pre class="programlisting">&lt;plug-in className="org.springframework.web.struts.ContextLoaderPlugIn"&gt;
  &lt;set-property property="contextConfigLocation"
      value="/WEB-INF/action-servlet.xml,/WEB-INF/applicationContext.xml"/&gt;
&lt;/plug-in&gt;</pre><p>
				It is possible to use this plugin to load all your context files, which can be
				useful when using testing tools like StrutsTestCase. StrutsTestCase's
				<code class="classname">MockStrutsTestCase</code> won't initialize Listeners on startup
				so putting all your context files in the plugin is a workaround. (A 
				<a href="http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1088866&amp;group_id=39190&amp;atid=424562" target="_top">
				bug has been filed</a> for this issue, but has been closed as 'Wont Fix').
			</p><p>
				After configuring this plug-in in <span class="emphasis"><em>struts-config.xml</em></span>, you can
				configure your <code class="classname">Action</code> to be managed by Spring. Spring (1.1.3+)
				provides two ways to do this:
			</p><div class="itemizedlist"><ul type="disc"><li><p>
	   					Override Struts' default <code class="classname">RequestProcessor</code>
						with Spring's <code class="classname">DelegatingRequestProcessor</code>.
						</p></li><li><p>
	   					Use the <code class="classname">DelegatingActionProxy</code> class 
						in the <code class="literal">type</code> attribute of your
						<code class="literal">&lt;action-mapping&gt;</code>.
					</p></li></ul></div><p>
				Both of these methods allow you to manage your Actions and 
				their dependencies in the <span class="emphasis"><em>action-servlet.xml</em></span> file.
				The bridge between the Action in <span class="emphasis"><em>struts-config.xml</em></span> 
				and <span class="emphasis"><em>action-servlet.xml</em></span> is built with the 
				action-mapping's "path" and the bean's "name". If you have the 
				following in your <span class="emphasis"><em>struts-config.xml</em></span> file:
			</p><pre class="programlisting">&lt;action path="/users" .../&gt;</pre><p>
				You must define that Action's bean with the "/users" name in
				<span class="emphasis"><em>action-servlet.xml</em></span>:
			</p><pre class="programlisting">&lt;bean name="/users" .../&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="struts-delegatingrequestprocessor"></a>15.4.1.1.&nbsp;DelegatingRequestProcessor</h4></div></div></div><p>
					To configure the <a href="http://www.springframework.org/docs/api/org/springframework/web/struts/DelegatingRequestProcessor.html" target="_top">
					<code class="literal">DelegatingRequestProcessor</code></a> in your 
					<span class="emphasis"><em>struts-config.xml</em></span> file, override the "processorClass" 
					property in the &lt;controller&gt; element. These lines follow the 
					&lt;action-mapping&gt; element.
				</p><pre class="programlisting">&lt;controller&gt;
  &lt;set-property property="processorClass"
      value="org.springframework.web.struts.DelegatingRequestProcessor"/&gt;
&lt;/controller&gt;</pre><p>
					After adding this setting, your Action will automatically be 
					looked up in Spring's context file, no matter what the type. In fact, 
					you don't even need to specify a type. Both of the following snippets 
					will work:
				</p><pre class="programlisting">&lt;action path="/user" type="com.whatever.struts.UserAction"/&gt;		
&lt;action path="/user"/&gt;</pre><p>
					If you're using Struts' <span class="emphasis"><em>modules</em></span> feature, 
					your bean names must contain the module prefix. For example, an action 
					defined as <code class="literal">&lt;action path="/user"/&gt;</code> with module 
					prefix "admin" requires a bean name with
					<code class="literal">&lt;bean name="/admin/user"/&gt;</code>.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
						If you are using Tiles in your Struts application, you must configure your
						&lt;controller&gt; with the
						<a href="http://www.springframework.org/docs/api/org/springframework/web/struts/DelegatingTilesRequestProcessor.html" target="_top"><code class="classname">DelegatingTilesRequestProcessor</code></a>
						instead.
					</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="struts-delegatingactionproxy"></a>15.4.1.2.&nbsp;DelegatingActionProxy</h4></div></div></div><p>
					If you have a custom <code class="classname">RequestProcessor</code> and 
					can't use the <code class="classname">DelegatingRequestProcessor</code> or
					<code class="classname">DelegatingTilesRequestProcessor</code> approaches, you can 
					use the <a href="http://www.springframework.org/docs/api/org/springframework/web/struts/DelegatingActionProxy.html" target="_top">
					<code class="classname">DelegatingActionProxy</code></a> as the type in your 
					action-mapping.
				</p><pre class="programlisting">&lt;action path="/user" type="org.springframework.web.struts.DelegatingActionProxy"
    name="userForm" scope="request" validate="false" parameter="method"&gt;
  &lt;forward name="list" path="/userList.jsp"/&gt;
  &lt;forward name="edit" path="/userForm.jsp"/&gt;
&lt;/action&gt;</pre><p>
					The bean definition in <span class="emphasis"><em>action-servlet.xml</em></span> 
					remains the same, whether you use a custom <code class="literal">RequestProcessor</code>
					or the <code class="classname">DelegatingActionProxy</code>.
				</p><p>
					If you define your <code class="classname">Action</code> in a context file, the
					full feature set of Spring's bean container will be available for it:
					dependency injection as well as the option to instantiate a new
					<code class="classname">Action</code> instance for each request. To activate the latter,
					add <span class="emphasis"><em>scope="prototype"</em></span> to your Action's bean definition.
				</p><pre class="programlisting">&lt;bean name="/user" scope="prototype" autowire="byName"
    class="org.example.web.UserAction"/&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="struts-actionsupport"></a>15.4.2.&nbsp;ActionSupport Classes</h3></div></div></div><p>
				As previously mentioned, you can retrieve the
				<code class="classname">WebApplicationContext</code> from the <span class="interface">ServletContext</span>
				using the <code class="classname">WebApplicationContextUtils</code> class. An
				easier way is to extend	Spring's <code class="classname">Action</code> classes for
				Struts. For example, instead of subclassing Struts'
				<code class="classname">Action</code> class, you can subclass Spring's
				<a href="http://www.springframework.org/docs/api/org/springframework/web/struts/ActionSupport.html" target="_top">
				<code class="classname">ActionSupport</code></a> class.
			</p><p>
				The <code class="classname">ActionSupport</code> class provides additional
				convenience methods, like <span class="emphasis"><em>getWebApplicationContext()</em></span>.
				Below is an example of how you might use this in an Action:
			</p><pre class="programlisting">public class UserAction extends DispatchActionSupport {

    public ActionForward execute(ActionMapping mapping,
                                 ActionForm form,
                                 HttpServletRequest request,
                                 HttpServletResponse response) throws Exception {
        if (log.isDebugEnabled()) {
            log.debug("entering 'delete' method...");
        }
        WebApplicationContext ctx = getWebApplicationContext();
        UserManager mgr = (UserManager) ctx.getBean("userManager");
        // talk to manager for business logic
        return mapping.findForward("success");
    }
}</pre><p>
			Spring includes subclasses for all of the standard Struts Actions
			- the Spring versions merely have <span class="emphasis"><em>Support</em></span> appended to the name:
			</p><div class="itemizedlist"><ul type="disc" compact><li><p><a href="http://www.springframework.org/docs/api/org/springframework/web/struts/ActionSupport.html" target="_top"><code class="classname">ActionSupport</code></a>,</p></li><li><p><a href="http://www.springframework.org/docs/api/org/springframework/web/struts/DispatchActionSupport.html" target="_top"><code class="literal">DispatchActionSupport</code></a>,</p></li><li><p><a href="http://www.springframework.org/docs/api/org/springframework/web/struts/LookupDispatchActionSupport.html" target="_top"><code class="literal">LookupDispatchActionSupport</code></a> and</p></li><li><p><a href="http://www.springframework.org/docs/api/org/springframework/web/struts/MappingDispatchActionSupport.html" target="_top"><code class="literal">MappingDispatchActionSupport</code></a>.</p></li></ul></div><p>
		</p><p>
			The recommended strategy is to use the approach that best suits
			your project. Subclassing makes your code more readable, and you know
			exactly how your dependencies are resolved. However, using the
			<code class="classname">ContextLoaderPlugin</code> allow you to easily add new
			dependencies in your context XML file. Either way, Spring provides some
			nice options for integrating the two frameworks.
			</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-tapestry"></a>15.5.&nbsp;Tapestry</h2></div></div></div><p>
			From the <a href="http://jakarta.apache.org/tapestry/" target="_top">Tapestry homepage</a>...
		</p>&#8220;<span class="quote">
			<span class="emphasis"><em>
				Tapestry is an open-source framework for creating dynamic, robust, highly
				scalable web applications in Java. Tapestry complements and builds upon
				the standard Java Servlet API, and so it works in any servlet container or
				application server.
			</em></span>
		</span>&#8221;<p>
			While Spring has its own <a href="#mvc" title="Chapter&nbsp;13.&nbsp;Web MVC framework">powerful web layer</a>, there
			are a number of unique advantages to building a J2EE application using a
			combination of Tapestry for the web	user interface and the Spring container
			for the lower layers. This section of the web integration chapter attempts
			to detail a few best practices for combining these two frameworks.
		</p><p>
			A <span class="emphasis"><em>typical</em></span> layered J2EE application built with Tapestry
			and Spring will consist of a top user interface (UI) layer built with Tapestry,
			and a number of lower layers, all wired together by one or more Spring containers.
			Tapestry's own
			<a href="http://jakarta.apache.org/tapestry/UsersGuide/hivemind.html" target="_top">reference documentation</a> 
			contains the following snippet of best practice advice. (Text that I the author
			have added is contained within <code class="literal">[]</code> brackets.)
		</p>&#8220;<span class="quote">
			<span class="emphasis"><em>
				A very succesful design pattern in Tapestry is to keep pages and components
				very simple, and <span class="bold"><strong>delegate</strong></span> as much logic as
				possible out to HiveMind [or Spring, or whatever] services. Listener methods
				should ideally do little more than marshall together the correct information
				and pass it over to a service.
			</em></span>
		</span>&#8221;<p>
            The key question then is... how does one supply Tapestry pages with collaborating
            services? The answer, ideally, is that one would want to dependency inject those
            services directly into one's Tapestry pages. In Tapestry, one can effect this
            dependency injection by a
            <a href="http://jakarta.apache.org/tapestry/UsersGuide/injection.html" target="_top">variety of means</a>...
            this section is only going to enumerate the dependency injection means afforded
            by Spring. The real beauty of the rest of this Spring-Tapestry integration is that
            the elegant and flexible design of Tapestry itself makes doing this dependency
            injection of Spring-managed beans a cinch. (Another nice thing is that this
            Spring-Tapestry itegration code was written - and continues to be maintained - by
            the Tapestry creator
            <a href="http://howardlewisship.com/blog/" target="_top">Howard M. Lewis Ship</a>, so hats
            off to him for what is really some silky smooth integration).
        </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-tapestry-di"></a>15.5.1.&nbsp;Injecting Spring-managed beans</h3></div></div></div><p>
				Assume we have the following simple Spring container definition (in the
				ubiquitous XML format):
			</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" 
        "http://www.springframework.org/dtd/spring-beans-2.0.dtd"&gt;
 
&lt;beans&gt;
    &lt;!-- the DataSource --&gt;
    &lt;bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
        &lt;property name="jndiName" value="java:DefaultDS"/&gt;
    &lt;/bean&gt;

    &lt;bean id="hibSessionFactory" 
          class="org.springframework.orm.hibernate.LocalSessionFactoryBean"&gt;
        &lt;property name="dataSource" ref="dataSource"/&gt;
    &lt;/bean&gt;

    &lt;bean id="transactionManager" 
          class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;

    &lt;bean id="mapper" 
          class="com.whatever.dataaccess.mapper.hibernate.MapperImpl"&gt;
        &lt;property name="sessionFactory" ref="hibSessionFactory"/&gt;
    &lt;/bean&gt;

    &lt;!-- (transactional) AuthenticationService --&gt;
    &lt;bean id="authenticationService" 
          class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"&gt;
        &lt;property name="transactionManager" ref="transactionManager"/&gt;
        &lt;property name="target"&gt;
            &lt;bean class="com.whatever.services.service.user.AuthenticationServiceImpl"&gt;
                &lt;property name="mapper" ref="mapper"/&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
        &lt;property name="proxyInterfacesOnly" value="true"/&gt;
        &lt;property name="transactionAttributes"&gt;
            &lt;value&gt;
                *=PROPAGATION_REQUIRED
            &lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;  
 
    &lt;!-- (transactional) UserService --&gt;
    &lt;bean id="userService" 
          class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"&gt;
        &lt;property name="transactionManager" ref="transactionManager"/&gt;
        &lt;property name="target"&gt;
             &lt;bean class="com.whatever.services.service.user.UserServiceImpl"&gt;
                 &lt;property name="mapper" ref="mapper"/&gt;
             &lt;/bean&gt;
        &lt;/property&gt;
        &lt;property name="proxyInterfacesOnly" value="true"/&gt;
        &lt;property name="transactionAttributes"&gt;
            &lt;value&gt;
                *=PROPAGATION_REQUIRED
            &lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;  
 
 &lt;/beans&gt;</pre><p>
	            Inside the Tapestry application, the above bean definitions need to
	            be <a href="#webintegration-common" title="15.2.&nbsp;Common configuration">loaded into a Spring container</a>,
	            and any relevant Tapestry pages need to be supplied (injected) with the
	            <code class="literal">authenticationService</code> and
	            <code class="literal">userService</code> beans, which implement the
				<code class="interfacename">AuthenticationService</code> and
				<code class="interfacename">UserService</code> interfaces, respectively.
			</p><p>
				At this point, the application context is available to a web
				application by calling Spring's static utility function
				<code class="literal">WebApplicationContextUtils.getApplicationContext(servletContext)</code>,
				where servletContext is the standard <span class="interface">ServletContext</span>
				from the J2EE Servlet specification. As such, one simple mechanism for
				a page to get an instance of the <code class="interfacename">UserService</code>,
				for example, would be with code such as:
			</p><pre class="programlisting">WebApplicationContext appContext = WebApplicationContextUtils.getApplicationContext(
    getRequestCycle().getRequestContext().getServlet().getServletContext());
UserService userService = (UserService) appContext.getBean("userService");
<em class="lineannotation"><span class="lineannotation">... some code which uses UserService</span></em></pre><p>
				This mechanism does work... having said that, it can be made a
				lot less verbose by encapsulating most of the functionality in a
				method in the base class for the page or component. However, in
				some respects it goes against the IoC principle; ideally you would like the page to
				not have to ask the context for a specific bean by name, and in
				fact, the page would ideally not know about the context at all.
			</p><p>
				Luckily, there is a mechanism to allow this. We rely upon the
				fact that Tapestry already has a mechanism to declaratively add
				properties to a page, and it is in fact the preferred approach to
				manage all properties on a page in this declarative fashion, so that
				Tapestry can properly manage their lifecycle as part of the page and
				component lifecycle.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
			        This next section is applicable to versions of Tapestry &lt; 4.0.
			        if you are using Tapestry version 4.0+, please consult the section
			        entitled <a href="#view-tapestry-40-style-di" title="15.5.1.4.&nbsp;Dependency Injecting Spring Beans into Tapestry pages - Tapestry 4.0+ style">Section&nbsp;15.5.1.4, &#8220;Dependency Injecting Spring Beans into Tapestry pages - Tapestry 4.0+ style&#8221;</a>.
				</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-tapestry-pre40-style-di"></a>15.5.1.1.&nbsp;Dependency Injecting Spring Beans into Tapestry pages</h4></div></div></div><p>
					First we need to make the <span class="interface">ApplicationContext</span>
					available to the Tapestry page or Component without having to have the
					<span class="interface">ServletContext</span>; this is because at the stage in the
					page's/component's lifecycle when we need to access the
					<span class="interface">ApplicationContext</span>, the
					<span class="interface">ServletContext</span> won't be easily available to the
					page, so we can't use
					<code class="literal">WebApplicationContextUtils.getApplicationContext(servletContext)</code>
					directly. One way is by defining a custom version of the Tapestry
					<code class="interfacename">IEngine</code> which exposes this for us:
				</p><pre class="programlisting">package com.whatever.web.xportal;

import ...

public class MyEngine extends org.apache.tapestry.engine.BaseEngine {
 
    public static final String APPLICATION_CONTEXT_KEY = "appContext";
 
    /**
     * @see org.apache.tapestry.engine.AbstractEngine#setupForRequest(org.apache.tapestry.request.RequestContext)
     */
    protected void setupForRequest(RequestContext context) {
        super.setupForRequest(context);
     
        // insert ApplicationContext in global, if not there
        Map global = (Map) getGlobal();
        ApplicationContext ac = (ApplicationContext) global.get(APPLICATION_CONTEXT_KEY);
        if (ac == null) {
            ac = WebApplicationContextUtils.getWebApplicationContext(
                context.getServlet().getServletContext()
            );
            global.put(APPLICATION_CONTEXT_KEY, ac);
        }
    }
}</pre><p>
					This engine class places the Spring Application Context as
					an attribute called "appContext" in this Tapestry app's 'Global'
					object. Make sure to register the fact that this special IEngine
					instance should be used for this Tapestry application, with an entry
					in the Tapestry application definition file. For example:
				</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">file: xportal.application:</span></em> 
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE application PUBLIC 
    "-//Apache Software Foundation//Tapestry Specification 3.0//EN" 
    "http://jakarta.apache.org/tapestry/dtd/Tapestry_3_0.dtd"&gt;
&lt;application
    name="Whatever xPortal"
    engine-class="com.whatever.web.xportal.MyEngine"&gt;
&lt;/application&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-tapestry-componentdefs"></a>15.5.1.2.&nbsp;Component definition files</h4></div></div></div><p>
					Now in our page or component definition file (*.page or *.jwc),
					we simply add property-specification elements to grab the beans we
					need out of the <code class="interfacename">ApplicationContext</code>,
					and create page or component properties for them. For example:
				</p><pre class="programlisting">    &lt;property-specification name="userService"
                            type="com.whatever.services.service.user.UserService"&gt;
        global.appContext.getBean("userService")
    &lt;/property-specification&gt;
    &lt;property-specification name="authenticationService"
                            type="com.whatever.services.service.user.AuthenticationService"&gt;
        global.appContext.getBean("authenticationService")
    &lt;/property-specification&gt;</pre><p>
					The OGNL expression	inside the property-specification specifies the
					initial value for the property, as a bean obtained from the context.
					The entire page definition might look like this:
				</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE page-specification PUBLIC 
    "-//Apache Software Foundation//Tapestry Specification 3.0//EN" 
    "http://jakarta.apache.org/tapestry/dtd/Tapestry_3_0.dtd"&gt;
     
&lt;page-specification class="com.whatever.web.xportal.pages.Login"&gt;
 
    &lt;property-specification name="username" type="java.lang.String"/&gt;
    &lt;property-specification name="password" type="java.lang.String"/&gt;
    &lt;property-specification name="error" type="java.lang.String"/&gt;
    &lt;property-specification name="callback" type="org.apache.tapestry.callback.ICallback" persistent="yes"/&gt;
    &lt;property-specification name="userService"
                            type="com.whatever.services.service.user.UserService"&gt;
        global.appContext.getBean("userService")
    &lt;/property-specification&gt;
    &lt;property-specification name="authenticationService"
                            type="com.whatever.services.service.user.AuthenticationService"&gt;
        global.appContext.getBean("authenticationService")
    &lt;/property-specification&gt;
   
    &lt;bean name="delegate" class="com.whatever.web.xportal.PortalValidationDelegate"/&gt;
 
    &lt;bean name="validator" class="org.apache.tapestry.valid.StringValidator" lifecycle="page"&gt;
        &lt;set-property name="required" expression="true"/&gt;
        &lt;set-property name="clientScriptingEnabled" expression="true"/&gt;
    &lt;/bean&gt;
 
    &lt;component id="inputUsername" type="ValidField"&gt;
        &lt;static-binding name="displayName" value="Username"/&gt;
        &lt;binding name="value" expression="username"/&gt;
        &lt;binding name="validator" expression="beans.validator"/&gt;
    &lt;/component&gt;
   
    &lt;component id="inputPassword" type="ValidField"&gt;
        &lt;binding name="value" expression="password"/&gt;
       &lt;binding name="validator" expression="beans.validator"/&gt;
       &lt;static-binding name="displayName" value="Password"/&gt;
       &lt;binding name="hidden" expression="true"/&gt;
    &lt;/component&gt;
 
&lt;/page-specification&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-tapestry-getters"></a>15.5.1.3.&nbsp;Adding abstract accessors</h4></div></div></div><p>
					Now in the Java class definition for the page or component
					itself, all we need to do is add an abstract getter method
					for the properties we have defined (in order to be able to
					access the properties).
				</p><pre class="programlisting">// our UserService implementation; will come from page definition
public abstract UserService getUserService();
// our AuthenticationService implementation; will come from page definition
public abstract AuthenticationService getAuthenticationService();</pre><p>
					For the sake of completeness, the entire Java class, for a
					login page in this example, might look like this:
				</p><pre class="programlisting">package com.whatever.web.xportal.pages;
 
/**
 *  Allows the user to login, by providing username and password.
 *  After successfully logging in, a cookie is placed on the client browser
 *  that provides the default username for future logins (the cookie
 *  persists for a week).
 */
public abstract class Login extends BasePage implements ErrorProperty, PageRenderListener {
 
    /** the key under which the authenticated user object is stored in the visit as */
    public static final String USER_KEY = "user";
   
    /** The name of the cookie that identifies a user **/
    private static final String COOKIE_NAME = Login.class.getName() + ".username";  
    private final static int ONE_WEEK = 7 * 24 * 60 * 60;
 
    public abstract String getUsername();
    public abstract void setUsername(String username);
 
    public abstract String getPassword();
    public abstract void setPassword(String password);
 
    public abstract ICallback getCallback();
    public abstract void setCallback(ICallback value);
    
    public abstract UserService getUserService();
    public abstract AuthenticationService getAuthenticationService();
 
    protected IValidationDelegate getValidationDelegate() {
        return (IValidationDelegate) getBeans().getBean("delegate");
    }
 
    protected void setErrorField(String componentId, String message) {
        IFormComponent field = (IFormComponent) getComponent(componentId);
        IValidationDelegate delegate = getValidationDelegate();
        delegate.setFormComponent(field);
        delegate.record(new ValidatorException(message));
    }
 
    /**
     *  Attempts to login. 
     * &lt;p&gt;
     *  If the user name is not known, or the password is invalid, then an error
     *  message is displayed.
     **/
    public void attemptLogin(IRequestCycle cycle) {
     
        String password = getPassword();
 
        // Do a little extra work to clear out the password.
        setPassword(null);
        IValidationDelegate delegate = getValidationDelegate();
 
        delegate.setFormComponent((IFormComponent) getComponent("inputPassword"));
        delegate.recordFieldInputValue(null);
 
        // An error, from a validation field, may already have occurred.
        if (delegate.getHasErrors()) {
            return;
        }

        try {
            User user = getAuthenticationService().login(getUsername(), getPassword());
           loginUser(user, cycle);
        }
        catch (FailedLoginException ex) {
            this.setError("Login failed: " + ex.getMessage());
            return;
        }
    }
 
    /**
     *  Sets up the {@link User} as the logged in user, creates
     *  a cookie for their username (for subsequent logins),
     *  and redirects to the appropriate page, or
     *  a specified page).
     **/
    public void loginUser(User user, IRequestCycle cycle) {
     
        String username = user.getUsername();
 
        // Get the visit object; this will likely force the
        // creation of the visit object and an HttpSession
        Map visit = (Map) getVisit();
        visit.put(USER_KEY, user);
 
        // After logging in, go to the MyLibrary page, unless otherwise specified
        ICallback callback = getCallback();
 
        if (callback == null) {
            cycle.activate("Home");
        }
        else {
            callback.performCallback(cycle);
        }

        IEngine engine = getEngine();
        Cookie cookie = new Cookie(COOKIE_NAME, username);
        cookie.setPath(engine.getServletPath());
        cookie.setMaxAge(ONE_WEEK);
 
        // Record the user's username in a cookie
        cycle.getRequestContext().addCookie(cookie);
        engine.forgetPage(getPageName());
    }
   
    public void pageBeginRender(PageEvent event) {
        if (getUsername() == null) {
            setUsername(getRequestCycle().getRequestContext().getCookieValue(COOKIE_NAME));
        }
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-tapestry-40-style-di"></a>15.5.1.4.&nbsp;Dependency Injecting Spring Beans into Tapestry pages - Tapestry 4.0+ style</h4></div></div></div><p>
					Effecting the dependency injection of Spring-managed beans into Tapestry
					pages in Tapestry version 4.0+ is <span class="emphasis"><em>so</em></span> much simpler.
					All that is needed is a single
					<a href="http://howardlewisship.com/tapestry-javaforge/tapestry-spring/" target="_top">add-on library</a>,
					and some (small) amount of (essentially boilerplate) configuration.
					Simply package and deploy this library with the (any of the) other
					libraries required by your web application (typially in
					<code class="literal">WEB-INF/lib</code>).
				</p><p>
					You will then need to create and expose the Spring container using the
					<a href="#webintegration-common" title="15.2.&nbsp;Common configuration">method detailed previously</a>.
					You can then inject Spring-managed beans into Tapestry very easily; if
					we are using Java 5, consider the <code class="classname">Login</code> page from above:
					we simply need to annotate the appropriate getter methods
					in order to dependency inject the Spring-managed <code class="literal">userService</code>
					and <code class="literal">authenticationService</code> objects (lots of the class
					definition has been elided for clarity)...
				</p><pre class="programlisting">package com.whatever.web.xportal.pages;

public abstract class Login extends BasePage implements ErrorProperty, PageRenderListener {
    
    @InjectObject("spring:userService")
    public abstract UserService getUserService();
    
    @InjectObject("spring:authenticationService")
    public abstract AuthenticationService getAuthenticationService();

}</pre><p>
				We are almost done... all that remains is the HiveMind configuration that exposes the
				Spring container stored in the <code class="interfacename">ServletContext</code> as a
				HiveMind service; for example:</p><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;module id="com.javaforge.tapestry.spring" version="0.1.1"&gt;

    &lt;service-point id="SpringApplicationInitializer"
        interface="org.apache.tapestry.services.ApplicationInitializer"
        visibility="private"&gt;
        &lt;invoke-factory&gt;
            &lt;construct class="com.javaforge.tapestry.spring.SpringApplicationInitializer"&gt;
                &lt;set-object property="beanFactoryHolder"
                    value="service:hivemind.lib.DefaultSpringBeanFactoryHolder" /&gt;
            &lt;/construct&gt;
        &lt;/invoke-factory&gt;
    &lt;/service-point&gt;

    &lt;!-- Hook the Spring setup into the overall application initialization. --&gt;
    &lt;contribution
        configuration-id="tapestry.init.ApplicationInitializers"&gt;
        &lt;command id="spring-context"
            object="service:SpringApplicationInitializer" /&gt;
    &lt;/contribution&gt;

&lt;/module&gt;</pre><p>
					If you are using Java 5 (and thus have access to annotations), then
					that really is it.
				</p><p>
		            If you are not using Java 5, then one obviously doesn't annotate one's
		            Tapestry page classes with annotations; instead, one simply uses
		            good old fashioned XML to declare the dependency injection; for example,
		            inside the <code class="literal">.page</code> or <code class="literal">.jwc</code> file
		            for the <code class="classname">Login</code> page (or component):
				</p><pre class="programlisting">&lt;inject property="userService" object="spring:userService"/&gt;
&lt;inject property="authenticationService" object="spring:authenticationService"/&gt;</pre></div></div><p>
			In this example, we've managed to allow service beans defined in
			a Spring container to be provided to the Tapestry page in a declarative
			fashion. The page class does not know where the service implementations
			are coming from, and in fact it is easy to slip in another implementation,
			for example, during testing. This inversion	of control is one of the
			prime goals and benefits of the Spring Framework, and we have managed
			to extend it all the way up the J2EE stack in this Tapestry application.
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="webwork"></a>15.6.&nbsp;WebWork</h2></div></div></div><p>
			From the <a href="http://www.opensymphony.com/webwork/" target="_top">WebWork homepage</a>...
		</p>&#8220;<span class="quote">
			<span class="emphasis"><em>
				WebWork is a Java web-application development framework. It is built
				specifically with developer productivity and code simplicity in mind,
				providing robust support for building reusable UI templates, such as form
				controls, UI themes, internationalization, dynamic form parameter mapping
				to JavaBeans, robust client and server side validation, and much more.
			</em></span>
		</span>&#8221;<p>
            WebWork is (in the opinion of this author) a very clean, elegant web framework.
            Its architecture and key concepts are not only very easy to understand, it has
            a rich tag library, nicely decoupled validation, and it is (again, in the opinion
            of this author) quite easy to be productive in next to no time at all (the
            documentation and tutorials are pretty good too).
        </p><p>
            One of the key enablers in WebWork's technology stack is
            <a href="http://www.opensymphony.com/webwork/wikidocs/IoC%20Overview.html" target="_top">an IoC container</a>
            to manage Webwork Actions, handle the "wiring" of business objects, etc.
            Previous to WebWork version 2.2, WebWork used it's own proprietary IoC container
            (and provided integration points so that one could integrate an IoC container
            such as Springs into the mix). However, as of WebWork version 2.2, the default
            IoC container that is used within WebWork <span class="emphasis"><em>is</em></span> Spring. This
            is obviously great news if one is a Spring developer, because it means that one
            is immediately familiar with the basics of IoC configuration, idioms and suchlike
            within WebWork.
        </p><p>
            Now in the interests of adhering to the DRY (Dont Repeat Yourself) principle, it
            would be foolish to writeup the Spring-WebWork integration in light of the fact that
            the WebWork team have already written such a writeup. Please do consult the
            <a href="http://www.opensymphony.com/webwork/wikidocs/Spring.html" target="_top">Spring-WebWork integration page</a>
             on the
            <a href="http://wiki.opensymphony.com/display/WW/WebWork" target="_top">WebWork wiki</a>
             for the full lowdown.
        </p><p>
            Note that the Spring-WebWork integration code was developed (and continues
            to be maintained and improved) by the WebWork developers themselves, so in the
            first instance please do refer to the WebWork site and forums if you are having
            issues with the integration. Do feel free to post comments and queries regarding
			the Spring-WebWork integration on the
			<a href="http://forum.springframework.org/forumdisplay.php?f=25" target="_top">Spring support forums</a>
            too.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="webintegration-resources"></a>15.7.&nbsp;Further Resources</h2></div></div></div><p>
            Find below links to further resources about the various web frameworks
            described in this chapter.
        </p><div class="itemizedlist"><ul type="disc"><li><p>The <a href="http://struts.apache.org/" target="_top">Struts</a> homepage</p></li><li><p>The <a href="http://java.sun.com/javaee/javaserverfaces/" target="_top">JSF</a> homepage</p></li><li><p>The <a href="http://jakarta.apache.org/tapestry/" target="_top">Tapestry</a> homepage</p></li><li><p>The <a href="http://www.opensymphony.com/webwork/" target="_top">WebWork</a> homepage</p></li></ul></div><p>
            Find below some further web framework-related resources that you may find personally enriching.
        </p><div class="itemizedlist"><ul type="disc"><li><p>The <a href="http://wiki.apache.org/struts/StrutsTi" target="_top">StrutsTI</a> project wiki</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="portlet"></a>Chapter&nbsp;16.&nbsp;Portlet MVC Framework</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-introduction"></a>16.1.&nbsp;Introduction</h2></div></div></div><div class="sidebar"><p class="title"><b>JSR-168 The Java Portlet Specification</b></p><p>For more general information about portlet development, please
		    review a whitepaper from Sun entitled 
		    <a href="http://developers.sun.com/prodtech/portalserver/reference/techart/jsr168/" target="_top">"Introduction to JSR 168"</a>,
		    and of course the
		    <a href="http://jcp.org/aboutJava/communityprocess/final/jsr168/" target="_top">JSR-168 Specification</a> itself.</p></div><p>In addition to supporting conventional (servlet-based) Web development,
		Spring also supports JSR-168 Portlet development. As much as possible, the
		Portlet MVC framework is a mirror image of the Web MVC framework, and also
		uses the same underlying view abstractions and integration technology. So, be
		sure to review the chapters entitled <a href="#mvc" title="Chapter&nbsp;13.&nbsp;Web MVC framework">Chapter&nbsp;13, <i>Web MVC framework</i></a> and
		<a href="#view" title="Chapter&nbsp;14.&nbsp;Integrating view technologies">Chapter&nbsp;14, <i>Integrating view technologies</i></a> before continuing with this chapter.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Bear in mind that while the concepts of Spring MVC are the
		    same in Spring Portlet MVC, there are some notable differences
		    created by the unique workflow of JSR-168 portlets.</p></td></tr></table></div><p>The main way in which portlet workflow differs from servlet 
		workflow is that the request to the portlet can have two distinct 
		phases: the action phase and the render phase. The action phase is
		executed only once and is where any 'backend' changes or actions occur, 
		such as making changes in a database. The render phase then produces
		what is displayed to the user each time the display is refreshed.
		The critical point here is that for a single overall request, the action 
		phase is executed only once, but the render phase may be executed 
		multiple times. This provides (and requires) a clean separation between
		the activities that modify the persistent state of your system and the 
		activities that generate what is displayed to the user.</p><div class="sidebar"><p class="title"><b>Spring WebFlow</b></p><p>Spring Web Flow (SWF) aims to be the best solution for the management of web application page flow.</p><p>SWF integrates with existing frameworks like Spring MVC, Struts, and JSF, in both servlet and
	portlet environments. If you have a business process (or processes) that would benefit from a
	conversational model as opposed to a purely request model, then SWF may be the solution.</p><p>SWF allows you to capture logical page flows as self-contained modules that are reusable in different
	situations, and as such is ideal for building web application modules that guide the user through controlled
	navigations that drive business processes.</p><p>For more information about SWF, consult the
    <a href="http://opensource.atlassian.com/confluence/spring/display/WEBFLOW/Home/" target="_top">Spring WebFlow site</a>.</p></div><p>The dual phases of portlet requests are one of the real strengths 
		of the JSR-168 specification. For example, dynamic search results can be
		updated routinely on the display without the user explicitly rerunning 
		the search. Most other portlet MVC frameworks attempt to completely
		hide the two phases from the developer and make it look as much like 
		traditional servlet development as possible - we think this 
		approach removes one of the main benefits of using portlets. So, the
		separation of the two phases is preserved throughout the Spring Portlet 
		MVC framework. The primary manifestation of this approach is that where
		the servlet version of the MVC classes will have one method that deals 
		with the request, the portlet version of the MVC classes will have two 
		methods that deal with the request: one for the action phase and one for 
		the render phase. For example, where the servlet version of
		<code class="classname">AbstractController</code> has the 
		<code class="methodname">handleRequestInternal(..)</code> method, the portlet
		version of <code class="classname">AbstractController</code> has 
		<code class="methodname">handleActionRequestInternal(..)</code> and 
		<code class="methodname">handleRenderRequestInternal(..)</code> methods.</p><p>The framework is designed around a 
		<code class="classname">DispatcherPortlet</code> that dispatches requests to 
		handlers, with configurable handler mappings and view resolution, just 
		as the <code class="classname">DispatcherServlet</code> in the web framework 
		does. File upload is also supported in the same way.</p><p>Locale resolution and theme resolution are not supported in 
		Portlet MVC - these areas are in the purview of the 
		portal/portlet-container and are not appropriate at the Spring level. 
		However, all mechanisms in Spring that depend on the locale (such as 
		internationalization of messages) will still function properly because 
		<code class="classname">DispatcherPortlet</code> exposes the current locale in 
		the same way as <code class="classname">DispatcherServlet</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-introduction-controller"></a>16.1.1.&nbsp;Controllers - The C in MVC</h3></div></div></div><p>The default handler is still a very simple
		    <code class="interfacename">Controller</code> interface, offering just two 
		    methods:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="methodname">void handleActionRequest(request,response)</code> </p></li><li><p><code class="methodname">ModelAndView handleRenderRequest(request,response)</code> </p></li></ul></div><p>The framework also includes most of the same controller
		    implementation hierarchy, such as <code class="classname">AbstractController</code>, 
		    <code class="classname">SimpleFormController</code>, and so on. Data binding,
		    command object usage, model handling, and view resolution are all the 
		    same as in the servlet framework.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-introduction-view"></a>16.1.2.&nbsp;Views - The V in MVC</h3></div></div></div><p>All the view rendering capabilities of the servlet framework are 
		    used directly via a special bridge servlet named 
		    <code class="classname">ViewRendererServlet</code>. By using this servlet, the
		    portlet request is converted into a servlet request and the view can be 
		    rendered using the entire normal servlet infrastructure. This means all
		    the existing renderers, such as JSP, Velocity, etc., can still be used 
		    within the portlet.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-introduction-scope"></a>16.1.3.&nbsp;Web-scoped beans</h3></div></div></div><p>Spring Portlet MVC supports beans whose lifecycle is scoped to the
            current HTTP request or HTTP <code class="interfacename">Session</code> (both
            normal and global). This is not a specific feature of Spring Portlet MVC
            itself, but rather of the <code class="interfacename">WebApplicationContext</code>
            container(s) that Spring Portlet MVC uses. These bean scopes are described
            in detail in the section entitled <a href="#beans-factory-scopes-other" title="3.4.4.&nbsp;The other scopes">Section&nbsp;3.4.4, &#8220;The other scopes&#8221;</a></p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The Spring distribution ships with a complete Spring Portlet MVC
		    sample application that demonstrates all of the features and functionality
		    of the Spring Portlet MVC framework. This 'petportal' application can be found
		    in the <code class="filename">'samples/petportal'</code> directory of
		    the full Spring distribution.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-dispatcher"></a>16.2.&nbsp;The <code class="classname">DispatcherPortlet</code></h2></div></div></div><p>Portlet MVC is a request-driven web MVC framework, designed around 
		a portlet that dispatches requests to controllers and offers other 
		functionality facilitating the development of portlet applications. 
		Spring's <code class="classname">DispatcherPortlet</code> however, does more 
		than just that. It is completely integrated with the Spring 
		<code class="interfacename">ApplicationContext</code> and allows you to use 
		every other feature Spring has.</p><p>Like ordinary portlets, the 
		<code class="classname">DispatcherPortlet</code> is declared in the 
		<code class="literal">portlet.xml</code> of your web application:</p><pre class="programlisting">&lt;portlet&gt;
	&lt;portlet-name&gt;sample&lt;/portlet-name&gt;
	&lt;portlet-class&gt;org.springframework.web.portlet.DispatcherPortlet&lt;/portlet-class&gt;
	&lt;supports&gt;
		&lt;mime-type&gt;text/html&lt;/mime-type&gt;
		&lt;portlet-mode&gt;view&lt;/portlet-mode&gt;
	&lt;/supports&gt;
	&lt;portlet-info&gt;
		&lt;title&gt;Sample Portlet&lt;/title&gt;
	&lt;/portlet-info&gt;
&lt;/portlet&gt;</pre><p>The <code class="classname">DispatcherPortlet</code> now needs to be 
		configured.</p><p>In the Portlet MVC framework, each 
		<code class="classname">DispatcherPortlet</code> has its own 
		<code class="interfacename">WebApplicationContext</code>, which inherits all 
		the beans already defined in the Root 
		<code class="interfacename">WebApplicationContext</code>. These inherited 
		beans can be overridden in the portlet-specific scope, and new scope-
		specific beans can be defined local to a given portlet instance.</p><p>The framework will, on initialization of a 
		<code class="classname">DispatcherPortlet</code>, look for a file named 
		<code class="literal">[portlet-name]-portlet.xml</code> in the <code class="literal">WEB-INF</code>
		directory of your web application and create the beans defined there
		(overriding the definitions of any beans defined with the same name in
		the global scope).</p><p>The config location used by the 
		<code class="classname">DispatcherPortlet</code> can be modified through a 
		portlet initialization parameter (see below for details).</p><p>The Spring <code class="classname">DispatcherPortlet</code> has a few 
		special beans it uses, in order to be able to process requests and 
		render the appropriate views. These beans are included in the Spring 
		framework and can be configured in the 
		<code class="interfacename">WebApplicationContext</code>, just as any other 
		bean would be configured. Each of those beans is described in more 
		detail below. Right now, we'll just mention them, just to let you know 
		they exist and to enable us to go on talking about the 
		<code class="classname">DispatcherPortlet</code>. For most of the beans, 
		defaults are provided so you don't have to worry about configuring 
		them.</p><div class="table"><a name="portlet-webappctx-special-beans-tbl"></a><p class="title"><b>Table&nbsp;16.1.&nbsp;Special beans in the <code class="interfacename">WebApplicationContext</code></b></p><div class="table-contents"><table summary="Special beans in the WebApplicationContext" border="1"><colgroup><col align="left"><col></colgroup><thead><tr><th align="left">Expression</th><th>Explanation</th></tr></thead><tbody><tr><td align="left">handler mapping(s)</td><td>(<a href="#portlet-handlermapping" title="16.5.&nbsp;Handler mappings">Section&nbsp;16.5, &#8220;Handler mappings&#8221;</a>) a 
						list of pre- and post-processors and controllers that 
						will be executed if they match certain criteria (for 
						instance a matching portlet mode specified with the 
						controller)</td></tr><tr><td align="left">controller(s)</td><td>(<a href="#portlet-controller" title="16.4.&nbsp;Controllers">Section&nbsp;16.4, &#8220;Controllers&#8221;</a>) the beans 
						providing the actual functionality (or at least, access 
						to the functionality) as part of the MVC triad</td></tr><tr><td align="left">view resolver</td><td>(<a href="#portlet-viewresolver" title="16.6.&nbsp;Views and resolving them">Section&nbsp;16.6, &#8220;Views and resolving them&#8221;</a>) capable 
						of resolving view names to view definitions</td></tr><tr><td align="left">multipart resolver</td><td>(<a href="#portlet-multipart" title="16.7.&nbsp;Multipart (file upload) support">Section&nbsp;16.7, &#8220;Multipart (file upload) support&#8221;</a>) offers 
						functionality to process file uploads from HTML 
						forms</td></tr><tr><td align="left">handler exception resolver</td><td>(<a href="#portlet-exceptionresolver" title="16.8.&nbsp;Handling exceptions">Section&nbsp;16.8, &#8220;Handling exceptions&#8221;</a>) 
						offers functionality to map exceptions to views or 
						implement other more complex exception handling 
						code</td></tr></tbody></table></div></div><br class="table-break"><p>When a <code class="classname">DispatcherPortlet</code> is setup for use 
		and a request comes in for that specific 
		<code class="classname">DispatcherPortlet</code>, it starts processing the 
		request. The list below describes the complete process a request goes 
		through if handled by a <code class="classname">DispatcherPortlet</code>:</p><div class="orderedlist"><ol type="1"><li><p>The locale returned by 
			<code class="literal">PortletRequest.getLocale()</code> is bound to the 
			request to let elements in the process resolve the locale to use 
			when processing the request (rendering the view, preparing data, 
			etc.).</p></li><li><p>If a multipart resolver is specified and this is an 
			<code class="interfacename">ActionRequest</code>, the request is 
			inspected for multiparts and if they are found, it is wrapped in a 
			<code class="interfacename">MultipartActionRequest</code> for further 
			processing by other elements in the process. (See <a href="#portlet-multipart" title="16.7.&nbsp;Multipart (file upload) support">Section&nbsp;16.7, &#8220;Multipart (file upload) support&#8221;</a> for further information about 
			multipart handling).</p></li><li><p>An appropriate handler is searched for. If a handler 
			is found, the execution chain associated with the handler (pre-
			processors, post-processors, controllers) will be executed in order 
			to prepare a model.</p></li><li><p>If a model is returned, the view is rendered, using 
			the view resolver that has been configured with the 
			<code class="interfacename">WebApplicationContext</code>. If no model is 
			returned (which could be due to a pre- or post-processor 
			intercepting the request, for example, for security reasons), no 
			view is rendered, since the request could already have been 
			fulfilled.</p></li></ol></div><p>Exceptions that might be thrown during processing of the request 
		get picked up by any of the handler exception resolvers that are 
		declared in the <code class="interfacename">WebApplicationContext</code>. 
		Using these exception resolvers you can define custom behavior in case 
		such exceptions get thrown.</p><p>You can customize Spring's <code class="classname">DispatcherPortlet</code>
		by adding context parameters in the <code class="literal">portlet.xml</code> file or
		portlet init-parameters. The possibilities are listed below.</p><div class="table"><a name="portlet-dpp-init-params"></a><p class="title"><b>Table&nbsp;16.2.&nbsp;<code class="classname">DispatcherPortlet</code> initialization parameters</b></p><div class="table-contents"><table summary="DispatcherPortlet initialization parameters" border="1"><colgroup><col align="left"><col></colgroup><thead><tr><th align="left">Parameter</th><th>Explanation</th></tr></thead><tbody><tr><td align="left"><code class="literal">contextClass</code></td><td>Class that implements 
						<code class="interfacename">WebApplicationContext</code>, 
						which will be used to instantiate the context used by 
						this portlet. If this parameter isn't specified, the 
						<code class="classname">XmlPortletApplicationContext</code> will 
						be used.</td></tr><tr><td align="left"><code class="literal">contextConfigLocation</code></td><td>String which is passed to the context instance 
						(specified by <code class="literal">contextClass</code>) to 
						indicate where context(s) can be found. The String is 
						potentially split up into multiple Strings (using a 
						comma as a delimiter) to support multiple contexts (in 
						case of multiple context locations, of beans that are 
						defined twice, the latest takes precedence).</td></tr><tr><td align="left"><code class="literal">namespace</code></td><td>The namespace of the 
						<code class="interfacename">WebApplicationContext</code>. 
						Defaults to <code class="literal">[portlet-name]-
						portlet</code>.</td></tr><tr><td align="left"><code class="literal">viewRendererUrl</code></td><td>The URL at which 
						<code class="classname">DispatcherPortlet</code> can access an 
						instance of <code class="classname">ViewRendererServlet</code> 
						(see <a href="#portlet-viewservlet" title="16.3.&nbsp;The ViewRendererServlet">Section&nbsp;16.3, &#8220;The <code class="classname">ViewRendererServlet</code>&#8221;</a>).</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-viewservlet"></a>16.3.&nbsp;The <code class="classname">ViewRendererServlet</code></h2></div></div></div><p>The rendering process in Portlet MVC is a bit more complex than in 
		Web MVC. In order to reuse all the <a href="#view" title="Chapter&nbsp;14.&nbsp;Integrating view technologies">view technologies</a>
		from Spring Web MVC), we must convert the 
		<code class="interfacename">PortletRequest</code> / 
		<code class="interfacename">PortletResponse</code> to 
		<code class="interfacename">HttpServletRequest</code> / 
		<code class="interfacename">HttpServletResponse</code> and then call the 
		<code class="literal">render</code> method of the 
		<code class="interfacename">View</code>. To do this,
		<code class="classname">DispatcherPortlet</code> uses a special servlet that 
		exists for just this purpose: the 
		<code class="classname">ViewRendererServlet</code>.</p><p>In order for <code class="classname">DispatcherPortlet</code> rendering to 
		work, you must declare an instance of the 
		<code class="classname">ViewRendererServlet</code> in the 
		<code class="literal">web.xml</code> file for your web application as 
		follows:</p><pre class="programlisting">&lt;servlet&gt;
    &lt;servlet-name&gt;ViewRendererServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.ViewRendererServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;ViewRendererServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/WEB-INF/servlet/view&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre><p>To perform the actual rendering, <code class="classname">DispatcherPortlet</code>
		does the following:</p><div class="orderedlist"><ol type="1"><li><p>Binds the 
			<code class="interfacename">WebApplicationContext</code> to the request 
			as an attribute under the same 
			<code class="literal">WEB_APPLICATION_CONTEXT_ATTRIBUTE</code> key that 
			<code class="classname">DispatcherServlet</code> uses.</p></li><li><p>Binds the <code class="interfacename">Model</code> and 
			<code class="interfacename">View</code> objects to the request to make 
			them available to the 
			<code class="classname">ViewRendererServlet</code>.</p></li><li><p>Constructs a 
			<code class="interfacename">PortletRequestDispatcher</code> and performs 
			an <code class="literal">include</code> using the <code class="literal">/WEB-
			INF/servlet/view</code> URL that is mapped to the 
			<code class="classname">ViewRendererServlet</code>.</p></li></ol></div><p>The <code class="classname">ViewRendererServlet</code> is then able to 
		call the <code class="literal">render</code> method on the 
		<code class="interfacename">View</code> with the appropriate 
		arguments.</p><p>The actual URL for the <code class="classname">ViewRendererServlet</code> 
		can be changed using <code class="classname">DispatcherPortlet</code>&#8217;s 
		<code class="literal">viewRendererUrl</code> configuration parameter.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-controller"></a>16.4.&nbsp;Controllers</h2></div></div></div><p>The controllers in Portlet MVC are very similar to the Web MVC 
		Controllers and porting code from one to the other should be 
		simple.</p><p>The basis for the Portlet MVC controller architecture is the 
		<code class="interfacename">org.springframework.web.portlet.mvc.Controller</code> 
		interface, which is listed below.</p><pre class="programlisting">public interface Controller {

    /**
     * Process the render request and return a ModelAndView object which the
     * DispatcherPortlet will render.
     */
    ModelAndView handleRenderRequest(RenderRequest request, RenderResponse response)
        throws Exception;

    /**
     * Process the action request. There is nothing to return.
     */
    void handleActionRequest(ActionRequest request, ActionResponse response)
        throws Exception;

}</pre><p>As you can see, the Portlet 
		<code class="interfacename">Controller</code> interface requires two methods 
		that handle the two phases of a portlet request: the action request and 
		the render request. The action phase should be capable of handling an
		action request and the render phase should be capable of handling a 
		render request and returning an appropriate model and view. While the
		<code class="interfacename">Controller</code> interface is quite abstract, 
		Spring Portlet MVC offers a lot of controllers that already contain a 
		lot of the functionality you might need &#8211; most of these are very similar 
		to controllers from Spring Web MVC. The 
		<code class="interfacename">Controller</code> interface just defines the 
		most common functionality required of every controller - handling an 
		action request, handling a render request, and returning a model and a 
		view.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-controller-abstractcontroller"></a>16.4.1.&nbsp;<code class="classname">AbstractController</code> and <code class="classname">PortletContentGenerator</code></h3></div></div></div><p>Of course, just a <code class="interfacename">Controller</code> 
			interface isn't enough. To provide a basic infrastructure, all of 
			Spring Portlet MVC's <code class="interfacename">Controller</code>s 
			inherit from <code class="classname">AbstractController</code>, a class 
			offering access to Spring's 
			<code class="interfacename">ApplicationContext</code> and control over 
			caching.</p><div class="table"><a name="portlet-ac-features"></a><p class="title"><b>Table&nbsp;16.3.&nbsp;Features offered by the <code class="classname">AbstractController</code></b></p><div class="table-contents"><table summary="Features offered by the AbstractController" border="1"><colgroup><col align="left"><col></colgroup><thead><tr><th align="left">Parameter</th><th>Explanation</th></tr></thead><tbody><tr><td align="left"><code class="literal">requireSession</code></td><td>Indicates whether or not this 
							<code class="interfacename">Controller</code> requires a 
							session to do its work. This feature is offered to 
							all controllers. If a session is not present when 
							such a controller receives a request, the user is 
							informed using a 
							<code class="classname">SessionRequiredException</code>.</td></tr><tr><td align="left"><code class="literal">synchronizeSession</code></td><td>Use this if you want handling by this 
							controller to be synchronized on the user's session. 
							To be more specific, the extending controller will 
							override the <code class="methodname">handleRenderRequestInternal(..)</code> and 
							<code class="methodname">handleActionRequestInternal(..)</code> methods, which will be 
							synchronized on the user&#8217;s session if you specify 
							this variable.</td></tr><tr><td align="left"><code class="literal">renderWhenMinimized</code></td><td>If you want your controller to actually 
							render the view when the portlet is in a minimized 
							state, set this to true. By default, this is set to
							false so that portlets that are in a minimized state 
							don&#8217;t display any content.</td></tr><tr><td align="left"><code class="literal">cacheSeconds</code></td><td>When you want a controller to override the 
							default cache expiration defined for the portlet, 
							specify a positive integer here. By default it is 
							set to <code class="literal">-1</code>, which does not change
							the default caching. Setting it to <code class="literal">0</code>
							will ensure the result is never cached.</td></tr></tbody></table></div></div><br class="table-break"><p>The <code class="literal">requireSession</code> and 
			<code class="literal">cacheSeconds</code> properties are declared on the 
			<code class="classname">PortletContentGenerator</code> class, which is the 
			superclass of <code class="classname">AbstractController</code>) but are 
			included here for completeness.</p><p>When using the <code class="classname">AbstractController</code> as a 
			baseclass for your controllers (which is not recommended since there 
			are a lot of other controllers that might already do the job for 
			you) you only have to override either the 
			<code class="methodname">handleActionRequestInternal(ActionRequest, 
			ActionResponse)</code> method or the 
			<code class="methodname">handleRenderRequestInternal(RenderRequest, 
			RenderResponse)</code> method (or both), implement your logic, 
			and return a <code class="classname">ModelAndView</code> object (in the case 
			of <code class="literal">handleRenderRequestInternal</code>).</p><p>The default implementations of both 
			<code class="methodname">handleActionRequestInternal(..)</code> and 
			<code class="methodname">handleRenderRequestInternal(..)</code> throw a 
			<code class="classname">PortletException</code>. This is consistent with
			the behavior of <code class="classname">GenericPortlet</code> from the JSR-
			168 Specification API. So you only need to override the method that
			your controller is intended to handle.</p><p>Here is short example consisting of a class and a declaration 
			in the web application context.</p><pre class="programlisting">package samples;

import javax.portlet.RenderRequest;
import javax.portlet.RenderResponse;

import org.springframework.web.portlet.mvc.AbstractController;
import org.springframework.web.portlet.ModelAndView;

public class SampleController extends AbstractController {

    public ModelAndView handleRenderRequestInternal(
        RenderRequest request,
        RenderResponse response) throws Exception {

        ModelAndView mav = new ModelAndView("foo");
        mav.addObject("message", "Hello World!");
        return mav;
    }
}

&lt;bean id="sampleController" class="samples.SampleController"&gt;
    &lt;property name="cacheSeconds" value="120"/&gt;
&lt;/bean&gt;</pre><p>The class above and the declaration in the web application 
			context is all you need besides setting up a handler mapping (see 
			<a href="#portlet-handlermapping" title="16.5.&nbsp;Handler mappings">Section&nbsp;16.5, &#8220;Handler mappings&#8221;</a>) to get this very simple 
			controller working.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-controller-simple"></a>16.4.2.&nbsp;Other simple controllers</h3></div></div></div><p>Although you can extend <code class="classname">AbstractController</code>,
			Spring Portlet MVC provides a number of concrete implementations which offer 
			functionality that is commonly used in simple MVC applications.</p><p>The <code class="classname">ParameterizableViewController</code> is 
			basically the same as the example above, except for the fact that 
			you can specify the view name that it will return in the web 
			application context (no need to hard-code the view name).</p><p>The <code class="classname">PortletModeNameViewController</code> uses 
			the current mode of the portlet as the view name. So, if your
			portlet is in View mode (i.e. <code class="literal">PortletMode.VIEW</code>) 
			then it uses "view" as the view name.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-controller-command"></a>16.4.3.&nbsp;Command Controllers</h3></div></div></div><p>Spring Portlet MVC has the exact same hierarchy of 
			<span class="emphasis"><em>command controllers</em></span> as Spring Web MVC. They
			provide a way to interact with data objects and dynamically bind 
			parameters from the <code class="interfacename">PortletRequest</code> to 
			the data object specified. Your data objects don't have to
			implement a framework-specific interface, so you can directly 
			manipulate your persistent objects if you desire. Let's examine what 
			command controllers are available, to get an overview of what you can do 
			with them:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">AbstractCommandController</code> 
				- a command controller you can use to create your own command 
				controller, capable of binding request parameters to a data 
				object you specify. This class does not offer form 
				functionality, it does however offer validation features and 
				lets you specify in the controller itself what to do with the 
				command object that has been filled with the parameters from the 
				request.</p></li><li><p><code class="classname">AbstractFormController</code> -
				an abstract controller offering form submission support. Using 
				this controller you can model forms and populate them using a 
				command object you retrieve in the controller. After a user has 
				filled the form, <code class="classname">AbstractFormController</code> 
				binds the fields, validates, and hands the object back to the 
				controller to take appropriate action. Supported features are: 
				invalid form submission (resubmission), validation, and normal 
				form workflow. You implement methods to determine which views 
				are used for form presentation and success. Use this controller 
				if you need forms, but don't want to specify what views you're 
				going to show the user in the application 
				context.</p></li><li><p><code class="classname">SimpleFormController</code> - a 
				concrete <code class="classname">AbstractFormController</code> that 
				provides even more support when creating a form with a 
				corresponding command object. The 
				<code class="classname">SimpleFormController</code> lets you specify a 
				command object, a viewname for the form, a viewname for the page you 
				want to show the user when form submission has succeeded, and 
				more.</p></li><li><p><code class="classname">AbstractWizardFormController</code> &#8211;
				a concrete <code class="classname">AbstractFormController</code> that 
				provides a wizard-style interface for editing the contents of a 
				command object across multiple display pages. Supports multiple
				user actions: finish, cancel, or page change, all of which are 
				easily specified in request parameters from the 
				view.</p></li></ul></div><p>These command controllers are quite powerful, but they do 
			require a detailed understanding of how they operate in order to use 
			them efficiently. Carefully review the Javadocs for this entire
			hierarchy and then look at some sample implementations before you 
			start using them.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-controller-wrapping"></a>16.4.4.&nbsp;<code class="classname">PortletWrappingController</code></h3></div></div></div><p>Instead of developing new controllers, it is possible to use 
			existing portlets and map requests to them from a 
			<code class="classname">DispatcherPortlet</code>. Using the
			<code class="classname">PortletWrappingController</code>, you can 
			instantiate an existing <code class="interfacename">Portlet</code> as a 
			<code class="interfacename">Controller</code> as follows:</p><pre class="programlisting">&lt;bean id="wrappingController"
      class="org.springframework.web.portlet.mvc.PortletWrappingController"&gt;
    &lt;property name="portletClass" value="sample.MyPortlet"/&gt;
    &lt;property name="portletName" value="my-portlet"/&gt;
    &lt;property name="initParameters"&gt;
        &lt;value&gt;
            config=/WEB-INF/my-portlet-config.xml
        &lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>This can be very valuable since you can then use interceptors 
			to pre-process and post-process requests going to these portlets. 
			Since JSR-168 does not support any kind of filter mechanism, this is 
			quite handy. For example, this can be used to wrap the Hibernate
			<code class="classname">OpenSessionInViewInterceptor</code> around a MyFaces 
			JSF Portlet.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-handlermapping"></a>16.5.&nbsp;Handler mappings</h2></div></div></div><p>Using a handler mapping you can map incoming portlet requests to 
		appropriate handlers. There are some handler mappings you can use out
		of the box, for example, the 
		<code class="classname">PortletModeHandlerMapping</code>, but let's first 
		examine the general concept of a 
		<code class="interfacename">HandlerMapping</code>.</p><p>Note: We are intentionally using the term &#8220;Handler&#8221; here instead 
		of &#8220;Controller&#8221;. <code class="classname">DispatcherPortlet</code> is designed
		to be used with other ways to process requests than just Spring Portlet 
		MVC&#8217;s own Controllers. A Handler is any Object that can handle portlet
		requests. Controllers are an example of Handlers, and they are of
		course the default. To use some other framework with
		<code class="classname">DispatcherPortlet</code>, a corresponding implementation 
		of <code class="interfacename">HandlerAdapter</code> is all that is needed.</p><p>The functionality a basic 
		<code class="interfacename">HandlerMapping</code> provides is the delivering 
		of a <code class="classname">HandlerExecutionChain</code>, which must contain 
		the handler that matches the incoming request, and may also contain a 
		list of handler interceptors that are applied to the request. When a 
		request comes in, the <code class="classname">DispatcherPortlet</code> will hand 
		it over to the handler mapping to let it inspect the request and come up 
		with an appropriate <code class="classname">HandlerExecutionChain</code>. Then 
		the <code class="classname">DispatcherPortlet</code> will execute the handler 
		and interceptors in the chain (if any). These concepts are all exactly
		the same as in Spring Web MVC.</p><p>The concept of configurable handler mappings that can optionally 
		contain interceptors (executed before or after the actual handler was 
		executed, or both) is extremely powerful. A lot of supporting 
		functionality can be built into a custom 
		<code class="interfacename">HandlerMapping</code>. Think of a custom handler 
		mapping that chooses a handler not only based on the portlet mode of the 
		request coming in, but also on a specific state of the session 
		associated with the request.</p><p>In Spring Web MVC, handler mappings are commonly based on URLs. 
		Since there is really no such thing as a URL within a Portlet, we must 
		use other mechanisms to control mappings. The two most common are the
		portlet mode and a request parameter, but anything available to the 
		portlet request can be used in a custom handler mapping.</p><p>The rest of this section describes three of Spring Portlet MVC's 
		most commonly used handler mappings. They all extend 
		<code class="classname">AbstractHandlerMapping</code> and share the following 
		properties:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">interceptors</code>: The list of 
			interceptors to use. 
			<code class="interfacename">HandlerInterceptor</code>s are discussed in 
			<a href="#portlet-handlermapping-interceptor" title="16.5.4.&nbsp;Adding HandlerInterceptors">Section&nbsp;16.5.4, &#8220;Adding <code class="interfacename">HandlerInterceptor</code>s&#8221;</a>.</p></li><li><p><code class="literal">defaultHandler</code>: The default 
			handler to use, when this handler mapping does not result in a 
			matching handler.</p></li><li><p><code class="literal">order</code>: Based on the value of the 
			order property (see the 
			<code class="interfacename">org.springframework.core.Ordered</code> 
			interface), Spring will sort all handler mappings available in the 
			context and apply the first matching handler.</p></li><li><p><code class="literal">lazyInitHandlers</code>: Allows for lazy 
			initialization of singleton handlers (prototype handlers are always 
			lazily initialized). Default value is false. This property is
			directly implemented in the three concrete 
			Handlers.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-handlermapping-portletmode"></a>16.5.1.&nbsp;<code class="classname">PortletModeHandlerMapping</code></h3></div></div></div><p>This is a simple handler mapping that maps incoming requests 
			based on the current mode of the portlet (e.g. &#8216;view&#8217;, &#8216;edit&#8217;, 
			&#8216;help&#8217;). An example:</p><pre class="programlisting">&lt;bean id="portletModeHandlerMapping"
      class="org.springframework.web.portlet.handler.PortletModeHandlerMapping"&gt;
    &lt;property name="portletModeMap"&gt;
        &lt;map&gt;
            &lt;entry key="view" value-ref="viewHandler"/&gt;
            &lt;entry key="edit" value-ref="editHandler"/&gt;
            &lt;entry key="help" value-ref="helpHandler"/&gt;
        &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-handlermapping-parameter"></a>16.5.2.&nbsp;<code class="classname">ParameterHandlerMapping</code></h3></div></div></div><p>If we need to navigate around to multiple controllers without 
			changing portlet mode, the simplest way to do this is with a request 
			parameter that is used as the key to control the mapping.</p><p><code class="classname">ParameterHandlerMapping</code> uses the value 
			of a specific request parameter to control the mapping. The default
			name of the parameter is <code class="literal">'action'</code>, but can be changed
			using the <code class="literal">'parameterName'</code> property.</p><p>The bean configuration for this mapping will look something 
			like this:</p><pre class="programlisting">&lt;bean id="parameterHandlerMapping"
      class="org.springframework.web.portlet.handler.ParameterHandlerMapping&#8221;&gt;
    &lt;property name="parameterMap"&gt;
        &lt;map&gt;
            &lt;entry key="add" value-ref="addItemHandler"/&gt;
            &lt;entry key="edit" value-ref="editItemHandler"/&gt;
            &lt;entry key="delete" value-ref="deleteItemHandler"/&gt;
        &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-handlermapping-portletmodeparameter"></a>16.5.3.&nbsp;<code class="classname">PortletModeParameterHandlerMapping</code></h3></div></div></div><p>The most powerful built-in handler mapping, 
			<code class="classname">PortletModeParameterHandlerMapping</code> combines 
			the capabilities of the two previous ones to allow different 
			navigation within each portlet mode.</p><p>Again the default name of the parameter is "action", but can 
			be changed using the <code class="literal">parameterName</code> 
			property.</p><p>By default, the same parameter value may not be used in two 
			different portlet modes. This is so that if the portal itself 
			changes the portlet mode, the request will no longer be valid in the 
			mapping. This behavior can be changed by setting the 
			<code class="literal">allowDupParameters</code> property to true. However,
			this is not recommended.</p><p>The bean configuration for this mapping will look something 
			like this:</p><pre class="programlisting">&lt;bean id="portletModeParameterHandlerMapping"
      class="org.springframework.web.portlet.handler.PortletModeParameterHandlerMapping"&gt;
    &lt;property name="portletModeParameterMap"&gt;
        &lt;map&gt;
            &lt;entry key="view"&gt; <em class="lineannotation"><span class="lineannotation">&lt;!-- 'view' portlet mode --&gt;</span></em>
                &lt;map&gt;
                    &lt;entry key="add" value-ref="addItemHandler"/&gt;
                    &lt;entry key="edit" value-ref="editItemHandler"/&gt;
                    &lt;entry key="delete" value-ref="deleteItemHandler"/&gt;
                &lt;/map&gt;
            &lt;/entry&gt;
            &lt;entry key="edit"&gt; <em class="lineannotation"><span class="lineannotation">&lt;!-- 'edit' portlet mode --&gt;</span></em>
                &lt;map&gt;
                    &lt;entry key="prefs" value-ref="prefsHandler"/&gt;
                    &lt;entry key="resetPrefs" value-ref="resetPrefsHandler"/&gt;
                &lt;/map&gt;
            &lt;/entry&gt;
        &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>This mapping can be chained ahead of a 
		<code class="classname">PortletModeHandlerMapping</code>, which can then provide 
		defaults for each mode and an overall default as well.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-handlermapping-interceptor"></a>16.5.4.&nbsp;Adding <code class="interfacename">HandlerInterceptor</code>s</h3></div></div></div><p>Spring's handler mapping mechanism has a notion of handler 
			interceptors, which can be extremely useful when you want to apply 
			specific functionality to certain requests, for example, checking 
			for a principal. Again Spring Portlet MVC implements these concepts
			in the same way as Web MVC.</p><p>Interceptors located in the handler mapping must implement 
			<code class="interfacename">HandlerInterceptor</code> from the 
			<code class="literal">org.springframework.web.portlet</code> package. Just 
			like the servlet version, this interface defines three methods: one 
			that will be called before the actual handler will be executed 
			(<code class="literal">preHandle</code>), one that will be called after the 
			handler is executed (<code class="literal">postHandle</code>), and one that is 
			called after the complete request has finished 
			(<code class="literal">afterCompletion</code>). These three methods should 
			provide enough flexibility to do all kinds of pre- and post-
			processing.</p><p>The <code class="literal">preHandle</code> method returns a boolean 
			value. You can use this method to break or continue the processing 
			of the execution chain. When this method returns 
			<code class="literal">true</code>, the handler execution chain will continue. 
			When it returns <code class="literal">false</code>, the 
			<code class="classname">DispatcherPortlet</code> assumes the interceptor 
			itself has taken care of requests (and, for example, rendered an 
			appropriate view) and does not continue executing the other 
			interceptors and the actual handler in the execution chain.</p><p>The <code class="literal">postHandle</code> method is only called on a 
			<code class="interfacename">RenderRequest</code>. The
			<code class="literal">preHandle</code> and <code class="literal">afterCompletion</code> 
			methods are called on both an 
			<code class="interfacename">ActionRequest</code> and a 
			<code class="interfacename">RenderRequest</code>. If you need to
			execute logic in these methods for just one type of request, be sure 
			to check what kind of request it is before processing it.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-handlermapping-interceptoradapter"></a>16.5.5.&nbsp;<code class="classname">HandlerInterceptorAdapter</code></h3></div></div></div><p>As with the servlet package, the portlet package has a 
			concrete implementation of 
			<code class="interfacename">HandlerInterceptor</code> called 
			<code class="classname">HandlerInterceptorAdapter</code>. This class has
			empty versions of all the methods so that you can inherit from this 
			class and implement just one or two methods when that is all you 
			need.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-handlermapping-parameterinterceptor"></a>16.5.6.&nbsp;<code class="classname">ParameterMappingInterceptor</code></h3></div></div></div><p>The portlet package also has a concrete interceptor named 
			<code class="classname">ParameterMappingInterceptor</code> that is meant to 
			be used directly with <code class="classname">ParameterHandlerMapping</code> 
			and <code class="classname">PortletModeParameterHandlerMapping</code>. This
			interceptor will cause the parameter that is being used to control 
			the mapping to be forwarded from an 
			<code class="interfacename">ActionRequest</code> to the subsequent 
			<code class="interfacename">RenderRequest</code>. This will help ensure
			that the <code class="interfacename">RenderRequest</code> is mapped to 
			the same Handler as the 
			<code class="interfacename">ActionRequest</code>. This is done in the
			<code class="literal">preHandle</code> method of the interceptor, so you can 
			still modify the parameter value in your handler to change where the 
			<code class="interfacename">RenderRequest</code> will be mapped.</p><p>Be aware that this interceptor is calling 
			<code class="literal">setRenderParameter</code> on the 
			<code class="interfacename">ActionResponse</code>, which means that you 
			cannot call <code class="literal">sendRedirect</code> in your handler when 
			using this interceptor. If you need to do external redirects then
			you will either need to forward the mapping parameter manually or 
			write a different interceptor to handle this for you.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-viewresolver"></a>16.6.&nbsp;Views and resolving them</h2></div></div></div><p>As mentioned previously, Spring Portlet MVC directly reuses all
		the view technologies from Spring Web MVC. This includes not only the
		various <code class="interfacename">View</code> implementations themselves,
		but also the <code class="interfacename">ViewResolver</code> implementations. 
		For more information, refer to the sections entitled
		<a href="#view" title="Chapter&nbsp;14.&nbsp;Integrating view technologies">Chapter&nbsp;14, <i>Integrating view technologies</i></a> and <a href="#mvc-viewresolver" title="13.5.&nbsp;Views and resolving them">Section&nbsp;13.5, &#8220;Views and resolving them&#8221;</a> respectively.</p><p>A few items on using the existing <code class="interfacename">View</code> and
		<code class="interfacename">ViewResolver</code> implementations	are worth mentioning:</p><div class="itemizedlist"><ul type="disc"><li><p>Most portals expect the result of rendering a 
			portlet to be an HTML fragment. So, things like JSP/JSTL, Velocity,
			FreeMarker, and XSLT all make sense. But it is unlikely that views
			that return other document types will make any sense in a portlet 
			context.</p></li><li><p>There is no such thing as an HTTP redirect from 
			within a portlet (the <code class="literal">sendRedirect(..)</code> method of 
			<code class="interfacename">ActionResponse</code> cannot 
			be used to stay within the portal). So, <code class="classname">RedirectView</code>
			and use of the <code class="literal">'redirect:'</code> prefix will
			<span class="bold"><strong>not</strong></span> work correctly from within Portlet MVC.</p></li><li><p>It may be possible to use the <code class="literal">'forward:'</code> prefix from 
			within Portlet MVC. However, remember that since you are in a
			portlet, you have no idea what the current URL looks like. This
			means you cannot use a relative URL to access other resources in 
			your web application and that you will have to use an absolute 
			URL.</p></li></ul></div><p>Also, for JSP development, the new Spring Taglib and the new 
		Spring Form Taglib both work in portlet views in exactly the same way 
		that they work in servlet views.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-multipart"></a>16.7.&nbsp;Multipart (file upload) support</h2></div></div></div><p>Spring Portlet MVC has built-in multipart support to handle file 
		uploads in portlet applications, just like Web MVC does. The design for
		the multipart support is done with pluggable 
		<code class="interfacename">PortletMultipartResolver</code> objects, defined 
		in the <code class="literal">org.springframework.web.portlet.multipart</code> 
		package. Spring provides a <code class="interfacename">PortletMultipartResolver</code>
		for use with
		<a href="http://jakarta.apache.org/commons/fileupload" target="_top">Commons FileUpload</a>.
		How uploading files is supported will be described in the rest of this section.</p><p>By default, no multipart handling will be done by Spring Portlet 
		MVC, as some developers will want to handle multiparts themselves. You 
		will have to enable it yourself by adding a multipart resolver to the 
		web application's context. After you have done that, 
		<code class="classname">DispatcherPortlet</code> will inspect each request to 
		see if it contains a multipart. If no multipart is found, the request 
		will continue as expected. However, if a multipart is found in the 
		request, the <code class="interfacename">PortletMultipartResolver</code> 
		that has been declared in your context will be used. After that, the 
		multipart attribute in your request will be treated like any other 
		attribute.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Any configured <code class="interfacename">PortletMultipartResolver</code>
			bean <span class="emphasis"><em>must</em></span> have the following id (or name):
			"<code class="literal">portletMultipartResolver</code>". If you have defined your
			<code class="interfacename">PortletMultipartResolver</code> with any other name,
			then the <code class="classname">DispatcherPortlet</code> will <span class="emphasis"><em>not</em></span>
			find your <code class="interfacename">PortletMultipartResolver</code>, and
			consequently no multipart support will be in effect.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-multipart-resolver"></a>16.7.1.&nbsp;Using the <code class="interfacename">PortletMultipartResolver</code></h3></div></div></div><p>The following example shows how to use the 
			<code class="classname">CommonsPortletMultipartResolver</code>:</p><pre class="programlisting">&lt;bean id="portletMultipartResolver"
    class="org.springframework.web.portlet.multipart.CommonsPortletMultipartResolver"&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- one of the properties available; the maximum file size in bytes --&gt;</span></em>
    &lt;property name="maxUploadSize" value="100000"/&gt;
&lt;/bean&gt;</pre><p>Of course you also need to put the appropriate jars in your 
			classpath for the multipart resolver to work. In the case of the 
			<code class="classname">CommonsMultipartResolver</code>, you need to use 
			<code class="literal">commons-fileupload.jar</code>. Be sure to use at least
			version 1.1 of Commons FileUpload as previous versions do not 
			support JSR-168 Portlet applications.</p><p>Now that you have seen how to set Portlet MVC up to handle 
			multipart requests, let's talk about how to actually use it. When 
			<code class="classname">DispatcherPortlet</code> detects a multipart 
			request, it activates the resolver that has been declared in your 
			context and hands over the request. What the resolver then does is 
			wrap the current <code class="interfacename">ActionRequest</code> into a 
			<code class="interfacename">MultipartActionRequest</code> that has 
			support for multipart file uploads. Using the 
			<code class="interfacename">MultipartActionRequest</code> you can get 
			information about the multiparts contained by this request and 
			actually get access to the multipart files themselves in your 
			controllers.</p><p>Note that you can only receive multipart file uploads as part 
			of an <code class="interfacename">ActionRequest</code>, not as part of a 
			<code class="interfacename">RenderRequest</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-multipart-forms"></a>16.7.2.&nbsp;Handling a file upload in a form</h3></div></div></div><p>After the 
			<code class="interfacename">PortletMultipartResolver</code> has finished 
			doing its job, the request will be processed like any other. To use 
			it, you create a form with an upload field (see immediately below), 
			then let Spring bind the file onto your form (backing object). To 
			actually let the user upload a file, we have to create a (JSP/HTML) 
			form:</p><pre class="programlisting">&lt;h1&gt;Please upload a file&lt;/h1&gt;
&lt;form method="post" action="&lt;portlet:actionURL/&gt;" enctype="multipart/form-data"&gt;
    &lt;input type="file" name="file"/&gt;
    &lt;input type="submit"/&gt;
&lt;/form&gt;</pre><p>As you can see, we've created a field named &#8220;file&#8221; after the 
			property of the bean that holds the <code class="literal">byte[]</code>. 
			Furthermore we've added the encoding attribute 
			(<code class="literal">enctype="multipart/form-data"</code>), which is 
			necessary to let the browser know how to encode the multipart fields 
			(do not forget this!).</p><p>Just as with any other property that's not automagically 
			convertible to a string or primitive type, to be able to put binary 
			data in your objects you have to register a custom editor with the 
			<code class="classname">PortletRequestDataBinder</code>. There are a couple 
			of editors available for handling files and setting the results on 
			an object. There's a 
			<code class="classname">StringMultipartFileEditor</code> capable of 
			converting files to Strings (using a user-defined character set) and 
			there is a <code class="classname">ByteArrayMultipartFileEditor</code> which 
			converts files to byte arrays. They function just as the 
			<code class="classname">CustomDateEditor</code> does.</p><p>So, to be able to upload files using a form, declare the 
			resolver, a mapping to a controller that will process the bean, and 
			the controller itself.</p><pre class="programlisting">&lt;bean id="portletMultipartResolver"
      class="org.springframework.web.portlet.multipart.CommonsPortletMultipartResolver"/&gt;

&lt;bean id="portletModeHandlerMapping"
      class="org.springframework.web.portlet.handler.PortletModeHandlerMapping"&gt;
    &lt;property name="portletModeMap"&gt;
        &lt;map&gt;
            &lt;entry key="view" value-ref="fileUploadController"/&gt;
        &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="fileUploadController" class="examples.FileUploadController"&gt;
    &lt;property name="commandClass" value="examples.FileUploadBean"/&gt;
    &lt;property name="formView" value="fileuploadform"/&gt;
    &lt;property name="successView" value="confirmation"/&gt;
&lt;/bean&gt;</pre><p>After that, create the controller and the actual class to hold 
			the file property.</p><pre class="programlisting">public class FileUploadController extends SimpleFormController {

    public void onSubmitAction(
        ActionRequest request,
        ActionResponse response,
        Object command,
        BindException errors)
        throws Exception {

        <em class="lineannotation"><span class="lineannotation">// cast the bean</span></em>
        FileUploadBean bean = (FileUploadBean) command;

        <em class="lineannotation"><span class="lineannotation">// let's see if there's content there</span></em>
        byte[] file = bean.getFile();
        if (file == null) {
            <em class="lineannotation"><span class="lineannotation">// hmm, that's strange, the user did not upload anything</span></em>
        }

        // do something with the file here
    }

    protected void initBinder(
            PortletRequest request, PortletRequestDataBinder binder)
        throws Exception {
        // to actually be able to convert Multipart instance to byte[]
        // we have to register a custom editor
        binder.registerCustomEditor(byte[].class, new ByteArrayMultipartFileEditor());
        <em class="lineannotation"><span class="lineannotation">// now Spring knows how to handle multipart object and convert</span></em>
    }
}

public class FileUploadBean {

    private byte[] file;

    public void setFile(byte[] file) {
        this.file = file;
    }

    public byte[] getFile() {
        return file;
    }
}</pre><p>As you can see, the <code class="classname">FileUploadBean</code> has 
			a property typed <code class="literal">byte[]</code> that holds the file. The 
			controller registers a custom editor to let Spring know how to 
			actually convert the multipart objects the resolver has found to 
			properties specified by the bean. In this example, nothing is done 
			with the <code class="literal">byte[]</code> property of the bean itself, but 
			in practice you can do whatever you want (save it in a database,
			mail it to somebody, etc).</p><p>An equivalent example in which a file is bound straight to a 
			String-typed property on a (form backing) object might look like 
			this:</p><pre class="programlisting">public class FileUploadController extends SimpleFormController {

    public void onSubmitAction(
        ActionRequest request,
        ActionResponse response,
        Object command,
        BindException errors) throws Exception {

        // cast the bean
        FileUploadBean bean = (FileUploadBean) command;

        // let's see if there's content there
        String file = bean.getFile();
        if (file == null) {
            // hmm, that's strange, the user did not upload anything
        }

        // do something with the file here
    }

    protected void initBinder(
        PortletRequest request, PortletRequestDataBinder binder) throws Exception {

        // to actually be able to convert Multipart instance to a String
        // we have to register a custom editor
        binder.registerCustomEditor(String.class,
            new StringMultipartFileEditor());
        // now Spring knows how to handle multipart objects and convert
    }
}

public class FileUploadBean {

    private String file;

    public void setFile(String file) {
        this.file = file;
    }

    public String getFile() {
        return file;
    }
}</pre><p>Of course, this last example only makes (logical) sense in the 
			context of uploading a plain text file (it wouldn't work so well in 
			the case of uploading an image file).</p><p>The third (and final) option is where one binds directly to a 
			<code class="interfacename">MultipartFile</code> property declared on 
			the (form backing) object's class. In this case one does not need to 
			register any custom property editor because there is no type 
			conversion to be performed.</p><pre class="programlisting">public class FileUploadController extends SimpleFormController {

    public void onSubmitAction(
        ActionRequest request,
        ActionResponse response,
        Object command,
        BindException errors) throws Exception {

        // cast the bean
        FileUploadBean bean = (FileUploadBean) command;

        // let's see if there's content there
        MultipartFile file = bean.getFile();
        if (file == null) {
            // hmm, that's strange, the user did not upload anything
        }

        // do something with the file here
    }
}

public class FileUploadBean {

    private MultipartFile file;

    public void setFile(MultipartFile file) {
        this.file = file;
    }

    public MultipartFile getFile() {
        return file;
    }
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-exceptionresolver"></a>16.8.&nbsp;Handling exceptions</h2></div></div></div><p>Just like Web MVC, Portlet MVC provides 
		<code class="interfacename">HandlerExceptionResolver</code>s to ease the 
		pain of unexpected exceptions occurring while your request is being 
		processed by a handler that matched the request. Portlet MVC also
		provides the same concrete 
		<code class="classname">SimpleMappingExceptionResolver</code> that enables you 
		to take the class name of any exception that might be thrown and map it 
		to a view name.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-deployment"></a>16.9.&nbsp;Portlet application deployment</h2></div></div></div><p>The process of deploying a Spring Portlet MVC application is no 
		different than deploying any JSR-168 Portlet application. However, this
		area is confusing enough in general that it is worth talking about here 
		briefly.</p><p>Generally, the portal/portlet-container runs in one webapp in your 
		servlet-container and your portlets run in another webapp in your 
		servlet-container. In order for the portlet-container webapp to make
		calls into your portlet webapp it must make cross-context calls to a 
		well-known servlet that provides access to the portlet services defined 
		in your <code class="literal">portlet.xml</code> file.</p><p>The JSR-168 specification does not specify exactly how this should 
		happen, so each portlet-container has its own mechanism for this, which 
		usually involves some kind of &#8220;deployment process&#8221; that makes changes to 
		the portlet webapp itself and then registers the portlets within the 
		portlet-container.</p><p>At a minimum, the <code class="literal">web.xml</code> file in your portlet 
		webapp is modified to inject the well-known servlet that the portlet-
		container will call. In some cases a single servlet will service all
		portlets in the webapp, in other cases there will be an instance of the 
		servlet for each portlet.</p><p>Some portlet-containers will also inject libraries and/or 
		configuration files into the webapp as well. The portlet-container must
		also make its implementation of the Portlet JSP Tag Library available to 
		your webapp.</p><p>The bottom line is that it is important to understand the 
		deployment needs of your target portal and make sure they are met 
		(usually by following the automated deployment process it provides).
		Be sure to carefully review the documentation from your portal for this
		process.</p><p>Once you have deployed your portlet, review the resulting 
		<code class="literal">web.xml</code> file for sanity. Some older portals have
		been known to corrupt the definition of the 
		<code class="classname">ViewRendererServlet</code>, thus breaking the rendering 
		of your portlets.</p></div></div></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="spring-integration"></a>Part&nbsp;IV.&nbsp;Integration</h1></div></div></div><div class="partintro" lang="en"><div></div><p>
				This part of the reference documentation covers
				the Spring Framework's integration with a number of J2EE
				(and related) technologies.
			</p><div class="itemizedlist"><ul type="disc"><li><a href="#remoting" title="Chapter&nbsp;17.&nbsp;Remoting and web services using Spring">Chapter&nbsp;17, <i>Remoting and web services using Spring</i></a></li><li><a href="#ejb" title="Chapter&nbsp;18.&nbsp;Enterprise Java Bean (EJB) integration">Chapter&nbsp;18, <i>Enterprise Java Bean (EJB) integration</i></a></li><li><a href="#jms" title="Chapter&nbsp;19.&nbsp;JMS">Chapter&nbsp;19, <i>JMS</i></a></li><li><a href="#jmx" title="Chapter&nbsp;20.&nbsp;JMX">Chapter&nbsp;20, <i>JMX</i></a></li><li><a href="#cci" title="Chapter&nbsp;21.&nbsp;JCA CCI">Chapter&nbsp;21, <i>JCA CCI</i></a></li><li><a href="#mail" title="Chapter&nbsp;22.&nbsp;Email">Chapter&nbsp;22, <i>Email</i></a></li><li><a href="#scheduling" title="Chapter&nbsp;23.&nbsp;Scheduling and Thread Pooling">Chapter&nbsp;23, <i>Scheduling and Thread Pooling</i></a></li><li><a href="#dynamic-language" title="Chapter&nbsp;24.&nbsp;Dynamic language support">Chapter&nbsp;24, <i>Dynamic language support</i></a></li><li><a href="#metadata" title="Chapter&nbsp;25.&nbsp;Annotations and Source Level Metadata Support">Chapter&nbsp;25, <i>Annotations and Source Level Metadata Support</i></a></li></ul></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="remoting"></a>Chapter&nbsp;17.&nbsp;Remoting and web services using Spring</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-introduction"></a>17.1.&nbsp;Introduction</h2></div></div></div><p>
			Spring features integration classes for remoting support using various
			technologies. The remoting support eases the development of remote-enabled
			services, implemented by your usual (Spring) POJOs. Currently, Spring supports
			four remoting technologies:
			</p><div class="itemizedlist"><ul type="disc"><li><p>
						<span class="emphasis"><em>Remote Method Invocation (RMI)</em></span>. Through the use
						of the <code class="classname">RmiProxyFactoryBean</code> and the
						<code class="classname">RmiServiceExporter</code> Spring supports both traditional
						RMI (with <code class="interfacename">java.rmi.Remote</code> interfaces and
						<code class="exceptionname">java.rmi.RemoteException</code>) and
						transparent remoting via RMI invokers (with any Java interface).
					</p></li><li><p>
						<span class="emphasis"><em>Spring's HTTP invoker</em></span>. Spring provides a special
						remoting strategy which allows for Java serialization via HTTP,
						supporting any Java interface (just like the RMI invoker). The corresponding
						support classes are <code class="classname">HttpInvokerProxyFactoryBean</code> and
						<code class="classname">HttpInvokerServiceExporter</code>.
					</p></li><li><p>
						<span class="emphasis"><em>Hessian</em></span>. By using the
						<code class="classname">HessianProxyFactoryBean</code>
						and the <code class="classname">HessianServiceExporter</code> you can transparently
						expose your services using the lightweight binary HTTP-based protocol
						provided by Caucho.
					</p></li><li><p>
						<span class="emphasis"><em>Burlap</em></span>. Burlap is Caucho's XML-based
						alternative for Hessian. Spring provides support classes such
						as <code class="classname">BurlapProxyFactoryBean</code> and 
						<code class="classname">BurlapServiceExporter</code>.
					</p></li><li><p>
						<span class="emphasis"><em>JAX RPC</em></span>. Spring provides remoting support
						for web services via JAX-RPC.
					</p></li><li><p>
						<span class="emphasis"><em>JMS</em></span>. Remoting using JMS as the underlying protocol
						is supported via the <code class="classname">JmsInvokerServiceExporter</code> and
						<code class="classname">JmsInvokerProxyFactoryBean</code> classes.
					</p></li></ul></div><p>
		</p><p>While discussing the remoting capabilities of Spring, we'll use the following domain 
		model and corresponding services:</p><pre class="programlisting">public class Account implements Serializable{
  private String name;

  public String getName();

  public void setName(String name) {
    this.name = name;
  }
}</pre><pre class="programlisting">public interface AccountService {

  public void insertAccount(Account account);
  
  public List getAccounts(String name);
}</pre><pre class="programlisting">public interface RemoteAccountService extends Remote {

  public void insertAccount(Account account) throws RemoteException;
  
  public List getAccounts(String name) throws RemoteException;
}</pre><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// the implementation doing nothing at the moment</span></em>
public class AccountServiceImpl implements AccountService {

  public void insertAccount(Account acc) {
    <em class="lineannotation"><span class="lineannotation">// do something...</span></em>
  }
  
  public List getAccounts(String name) {
    <em class="lineannotation"><span class="lineannotation">// do something...</span></em>
  }
}</pre><p>We will start exposing the service to a remote client by using RMI and 
		talk a bit about the drawbacks of using RMI. We'll then continue to show
		an example using Hessian as the protocol.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-rmi"></a>17.2.&nbsp;Exposing services using RMI</h2></div></div></div><p>
			Using Spring's support for RMI, you can transparently expose your services through
			the RMI infrastructure. After having this set up, you basically have a configuration
			similar to remote EJBs, except for the fact that there is no standard support for
			security context propagation or remote transaction propagation. Spring does provide
			hooks for such additional invocation context when using the RMI invoker, so you can
			for example plug in security frameworks or custom security credentials here.
		</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-rmi-server"></a>17.2.1.&nbsp;Exporting the service using the <code class="classname">RmiServiceExporter</code></h3></div></div></div><p>
				Using the <code class="classname">RmiServiceExporter</code>, we can expose the interface
				of our AccountService object as RMI object. The interface can be accessed by using
				<code class="classname">RmiProxyFactoryBean</code>, or via plain RMI in case of a traditional
				RMI service. The <code class="classname">RmiServiceExporter</code> explicitly supports the
				exposing of any non-RMI services via RMI invokers.
			</p><p>Of course, we first have to set up our service in the Spring container:</p><pre class="programlisting">
&lt;bean id="accountService" class="example.AccountServiceImpl"&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- any additional properties, maybe a DAO? --&gt;</span></em>
&lt;/bean&gt;</pre><p>Next we'll have to expose our service using the <code class="classname">RmiServiceExporter</code>:</p><pre class="programlisting">&lt;bean class="org.springframework.remoting.rmi.RmiServiceExporter"&gt;
	<em class="lineannotation"><span class="lineannotation">&lt;!-- does not necessarily have to be the same name as the bean to be exported --&gt;</span></em>
	&lt;property name="serviceName" value="AccountService"/&gt;
	&lt;property name="service" ref="accountService"/&gt;
	&lt;property name="serviceInterface" value="example.AccountService"/&gt;
	<em class="lineannotation"><span class="lineannotation">&lt;!-- defaults to <code class="literal">1099</code> --&gt;</span></em>
	&lt;property name="registryPort" value="1199"/&gt;
&lt;/bean&gt;</pre><p>As you can see, we're overriding the port for the RMI registry. Often,
			your application server also maintains an RMI registry and it is wise
			to not interfere with that one. Furthermore, the service name is used to bind the
			service under. So right now, the service will be bound at
			<code class="literal">'rmi://HOST:1199/AccountService'</code>. We'll use the URL later on to
			link in the service at the client side.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">servicePort</code> property has been omitted (it defaults to 0).
			    This means that an anonymous port will be used to communicate with the service.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-rmi-client"></a>17.2.2.&nbsp;Linking in the service at the client</h3></div></div></div><p>Our client is a simple object using the <code class="interfacename">AccountService</code>
			to manage accounts:</p><pre class="programlisting">
public class SimpleObject {

  private AccountService accountService;

  public void setAccountService(AccountService accountService) {
    this.accountService = accountService;
  }
}</pre><p>To link in the service on the client, we'll create a separate Spring container,
			containing the simple object and the service linking configuration bits:</p><pre class="programlisting">&lt;bean class="example.SimpleObject"&gt;
	&lt;property name="accountService" ref="accountService"/&gt;
&lt;/bean&gt;

&lt;bean id="accountService" class="org.springframework.remoting.rmi.RmiProxyFactoryBean"&gt;
	&lt;property name="serviceUrl" value="rmi://HOST:1199/AccountService"/&gt;
	&lt;property name="serviceInterface" value="example.AccountService"/&gt;
&lt;/bean&gt;</pre><p>That's all we need to do to support the remote account service on the client.
			Spring will transparently create an invoker and remotely enable the account
			service through the <code class="classname">RmiServiceExporter</code>. At the client
			we're linking it in using the <code class="classname">RmiProxyFactoryBean</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-caucho-protocols"></a>17.3.&nbsp;Using Hessian or Burlap to remotely call services via HTTP</h2></div></div></div><p>Hessian offers a binary HTTP-based remoting protocol. It is developed by
		Caucho and more information about Hessian itself can be found at
		<a href="http://www.caucho.com" target="_top">http://www.caucho.com</a>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-caucho-protocols-hessian"></a>17.3.1.&nbsp;Wiring up the <code class="classname">DispatcherServlet</code> for Hessian</h3></div></div></div><p>Hessian communicates via HTTP and does so using a custom servlet.
			Using Spring's <code class="classname">DispatcherServlet</code> principles, you can easily 
			wire up such a servlet exposing your services. First we'll have to
			create a new servlet in your application (this an excerpt from
			<code class="filename">'web.xml'</code>):</p><pre class="programlisting">
&lt;servlet&gt;
	&lt;servlet-name&gt;remoting&lt;/servlet-name&gt;
	&lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
	&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;remoting&lt;/servlet-name&gt;
	&lt;url-pattern&gt;/remoting/*&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre><p>You're probably familiar with Spring's <code class="classname">DispatcherServlet</code>
			principles and if so, you know that now you'll have to create a Spring container
			configuration resource named <code class="filename">'remoting-servlet.xml'</code> (after
			the name of your servlet) in the <code class="filename">'WEB-INF'</code>
			directory. The application context will be used	in the next section.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-caucho-protocols-hessian-server"></a>17.3.2.&nbsp;Exposing your beans by using the <code class="classname">HessianServiceExporter</code></h3></div></div></div><p>In the newly created application context called <code class="literal">remoting-servlet.xml</code>,
			we'll create a <code class="classname">HessianServiceExporter</code> exporting your services:</p><pre class="programlisting">&lt;bean id="accountService" class="example.AccountServiceImpl"&gt;
  <em class="lineannotation"><span class="lineannotation">&lt;!-- any additional properties, maybe a DAO? --&gt;</span></em>
&lt;/bean&gt;

&lt;bean name="/AccountService" class="org.springframework.remoting.caucho.HessianServiceExporter"&gt;
  &lt;property name="service" ref="accountService"/&gt;
  &lt;property name="serviceInterface" value="example.AccountService"/&gt;
&lt;/bean&gt;</pre><p>Now we're ready to link in the service at the client. No explicit handler mapping
			is specified, mapping request URLs onto services, so <code class="classname">BeanNameUrlHandlerMapping</code>
			will be used: hence, the service will be exported at the URL indicated through
			its bean name: <code class="literal">'http://HOST:8080/remoting/AccountService'</code>.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-caucho-protocols-hessian-client"></a>17.3.3.&nbsp;Linking in the service on the client</h3></div></div></div><p>Using the <code class="classname"></code> we can link in the service
			at the client. The same principles apply as with the RMI example. We'll create
			a separate bean factory or application context and mention the following beans
			where the <code class="classname">SimpleObject</code> is using the
			<code class="interfacename">AccountService</code> to manage accounts:</p><pre class="programlisting">
&lt;bean class="example.SimpleObject"&gt;
  &lt;property name="accountService" ref="accountService"/&gt;
&lt;/bean&gt;

&lt;bean id="accountService" class="org.springframework.remoting.caucho.HessianProxyFactoryBean"&gt;
	&lt;property name="serviceUrl" value="http://remotehost:8080/remoting/AccountService"/&gt;
	&lt;property name="serviceInterface" value="example.AccountService"/&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-caucho-protocols-burlap"></a>17.3.4.&nbsp;Using Burlap</h3></div></div></div><p>We won't discuss Burlap, the XML-based equivalent of Hessian, in detail here,
			since it is configured and set up in exactly the same way as the Hessian
			variant explained above. Just replace the word <code class="literal">Hessian</code>
			with <code class="literal">Burlap</code> and you're all set to go.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-caucho-protocols-securoty"></a>17.3.5.&nbsp;Applying HTTP basic authentication to a service exposed through Hessian or Burlap</h3></div></div></div><p>One of the advantages of Hessian and Burlap is that we can easily apply HTTP basic
			authentication, because both protocols are HTTP-based. Your normal HTTP server security
			mechanism can easily be applied through using the <code class="literal">web.xml</code> security
			features, for example. Usually, you don't use per-user security credentials here, but
			rather shared credentials defined at the <code class="literal">Hessian/BurlapProxyFactoryBean</code> level
			(similar to a JDBC <code class="interfacename">DataSource</code>).</p><pre class="programlisting">&lt;bean class="org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping"&gt;
   &lt;property name="interceptors"&gt;
      &lt;list&gt;
         &lt;ref bean="authorizationInterceptor"/&gt;
      &lt;/list&gt;
   &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="authorizationInterceptor" 
   class="org.springframework.web.servlet.handler.UserRoleAuthorizationInterceptor"&gt;
   &lt;property name="authorizedRoles"&gt;
      &lt;list&gt;
         &lt;value&gt;administrator&lt;/value&gt;
         &lt;value&gt;operator&lt;/value&gt;
      &lt;/list&gt;
   &lt;/property&gt;   
&lt;/bean&gt;</pre><p>
				This an example where we explicitly mention the <code class="classname">BeanNameUrlHandlerMapping</code>
				and set an interceptor allowing only administrators and operators to call
				the beans mentioned in this application context.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Of course, this example doesn't show a flexible kind of security
				infrastructure. For more options as far as security is concerned,
				have a look at the Acegi Security System for Spring, to be found at
				<a href="http://acegisecurity.sourceforge.net" target="_top">http://acegisecurity.sourceforge.net</a>.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-httpinvoker"></a>17.4.&nbsp;Exposing services using HTTP invokers</h2></div></div></div><p>As opposed to Burlap and Hessian, which are both lightweight protocols using their
		own slim serialization mechanisms, Spring Http invokers use the standard
		Java serialization mechanism to expose services through HTTP. This has a huge
		advantage if your arguments and return types are complex types that cannot be
		serialized using the serialization mechanisms Hessian and Burlap use (refer to the
		next section for more considerations when choosing a remoting technology).</p><p>Under the hood, Spring uses either the standard facilities provided by J2SE to
		perform HTTP calls or Commons <code class="classname">HttpClient</code>. Use the latter if you need more advanced
		and easy-to-use functionality. Refer to 
		<a href="http://jakarta.apache.org/commons/httpclient" target="_top">jakarta.apache.org/commons/httpclient</a>
		for more info.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-httpinvoker-server"></a>17.4.1.&nbsp;Exposing the service object</h3></div></div></div><p>Setting up the HTTP invoker infrastructure for a service objects much resembles
			the way you would do using Hessian or Burlap. Just as Hessian support provides
			the <code class="classname">HessianServiceExporter</code>, Spring's HttpInvoker support provides
			the <code class="classname">org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter</code>.
			To expose the <code class="literal">AccountService</code> (mentioned above), the following
			configuration needs to be in place:</p><pre class="programlisting">&lt;bean name="/AccountService" class="org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter"&gt;
  &lt;property name="service" ref="accountService"/&gt;
  &lt;property name="serviceInterface" value="example.AccountService"/&gt;
&lt;/bean&gt;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-httpinvoker-client"></a>17.4.2.&nbsp;Linking in the service at the client</h3></div></div></div><p>Again, linking in the service from the client much resembles the way you would
			do it when using Hessian or Burlap. Using a proxy, Spring will be able to
			translate your calls to HTTP POST requests to the URL pointing to the exported
			service.</p><pre class="programlisting">&lt;bean id="httpInvokerProxy" class="org.springframework.remoting.httpinvoker.HttpInvokerProxyFactoryBean"&gt;
  &lt;property name="serviceUrl" value="http://remotehost:8080/remoting/AccountService"/&gt;
  &lt;property name="serviceInterface" value="example.AccountService"/&gt;
&lt;/bean&gt;
</pre><p>As mentioned before, you can choose what HTTP client you want to use.
			By default, the <code class="classname">HttpInvokerProxy</code> uses the J2SE HTTP functionality, but
			you can also use the Commons <code class="classname">HttpClient</code> by setting the
			<code class="literal">httpInvokerRequestExecutor</code> property:</p><pre class="programlisting">
&lt;property name="httpInvokerRequestExecutor"&gt;
	&lt;bean class="org.springframework.remoting.httpinvoker.CommonsHttpInvokerRequestExecutor"/&gt;
&lt;/property&gt;
</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-web-services"></a>17.5.&nbsp;Web services</h2></div></div></div><p>Spring has support for:</p><div class="itemizedlist"><ul type="disc"><li><p>Exposing services using JAX-RPC</p></li><li><p>Accessing web services</p></li></ul></div><p>In addition to stock support for JAX-RPC in Spring Core, the Spring portfolio also features
        <a href="http://www.springframework.org/spring-ws" target="_top">Spring Web Services</a>, a solution
        for contract-first, document-driven web services. Last but not least, <a href="http://xfire.codehaus.org" target="_top">XFire</a>
        also allows you to export Spring-managed beans as a web service.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-web-services-jaxrpc"></a>17.5.1.&nbsp;Exposing services using JAX-RPC</h3></div></div></div><p>
				Spring has a convenience base class for JAX-RPC servlet endpoint implementations -
				<code class="classname">ServletEndpointSupport</code>. To expose our
				<code class="interfacename">AccountService</code> we extend Spring's
				<code class="classname">ServletEndpointSupport</code> class	and implement our business
				logic here, usually delegating the call to the business layer.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">/**
 * JAX-RPC compliant RemoteAccountService implementation that simply delegates
 * to the AccountService implementation in the root web application context.
 *
 * This wrapper class is necessary because JAX-RPC requires working with
 * RMI interfaces. If an existing service needs to be exported, a wrapper that
 * extends ServletEndpointSupport for simple application context access is
 * the simplest JAX-RPC compliant way.
 *
 * This is the class registered with the server-side JAX-RPC implementation.
 * In the case of Axis, this happens in "server-config.wsdd" respectively via
 * deployment calls. The Web Service tool manages the life-cycle of instances
 * of this class: A Spring application context can just be accessed here.
 */</span></em>
public class AccountServiceEndpoint extends ServletEndpointSupport implements RemoteAccountService {
    
    private AccountService biz;
	
    protected void onInit() {
        this.biz = (AccountService) getWebApplicationContext().getBean("accountService");
    }

    public void insertAccount(Account acc) throws RemoteException {
        biz.insertAccount(acc);
    }
  
    public Account[] getAccounts(String name) throws RemoteException {
        return biz.getAccounts(name);
    }
}</pre><p>Our <code class="classname">AccountServletEndpoint</code> needs to run in the same web
            application as the Spring context to allow for access to Spring's facilities. In case of
            Axis, copy the <code class="classname">AxisServlet</code> definition into your
            <code class="filename">'web.xml'</code>, and set up the endpoint in
            <code class="filename">'server-config.wsdd'</code> (or use the deploy tool).	See the sample
            application JPetStore where the <code class="interfacename">OrderService</code> is exposed as
            a Web Service using Axis.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-web-services-jaxrpc-access"></a>17.5.2.&nbsp;Accessing web services</h3></div></div></div><p>
				Spring has two factory beans to create web service proxies, namely
				<code class="classname">LocalJaxRpcServiceFactoryBean</code> and
				<code class="classname">JaxRpcPortProxyFactoryBean</code>. The former can only return a JAX-RPC
				service class for us to work with. The latter is the full fledged version that can return
				a proxy that implements our business service interface. In this example we use the latter
				to create a proxy for the <code class="interfacename">AccountService</code> endpoint we exposed
				in the previous paragraph. You will see that Spring has great support for web services
				requiring little coding efforts - most of the setup is done in the Spring configuration
				file as usual:</p><pre class="programlisting">&lt;bean id="accountWebService" class="org.springframework.remoting.jaxrpc.JaxRpcPortProxyFactoryBean"&gt;
    &lt;property name="serviceInterface" value="example.RemoteAccountService"/&gt;
    &lt;property name="wsdlDocumentUrl" value="http://localhost:8080/account/services/accountService?WSDL"/&gt;
    &lt;property name="namespaceUri" value="http://localhost:8080/account/services/accountService"/&gt;
    &lt;property name="serviceName" value="AccountService"/&gt;
    &lt;property name="portName" value="AccountPort"/&gt;
&lt;/bean&gt;</pre><p>
				Where <code class="literal">serviceInterface</code> is our remote business interface the clients will use.
				<code class="literal">wsdlDocumentUrl</code> is the URL for the WSDL file. Spring needs this a startup time to create the JAX-RPC Service.
				<code class="literal">namespaceUri</code> corresponds to the targetNamespace in the .wsdl file.
				<code class="literal">serviceName</code> corresponds to the serivce name in the .wsdl file.
				<code class="literal">portName</code> corresponds to the port name in the .wsdl file.
			</p><p>Accessing the Web Service is now very easy as we have a bean factory for it that will expose it
			as <code class="literal">RemoteAccountService</code> interface. We can wire this up in Spring:</p><pre class="programlisting">&lt;bean id="client" class="example.AccountClientImpl"&gt;
    ...
    &lt;property name="service" ref="accountWebService"/&gt;
&lt;/bean&gt;</pre><p>From the client code we can access the web service just as if it
			was a normal class, except that it throws <code class="exceptionname">RemoteException</code>.</p><pre class="programlisting">public class AccountClientImpl {

    private RemoteAccountService service;
    
    public void setService(RemoteAccountService service) {
        this.service = service;
    }
    
    public void foo() {
       try {
           service.insertAccount(...);
        } catch (RemoteException ex) {
           <em class="lineannotation"><span class="lineannotation">// ouch</span></em>
        }
     }
}
</pre><p>We can get rid of the checked <code class="exceptionname">RemoteException</code> since
			Spring supports automatic conversion to its corresponding unchecked
			<code class="exceptionname">RemoteException</code>. This requires that we provide a non-RMI
			interface also. Our configuration is now:</p><pre class="programlisting">&lt;bean id="accountWebService" class="org.springframework.remoting.jaxrpc.JaxRpcPortProxyFactoryBean"&gt;
    &lt;property name="serviceInterface" value="example.AccountService"/&gt;
    &lt;property name="portInterface" value="example.RemoteAccountService"/&gt;
&lt;/bean&gt;</pre><p>Where <code class="literal">serviceInterface</code> is changed to our non RMI interface. Our RMI
				interface is now defined using the property	<code class="literal">portInterface</code>. Our client
				code can now avoid handling <code class="exceptionname">java.rmi.RemoteException</code>:</p><pre class="programlisting">public class AccountClientImpl {

    private AccountService service;
    
    public void setService(AccountService service) {
        this.service = service;
    }
    
    public void foo() {
        service.insertAccount(...);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-web-services-jaxrpc-mapping-registration"></a>17.5.3.&nbsp;Register Bean Mappings</h3></div></div></div><p>To transfer complex objects over the wire such as <code class="classname">Account</code> we must
			register bean mappings on the client side.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>On the server side using Axis registering bean mappings is usually done in
				the <code class="filename">'server-config.wsdd'</code> file.</p></td></tr></table></div><p>We will use Axis to register bean mappings on the client side. To do this we need to
			register the bean mappings programmatically:</p><pre class="programlisting">public class AxisPortProxyFactoryBean extends JaxRpcPortProxyFactoryBean {

   protected void postProcessJaxRpcService(Service service) {
      TypeMappingRegistry registry = service.getTypeMappingRegistry();
      TypeMapping mapping = registry.createTypeMapping();
      registerBeanMapping(mapping, Account.class, "Account");
      registry.register("http://schemas.xmlsoap.org/soap/encoding/", mapping);
   }

   protected void registerBeanMapping(TypeMapping mapping, Class type, String name) {
      QName qName = new QName("http://localhost:8080/account/services/accountService", name);
      mapping.register(type, qName,
          new BeanSerializerFactory(type, qName),
          new BeanDeserializerFactory(type, qName));
   }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-web-services-jaxrpc-handler-registration"></a>17.5.4.&nbsp;Registering our own Handler</h3></div></div></div><p>In this section we will register our own
			<code class="interfacename">javax.rpc.xml.handler.Handler</code> to the web service proxy
			where we can do custom code before the SOAP message is sent over the wire.
			The <code class="interfacename">Handler</code> is a callback interface. There is a convenience
			base class provided in <code class="filename">jaxrpc.jar</code>, namely
			<code class="classname">javax.rpc.xml.handler.GenericHandler</code> that we will extend:</p><pre class="programlisting">public class AccountHandler extends GenericHandler {

    public QName[] getHeaders() {
        return null;
    }

    public boolean handleRequest(MessageContext context) {
        SOAPMessageContext smc = (SOAPMessageContext) context;
        SOAPMessage msg = smc.getMessage();

        try {
            SOAPEnvelope envelope = msg.getSOAPPart().getEnvelope();
            SOAPHeader header = envelope.getHeader();
            <em class="lineannotation"><span class="lineannotation">// ...</span></em>
		
        } catch (SOAPException e) {
            throw new JAXRPCException(e);
        }

        return true;
    }
}</pre><p>What we need to do now is to register our AccountHandler to JAX-RPC Service so it would
            invoke <code class="methodname">handleRequest(..)</code> before the message is sent over the wire.
            Spring has at this time of writing no declarative support for registering handlers, so we must
            use the programmatic approach. However Spring has made it very easy for us to do this as we can
            override the <code class="methodname">postProcessJaxRpcService(..)</code> method that is designed for
            this:</p><pre class="programlisting">public class AccountHandlerJaxRpcPortProxyFactoryBean extends JaxRpcPortProxyFactoryBean {

    protected void postProcessJaxRpcService(Service service) {
        QName port = new QName(this.getNamespaceUri(), this.getPortName());
        List list = service.getHandlerRegistry().getHandlerChain(port);
        list.add(new HandlerInfo(AccountHandler.class, null, null));

        logger.info("Registered JAX-RPC Handler [" + AccountHandler.class.getName() + "] on port " + port);
    }
}</pre><p>The last thing we must remember to do is to change the Spring configuration to use our
            factory bean:</p><pre class="programlisting">&lt;bean id="accountWebService" class="example.AccountHandlerJaxRpcPortProxyFactoryBean"&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- ... --&gt;</span></em>
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-web-services-xfire"></a>17.5.5.&nbsp;Exposing web services using XFire</h3></div></div></div><p>XFire is a lightweight SOAP library, hosted by Codehaus. Exposing XFire is done using a
            XFire context that shipping with XFire itself in combination with a RemoteExporter-style bean
            you have to add to your <code class="interfacename">WebApplicationContext</code>. As with all
            methods that allow you to expose service, you have to create a
            <code class="classname">DispatcherServlet</code> with a corresponding
            <code class="interfacename">WebApplicationContext</code> containing the services you will be
            exposing:</p><pre class="programlisting">&lt;servlet&gt;
  &lt;servlet-name&gt;xfire&lt;/servlet-name&gt;
  &lt;servlet-class&gt;
    org.springframework.web.servlet.DispatcherServlet
  &lt;/servlet-class&gt;
&lt;/servlet&gt;</pre><p>You also have to link in the XFire configuration. This is done by adding a context
            file to the <code class="literal">contextConfigLocations</code> context parameter picked up by the
            <code class="classname">ContextLoaderListener</code> (or <code class="classname">ContextLoaderServlet</code>
            for that matter).</p><pre class="programlisting">&lt;context-param&gt;
  &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
  &lt;param-value&gt;
    classpath:org/codehaus/xfire/spring/xfire.xml
  &lt;/param-value&gt;
&lt;/context-param&gt;

&lt;listener&gt;
  &lt;listener-class&gt;
    org.springframework.web.context.ContextLoaderListener
  &lt;/listener-class&gt;
&lt;/listener&gt;</pre><p>After you added a servlet mapping (mapping <code class="literal">/*</code> to the XFire servlet
            declared above) you only have to add one extra bean to expose the service using XFire.
            Add for example the following configuration in your <code class="filename">'xfire-servlet.xml'</code>
            file:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean name="/Echo" class="org.codehaus.xfire.spring.remoting.XFireExporter"&gt;
    &lt;property name="serviceInterface" value="org.codehaus.xfire.spring.Echo"/&gt;
    &lt;property name="serviceBean"&gt;
    	&lt;bean class="org.codehaus.xfire.spring.EchoImpl"/&gt;
    &lt;/property&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- the XFire bean is defined in the <code class="filename">xfire.xml</code> file --&gt;</span></em>
    &lt;property name="xfire" ref="xfire"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>XFire handles the rest. It introspects your service interface and generates a WSDL from it.
            Parts of this documentation have been taken from the XFire site; for more detailed information
            on XFire Spring integration, navigate to
            <a href="http://docs.codehaus.org/display/XFIRE/Spring" target="_top">http://docs.codehaus.org/display/XFIRE/Spring</a>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-jms"></a>17.6.&nbsp;JMS</h2></div></div></div><p>It is also possible to expose services transparently using JMS as the underlying
	    communication protocol. The JMS remoting support in the Spring Framework is pretty basic -
	    it sends and receives on the <code class="interfacename">same thread</code> and in the
	    <span class="emphasis"><em>same non-transactional</em></span> <code class="interfacename">Session</code>, and as
	    such throughput will be very implementation dependent.</p><p>The following interface is used on both the server and the client side.</p><pre class="programlisting">package com.foo;

public interface CheckingAccountService {

   void cancelAccount(Long accountId);
}</pre><p>The following simple implementation of the above interface is used on the server-side.</p><pre class="programlisting">package com.foo;

public class SimpleCheckingAccountService implements CheckingAccountService {

   public void cancelAccount(Long accountId) {
      System.out.println("Cancelling account [" + accountId + "]");
   }
}</pre><p>This configuration file contains the JMS-infrastructure beans that are shared on both
        the client and server.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-2.0.xsd"&gt;

   &lt;bean id="connectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory"&gt;
      &lt;property name="brokerURL" value="tcp://ep-t43:61616"/&gt;
   &lt;/bean&gt;

   &lt;bean id="queue" class="org.apache.activemq.command.ActiveMQQueue"&gt;
      &lt;constructor-arg value="mmm"/&gt;
   &lt;/bean&gt;

&lt;/beans&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-jms-server"></a>17.6.1.&nbsp;Server-side configuration</h3></div></div></div><p>On the server, you just need to expose the service object using the
	        <code class="classname">JmsInvokerServiceExporter</code>.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans
         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd"&gt;

   &lt;bean id="checkingAccountService"
        class="org.springframework.jms.remoting.JmsInvokerServiceExporter"&gt;
      &lt;property name="serviceInterface" value="com.foo.CheckingAccountService"/&gt;
      &lt;property name="service"&gt;
         &lt;bean class="com.foo.SimpleCheckingAccountService"/&gt;
      &lt;/property&gt;
   &lt;/bean&gt;

   &lt;bean class="org.springframework.jms.listener.SimpleMessageListenerContainer"&gt;
      &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
      &lt;property name="destination" ref="queue"/&gt;
      &lt;property name="concurrentConsumers" value="3"/&gt;
      &lt;property name="messageListener" ref="checkingAccountService"/&gt;
   &lt;/bean&gt;

&lt;/beans&gt;</pre><pre class="programlisting">package com.foo;

import org.springframework.context.support.ClassPathXmlApplicationContext;

public class Server {

   public static void main(String[] args) throws Exception {
      new ClassPathXmlApplicationContext(new String[]{"com/foo/server.xml", "com/foo/jms.xml"});
   }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-jms-client"></a>17.6.2.&nbsp;Client-side configuration</h3></div></div></div><p>The client merely needs to create a client-side proxy that will implement the agreed
	        upon interface (<code class="interfacename">CheckingAccountService</code>). The resulting
	        object created off the back of the following bean definition can be injected into other
	        client side objects, and the proxy will take care of forwarding the call to the
	        server-side object via JMS.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-2.0.xsd"&gt;

   &lt;bean id="checkingAccountService"
        class="org.springframework.jms.remoting.JmsInvokerProxyFactoryBean"&gt;
      &lt;property name="serviceInterface" value="com.foo.CheckingAccountService"/&gt;
      &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
      &lt;property name="queue" ref="queue"/&gt;
   &lt;/bean&gt;

&lt;/beans&gt;</pre><pre class="programlisting">package com.foo;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class Client {

   public static void main(String[] args) throws Exception {
      ApplicationContext ctx = new ClassPathXmlApplicationContext(
               new String[]{"com/foo/client.xml", "com/foo/jms.xml"});
      CheckingAccountService service = (CheckingAccountService) ctx.getBean("checkingAccountService");
      service.cancelAccount(new Long(10));
   }
}</pre></div><p>You may also wish to investigate the support provided by the
	    <a href="http://lingo.codehaus.org/" target="_top">Lingo</a> project, which (to quote the
	    homepage blurb) &#8220;<span class="quote"><span class="emphasis"><em>... is a lightweight POJO based remoting and messaging library
	    based on the Spring Framework's remoting libraries which extends it to support JMS.</em></span></span>&#8221;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-autodection-remote-interfaces"></a>17.7.&nbsp;Auto-detection is not implemented for remote interfaces</h2></div></div></div><p>
            The main reason why auto-detection of implemented interfaces does not occur for
            remote interfaces is to avoid opening too many doors to remote callers. The target
            object might implement internal callback interfaces like <code class="interfacename">InitializingBean</code> or
            <code class="interfacename">DisposableBean</code> which one would not want to expose to callers.
        </p><p>
            Offering a proxy with all interfaces implemented by the target usually does not
            matter in the local case. But when exporting a remote service, you should expose
            a specific service interface, with specific operations intended for remote usage.
            Besides internal callback interfaces, the target might implement multiple business
            interfaces, with just one of them intended for remote exposure. For these reasons,
            we <span class="emphasis"><em>require</em></span> such a service interface to be specified.
        </p><p>
            This is a trade-off between configuration convenience and the risk of accidental
            exposure of internal methods. Always specifying a service interface is not too much
            effort, and puts you on the safe side regarding controlled exposure of specific
            methods.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-considerations"></a>17.8.&nbsp;Considerations when choosing a technology</h2></div></div></div><p>
			Each and every technology presented here has its drawbacks. You should carefully
			consider you needs, the services your exposing and the objects you'll be sending
			over the wire when choosing a technology.
		</p><p>
			When using RMI, it's not possible to access the objects through the HTTP protocol,
			unless you're tunneling the RMI traffic. RMI is a fairly heavy-weight protocol
			in that it support full-object serialization which is important when using a
			complex data model that needs serialization over the wire. However, RMI-JRMP
			is tied to Java clients: It is a Java-to-Java remoting solution.
		</p><p>
			Spring's HTTP invoker is a good choice if you need HTTP-based remoting but also
			rely on Java serialization. It shares the basic infrastructure with RMI invokers,
			just using HTTP as transport. Note that HTTP invokers are not only limited to
			Java-to-Java remoting but also to Spring on both the client and server side.
			(The latter also applies to Spring's RMI invoker for non-RMI interfaces.)
		</p><p>
			Hessian and/or Burlap might provide significant value when operating in a
			heterogeneous environment, because they explicitly allow for non-Java clients.
			However, non-Java support is still limited. Known issues include the serialization
			of Hibernate objects in combination with lazily-initialized collections. If you
			have such a data model, consider using RMI or HTTP invokers instead of Hessian.
		</p><p>
			JMS can be useful for providing clusters of services and allowing the JMS broker
            to take care of load balancing, discovery and auto-failover.
            By default Java serialization is used when using JMS remoting but
            the JMS provider could use a different mechanism for the wire formatting,
            such as XStream to allow servers to be implemented in other technologies.
		</p><p>
			Last but not least, EJB has an advantage over RMI in that it supports standard
			role-based authentication and authorization and remote transaction propagation.
			It is possible to get RMI invokers or HTTP invokers to support security context
			propagation as well, although this is not provided by core Spring: There are
			just appropriate hooks for plugging in third-party or custom solutions here.
		</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="ejb"></a>Chapter&nbsp;18.&nbsp;Enterprise Java Bean (EJB) integration</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ejb-introduction"></a>18.1.&nbsp;Introduction</h2></div></div></div><p>
		    As a lightweight container, Spring is often considered an EJB
		    replacement. We do believe that for many if not most applications and use
		    cases, Spring as a container, combined with its rich supporting
		    functionality in the area of transactions, ORM and JDBC access, is a better
		    choice than implementing equivalent functionality via an EJB container and
		    EJBs.
        </p><p>
		    However, it is important to note that using Spring does not prevent
		    you from using EJBs. In fact, Spring makes it much easier to access EJBs and
		    implement EJBs and functionality within them. Additionally, using Spring to
		    access services provided by EJBs allows the implementation of those services
		    to later transparently be switched between local EJB, remote EJB, or POJO
		    (plain old Java object) variants, without the client code having to
		    be changed.
        </p><p>
		    In this chapter, we look at how Spring can help you access and
		    implement EJBs. Spring provides particular value when accessing stateless
		    session beans (SLSBs), so we'll begin by discussing this.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ejb-access"></a>18.2.&nbsp;Accessing EJBs</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ejb-access-concepts"></a>18.2.1.&nbsp;Concepts</h3></div></div></div><p>
				To invoke a method on a local or remote stateless session bean,
				client code must normally perform a JNDI lookup to obtain the (local or
				remote) EJB Home object, then use a 'create' method call on that object
				to obtain the actual (local or remote) EJB object. One or more methods
				are then invoked on the EJB.
            </p><p>
				To avoid repeated low-level code, many EJB applications use the
				Service Locator and Business Delegate patterns. These are better than
				spraying JNDI lookups throughout client code, but their usual
				implementations have significant disadvantages. For example:
            </p><div class="itemizedlist"><ul type="disc"><li><p>
						Typically code using EJBs depends on Service Locator or
						Business Delegate singletons, making it hard to test.
					</p></li><li><p>
						In the case of the Service Locator pattern used without a
						Business Delegate, application code still ends up having to invoke
						the create() method on an EJB home, and deal with the resulting
						exceptions. Thus it remains tied to the EJB API and the complexity
						of the EJB programming model.
					</p></li><li><p>
						Implementing the Business Delegate pattern typically results
						in significant code duplication, where we have to write numerous
						methods that simply call the same method on the EJB.
					</p></li></ul></div><p>
				The Spring approach is to allow the creation and use of proxy objects,
				normally configured inside a Spring container, which act as codeless
				business delegates. You do not need	to write another Service Locator, another
				JNDI lookup, or duplicate methods in a hand-coded Business Delegate unless
				you are actually adding real value in such code.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ejb-access-local"></a>18.2.2.&nbsp;Accessing local SLSBs</h3></div></div></div><p>
				Assume that we have a web controller that needs to use a local
				EJB. We&#8217;ll follow best practice and use the EJB Business Methods
				Interface pattern, so that the EJB&#8217;s local interface extends a non
				EJB-specific business methods interface. Let&#8217;s call this business
				methods interface <code class="classname">MyComponent</code>.
			</p><pre class="programlisting">public interface MyComponent {
    ...
}</pre><p>
				One of the main reasons to use the Business Methods Interface pattern
				is to ensure that synchronization between method signatures in local
				interface and bean implementation class is automatic. Another reason is
				that it later makes it much easier for us to switch to a POJO (plain old
				Java object) implementation of the service if it makes sense to do so.
				Of course we&#8217;ll also need to implement the local home interface and
				provide an implementation class that implements <code class="classname">SessionBean</code>
				and the <code class="classname">MyComponent</code> business methods interface. Now the
				only Java coding we&#8217;ll  need to do to hook up our web tier controller to the
				EJB implementation is to expose a setter method of type <code class="classname">MyComponent</code>
				on the controller. This will save the reference as an instance variable in the
				controller:
			</p><pre class="programlisting">private MyComponent myComponent;

public void setMyComponent(MyComponent myComponent) {
    this.myComponent = myComponent;
}</pre><p>
				We can subsequently use this instance variable in any business
				method in the controller. Now assuming we are obtaining our controller
				object out of a Spring container, we can (in the same context) configure a
				<code class="classname">LocalStatelessSessionProxyFactoryBean</code> instance, which
				will be the EJB proxy object. The configuration of the proxy, and setting of
				the <code class="literal">myComponent</code> property of the controller is done
				with a configuration entry such as:
			</p><pre class="programlisting">&lt;bean id="myComponent"
      class="org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean"&gt;
  &lt;property name="jndiName" value="myComponent"/&gt;
  &lt;property name="businessInterface" value="com.mycom.MyComponent"/&gt;
&lt;/bean&gt;

&lt;bean id="myController" class="com.mycom.myController"&gt;
  &lt;property name="myComponent" ref="myComponent"/&gt;
&lt;/bean&gt;</pre><p>
				There&#8217;s a lot of work happening behind the scenes, courtesy of
				the Spring AOP framework, although you aren&#8217;t forced to work with AOP
				concepts to enjoy the results. The <code class="literal">myComponent</code> bean
				definition creates a proxy for the EJB, which implements the business
				method interface. The EJB local home is cached on startup, so there&#8217;s
				only a single JNDI lookup. Each time the EJB is invoked, the proxy
				invokes the <code class="literal">classname</code> method on the local EJB and
				invokes the	corresponding business method on the EJB.
			</p><p>
				The <code class="literal">myController</code> bean definition sets the
				<code class="literal">myComponent</code> property of the controller class to the
				EJB proxy.
			</p><p>
				This EJB access mechanism delivers huge simplification of
				application code: the web tier code (or other EJB client code) has no
				dependence on the use of EJB. If we want to replace this EJB reference
				with a POJO or a mock object or other test stub, we could simply change
				the <code class="literal">myComponent</code> bean definition without changing a
				line of Java code. Additionally, we haven&#8217;t had to write a single line of
				JNDI lookup or other EJB plumbing code as part of our application.
			</p><p>
				Benchmarks and experience in real applications indicate that the
				performance overhead of this approach (which involves reflective
				invocation of the target EJB) is minimal, and is typically undetectable
				in typical use. Remember that we don&#8217;t want to make fine-grained calls
				to EJBs anyway, as there&#8217;s a cost associated with the EJB infrastructure
				in the application server.
			</p><p>
				There is one caveat with regards to the JNDI lookup. In a bean
				container, this class is normally best used as a singleton (there simply
				is no reason to make it a prototype). However, if that bean container
				pre-instantiates singletons (as do the various XML
				<code class="classname">ApplicationContext</code> variants)
				you may have a problem if the bean container is loaded before the EJB
				container loads the target EJB. That is because the JNDI lookup will be
				performed in the <code class="literal">init()</code> method of this class and then
				cached, but the EJB will not have been bound at the target location yet.
				The solution is to not pre-instantiate this factory object, but allow it
				to be created on first use. In the XML containers, this is controlled via
				the <code class="literal">lazy-init</code> attribute.
			</p><p>
				Although this will not be of interest to the majority of Spring
				users, those doing programmatic AOP work with EJBs may want to look at
				<code class="classname">LocalSlsbInvokerInterceptor</code>.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ejb-access-remote"></a>18.2.3.&nbsp;Accessing remote SLSBs</h3></div></div></div><p>
				Accessing remote EJBs is essentially identical to accessing local
				EJBs, except that the
				<code class="classname">SimpleRemoteStatelessSessionProxyFactoryBean</code> is used.
				Of course, with or without Spring, remote invocation semantics apply; a
				call to a method on an object in another VM in another computer does
				sometimes have to be treated differently in terms of usage scenarios and
				failure handling.
			</p><p>
				Spring's EJB client support adds one more advantage over the
				non-Spring approach. Normally it is problematic for EJB client code to
				be easily switched back and forth between calling EJBs locally or
				remotely. This is because the remote interface methods must declare that
				they throw <code class="classname">RemoteException</code>, and client code must deal
				with this, while the local interface methods don't. Client code
				written for local EJBs which needs to be moved to remote EJBs
				typically has to be modified to add handling for the remote exceptions,
				and client code written for remote EJBs which needs to be moved to local
				EJBs, can either stay the same but do a lot of unnecessary handling of
				remote exceptions, or needs to be modified to remove that code. With the
				Spring remote EJB proxy, you can instead not declare any thrown
				<code class="classname">RemoteException</code> in your Business Method Interface and
				implementing EJB code, have a remote interface which is identical except
				that it does throw <code class="classname">RemoteException</code>, and rely on the
				proxy to dynamically treat the two interfaces as if they were the same.
				That is, client code does not have to deal with the checked
				<code class="classname">RemoteException</code> class. Any actual
				<code class="classname">RemoteException</code> that is thrown during the EJB
				invocation will be re-thrown as the non-checked
				<code class="classname">RemoteAccessException</code> class, which is a subclass of
				<code class="classname">RuntimeException</code>. The target service can then be
				switched at will between a local EJB or remote EJB (or even plain Java
				object) implementation, without the client code knowing or caring. Of
				course, this is optional; there is nothing stopping you from declaring
				<code class="classname">RemoteExceptions</code> in your business interface.
			</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ejb-implementation"></a>18.3.&nbsp;Using Spring's convenience EJB implementation classes</h2></div></div></div><p>
			Spring also provides convenience classes to help you implement EJBs.
			These are designed to encourage the good practice of putting business
			logic behind EJBs in POJOs, leaving EJBs responsible for transaction
			demarcation and (optionally) remoting.
		</p><p>
			To implement a Stateless or Stateful session bean, or a Message Driven
			bean, you need only derive your implementation class from
			<code class="classname">AbstractStatelessSessionBean</code>,
			<code class="classname">AbstractStatefulSessionBean</code>, and
			<code class="classname">AbstractMessageDrivenBean</code>/<code class="classname">AbstractJmsMessageDrivenBean</code>,
			respectively.
		</p><p>
			Consider an example Stateless Session bean which actually delegates
			the implementation to a plain java service object. We have the business	interface:
		</p><pre class="programlisting">public interface MyComponent {
    public void myMethod(...);
    ...
}</pre><p>We also have the plain Java implementation object:</p><pre class="programlisting">public class MyComponentImpl implements MyComponent {
    public String myMethod(...) {
        ...
    }
    ...
}</pre><p>And finally the Stateless Session Bean itself:</p><pre class="programlisting">public class MyComponentEJB extends AbstractStatelessSessionBean
        implements MyComponent {

    MyComponent myComp;

    /**
     * Obtain our POJO service object from the BeanFactory/ApplicationContext
     * @see org.springframework.ejb.support.AbstractStatelessSessionBean#onEjbCreate()
     */
    protected void onEjbCreate() throws CreateException {
        myComp = (MyComponent) getBeanFactory().getBean(
            ServicesConstants.CONTEXT_MYCOMP_ID);
    }

    // for business method, delegate to POJO service impl.
    public String myMethod(...) {
        return myComp.myMethod(...);
    }
    ...
}</pre><p>
			The Spring EJB support base classes will by default create and load
			a Spring IoC container as part of their lifecycle, which is then available
			to the EJB (for example, as used in the code above to obtain the POJO
			service object). The loading is	done via a strategy object which is a subclass of
			<code class="classname">BeanFactoryLocator</code>. The actual implementation of
			<code class="classname">BeanFactoryLocator</code> used by default is
			<code class="classname">ContextJndiBeanFactoryLocator</code>, which creates the
			ApplicationContext from a resource locations specified as a JNDI
			environment variable (in the case of the EJB classes, at
			<code class="literal">java:comp/env/ejb/BeanFactoryPath</code>). If there is a need
			to change the BeanFactory/ApplicationContext loading strategy, the default
			<code class="classname">BeanFactoryLocator</code> implementation used may be overridden
			by calling the <code class="literal">setBeanFactoryLocator()</code> method, either
			in <code class="literal">setSessionContext()</code>, or in the actual constructor of
			the EJB. Please see the Javadocs for more details.
		</p><p>
			As described in the Javadocs, Stateful Session beans expecting to be
			passivated and reactivated as part of their lifecycle, and which use a
			non-serializable container instance (which is the normal case) will have
			to manually call <code class="literal">unloadBeanFactory()</code> and
			<code class="literal">loadBeanFactory</code> from <code class="literal">ejbPassivate</code>
			and <code class="literal">ejbActivate</code>, respectively, to unload and reload the
			BeanFactory on passivation and activation, since it can not be saved by
			the EJB container.
		</p><p>
			The default behavior of the <code class="classname">ContextJndiBeanFactoryLocator</code>
			classes which is to load an <code class="classname">ApplicationContext</code> for the
			use of the EJB is adequate for some situations. However, it is problematic when
			the <code class="classname">ApplicationContext</code> is loading a number
			of beans, or the initialization of those beans is time consuming or memory
			intensive (such as a Hibernate <code class="classname">SessionFactory</code> initialization, for
			example), since every EJB will have their own copy. In this case, the user
			may want to override the default <code class="classname">ContextJndiBeanFactoryLocator</code>
			usage and use another <code class="classname">BeanFactoryLocator</code> variant, such as the
			<code class="classname">ContextSingletonBeanFactoryLocator</code> which can load and use a
			shared container to be used by multiple EJBs or other clients. Doing this is relatively
			simple, by adding code similar to this to the EJB:
		</p><pre class="programlisting">   /**
    * Override default BeanFactoryLocator implementation
    * @see javax.ejb.SessionBean#setSessionContext(javax.ejb.SessionContext)
    */
   public void setSessionContext(SessionContext sessionContext) {
       super.setSessionContext(sessionContext);
       setBeanFactoryLocator(ContextSingletonBeanFactoryLocator.getInstance());
       setBeanFactoryLocatorKey(ServicesConstants.PRIMARY_CONTEXT_ID);
   }</pre><p>
			You would then need to create a bean definition file named <code class="literal">beanRefContext.xml</code>.
			This file defines all bean factories (usually in the form of application contexts) that may be used
			in the EJB. In many cases, this file will only contain a single bean definition such as this (where
			<code class="literal">businessApplicationContext.xml</code> contains the bean	definitions for all business
			service POJOs):
		</p><pre class="programlisting">&lt;beans&gt;
    &lt;bean id="businessBeanFactory" class="org.springframework.context.support.ClassPathXmlApplicationContext"&gt;
        &lt;constructor-arg value="businessApplicationContext.xml" /&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</pre><p>
		In the above example, the <code class="literal">ServicesConstants.PRIMARY_CONTEXT_ID</code> constant
		would be defined as follows:
    </p><pre class="programlisting">public static final String ServicesConstants.PRIMARY_CONTEXT_ID = "businessBeanFactory";</pre><p>
		Please see the respective Javadocs for the <code class="classname">BeanFactoryLocator</code> and
		<code class="classname">ContextSingletonBeanFactoryLocator</code> classes for more information on
		their usage.
	</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="jms"></a>Chapter&nbsp;19.&nbsp;JMS</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-introduction"></a>19.1.&nbsp;Introduction</h2></div></div></div><p>Spring provides a JMS abstraction framework that simplifies the use
    of the JMS API and shields the user from differences between the JMS 1.0.2
    and 1.1 APIs.</p><p>JMS can be roughly divided into two areas of functionality, namely the
    production and consumption of messages. The <code class="classname">JmsTemplate</code>
    class is used for message production and synchronous message reception. For
    asynchronous reception similar to J2EE's message-driven bean style, Spring
    provides a number of message listener containers that are used to create
    Message-Driven POJOs (MDPs).</p><div class="sidebar"><p class="title"><b>Domain Unification</b></p><p>There are two major releases of the JMS specification, 1.0.2 and
			1.1.</p><p>JMS 1.0.2 defined two types of messaging domains, point-to-point
			(Queues) and publish/subscribe (Topics). The 1.0.2 API reflected these two
			messaging domains by providing a parallel class hierarchy for each domain.
			As a result, a client application became domain specific in its use of
			the JMS API. JMS 1.1 introduced the concept of domain unification that
			minimized both the functional differences and client API differences
			between the two domains. As an example of a functional difference that was
			removed, if you use a JMS 1.1 provider you can transactionally consume a
			message from one domain and produce a message on the other using the same
			<code class="literal">Session</code>.</p><p>Note: The JMS 1.1 specification was released in April 2002 and
			incorporated as part of J2EE 1.4 in November 2003. As a result, common
			J2EE 1.3 application servers which are still in widespread use (such as
			BEA WebLogic 8.1 and IBM WebSphere 5.1) are based on JMS 1.0.2.</p></div><p>The package <code class="literal">org.springframework.jms.core</code> provides
    the core functionality for using JMS. It contains JMS template classes
    that simplifies the use of the JMS by handling the creation and release of
    resources, much like the <code class="classname">JdbcTemplate</code> does for
    JDBC. The design principle common to Spring template classes is to provide
    helper methods to perform common operations and for more sophisticated
    usage, delegate the essence of the processing task to user implemented
    callback interfaces. The JMS template follows the same design. The classes
    offer various convenience methods for the sending of messages, consuming a
    message synchronously, and exposing the JMS session and message producer
    to the user.</p><p>The package <code class="literal">org.springframework.jms.support</code>
    provides JMSException translation functionality. The translation converts
    the checked <code class="classname">JMSException</code> hierarchy to a mirrored
    hierarchy of unchecked exceptions. If there are any provider specific
    subclasses of the checked <code class="classname">javax.jms.JMSException</code>,
    this exception is wrapped in the unchecked
    <code class="classname">UncategorizedJmsException</code>.</p><p>The package <code class="literal">org.springframework.jms.support.converter</code> provides a
    <code class="interfacename">MessageConverter</code> abstraction to convert between Java objects
    and JMS messages.</p><p>The package <code class="literal">org.springframework.jms.support.destination</code> provides
    various strategies for managing JMS destinations, such as providing a
    service locator for destinations stored in JNDI.</p><p>Finally, the package
    <code class="literal">org.springframework.jms.connection</code> provides an
    implementation of the <code class="classname">ConnectionFactory</code> suitable
    for use in standalone applications. It also contains an implementation of
    Spring's <code class="interfacename">PlatformTransactionManager</code> for
    JMS (the cunningly named <code class="classname">JmsTransactionManager</code>).
    This allows for seamless integration of JMS as a transactional resource into
    Spring's transaction management mechanisms.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-using"></a>19.2.&nbsp;Using Spring JMS</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-jmstemplate"></a>19.2.1.&nbsp;<code class="classname">JmsTemplate</code></h3></div></div></div><p>There are two variants of the functionality offered by the
			<code class="classname">JmsTemplate</code>: the <code class="classname">JmsTemplate</code>
			uses the JMS 1.1 API, and the subclass <code class="classname">JmsTemplate102</code>
			uses the JMS 1.0.2 API.</p><p>Code that uses the <code class="classname">JmsTemplate</code> only needs to
			implement callback interfaces giving them a clearly defined contract. The
			<code class="classname">MessageCreator</code> callback interface creates a message
			given a <code class="interfacename">Session</code> provided by the calling code
			in <code class="classname">JmsTemplate</code>. In order to allow for more complex
			usage of the JMS API, the callback <code class="classname">SessionCallback</code>
			provides the user with the JMS session and the callback
			<code class="classname">ProducerCallback</code> exposes a
			<code class="interfacename">Session</code> and
			<code class="interfacename">MessageProducer</code> pair.</p><p>The JMS API exposes two types of send methods, one that takes
			delivery mode, priority, and time-to-live as Quality of Service (QOS)
			parameters and one that takes no QOS parameters which uses default values.
			Since there are many send methods in <code class="classname">JmsTemplate</code>,
			the setting of the QOS parameters have been exposed as bean properties to
			avoid duplication in the number of send methods. Similarly, the timeout
			value for synchronous receive calls is set using the property
			<code class="classname">setReceiveTimeout</code>.</p><p>Some JMS providers allow the setting of default QOS values
			administratively through the configuration of the ConnectionFactory. This
			has the effect that a call to <code class="classname">MessageProducer</code>'s
			send method <code class="methodname">send(Destination destination, Message
			message)</code> will use different QOS default values than those
			specified in the JMS specification. In order to provide consistent
			management of QOS values, the <code class="classname">JmsTemplate</code> must
			therefore be specifically enabled to use its own QOS values by setting
			the boolean property <span class="property">isExplicitQosEnabled</span>
			to <code class="literal">true</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Instances of the <code class="classname">JmsTemplate</code> class are
				<span class="emphasis"><em>thread-safe once configured</em></span>. This is important because
				it means that you can configure a single instance of a
				<code class="classname">JmsTemplate</code> and then safely inject this
				<span class="emphasis"><em>shared</em></span> reference into multiple collaborators. To be
				clear, the <code class="classname">JmsTemplate</code> is stateful, in that it
				maintains a reference to a <code class="interfacename">ConnectionFactory</code>,
				but this state is <span class="emphasis"><em>not</em></span> conversational state.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-connections"></a>19.2.2.&nbsp;Connections</h3></div></div></div><p>The <code class="classname">JmsTemplate</code> requires a reference to a
			<code class="classname">ConnectionFactory</code>. The
			<code class="classname">ConnectionFactory</code> is part of the JMS
			specification and serves as the entry point for working with JMS. It is
			used by the client application as a factory to create connections with
			the JMS provider and encapsulates various configuration parameters, many
			of which are vendor specific such as SSL configuration options.</p><p>When using JMS inside an EJB, the vendor provides implementations
			of the JMS interfaces so that they can participate in declarative
			transaction management and perform pooling of connections and session.
			In order to use this implementation, J2EE containers typically require
			that you declare a JMS connection factory as a
			<span class="property">resource-ref</span> inside the EJB or servlet deployment
			descriptors. To ensure the use of these features with the
     	<code class="classname">JmsTemplate</code> inside an EJB, the client application
			should ensure that it references the managed implementation of the
			<code class="classname">ConnectionFactory</code>.</p><p>Spring provides an implementation of the
			<code class="classname">ConnectionFactory</code> interface,
			<code class="classname">SingleConnectionFactory</code>, that will return the
			same <code class="classname">Connection</code> on all
			<code class="methodname">createConnection</code> calls and ignore calls to
			<code class="methodname">close.</code> This is useful for testing and
			standalone environments so that the same connection can be used for
			multiple <code class="classname">JmsTemplate</code> calls that may span any
			number of transactions. <code class="classname">SingleConnectionFactory</code>
			takes a reference to a standard <code class="classname">ConnectionFactory</code>
			that would typically come from JNDI.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-destinations"></a>19.2.3.&nbsp;Destination Management</h3></div></div></div><p>Destinations, like ConnectionFactories, are JMS administered
      	objects that can be stored and retrieved in JNDI. When configuring a
      	Spring application context you can use the JNDI factory class
      	<code class="classname">JndiObjectFactoryBean</code> to perform dependency
      	injection on your object's references to JMS destinations. However,
      	often this strategy is cumbersome if there are a large number of
      	destinations in the application or if there are advanced destination
      	management features unique to the JMS provider. Examples of such
      	advanced destination management would be the creation of dynamic
      	destinations or support for a hierarchical namespace of destinations.
      	The <code class="classname">JmsTemplate</code> delegates the resolution of a
      	destination name to a JMS destination object to an implementation of the
      	interface <code class="classname">DestinationResolver</code>.
      	<code class="classname">DynamicDestinationResolver</code> is the default
      	implementation used by <code class="classname">JmsTemplate</code> and
      	accommodates resolving dynamic destinations. A
      	<code class="classname">JndiDestinationResolver</code> is also provided that
      	acts as a service locator for destinations contained in JNDI and
      	optionally falls back to the behavior contained in
      	<code class="classname">DynamicDestinationResolver</code>.</p><p>Quite often the destinations used in a JMS application are only
      	known at runtime and therefore cannot be administratively created when
      	the application is deployed. This is often because there is shared
      	application logic between interacting system components that create
     	destinations at runtime according to a well-known naming convention.
     	Even though the creation of dynamic destinations are not part of the JMS
      	specification, most vendors have provided this functionality. Dynamic
      	destinations are created with a name defined by the user which
      	differentiates them from temporary destinations and are often not
      	registered in JNDI. The API used to create dynamic destinations varies
      	from provider to provider since the properties associated with the
      	destination are vendor specific. However, a simple implementation choice
      	that is sometimes made by vendors is to disregard the warnings in the
      	JMS specification and to use the <code class="classname">TopicSession</code>
      	method <code class="methodname">createTopic(String topicName)</code> or the
      	<code class="classname">QueueSession</code> method
      	<code class="methodname">createQueue(String queueName)</code> to create a new
      	destination with default destination properties. Depending on the vendor
      	implementation, <code class="classname">DynamicDestinationResolver</code> may
      	then also create a physical destination instead of only resolving
      	one.</p><p>The boolean property <span class="property">pubSubDomain</span> is used to
      	configure the <code class="classname">JmsTemplate</code> with knowledge of what
      	JMS domain is being used. By default the value of this property is
      	false, indicating that the point-to-point domain, Queues, will be used.
      	In the 1.0.2 implementation the value of this property determines if the
      	<code class="classname">JmsTemplate</code>'s send operations will send a message
      	to a <code class="interfacename">Queue</code> or to a <code class="interfacename">Topic</code>.
      	This flag has no effect on send operations for
      	the 1.1 implementation. However, in both implementations, this property
      	determines the behavior of dynamic destination resolution via
      	implementations of the <code class="interfacename">DestinationResolver</code> interface.</p><p>You can also configure the <code class="classname">JmsTemplate</code> with
      	a default destination via the property
      	<span class="property">defaultDestination</span>. The default destination will be
      	used with send and receive operations that do not refer to a specific
      	destination.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-mdp"></a>19.2.4.&nbsp;Message Listener Containers</h3></div></div></div><p>One of the most common uses of JMS messages in the EJB world is to
			drive message-driven beans (MDBs). Spring offers a solution to create
			message-driven POJOs (MDPs) in a way that does not tie a user to an EJB
			container. (See the section entitled <a href="#jms-asynchronousMessageReception" title="19.4.2.&nbsp;Asynchronous Reception - Message-Driven POJOs">Section&nbsp;19.4.2, &#8220;Asynchronous Reception - Message-Driven POJOs&#8221;</a>
			for detailed coverage of Spring's MDP support.)</p><p>A message listener container is used to receive messages
			from a JMS message queue and drive the MessageListener that is
			injected into it. The listener container is responsible for all
			threading of message reception and dispatches into the listener
			for processing. A message listener container is the intermediary between an
			MDP and a messaging provider, and takes care of registering to receive messages,
			participating in transactions, resource acquisition and release, exception
			conversion and suchlike. This allows you as an application developer to write
			the (possibly complex) business logic associated with receiving a message
			(and possibly responding to it), and delegates boilerplate JMS
			infrastructure concerns to the framework.</p><p>There are three standard JMS message listener containers packaged
			with Spring, each with its specialised feature set.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="jms-mdp-simple"></a>19.2.4.1.&nbsp;<code class="classname">SimpleMessageListenerContainer</code></h4></div></div></div><p>This message listener container is the simplest of the three
				standard flavors. It simply creates a fixed number of JMS sessions
				at startup and uses them throughout the lifespan of the container.
				This container doesn't allow for dynamic adaption to runtime demands
				or participate in externally managed transactions. However,
				it does have the fewest requirements on the JMS provider: This
				listener container only requires simple JMS API compliance.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="jms-mdp-default"></a>19.2.4.2.&nbsp;<code class="classname">DefaultMessageListenerContainer</code></h4></div></div></div><p>This message listener container is the one used in most cases.
				In contrast to <code class="classname">SimpleMessageListenerContainer</code>,
				this container variant does allow for dynamic adaption to runtime
				demands and is able to participate in externally managed transactions.
				Each received message is registered with an XA transaction
				(when configured with a <code class="classname">JtaTransactionManager</code>);
				processing can take advantage of XA transation semantics.
				This listener container strikes a good balance between low
				requirements on the JMS provider and good functionality including
				transaction participation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="jms-mdp-server-session"></a>19.2.4.3.&nbsp;<code class="classname">ServerSessionMessageListenerContainer</code></h4></div></div></div><p>This listener container leverages the JMS ServerSessionPool SPI
				to allow for dynamic management of JMS sessions. The use of this variety
				of message listener container enables the provider to perform dynamic
				runtime tuning but, at the expense of requiring the JMS provider to support
				the ServerSessionPool SPI. If there is no need for provider-driven runtime
				tuning, look at the <code class="classname">DefaultMessageListenerContainer</code>
				or the <code class="classname">SimpleMessageListenerContainer</code> instead.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-tx"></a>19.2.5.&nbsp;Transaction management</h3></div></div></div><p>Spring provides a <code class="classname">JmsTransactionManager</code>
			that manages transactions for a single JMS
			<code class="classname">ConnectionFactory</code>. This allows JMS applications
			to leverage the managed transaction features of Spring as described in
			<a href="#transaction" title="Chapter&nbsp;9.&nbsp;Transaction management">Chapter&nbsp;9, <i>Transaction management</i></a>. The <code class="classname">JmsTransactionManager</code>
			performs local resource transactions, binding a JMS Connection/Session
			pair from the specified <code class="classname">ConnectionFactory</code> to the
			thread. <code class="classname">JmsTemplate</code> automatically detects such
			transactional resources and operates on them accordingly.</p><p>In a J2EE environment, the <code class="classname">ConnectionFactory</code>
			will pool Connections and Sessions, so those resources are efficiently
			reused across transactions. In a standalone environment, using Spring's
			<code class="classname">SingleConnectionFactory</code> will result in a shared
			JMS <code class="classname">Connection</code>, with each transaction having its
			own independent <code class="classname">Session</code>. Alternatively, consider
			the use of a provider-specific pooling adapter such as ActiveMQ's
			<code class="classname">PooledConnectionFactory</code> class.</p><p><code class="classname">JmsTemplate</code> can also be used with the
			<code class="classname">JtaTransactionManager</code> and an XA-capable JMS
			<code class="classname">ConnectionFactory</code> for performing distributed
			transactions. Note that this requires the use of a JTA transaction
			manager as well as a properly XA-configured ConnectionFactory!
			(Check your J2EE server's / JMS provider's documentation.)</p><p>Reusing code across a managed and unmanaged transactional
			environment can be confusing when using the JMS API to create a
			<code class="classname">Session</code> from a <code class="classname">Connection</code>.
			This is because the JMS API has only one factory method to create a
			<code class="classname">Session</code> and it requires values for the
			transaction and acknowledgement modes. In a managed environment, setting
			these values is the responsibility of the environment's transactional
			infrastructure, so these values are ignored by the vendor's wrapper to
			the JMS Connection. When using the <code class="classname">JmsTemplate</code> in
			an unmanaged environment you can specify these values through the use of
			the properties <code class="literal">sessionTransacted</code> and
			<code class="literal">sessionAcknowledgeMode</code>. When using a
			<code class="classname">PlatformTransactionManager</code> with
			<code class="classname">JmsTemplate</code>, the template will always be given a
			transactional JMS <code class="classname">Session</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-sending"></a>19.3.&nbsp;Sending a <code class="interfacename">Message</code></h2></div></div></div><p>The <code class="classname">JmsTemplate</code> contains many convenience
    methods to send a message. There are send methods that specify the
    destination using a <code class="classname">javax.jms.Destination</code> object
    and those that specify the destination using a string for use in a JNDI
    lookup. The send method that takes no destination argument uses the
    default destination. Here is an example that sends a message to a queue
    using the 1.0.2 implementation.</p><pre class="programlisting">import javax.jms.ConnectionFactory;
import javax.jms.JMSException;
import javax.jms.Message;
import javax.jms.Queue;
import javax.jms.Session;

import org.springframework.jms.core.MessageCreator;
import org.springframework.jms.core.JmsTemplate;
import org.springframework.jms.core.JmsTemplate102;

public class JmsQueueSender {

  private JmsTemplate jmsTemplate;
  private Queue queue;

  public void setConnectionFactory(ConnectionFactory cf) {
    this.jmsTemplate = new JmsTemplate102(cf, false);
  }

  public void setQueue(Queue queue) {
    this.queue = queue;
  }

  public void simpleSend() {
    this.jmsTemplate.send(this.queue, new MessageCreator() {
      public Message createMessage(Session session) throws JMSException {
        return session.createTextMessage("hello queue world");
      }
    });
  }
}</pre><p>This example uses the <code class="classname">MessageCreator</code>
    callback to create a text message from the supplied
    <code class="classname">Session</code> object and the
    <code class="classname">JmsTemplate</code> is constructed by passing a reference
    to a <code class="classname">ConnectionFactory</code> and a boolean specifying
    the messaging domain. A zero argument constructor and
    <span class="property">connectionFactory</span> / <span class="property">queue</span> bean
    properties are provided and can be used for constructing the instance
    (using a BeanFactory or plain Java code). Alternatively, consider
    deriving from Spring's <code class="classname">JmsGatewaySupport</code>
    convenience base class, which provides pre-built bean properties for JMS
    configuration.</p><p>When configuring the JMS 1.0.2 support in an application context,
    it is important to remember setting the value of the boolean property
    <span class="property">pubSubDomain</span> property in order to indicate if you
    want to send to Queues or Topics.</p><p>The method <code class="methodname">send(String destinationName, MessageCreator
    creator)</code> lets you send to a message using the string name
    of the destination. If these names are registered in JNDI, you should
    set the <span class="property">destinationResolver</span> property of the
    template to an instance of
    <code class="classname">JndiDestinationResolver</code>.</p><p>If you created the <code class="classname">JmsTemplate</code> and
    specified a default destination, the <code class="methodname">send(MessageCreator c)</code>
    sends a message to that destination.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-msg-conversion"></a>19.3.1.&nbsp;Using Message Converters</h3></div></div></div><p>In order to facilitate the sending of domain model objects, the
        <code class="classname">JmsTemplate</code> has various send methods that take a
        Java object as an argument for a message's data content. The overloaded
        methods <code class="methodname">convertAndSend</code> and
        <code class="methodname">receiveAndConvert</code> in
        <code class="classname">JmsTemplate</code> delegate the conversion process to an
        instance of the <code class="literal">MessageConverter</code> interface. This
        interface defines a simple contract to convert between Java objects and
        JMS messages. The default implementation
        <code class="classname">SimpleMessageConverter</code> supports conversion
        between <code class="classname">String</code> and
        <code class="classname">TextMessage</code>, <code class="classname">byte[]</code> and
        <code class="classname">BytesMesssage</code>, and
        <code class="classname">java.util.Map</code> and
        <code class="classname">MapMessage</code>. By using the converter, you and your
        application code can focus on the business object that is being sent or
        received via JMS and not be concerned with the details of how it is
        represented as a JMS message.</p><p>The sandbox currently includes a
        <code class="classname">MapMessageConverter</code> which uses reflection to
        convert between a JavaBean and a <code class="classname">MapMessage</code>.
        Other popular implementations choices you might implement yourself are
        Converters that use an existing XML marshalling package, such as JAXB,
        Castor, XMLBeans, or XStream, to create a
        <code class="interfacename">TextMessage</code> representing the object.</p><p>To accommodate the setting of a message's properties, headers, and
        body that can not be generically encapsulated inside a converter class,
        the <code class="interfacename">MessagePostProcessor</code> interface gives you access
        to the message after it has been converted, but before it is sent. The
        example below demonstrates how to modify a message header and a property after
        a <code class="interfacename">java.util.Map</code> is converted to a message.</p><pre class="programlisting">public void sendWithConversion() {
  Map m = new HashMap();
  m.put("Name", "Mark");
  m.put("Age", new Integer(47));
  jmsTemplate.convertAndSend("testQueue", m, new MessagePostProcessor() {
    public Message postProcessMessage(Message message) throws JMSException {
      message.setIntProperty("AccountID", 1234);
      message.setJMSCorrelationID("123-00001");
      return message;
    }
  });
}</pre><p>This results in a message of the form:</p><pre class="programlisting">MapMessage={ 
  Header={ 
    ... standard headers ...
    CorrelationID={123-00001} 
  } 
  Properties={ 
    AccountID={Integer:1234}
  } 
  Fields={ 
    Name={String:Mark} 
    Age={Integer:47} 
  } 
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-callbacks"></a>19.3.2.&nbsp;<code class="interfacename">SessionCallback</code> and <code class="interfacename">ProducerCallback</code></h3></div></div></div><p>While the send operations cover many common usage scenarios, there
        are cases when you want to perform multiple operations on a JMS
        <code class="interfacename">Session</code> or
        <code class="interfacename">MessageProducer</code>. The
        <code class="interfacename">SessionCallback</code> and
        <code class="interfacename">ProducerCallback</code> expose the JMS
        <code class="interfacename">Session</code> and
        <code class="interfacename">Session</code> / <code class="interfacename">MessageProducer</code>
        pair respectfully. The <code class="methodname">execute()</code> methods on
        <code class="classname">JmsTemplate</code> execute these callback
        methods.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-receiving"></a>19.4.&nbsp;Receiving a message</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-receiving-sync"></a>19.4.1.&nbsp;Synchronous Reception</h3></div></div></div><p>While JMS is typically associated with asynchronous processing, it
        is possible to consume messages synchronously. The overloaded
        <code class="methodname">receive(..)</code> methods provide this functionality.
        During a synchronous receive, the calling thread blocks until a message
        becomes available. This can be a dangerous operation since the calling
        thread can potentially be blocked indefinitely. The property
        <span class="property">receiveTimeout</span> specifies how long the receiver
        should wait before giving up waiting for a message.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-asynchronousMessageReception"></a>19.4.2.&nbsp;Asynchronous Reception - Message-Driven POJOs</h3></div></div></div><p>In a fashion similar to a Message-Driven Bean (MDB) in the EJB world,
  		the Message-Driven POJO (MDP) acts as a receiver for JMS messages. The one
  		restriction (but see also below for the discussion of the
  		<code class="classname">MessageListenerAdapter</code> class) on an MDP is that it
  		must implement the <code class="interfacename">javax.jms.MessageListener</code>
  		interface. Please also be aware that in the case where your POJO will be
  		receiving messages on multiple threads, it is important to ensure that your
  		implementation is thread-safe.</p><p>Below is a simple implementation of an MDP:</p><pre class="programlisting">import javax.jms.JMSException;
import javax.jms.Message;
import javax.jms.MessageListener;
import javax.jms.TextMessage;

public class ExampleListener implements MessageListener {

  public void onMessage(Message message) {
    if (message instanceof TextMessage) {
      try {
        System.out.println(((TextMessage) message).getText());
      } catch (JMSException ex) {
        throw new RuntimeException(ex);
      }
    } else {
      throw new IllegalArgumentException("Message must be of type TextMessage");
    }
  }
}</pre><p>Once you've implemented your <code class="interfacename">MessageListener</code>, 
		it's time to create a message listener container.</p><p>Find below an example of how to define and configure one of the message listener
		containers that ships with Spring (in this case the 
		<code class="classname">DefaultMessageListenerContainer</code>).</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- this is the Message Driven POJO (MDP) --&gt;</span></em>
&lt;bean id="messageListener" class="jmsexample.ExampleListener" /&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- and this is the message listener container --&gt;</span></em>
&lt;bean id="jmsContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
  &lt;property name="destination" ref="destination"/&gt;
  <span class="bold"><strong>&lt;property name="messageListener" ref="messageListener" /&gt;</strong></span>
&lt;/bean&gt;</pre><p>Please refer to the Spring Javadoc of the various message
        listener containers for a full description of the features supported by each implementation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-receiving-async-session-aware-message-listener"></a>19.4.3.&nbsp;The <code class="interfacename">SessionAwareMessageListener</code> interface</h3></div></div></div><p>The <code class="interfacename">SessionAwareMessageListener</code> interface
  	    is a Spring-specific interface that provides a similar contract the JMS
  	    <code class="interfacename">MessageListener</code> interface, but also provides
  	    the message handling method with access to the JMS <code class="interfacename">Session</code>
  	    from which the <code class="interfacename">Message</code> was received.</p><pre class="programlisting">package org.springframework.jms.listener;

public interface SessionAwareMessageListener {

    void onMessage(Message message, Session session) <span class="bold"><strong>throws JMSException</strong></span>;
}</pre><p>You can choose to have your MDPs implement this interface (in preference to the
        standard JMS <code class="interfacename">MessageListener</code> interface) if you
        want your MDPs to be able to respond to any received messages (using the
        <code class="interfacename">Session</code> supplied in the
        <code class="literal">onMessage(Message, Session)</code> method). All of the message listener
        container implementations that ship wth Spring have support for MDPs that implement either
        the <code class="interfacename">MessageListener</code> or
        <code class="interfacename">SessionAwareMessageListener</code> interface. Classes
        that implement the <code class="interfacename">SessionAwareMessageListener</code> come
        with the caveat that they are then tied to Spring through the interface. The choice of whether
        or not to use it is left entirely up to you as an application developer or architect.</p><p>Please note that the <code class="literal">'onMessage(..)'</code> method of the
        <code class="interfacename">SessionAwareMessageListener</code> interface throws
        <code class="classname">JMSException</code>. In contrast to the standard JMS
        <code class="interfacename">MessageListener</code> interface, when using the
        <code class="interfacename">SessionAwareMessageListener</code> interface, it is the responsibility
        of the client code to handle any exceptions thrown.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-receiving-async-message-listener-adapter"></a>19.4.4.&nbsp;The <code class="classname">MessageListenerAdapter</code></h3></div></div></div><p>The <code class="classname">MessageListenerAdapter</code> class is the final component in
  	    Spring's asynchronous messaging support: in a nutshell, it allows you to 
  	    expose almost <span class="emphasis"><em>any</em></span> class as a MDP (there are of course some constraints).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you are using the JMS 1.0.2 API, you will want to use the
  	        <code class="classname">MessageListenerAdapter102</code> class which provides the exact
  	        same functionality and value add as the <code class="classname">MessageListenerAdapter</code>
  	        class, but for the JMS 1.0.2 API.</p></td></tr></table></div><p>Consider the following interface definition. Notice that although the interface extends
  	    neither the <code class="interfacename">MessageListener</code> nor
        <code class="interfacename">SessionAwareMessageListener</code> interfaces, it can still
        be used as a MDP via the use of the <code class="classname">MessageListenerAdapter</code> class.
        Notice also how the various message handling methods are strongly typed according to
        the <span class="emphasis"><em>contents</em></span> of the various <code class="interfacename">Message</code>
        types that they can receive and handle.</p><pre class="programlisting">public interface MessageDelegate {

    void handleMessage(String message);

    void handleMessage(Map message);

    void handleMessage(byte[] message);

    void handleMessage(Serializable message);
}</pre><pre class="programlisting">public class DefaultMessageDelegate implements MessageDelegate {
    <em class="lineannotation"><span class="lineannotation">// implementation elided for clarity...</span></em>
}</pre><p>In particular, note how the above implementation of the <code class="interfacename">MessageDelegate</code>
        interface (the above <code class="classname">DefaultMessageDelegate</code> class) has
        <span class="emphasis"><em>no</em></span> JMS dependencies at all. It truly is a POJO that we will
        make into an MDP via the following configuration.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- this is the Message Driven POJO (MDP) --&gt;</span></em>
<span class="bold"><strong>&lt;bean id="messageListener" class="org.springframework.jms.listener.adapter.MessageListenerAdapter"&gt;
    &lt;constructor-arg&gt;
        &lt;bean class="jmsexample.DefaultMessageDelegate"/&gt;
    &lt;/constructor-arg&gt;
&lt;/bean&gt;</strong></span>

<em class="lineannotation"><span class="lineannotation">&lt;!-- and this is the message listener container... --&gt;</span></em>
&lt;bean id="jmsContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
  &lt;property name="destination" ref="destination"/&gt;
  <span class="bold"><strong>&lt;property name="messageListener" ref="messageListener" /&gt;</strong></span>
&lt;/bean&gt;</pre><p>Below is an example of another MDP that can only handle the receiving of
        JMS <code class="interfacename">TextMessage</code> messages. Notice how the message handling
        method is actually called <code class="literal">'receive'</code> (the name of the message handling
        method in a <code class="classname">MessageListenerAdapter</code> defaults to
        <code class="literal">'handleMessage'</code>), but it is configurable (as you will see below).
        Notice also how the <code class="literal">'receive(..)'</code> method is strongly typed to
        receive and respond only to JMS <code class="interfacename">TextMessage</code> messages.</p><pre class="programlisting">public interface TextMessageDelegate {

    void receive(TextMessage message);
}</pre><pre class="programlisting">public class DefaultTextMessageDelegate implements TextMessageDelegate {
    <em class="lineannotation"><span class="lineannotation">// implementation elided for clarity...</span></em>
}</pre><p>The configuration of the attendant <code class="classname">MessageListenerAdapter</code> would
        look like this:</p><pre class="programlisting">&lt;bean id="messageListener" class="org.springframework.jms.listener.adapter.MessageListenerAdapter"&gt;
    &lt;constructor-arg&gt;
        &lt;bean class="jmsexample.DefaultTextMessageDelegate"/&gt;
    &lt;/constructor-arg&gt;
    &lt;property name="defaultListenerMethod" value="receive"/&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- we <span class="bold"><strong>don't</strong></span> want automatic message context extraction --&gt;</span></em>
    &lt;property name="messageConverter"&gt;
        &lt;null/&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>Please note that if the above <code class="literal">'messageListener'</code> receives a
        JMS <code class="interfacename">Message</code> of a type other than
        <code class="interfacename">TextMessage</code>, an <code class="classname">IllegalStateException</code>
        will be thrown (and subsequently swallowed).
        Another of the capabilities of the <code class="classname">MessageListenerAdapter</code>
        class is the ability to automatically send back a response <code class="interfacename">Message</code>
        if a handler method returns a non-void value.
        Consider the interface and class:</p><pre class="programlisting">public interface ResponsiveTextMessageDelegate {

    <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>// notice the return type...</strong></span></span></em>
    String receive(TextMessage message);
}</pre><pre class="programlisting">public class DefaultResponsiveTextMessageDelegate implements ResponsiveTextMessageDelegate {
    <em class="lineannotation"><span class="lineannotation">// implementation elided for clarity...</span></em>
}</pre><p>If the above <code class="classname">DefaultResponsiveTextMessageDelegate</code> is used in
        conjunction with a <code class="classname">MessageListenerAdapter</code> then any non-null
        value that is returned from the execution of the <code class="literal">'receive(..)'</code>
        method will (in the default configuration) be converted into a
        <code class="interfacename">TextMessage</code>. The resulting <code class="interfacename">TextMessage</code>
        will then be sent to the <code class="interfacename">Destination</code> (if one exists) 
        defined in the JMS Reply-To property of the original <code class="interfacename">Message</code>, or the
        default <code class="interfacename">Destination</code> set on the
        <code class="classname">MessageListenerAdapter</code> (if one has been configured); if no
        <code class="interfacename">Destination</code> is found then an
        <code class="classname">InvalidDestinationException</code> will be thrown (and please note
        that this exception <span class="emphasis"><em>will not</em></span> be swallowed and
        <span class="emphasis"><em>will</em></span> propagate up the call stack).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-tx-participation"></a>19.4.5.&nbsp;Processing messages within transactions</h3></div></div></div><p>Invoking a message listener within a transaction only requires
			reconfiguration of the listener container.</p><p>Local resource transactions can simply be activated through the
			<code class="literal">sessionTransacted</code> flag on the listener container
			definition. Each message listener invocation will then operate within
			an active JMS transaction, with message reception rolled back in case
			of listener execution failure. Sending a response message
			(via <code class="interfacename">SessionAwareMessageListener</code>)
			will be part of the same local transaction, but any other resource
			operations (such as database access) will operate independently.
			This usually requires duplicate message detection in the listener
			implementation, covering the case where database processing has
			committed but message processing failed to commit.</p><pre class="programlisting">&lt;bean id="jmsContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
  &lt;property name="destination" ref="destination"/&gt;
  &lt;property name="messageListener" ref="messageListener"/&gt;
  <span class="bold"><strong>&lt;property name="sessionTransacted" value="true"/&gt;</strong></span>
&lt;/bean&gt;</pre><p>For participating in an externally managed transaction,
			you will need to configured a transaction manager and use a listener
			container which supports externally managed transactions: typically
			<code class="classname">DefaultMessageListenerContainer</code>.</p><p>To configure a message listener container for XA transaction
			participation, you'll want to configure a <code class="classname">JtaTransactionManager</code>
			(which, by default, delegates to the J2EE server's transaction subsystem).
			Note that the underlying JMS ConnectionFactory needs to be XA-capable
			and properly registered with your JTA transaction coordinator!
			(Check your J2EE server's configuration of JNDI resources.)
			This allows message recepton as well as e.g. database access to be
			part of the same transaction (with unified commit semantics,
			at the expense of XA transaction log overhead).</p><pre class="programlisting">&lt;bean id="transactionManager" class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;
</pre><p>Then you just need to add it to our earlier container configuration. The
			container will take care of the rest.</p><pre class="programlisting">&lt;bean id="jmsContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
  &lt;property name="destination" ref="destination"/&gt;
  &lt;property name="messageListener" ref="messageListener"/&gt;
  <span class="bold"><strong>&lt;property name="transactionManager" ref="transactionManager"/&gt;</strong></span>
&lt;/bean&gt;</pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="jmx"></a>Chapter&nbsp;20.&nbsp;JMX</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-introduction"></a>20.1.&nbsp;Introduction</h2></div></div></div><p>The JMX support in Spring provides you with the features to easily
    and transparently integrate your Spring application into a JMX
    infrastructure.</p><div class="sidebar"><p class="title"><b>JMX?</b></p><p>This chapter is not an introduction to JMX... it doesn't try to
      explain the motivations of why one might want to use JMX (or indeed what
      the letters JMX actually stand for). If you are new to JMX, check out
      the section entitled <a href="#jmx-resources" title="20.8.&nbsp;Further Resources">Section&nbsp;20.8, &#8220;Further Resources&#8221;</a> at the end of this
      chapter.</p></div><p>Specifically, Spring's JMX support provides four core
    features:</p><div class="itemizedlist"><ul type="disc"><li><p>The automatic registration of <span class="emphasis"><em>any</em></span> Spring
        bean as a JMX MBean</p></li><li><p>A flexible mechanism for controlling the management interface of
        your beans</p></li><li><p>The declarative exposure of MBeans over remote, JSR-160
        connectors</p></li><li><p>The simple proxying of both local and remote MBean
        resources</p></li></ul></div><p>These features are designed to work without coupling your
    application components to either Spring or JMX interfaces and classes.
    Indeed, for the most part your application classes need not be aware of
    either Spring or JMX in order to take advantage of the Spring JMX
    features.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-exporting"></a>20.2.&nbsp;Exporting your beans to JMX</h2></div></div></div><p>The core class in Spring's JMX framework is the
    <code class="classname">MBeanExporter</code>. This class is responsible for taking
    your Spring beans and registering them with a JMX
    <code class="interfacename">MBeanServer</code>. For example, consider the following
    class:</p><pre class="programlisting">package org.springframework.jmx;

public class JmxTestBean implements IJmxTestBean {

    private String name;
    private int age;
    private boolean isSuperman;

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
    
    public void setName(String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    public int add(int x, int y) {
        return x + y;
    }

    public void dontExposeMe() {
        throw new RuntimeException();
    }
}</pre><p>To expose the properties and methods of this bean as attributes and
    operations of an MBean you simply configure an instance of the
    <code class="classname">MBeanExporter</code> class in your configuration file and
    pass in the bean as shown below:</p><pre class="programlisting">&lt;beans&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!-- this bean must <span class="bold"><strong>not</strong></span> be lazily initialized if the exporting is to happen --&gt;</span></em>
  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter" <span class="bold"><strong>lazy-init="false"</strong></span>&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>The pertinent bean definition from the above configuration snippet
    is the <code class="literal">exporter</code> bean. The <code class="literal">beans</code>
    property tells the <code class="classname">MBeanExporter</code> exactly which of
    your beans must be exported to the JMX <code class="interfacename">MBeanServer</code>.
    In the default configuration, the key of each entry in the
    <code class="literal">beans</code> <code class="interfacename">Map</code> is used as the
    <code class="classname">ObjectName</code> for the bean referenced by the
    corresponding entry value. This behavior can be changed as described in
    the section entitled <a href="#jmx-naming" title="20.4.&nbsp;Controlling the ObjectNames for your beans">Section&nbsp;20.4, &#8220;Controlling the <code class="classname">ObjectName</code>s for your beans&#8221;</a>.</p><p>With this configuration the <code class="literal">testBean</code> bean is
    exposed as an MBean under the <code class="classname">ObjectName</code>
    <code class="literal">bean:name=testBean1</code>. By default, all
    <span class="emphasis"><em>public</em></span> properties of the bean are exposed as
    attributes and all <span class="emphasis"><em>public</em></span> methods (bar those
    inherited from the <code class="classname">Object</code> class) are exposed as
    operations.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-exporting-mbeanserver"></a>20.2.1.&nbsp;Creating an <code class="interfacename">MBeanServer</code></h3></div></div></div><p>The above configuration assumes that the application is running in
      an environment that has one (and only one)
      <code class="interfacename">MBeanServer</code> already running. In this case, Spring
      will attempt to locate the running <code class="interfacename">MBeanServer</code>
      and register your beans with that server (if any). This behavior is
      useful when your application is running inside a container such as
      Tomcat or IBM WebSphere that has it's own
      <code class="interfacename">MBeanServer</code>.</p><p>However, this approach is of no use in a standalone environment,
      or when running inside a container that does not provide an
      <code class="interfacename">MBeanServer</code>. To address this you can create an
      <code class="interfacename">MBeanServer</code> instance declaratively by adding an
      instance of the
      <code class="classname">org.springframework.jmx.support.MBeanServerFactoryBean</code>
      class to your configuration. You can also ensure that a specific
      <code class="interfacename">MBeanServer</code> is used by setting the value of the
      <code class="classname">MBeanExporter</code>'s <code class="literal">server</code>
      property to the <code class="interfacename">MBeanServer</code> value returned by an
      <code class="classname">MBeanServerFactoryBean</code>; for example:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="mbeanServer" class="org.springframework.jmx.support.MBeanServerFactoryBean"/&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!--
    this bean needs to be eagerly pre-instantiated in order for the exporting to occur;
    this means that it must <span class="bold"><strong>not</strong></span> be marked as lazily initialized
  --&gt;</span></em>
  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="server" ref="mbeanServer"/&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>Here an instance of <code class="interfacename">MBeanServer</code> is created
      by the <code class="classname">MBeanServerFactoryBean</code> and is supplied to
      the <code class="classname">MBeanExporter</code> via the server property. When
      you supply your own <code class="interfacename">MBeanServer</code> instance, the
      <code class="classname">MBeanExporter</code> will not attempt to locate a
      running <code class="interfacename">MBeanServer</code> and will use the supplied
      <code class="interfacename">MBeanServer</code> instance. For this to work correctly,
      you must (of course) have a JMX implementation on your classpath.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-mbean-server"></a>20.2.2.&nbsp;Reusing an existing <code class="interfacename">MBeanServer</code></h3></div></div></div><p>If no server is specified, the <code class="classname">MBeanExporter</code>
      tries to automatically detect a running <code class="interfacename">MBeanServer</code>.
      This works in most environment where only one
      <code class="interfacename">MBeanServer</code> instance is used, however when multiple
      instances exist, the exporter might pick the wrong server. In such
      cases, one should use the <code class="interfacename">MBeanServer</code>
      <code class="literal">agentId</code> to indicate which instance to be used:</p><pre class="programlisting">&lt;beans&gt;
   &lt;bean id="mbeanServer" class="org.springframework.jmx.support.MBeanServerFactoryBean"&gt;
     <em class="lineannotation"><span class="lineannotation">&lt;!-- indicate to first look for a server --&gt;</span></em>
     &lt;property name="locateExistingServerIfPossible" value="true"/&gt;
     <em class="lineannotation"><span class="lineannotation">&lt;!-- search for the <code class="interfacename">MBeanServer</code> instance with the given agentId --&gt;</span></em>
     &lt;property name="agentId" value="<span class="emphasis"><em>&lt;MBeanServer instance agentId&gt;</em></span>"/&gt;
   &lt;/bean&gt;
   
   &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
     &lt;property name="server" ref="mbeanServer"/&gt;
   ...
   &lt;/bean&gt;
&lt;/beans&gt;</pre><p>For platforms/cases where the existing <code class="interfacename">MBeanServer</code>
      has a dynamic (or unknown) <code class="literal">agentId</code> which is retrieved through lookup
      methods, one should use <a href="#beans-factory-class-static-factory-method" title="3.2.3.2.2.&nbsp;Instantiation using a static factory method">factory-method</a>:</p><pre class="programlisting">&lt;beans&gt;
   &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
     &lt;property name="server"&gt;
       <em class="lineannotation"><span class="lineannotation">&lt;!-- Custom <code class="literal">MBeanServerLocator</code> --&gt;</span></em>
       &lt;bean class="platform.package.MBeanServerLocator" factory-method="locateMBeanServer"/&gt;
     &lt;/property&gt;
     
     <em class="lineannotation"><span class="lineannotation">&lt;!-- other beans here --&gt;</span></em>
     
   &lt;/bean&gt;
&lt;/beans&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-exporting-lazy"></a>20.2.3.&nbsp;Lazy-initialized MBeans</h3></div></div></div><p>If you configure a bean with the
      <code class="classname">MBeanExporter</code> that is also configured for lazy
      initialization, then the <code class="classname">MBeanExporter</code> will
      <span class="bold"><strong>not</strong></span> break this contract and will avoid
      instantiating the bean. Instead, it will register a proxy with
      the <code class="interfacename">MBeanServer</code> and will defer obtaining the bean
      from the container until the first invocation on the proxy occurs.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-exporting-auto"></a>20.2.4.&nbsp;Automatic registration of MBeans</h3></div></div></div><p>Any beans that are exported through the
      <code class="classname">MBeanExporter</code> and are already valid MBeans are
      registered as-is with the <code class="interfacename">MBeanServer</code> without
      further intervention from Spring. MBeans can be automatically detected
      by the <code class="classname">MBeanExporter</code> by setting the
      <code class="literal">autodetect</code> property to <code class="literal">true</code>:</p><pre class="programlisting">&lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
  &lt;property name="autodetect" value="true"/&gt;
&lt;/bean&gt;

&lt;bean name="spring:mbean=true" class="org.springframework.jmx.export.TestDynamicMBean"/&gt;</pre><p>Here, the bean called <code class="literal">spring:mbean=true</code> is
      already a valid JMX MBean and will be automatically registered by
      Spring. By default, beans that are autodetected for JMX registration
      have their bean name used as the <code class="classname">ObjectName</code>. This
      behavior can be overridden as detailed in the section entitled
      <a href="#jmx-naming" title="20.4.&nbsp;Controlling the ObjectNames for your beans">Section&nbsp;20.4, &#8220;Controlling the <code class="classname">ObjectName</code>s for your beans&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-exporting-registration-behavior"></a>20.2.5.&nbsp;Controlling the registration behavior</h3></div></div></div><p>Consider the scenario where a Spring
      <code class="classname">MBeanExporter</code> attempts to register an
      <code class="classname">MBean</code> with an <code class="interfacename">MBeanServer</code>
      using the <code class="classname">ObjectName</code>
      <code class="literal">'bean:name=testBean1'</code>. If an
      <code class="classname">MBean</code> instance has already been registered under
      that same <code class="classname">ObjectName</code>, the default behavior is to
      fail (and throw an
      <code class="exceptionname">InstanceAlreadyExistsException</code>).</p><p>It is possible to control the behavior of exactly what happens
      when an <code class="classname">MBean</code> is registered with an
      <code class="interfacename">MBeanServer</code>. Spring's JMX support allows for
      three different registration behaviors to control the registration
      behavior when the registration process finds that an
      <code class="classname">MBean</code> has already been registered under the same
      <code class="classname">ObjectName</code>; these registration behaviors are
      summarized on the following table:</p><div class="table"><a name="jmx-registration-behaviors"></a><p class="title"><b>Table&nbsp;20.1.&nbsp;Registration Behaviors</b></p><div class="table-contents"><table summary="Registration Behaviors" border="1"><colgroup><col align="left"><col></colgroup><thead><tr><th align="center">Registration behavior</th><th align="center">Explanation</th></tr></thead><tbody><tr><td align="left"><p><code class="literal">REGISTRATION_FAIL_ON_EXISTING</code></p></td><td><p> This is the default registration behavior. If an
                <code class="classname">MBean</code> instance has already been
                registered under the same <code class="classname">ObjectName</code>,
                the <code class="classname">MBean</code> that is being registered will
                not be registered and an
                <code class="exceptionname">InstanceAlreadyExistsException</code> will be
                thrown. The existing <code class="classname">MBean</code> is
                unaffected. </p></td></tr><tr><td align="left"><p><code class="literal">REGISTRATION_IGNORE_EXISTING</code></p></td><td><p> If an <code class="classname">MBean</code> instance has
                already been registered under the same
                <code class="classname">ObjectName</code>, the
                <code class="classname">MBean</code> that is being registered will
                <span class="emphasis"><em>not</em></span> be registered. The existing
                <code class="classname">MBean</code> is unaffected, and no
                <code class="exceptionname">Exception</code> will be thrown. </p>
                <p> This is useful in settings where multiple applications
                want to share a common <code class="classname">MBean</code> in a
                shared <code class="interfacename">MBeanServer</code>. </p></td></tr><tr><td align="left"><p><code class="literal">REGISTRATION_REPLACE_EXISTING</code></p></td><td><p> If an <code class="classname">MBean</code> instance has
                already been registered under the same
                <code class="classname">ObjectName</code>, the existing
                <code class="classname">MBean</code> that was previously registered
                will be unregistered and the new <code class="classname">MBean</code>
                will be registered in it's place (the new
                <code class="classname">MBean</code> effectively replaces the previous
                instance). </p></td></tr></tbody></table></div></div><br class="table-break"><p>The above values are defined as constants on the
      <code class="classname">MBeanRegistrationSupport</code> class (the
      <code class="classname">MBeanExporter</code> class derives from this
      superclass). If you want to change the default registration behavior,
      you simply need to set the value of the
      <code class="literal">registrationBehaviorName</code> property on your
      <code class="classname">MBeanExporter</code> definition to one of those
      values.</p><p>The following example illustrates how to effect a change from the
      default registration behavior to the
      <code class="literal">REGISTRATION_REPLACE_EXISTING</code> behavior:</p><pre class="programlisting">&lt;beans&gt;

    &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
        &lt;property name="beans"&gt;
            &lt;map&gt;
                &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
            &lt;/map&gt;
        &lt;/property&gt;
        &lt;property name="registrationBehaviorName" value="REGISTRATION_REPLACE_EXISTING"/&gt;
    &lt;/bean&gt;

    &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
        &lt;property name="name" value="TEST"/&gt;
        &lt;property name="age" value="100"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-interface"></a>20.3.&nbsp;Controlling the management interface of your beans</h2></div></div></div><p>In the previous example, you had little control over the management
    interface of your bean; <span class="emphasis"><em>all</em></span> of the
    <span class="emphasis"><em>public</em></span> properties and methods of each exported bean
    was exposed as JMX attributes and operations respectively. To exercise
    finer-grained control over exactly which properties and methods of your
    exported beans are actually exposed as JMX attributes and operations,
    Spring JMX provides a comprehensive and extensible mechanism for
    controlling the management interfaces of your beans.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-interface-assembler"></a>20.3.1.&nbsp;The <code class="interfacename">MBeanInfoAssembler</code>
      Interface</h3></div></div></div><p>Behind the scenes, the <code class="classname">MBeanExporter</code>
      delegates to an implementation of the
      <code class="classname">org.springframework.jmx.export.assembler.MBeanInfoAssembler</code>
      interface which is responsible for defining the management interface of
      each bean that is being exposed. The default implementation,
      <code class="classname">org.springframework.jmx.export.assembler.SimpleReflectiveMBeanInfoAssembler</code>,
      simply defines a management interface that exposes all public properties
      and methods (as you saw in the previous examples). Spring provides two
      additional implementations of the
      <code class="interfacename">MBeanInfoAssembler</code> interface that allow
      you to control the generated management interface using either
      source-level metadata or any arbitrary interface.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-interface-metadata"></a>20.3.2.&nbsp;Using source-Level metadata</h3></div></div></div><p>Using the <code class="classname">MetadataMBeanInfoAssembler</code> you
      can define the management interfaces for your beans using source level
      metadata. The reading of metadata is encapsulated by the
      <code class="classname">org.springframework.jmx.export.metadata.JmxAttributeSource</code>
      interface. Out of the box, Spring JMX provides support for two
      implementations of this interface:
      <code class="classname">org.springframework.jmx.export.metadata.AttributesJmxAttributeSource</code>
      for Commons Attributes and
      <code class="classname">org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource</code>
      for JDK 5.0 annotations. The
      <code class="classname">MetadataMBeanInfoAssembler</code>
      <span class="emphasis"><em>must</em></span> be configured with an implementation instance
      of the <code class="classname">JmxAttributeSource</code> interface for it to
      function correctly (there is <span class="emphasis"><em>no</em></span> default). For the
      following example, we will use the Commons Attributes metadata
      approach.</p><p>To mark a bean for export to JMX, you should annotate the bean
      class with the <code class="classname">ManagedResource</code> attribute. In the
      case of the Commons Attributes metadata approach this class can be found
      in the <code class="literal">org.springframework.jmx.metadata</code> package. Each
      method you wish to expose as an operation must be marked with the
      <code class="classname">ManagedOperation</code> attribute and each property you
      wish to expose must be marked with the
      <code class="classname">ManagedAttribute</code> attribute. When marking
      properties you can omit either the annotation of the getter or the
      setter to create a write-only or read-only attribute
      respectively.</p><p>The example below shows the <code class="classname">JmxTestBean</code>
      class that you saw earlier marked with Commons Attributes
      metadata:</p><pre class="programlisting">package org.springframework.jmx;

/**
 * @@org.springframework.jmx.export.metadata.ManagedResource
 *  (description="My Managed Bean", objectName="spring:bean=test",
 *  log=true, logFile="jmx.log", currencyTimeLimit=15, persistPolicy="OnUpdate",
 *  persistPeriod=200, persistLocation="foo", persistName="bar")
 */
public class JmxTestBean implements IJmxTestBean {

  private String name;

  private int age;


  /**
   * @@org.springframework.jmx.export.metadata.ManagedAttribute
   *   (description="The Age Attribute", currencyTimeLimit=15)
   */
  public int getAge() {
    return age;
  }

  public void setAge(int age) {
    this.age = age;
  }

  /**
   * @@org.springframework.jmx.export.metadata.ManagedAttribute
   *  (description="The Name Attribute",  currencyTimeLimit=20,
   *   defaultValue="bar", persistPolicy="OnUpdate")
   */
  public void setName(String name) {
    this.name = name;
  }

  /**
   * @@org.springframework.jmx.export.metadata.ManagedAttribute
   *   (defaultValue="foo", persistPeriod=300)
   */
  public String getName() {
    return name;
  }

  /**
   * @@org.springframework.jmx.export.metadata.ManagedOperation
   *  (description="Add Two Numbers Together")
   */
  public int add(int x, int y) {
    return x + y;
  }

  public void dontExposeMe() {
    throw new RuntimeException();
  }
}</pre><p>Here you can see that the <code class="classname">JmxTestBean</code> class
      is marked with the <code class="classname">ManagedResource</code> attribute and
      that this <code class="classname">ManagedResource</code> attribute is configured
      with a set of properties. These properties can be used to configure
      various aspects of the MBean that is generated by the
      <code class="classname">MBeanExporter</code>, and are explained in greater
      detail later in section entitled <a href="#jmx-interface-metadata-types" title="20.3.4.&nbsp;Source-Level Metadata Types">Section&nbsp;20.3.4, &#8220;Source-Level Metadata Types&#8221;</a>.</p><p>You will also notice that both the <code class="literal">age</code> and
      <code class="literal">name</code> properties are annotated with the
      <code class="classname">ManagedAttribute</code> attribute, but in the case of
      the <code class="literal">age</code> property, only the getter is marked. This
      will cause both of these properties to be included in the management
      interface as attributes, but the <code class="literal">age</code> attribute will
      be read-only.</p><p>Finally, you will notice that the <code class="literal">add(int, int)</code>
      method is marked with the <code class="classname">ManagedOperation</code>
      attribute whereas the <code class="literal">dontExposeMe()</code> method is not.
      This will cause the management interface to contain only one operation,
      <code class="literal">add(int, int)</code>, when using the
      <code class="classname">MetadataMBeanInfoAssembler</code>.</p><p>The code below shows how you configure the
      <code class="classname">MBeanExporter</code> to use the
      <code class="classname">MetadataMBeanInfoAssembler</code>:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="assembler" ref="assembler"/&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

  &lt;bean id="attributeSource"
        class="org.springframework.jmx.export.metadata.AttributesJmxAttributeSource"&gt;
    &lt;property name="attributes"&gt;
      &lt;bean class="org.springframework.metadata.commons.CommonsAttributes"/&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="assembler" class="org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler"&gt;
    &lt;property name="attributeSource" ref="attributeSource"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>Here you can see that an
      <code class="classname">MetadataMBeanInfoAssembler</code> bean has been
      configured with an instance of the
      <code class="classname">AttributesJmxAttributeSource</code> class and passed to
      the <code class="classname">MBeanExporter</code> through the assembler property.
      This is all that is required to take advantage of metadata-driven
      management interfaces for your Spring-exposed MBeans.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-interface-annotations"></a>20.3.3.&nbsp;Using JDK 5.0 Annotations</h3></div></div></div><p>To enable the use of JDK 5.0 annotations for management interface
      definition, Spring provides a set of annotations that mirror the Commons
      Attribute attribute classes and an implementation of the
      <code class="interfacename">JmxAttributeSource</code> strategy interface,
      the <code class="classname">AnnotationsJmxAttributeSource</code> class, that
      allows the <code class="interfacename">MBeanInfoAssembler</code> to read
      them.</p><p>The example below shows a bean where the management interface is defined
      by the presence of JDK 5.0 annotation types:</p><pre class="programlisting">package org.springframework.jmx;

import org.springframework.jmx.export.annotation.ManagedResource;
import org.springframework.jmx.export.annotation.ManagedOperation;
import org.springframework.jmx.export.annotation.ManagedAttribute;

@ManagedResource(objectName="bean:name=testBean4", description="My Managed Bean", log=true,
    logFile="jmx.log", currencyTimeLimit=15, persistPolicy="OnUpdate", persistPeriod=200,
    persistLocation="foo", persistName="bar")
public class AnnotationTestBean implements IJmxTestBean {

  private String name;
  private int age;

  @ManagedAttribute(description="The Age Attribute", currencyTimeLimit=15)
  public int getAge() {
    return age;
  }

  public void setAge(int age) {
    this.age = age;
  }

  @ManagedAttribute(description="The Name Attribute",
      currencyTimeLimit=20,
      defaultValue="bar",
      persistPolicy="OnUpdate")
  public void setName(String name) {
    this.name = name;
  }

  @ManagedAttribute(defaultValue="foo", persistPeriod=300)
  public String getName() {
    return name;
  }

  @ManagedOperation(description="Add two numbers")
  @ManagedOperationParameters({
    @ManagedOperationParameter(name = "x", description = "The first number"),
    @ManagedOperationParameter(name = "y", description = "The second number")})
  public int add(int x, int y) {
    return x + y;
  }

  public void dontExposeMe() {
    throw new RuntimeException();
  }
}</pre><p>As you can see little has changed, other than the basic syntax of
      the metadata definitions. Behind the scenes this approach is a little
      slower at startup because the JDK 5.0 annotations are converted into the
      classes used by Commons Attributes. However, this is only a one-off cost
      and JDK 5.0 annotations give you the added (and valuable) benefit of
      compile-time checking.</p><pre class="programlisting">&lt;beans&gt;
    &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
        &lt;property name="assembler" ref="assembler"/&gt;
        &lt;property name="namingStrategy" ref="namingStrategy"/&gt;
        &lt;property name="autodetect" value="true"/&gt;
    &lt;/bean&gt;

    &lt;bean id="jmxAttributeSource"
          class="org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource"/&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- will create management interface using annotation metadata --&gt;</span></em>
    &lt;bean id="assembler"
          class="org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler"&gt;
        &lt;property name="attributeSource" ref="jmxAttributeSource"/&gt;
    &lt;/bean&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- will pick up the <code class="classname">ObjectName</code> from the annotation --&gt;</span></em>
    &lt;bean id="namingStrategy"
          class="org.springframework.jmx.export.naming.MetadataNamingStrategy"&gt;
        &lt;property name="attributeSource" ref="jmxAttributeSource"/&gt;
    &lt;/bean&gt;

    &lt;bean id="testBean" class="org.springframework.jmx.AnnotationTestBean"&gt;
        &lt;property name="name" value="TEST"/&gt;
        &lt;property name="age" value="100"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-interface-metadata-types"></a>20.3.4.&nbsp;Source-Level Metadata Types</h3></div></div></div><p>The following source level metadata types are available for use in
      Spring JMX:</p><div class="table"><a name="jmx-metadata-types"></a><p class="title"><b>Table&nbsp;20.2.&nbsp;Source-Level Metadata Types</b></p><div class="table-contents"><table summary="Source-Level Metadata Types" border="1"><colgroup><col align="left"><col><col><col></colgroup><thead><tr><th align="center">Purpose</th><th align="center">Commons Attributes Attribute</th><th align="center">JDK 5.0 Annotation</th><th align="center">Attribute / Annotation Type</th></tr></thead><tbody><tr><td align="left">Mark all instances of a <code class="classname">Class</code> as
                JMX managed resources</td><td><code class="classname">ManagedResource</code></td><td><code class="literal">@ManagedResource</code></td><td>Class</td></tr><tr><td align="left">Mark a method as a JMX operation</td><td><code class="classname">ManagedOperation</code></td><td><code class="literal">@ManagedOperation</code></td><td>Method</td></tr><tr><td align="left">Mark a getter or setter as one half of a JMX
                attribute</td><td><code class="classname">ManagedAttribute</code></td><td><code class="classname">@ManagedAttribute</code></td><td>Method (only getters and setters)</td></tr><tr><td align="left">Define descriptions for operation parameters</td><td><code class="classname">ManagedOperationParameter</code></td><td><code class="classname">@ManagedOperationParameter</code> and
                <code class="classname">@ManagedOperationParameters</code></td><td>Method</td></tr></tbody></table></div></div><p><br class="table-break"></p><p>The following configuration parameters are available for use on
      these source-level metadata types:</p><div class="table"><a name="jmx-metadata-parameters"></a><p class="title"><b>Table&nbsp;20.3.&nbsp;Source-Level Metadata Parameters</b></p><div class="table-contents"><table summary="Source-Level Metadata Parameters" border="1"><colgroup><col align="left"><col><col></colgroup><thead><tr><th align="center">Parameter</th><th align="center">Description</th><th align="center">Applies to</th></tr></thead><tbody><tr><td align="left"><code class="classname">ObjectName</code></td><td>Used by <code class="classname">MetadataNamingStrategy</code>
                to determine the <code class="classname">ObjectName</code> of a
                managed resource</td><td><code class="classname">ManagedResource</code></td></tr><tr><td align="left"><code class="literal">description</code></td><td>Sets the friendly description of the resource,
                attribute or operation</td><td><code class="classname">ManagedResource</code>,
                <code class="classname">ManagedAttribute</code>,
                <code class="classname">ManagedOperation</code>,
                <code class="classname">ManagedOperationParameter</code></td></tr><tr><td align="left"><code class="literal">currencyTimeLimit</code></td><td>Sets the value of the
                <code class="literal">currencyTimeLimit</code> descriptor field</td><td><code class="classname">ManagedResource</code>,
                <code class="classname">ManagedAttribute</code></td></tr><tr><td align="left"><code class="literal">defaultValue</code></td><td>Sets the value of the <code class="literal">defaultValue</code>
                descriptor field</td><td><code class="classname">ManagedAttribute</code></td></tr><tr><td align="left"><code class="literal">log</code></td><td>Sets the value of the <code class="literal">log</code> descriptor
                field</td><td><code class="classname">ManagedResource</code></td></tr><tr><td align="left"><code class="literal">logFile</code></td><td>Sets the value of the <code class="literal">logFile</code>
                descriptor field</td><td><code class="classname">ManagedResource</code></td></tr><tr><td align="left"><code class="literal">persistPolicy</code></td><td>Sets the value of the <code class="literal">persistPolicy</code>
                descriptor field</td><td><code class="classname">ManagedResource</code></td></tr><tr><td align="left"><code class="literal">persistPeriod</code></td><td>Sets the value of the <code class="literal">persistPeriod</code>
                descriptor field</td><td><code class="classname">ManagedResource</code></td></tr><tr><td align="left"><code class="literal">persistLocation</code></td><td>Sets the value of the
                <code class="literal">persistLocation</code> descriptor field</td><td><code class="classname">ManagedResource</code></td></tr><tr><td align="left"><code class="literal">persistName</code></td><td>Sets the value of the <code class="literal">persistName</code>
                descriptor field</td><td><code class="classname">ManagedResource</code></td></tr><tr><td align="left"><code class="literal">name</code></td><td>Sets the display name of an operation parameter</td><td><code class="literal">ManagedOperationParameter</code></td></tr><tr><td align="left"><code class="literal">index</code></td><td>Sets the index of an operation parameter</td><td><code class="literal">ManagedOperationParameter</code></td></tr></tbody></table></div></div><p><br class="table-break"></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-interface-autodetect"></a>20.3.5.&nbsp;The <code class="classname">AutodetectCapableMBeanInfoAssembler</code>
      interface</h3></div></div></div><p>To simply configuration even further, Spring introduces the
      <code class="classname">AutodetectCapableMBeanInfoAssembler</code> interface
      which extends the <code class="interfacename">MBeanInfoAssembler</code>
      interface to add support for autodetection of MBean resources. If you
      configure the <code class="classname">MBeanExporter</code> with an instance of
      <code class="classname">AutodetectCapableMBeanInfoAssembler</code> then it is
      allowed to "vote" on the inclusion of beans for exposure to JMX.</p><p>Out of the box, the only implementation of the
      <code class="classname">AutodetectCapableMBeanInfo</code> interface is the
      <code class="classname">MetadataMBeanInfoAssembler</code> which will vote to
      include any bean which is marked with the
      <code class="classname">ManagedResource</code> attribute. The default approach
      in this case is to use the bean name as the
      <code class="classname">ObjectName</code> which results in a configuration like
      this:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- notice how no <code class="literal">'beans'</code> are explicitly configured here --&gt;</span></em>
    &lt;property name="autodetect" value="true"/&gt;
    &lt;property name="assembler" ref="assembler"/&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

  <em class="lineannotation"><span class="lineannotation">&lt;!-- (for Commons Attributes-based metadata) --&gt;</span></em>
  &lt;bean id="attributeSource"
        class="org.springframework.jmx.export.metadata.AttributesJmxAttributeSource"&gt;
    &lt;property name="attributes"&gt;
      &lt;bean class="org.springframework.metadata.commons.CommonsAttributes"/&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- (for Java 5+ annotations-based metadata) --&gt;</span></em><span class="emphasis"><em>
  &lt;!--
  &lt;bean id="attributeSource"
        class="org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource"/&gt;
  --&gt;</em></span>

  &lt;bean id="assembler" class="org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler"&gt;
    &lt;property name="attributeSource" ref="attributeSource"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>Notice that in this configuration no beans are passed to the
      <code class="classname">MBeanExporter</code>; however, the
      <code class="classname">JmxTestBean</code> will still be registered since it is
      marked with the <code class="classname">ManagedResource</code> attribute and the
      <code class="classname">MetadataMBeanInfoAssembler</code> detects this and votes
      to include it. The only problem with this approach is that the name of
      the <code class="classname">JmxTestBean</code> now has business meaning. You can
      address this issue by changing the default behavior for
      <code class="classname">ObjectName</code> creation as defined in the section
      entitled <a href="#jmx-naming" title="20.4.&nbsp;Controlling the ObjectNames for your beans">Section&nbsp;20.4, &#8220;Controlling the <code class="classname">ObjectName</code>s for your beans&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-interface-java"></a>20.3.6.&nbsp;Defining Management interfaces using Java interfaces</h3></div></div></div><p>In addition to the
      <code class="classname">MetadataMBeanInfoAssembler</code>, Spring also includes
      the <code class="classname">InterfaceBasedMBeanInfoAssembler</code> which allows
      you to constrain the methods and properties that are exposed based on
      the set of methods defined in a collection of interfaces.</p><p>Although the standard mechanism for exposing MBeans is to use
      interfaces and a simple naming scheme, the
      <code class="classname">InterfaceBasedMBeanInfoAssembler</code> extends this
      functionality by removing the need for naming conventions, allowing you
      to use more than one interface and removing the need for your beans to
      implement the MBean interfaces.</p><p>Consider this interface that is used to define a management
      interface for the <code class="classname">JmxTestBean</code> class that you saw
      earlier:</p><pre class="programlisting">public interface IJmxTestBean {

  public int add(int x, int y);

  public long myOperation();

  public int getAge();

  public void setAge(int age);

  public void setName(String name);

  public String getName();
}</pre><p>This interface defines the methods and properties that will be
      exposed as operations and attributes on the JMX MBean. The code below
      shows how to configure Spring JMX to use this interface as the
      definition for the management interface:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean5" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="assembler"&gt;
      &lt;bean class="org.springframework.jmx.export.assembler.InterfaceBasedMBeanInfoAssembler"&gt;
        &lt;property name="managedInterfaces"&gt;
          &lt;value&gt;org.springframework.jmx.IJmxTestBean&lt;/value&gt;
        &lt;/property&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>Here you can see that the
      <code class="classname">InterfaceBasedMBeanInfoAssembler</code> is configured to
      use the <code class="interfacename">IJmxTestBean</code> interface when
      constructing the management interface for any bean. It is important to
      understand that beans processed by the
      <code class="classname">InterfaceBasedMBeanInfoAssembler</code> are
      <span class="emphasis"><em>not</em></span> required to implement the interface used to
      generate the JMX management interface.</p><p>In the case above, the <code class="interfacename">IJmxTestBean</code>
      interface is used to construct all management interfaces for all beans.
      In many cases this is not the desired behavior and you may want to use
      different interfaces for different beans. In this case, you can pass
      <code class="classname">InterfaceBasedMBeanInfoAssembler</code> a
      <code class="classname">Properties</code> instance via the
      <code class="literal">interfaceMappings</code> property, where the key of each
      entry is the bean name and the value of each entry is a comma-separated
      list of interface names to use for that bean.</p><p>If no management interface is specified through either the
      <code class="literal">managedInterfaces</code> or
      <code class="literal">interfaceMappings</code> properties, then the
      <code class="classname">InterfaceBasedMBeanInfoAssembler</code> will reflect on
      the bean and use all of the interfaces implemented by that bean to
      create the management interface.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-interface-methodnames"></a>20.3.7.&nbsp;Using
      <code class="classname">MethodNameBasedMBeanInfoAssembler</code></h3></div></div></div><p>The <code class="classname">MethodNameBasedMBeanInfoAssembler</code>
      allows you to specify a list of method names that will be exposed to JMX
      as attributes and operations. The code below shows a sample
      configuration for this:</p><pre class="programlisting">&lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean5" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="assembler"&gt;
      &lt;bean class="org.springframework.jmx.export.assembler.MethodNameBasedMBeanInfoAssembler"&gt;
        &lt;property name="managedMethods"&gt;
          &lt;value&gt;add,myOperation,getName,setName,getAge&lt;/value&gt;
        &lt;/property&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>Here you can see that the methods <code class="literal">add</code> and
      <code class="literal">myOperation</code> will be exposed as JMX operations and
      <code class="literal">getName()</code>, <code class="literal">setName(String)</code> and
      <code class="literal">getAge()</code> will be exposed as the appropriate half of a
      JMX attribute. In the code above, the method mappings apply to beans
      that are exposed to JMX. To control method exposure on a bean-by-bean
      basis, use the <code class="literal">methodMappings</code> property of
      <code class="classname">MethodNameMBeanInfoAssembler</code> to map bean names to
      lists of method names.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-naming"></a>20.4.&nbsp;Controlling the <code class="classname">ObjectName</code>s for your beans</h2></div></div></div><p>Behind the scenes, the <code class="classname">MBeanExporter</code>
    delegates to an implementation of the
    <code class="classname">ObjectNamingStrategy</code> to obtain
    <code class="classname">ObjectName</code>s for each of the beans it is
    registering. The default implementation,
    <code class="classname">KeyNamingStrategy</code>, will, by default, use the key of
    the <code class="literal">beans</code> <code class="interfacename">Map</code> as the
    <code class="classname">ObjectName</code>. In addition, the
    <code class="classname">KeyNamingStrategy</code> can map the key of the
    <code class="literal">beans</code> <code class="interfacename">Map</code> to an entry in a
    <code class="classname">Properties</code> file (or files) to resolve the
    <code class="classname">ObjectName</code>. In addition to the
    <code class="classname">KeyNamingStrategy</code>, Spring provides two additional
    <code class="classname">ObjectNamingStrategy</code> implementations: the
    <code class="classname">IdentityNamingStrategy</code> that builds an
    <code class="classname">ObjectName</code> based on the JVM identity of the bean
    and the <code class="classname">MetadataNamingStrategy</code> that uses source
    level metadata to obtain the <code class="classname">ObjectName</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-naming-properties"></a>20.4.1.&nbsp;Reading <code class="classname">ObjectName</code>s from <code class="classname">Properties</code></h3></div></div></div><p>You can configure your own
      <code class="classname">KeyNamingStrategy</code> instance and configure it to
      read <code class="classname">ObjectName</code>s from a
      <code class="classname">Properties</code> instance rather than use bean key. The
      <code class="classname">KeyNamingStrategy</code> will attempt to locate an entry
      in the <code class="classname">Properties</code> with a key corresponding to the
      bean key. If no entry is found or if the
      <code class="classname">Properties</code> instance is <code class="literal">null</code>
      then the bean key itself is used.</p><p>The code below shows a sample configuration for the
      <code class="classname">KeyNamingStrategy</code>:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="testBean" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="namingStrategy" ref="namingStrategy"/&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

  &lt;bean id="namingStrategy" class="org.springframework.jmx.export.naming.KeyNamingStrategy"&gt;
    &lt;property name="mappings"&gt;
      &lt;props&gt;
        &lt;prop key="testBean"&gt;bean:name=testBean1&lt;/prop&gt;
      &lt;/props&gt;
    &lt;/property&gt;
    &lt;property name="mappingLocations"&gt;
      &lt;value&gt;names1.properties,names2.properties&lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean

&lt;/beans&gt;</pre><p>Here an instance of <code class="classname">KeyNamingStrategy</code> is
      configured with a <code class="classname">Properties</code> instance that is
      merged from the <code class="classname">Properties</code> instance defined by
      the mapping property and the properties files located in the paths
      defined by the mappings property. In this configuration, the
      <code class="literal">testBean</code> bean will be given the
      <code class="classname">ObjectName</code> <code class="literal">bean:name=testBean1</code>
      since this is the entry in the <code class="classname">Properties</code>
      instance that has a key corresponding to the bean key.</p><p>If no entry in the <code class="classname">Properties</code> instance can
      be found then the bean key name is used as the
      <code class="classname">ObjectName</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-naming-metadata"></a>20.4.2.&nbsp;Using the <code class="classname">MetadataNamingStrategy</code></h3></div></div></div><p>The <code class="classname">MetadataNamingStrategy</code> uses
      <code class="literal">objectName</code> property of the
      <code class="classname">ManagedResource</code> attribute on each bean to create
      the <code class="classname">ObjectName</code>. The code below shows the
      configuration for the
      <code class="classname">MetadataNamingStrategy</code>:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="testBean" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="namingStrategy" ref="namingStrategy"/&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

  &lt;bean id="namingStrategy" class="org.springframework.jmx.export.naming.MetadataNamingStrategy"&gt;
    &lt;property name="attributeSource" ref="attributeSource"/&gt;
  &lt;/bean&gt;

  &lt;bean id="attributeSource"
      class="org.springframework.jmx.export.metadata.AttributesJmxAttributeSource"/&gt;

&lt;/beans&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-jsr160"></a>20.5.&nbsp;JSR-160 Connectors</h2></div></div></div><p>For remote access, Spring JMX module offers two
    <code class="classname">FactoryBean</code> implementations inside the
    <code class="literal">org.springframework.jmx.support</code> package for creating
    both server- and client-side connectors.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-jsr160-server"></a>20.5.1.&nbsp;Server-side Connectors</h3></div></div></div><p>To have Spring JMX create, start and expose a JSR-160
      <code class="classname">JMXConnectorServer</code> use the following
      configuration:</p><pre class="programlisting">&lt;bean id="serverConnector" class="org.springframework.jmx.support.ConnectorServerFactoryBean"/&gt;</pre><p>By default <code class="literal">ConnectorServerFactoryBean</code> creates a
      <code class="classname">JMXConnectorServer</code> bound to
      <code class="literal">"service:jmx:jmxmp://localhost:9875"</code>. The
      <code class="literal">serverConnector</code> bean thus exposes the local
      <code class="interfacename">MBeanServer</code> to clients through the JMXMP protocol
      on localhost, port 9875. Note that the JMXMP protocol is marked as
      optional by the JSR 160 specification: currently, the main open-source
      JMX implementation, MX4J, and the one provided with J2SE 5.0 do
      <span class="emphasis"><em>not</em></span> support JMXMP.</p><p>To specify another URL and register the
      <code class="classname">JMXConnectorServer</code> itself with the
      <code class="interfacename">MBeanServer</code> use the <code class="literal">serviceUrl</code>
      and <code class="classname">ObjectName</code> properties respectively:</p><pre class="programlisting">&lt;bean id="serverConnector"
      class="org.springframework.jmx.support.ConnectorServerFactoryBean"&gt;
  &lt;property name="objectName" value="connector:name=rmi"/&gt;
  &lt;property name="serviceUrl" 
            value="service:jmx:rmi://localhost/jndi/rmi://localhost:1099/myconnector"/&gt;
&lt;/bean&gt;</pre><p>If the <code class="classname">ObjectName</code> property is set Spring
      will automatically register your connector with the
      <code class="interfacename">MBeanServer</code> under that
      <code class="classname">ObjectName</code>. The example below shows the full set
      of parameters which you can pass to the
      <code class="classname">ConnectorServerFactoryBean</code> when creating a
      JMXConnector:</p><pre class="programlisting">&lt;bean id="serverConnector"
      class="org.springframework.jmx.support.ConnectorServerFactoryBean"&gt;
  &lt;property name="objectName" value="connector:name=iiop"/&gt;
  &lt;property name="serviceUrl" 
               value="service:jmx:iiop://localhost/jndi/iiop://localhost:900/myconnector"/&gt;
  &lt;property name="threaded" value="true"/&gt;
  &lt;property name="daemon" value="true"/&gt;
  &lt;property name="environment"&gt;
    &lt;map&gt;
      &lt;entry key="someKey" value="someValue"/&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>Note that when using a RMI-based connector you need the lookup
      service (tnameserv or rmiregistry) to be started in order for the name
      registration to complete. If you are using Spring to export remote
      services for you via RMI, then Spring will already have constructed an
      RMI registry. If not, you can easily start a registry using the
      following snippet of configuration:</p><pre class="programlisting">&lt;bean id="registry" class="org.springframework.remoting.rmi.RmiRegistryFactoryBean"&gt;
  &lt;property name="port" value="1099"/&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-jsr160-client"></a>20.5.2.&nbsp;Client-side Connectors</h3></div></div></div><p>To create an <code class="classname">MBeanServerConnection</code> to a
      remote JSR-160 enabled <code class="interfacename">MBeanServer</code> use the
      <code class="classname">MBeanServerConnectionFactoryBean</code> as shown
      below:</p><pre class="programlisting">&lt;bean id="clientConnector" class="org.springframework.jmx.support.MBeanServerConnectionFactoryBean"&gt;
  &lt;property name="serviceUrl" value="service:jmx:rmi://localhost:9875"/&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-jsr160-protocols"></a>20.5.3.&nbsp;JMX over Burlap/Hessian/SOAP</h3></div></div></div><p>JSR-160 permits extensions to the way in which communication is
      done between the client and the server. The examples above are using the
      mandatory RMI-based implementation required by the JSR-160 specification
      (IIOP and JRMP) and the (optional) JMXMP. By using other providers or
      JMX implementations (such as <a href="http://mx4j.sourceforge.net" target="_top">MX4J</a>) you can take advantage
      of protocols like SOAP, Hessian, Burlap over simple HTTP or SSL and
      others:</p><pre class="programlisting">&lt;bean id="serverConnector" class="org.springframework.jmx.support.ConnectorServerFactoryBean"&gt;
  &lt;property name="objectName" value="connector:name=burlap"/&gt;
  &lt;property name="serviceUrl" value="service:jmx:burlap://localhost:9874"/&gt;
&lt;/bean&gt;</pre><p>In the case of the above example, MX4J 3.0.0 was used; see the
      official MX4J documentation for more information.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-proxy"></a>20.6.&nbsp;Accessing MBeans via Proxies</h2></div></div></div><p>Spring JMX allows you to create proxies that re-route calls to
    MBeans registered in a local or remote <code class="interfacename">MBeanServer</code>.
    These proxies provide you with a standard Java interface through which you
    can interact with your MBeans. The code below shows how to configure a
    proxy for an MBean running in a local
    <code class="interfacename">MBeanServer</code>:</p><pre class="programlisting">&lt;bean id="proxy" class="org.springframework.jmx.access.MBeanProxyFactoryBean"&gt;
    &lt;property name="objectName" value="bean:name=testBean"/&gt;
    &lt;property name="proxyInterface" value="org.springframework.jmx.IJmxTestBean"/&gt;
&lt;/bean&gt;</pre><p>Here you can see that a proxy is created for the MBean registered
    under the <code class="classname">ObjectName</code>:
    <code class="literal">bean:name=testBean</code>. The set of interfaces that the
    proxy will implement is controlled by the
    <code class="literal">proxyInterfaces</code> property and the rules for mapping
    methods and properties on these interfaces to operations and attributes on
    the MBean are the same rules used by the
    <code class="classname">InterfaceBasedMBeanInfoAssembler</code>.</p><p>The <code class="classname">MBeanProxyFactoryBean</code> can create a proxy
    to any MBean that is accessible via an
    <code class="classname">MBeanServerConnection</code>. By default, the local
    <code class="interfacename">MBeanServer</code> is located and used, but you can
    override this and provide an <code class="classname">MBeanServerConnection</code>
    pointing to a remote <code class="interfacename">MBeanServer</code> to cater for
    proxies pointing to remote MBeans:</p><pre class="programlisting">&lt;bean id="clientConnector"
      class="org.springframework.jmx.support.MBeanServerConnectionFactoryBean"&gt;
  &lt;property name="serviceUrl" value="service:jmx:rmi://remotehost:9875"/&gt;
&lt;/bean&gt;

&lt;bean id="proxy" class="org.springframework.jmx.access.MBeanProxyFactoryBean"&gt;
  &lt;property name="objectName" value="bean:name=testBean"/&gt;
  &lt;property name="proxyInterface" value="org.springframework.jmx.IJmxTestBean"/&gt;
  &lt;property name="server" ref="clientConnector"/&gt;
&lt;/bean&gt;</pre><p>Here you can see that we create an
    <code class="classname">MBeanServerConnection</code> pointing to a remote machine
    using the <code class="classname">MBeanServerConnectionFactoryBean</code>. This
    <code class="classname">MBeanServerConnection</code> is then passed to the
    <code class="classname">MBeanProxyFactoryBean</code> via the
    <code class="literal">server</code> property. The proxy that is created will forward
    all invocations to the <code class="interfacename">MBeanServer</code> via this
    <code class="classname">MBeanServerConnection</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-notifications"></a>20.7.&nbsp;Notifications</h2></div></div></div><p>Spring's JMX offering includes comprehensive support for JMX
    notifications.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-notifications-listeners"></a>20.7.1.&nbsp;Registering Listeners for Notifications</h3></div></div></div><p>Spring's JMX support makes it very easy to register any number of
      <code class="classname">NotificationListeners</code> with any number of MBeans
      (this includes MBeans exported by Spring's
      <code class="classname">MBeanExporter</code> and MBeans registered via some
      other mechanism). An example will best illustrate how simple it is to
      effect the registration of <code class="classname">NotificationListeners</code>.
      Consider the scenario where one would like to be informed (via a
      <code class="classname">Notification</code>) each and every time an attribute of
      a target MBean changes.</p><pre class="programlisting">package com.example;

import javax.management.AttributeChangeNotification;
import javax.management.Notification;
import javax.management.NotificationFilter;
import javax.management.NotificationListener;

public class ConsoleLoggingNotificationListener
               implements NotificationListener, NotificationFilter {

    public void handleNotification(Notification notification, Object handback) {
        System.out.println(notification);
        System.out.println(handback);
    }

    public boolean isNotificationEnabled(Notification notification) {
        return AttributeChangeNotification.class.isAssignableFrom(notification.getClass());
    }
}</pre><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="notificationListenerMappings"&gt;
        &lt;map&gt;
            &lt;entry key="bean:name=testBean1"&gt;
                &lt;bean class="com.example.ConsoleLoggingNotificationListener"/&gt;
            &lt;/entry&gt;
        &lt;/map&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>With the above configuration in place, every time a JMX
      <code class="classname">Notification</code> is broadcast from the target MBean
      (<code class="literal">bean:name=testBean1</code>), the
      <code class="classname">ConsoleLoggingNotificationListener</code> bean that was
      registered as a listener via the
      <code class="literal">notificationListenerMappings</code> property will be
      notified. The <code class="classname">ConsoleLoggingNotificationListener</code>
      bean can then take whatever action it deems appropriate in response to
      the <code class="classname">Notification</code>.</p><p>If one wants to register a single
      <code class="classname">NotificationListener</code> instance for all of the
      beans that the enclosing <code class="classname">MBeanExporter</code> is
      exporting, one can use the special wildcard <code class="literal">'*'</code> (sans
      quotes) as the key for an entry in the
      <code class="literal">notificationListenerMappings</code> property map; for example:</p><pre class="programlisting">    &lt;property name="notificationListenerMappings"&gt;
        &lt;map&gt;
            &lt;entry key="*"&gt;
                &lt;bean class="com.example.ConsoleLoggingNotificationListener"/&gt;
            &lt;/entry&gt;
        &lt;/map&gt;
    &lt;/property&gt;</pre><p>If one needs to do the inverse (i.e. register a number of distinct
      listeners against an MBean), then one has to use the
      <code class="literal">notificationListeners</code> list property instead (and in
      preference to the <code class="literal">notificationListenerMappings</code>
      property). This time, instead of configuring simply a
      <code class="classname">NotificationListener</code> for a single MBean, one
      configures <code class="classname">NotificationListenerBean</code> instances...
      a <code class="classname">NotificationListenerBean</code> encapsulates a
      <code class="classname">NotificationListener</code> and the
      <code class="classname">ObjectName</code> (or
      <code class="classname">ObjectNames</code>) that it is to be registered against
      in an <code class="interfacename">MBeanServer</code>. The
      <code class="classname">NotificationListenerBean</code> also encapsulates a
      number of other properties such as a
      <code class="classname">NotificationFilter</code> and an arbitrary handback
      object that can be used in advanced JMX notification scenarios.</p><p>The configuration when using
      <code class="classname">NotificationListenerBean</code> instances is not wildly
      different to what was presented previously:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="notificationListeners"&gt;
        &lt;list&gt;
            &lt;bean class="org.springframework.jmx.export.NotificationListenerBean"&gt;
                &lt;constructor-arg&gt;
                    &lt;bean class="com.example.ConsoleLoggingNotificationListener"/&gt;
                &lt;/constructor-arg&gt;
                &lt;property name="mappedObjectNames"&gt;
                    &lt;list&gt;
                        &lt;value&gt;bean:name=testBean1&lt;/value&gt;
                    &lt;/list&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
        &lt;/list&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>The above example is equivalent to the first notification example.
      Lets assume then that we want to be given a handback object every time a
      <code class="classname">Notification</code> is raised, and that additionally we
      want to filter out extraneous <code class="classname">Notifications</code> by
      supplying a <code class="classname">NotificationFilter</code>. (For a full
      discussion of just what a handback object is, and indeed what a
      <code class="classname">NotificationFilter</code> is, please do consult that
      section of the JMX specification (1.2) entitled <code class="literal">'The JMX
      Notification Model'</code>.)</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean1"/&gt;
        &lt;entry key="bean:name=testBean2" value-ref="testBean2"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="notificationListeners"&gt;
        &lt;list&gt;
            &lt;bean class="org.springframework.jmx.export.NotificationListenerBean"&gt;
                &lt;constructor-arg ref="customerNotificationListener"/&gt;
                &lt;property name="mappedObjectNames"&gt;
                    &lt;list&gt;
                        <em class="lineannotation"><span class="lineannotation">&lt;!-- let's handle notifications from two distinct MBeans --&gt;</span></em>
                        &lt;value&gt;bean:name=testBean1&lt;/value&gt;
                        &lt;value&gt;bean:name=testBean2&lt;/value&gt;
                    &lt;/list&gt;
                &lt;/property&gt;
                &lt;property name="handback"&gt;
                    &lt;bean class="java.lang.String"&gt;
                        &lt;constructor-arg value="This could be anything..."/&gt;
                    &lt;/bean&gt;
                &lt;/property&gt;
                &lt;property name="notificationFilter" ref="customerNotificationListener"/&gt;
            &lt;/bean&gt;
        &lt;/list&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
  
  <em class="lineannotation"><span class="lineannotation">&lt;!-- implements both the 'NotificationListener' and 'NotificationFilter' interfaces --&gt;</span></em>
  &lt;bean id="customerNotificationListener" class="com.example.ConsoleLoggingNotificationListener"/&gt;

  &lt;bean id="testBean1" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean2" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="ANOTHER TEST"/&gt;
    &lt;property name="age" value="200"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-notifications-publishing"></a>20.7.2.&nbsp;Publishing Notifications</h3></div></div></div><p>Spring provides support not just for registering to receive
      <code class="classname">Notifications</code>, but also for publishing
      <code class="classname">Notifications</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Please note that this section is really only relevant to Spring
        managed beans that have been exposed as MBeans via an
        <code class="classname">MBeanExporter</code>; any existing, user-defined
        MBeans should use the standard JMX APIs for notification
        publication.</p></td></tr></table></div><p>The key interface in Spring's JMX notification publication support
      is the <code class="classname">NotificationPublisher</code> interface (defined
      in the <code class="literal">org.springframework.jmx.export.notification</code>
      package). Any bean that is going to be exported as an MBean via an
      <code class="classname">MBeanExporter</code> instance can implement the related
      <code class="classname">NotificationPublisherAware</code> interface to gain
      access to a <code class="classname">NotificationPublisher</code> instance. The
      <code class="classname">NotificationPublisherAware</code> interface simply
      supplies an instance of a <code class="classname">NotificationPublisher</code>
      to the implementing bean via a simple setter method, which the bean can
      then use to publish <code class="classname">Notifications</code>.</p><p>As stated in the Javadoc for the
      <code class="classname">NotificationPublisher</code> class, managed beans that
      are publishing events via the
      <code class="classname">NotificationPublisher</code> mechanism are
      <span class="emphasis"><em>not</em></span> responsible for the state management of any
      notification listeners and the like ... Spring's JMX support will take
      care of handling all the JMX infrastructure issues. All one need do as
      an application developer is implement the
      <code class="classname">NotificationPublisherAware</code> interface and start
      publishing events using the supplied
      <code class="classname">NotificationPublisher</code> instance. Note that the
      <code class="classname">NotificationPublisher</code> will be set
      <span class="emphasis"><em>after</em></span> the managed bean has been registered with an
      <code class="interfacename">MBeanServer</code>.</p><p>Using a <code class="classname">NotificationPublisher</code> instance is
      quite straightforward... one simply creates a JMX
      <code class="classname">Notification</code> instance (or an instance of an
      appropriate <code class="classname">Notification</code> subclass), populates
      the notification with the data pertinent to the event that is to be
      published, and one then invokes the
      <code class="literal">sendNotification(Notification)</code> on the
      <code class="classname">NotificationPublisher</code> instance, passing in the
      <code class="classname">Notification</code>.</p><p>Let's look at a simple example... in this scenario, exported
      instances of the <code class="classname">JmxTestBean</code> are going to publish
      a <code class="classname">NotificationEvent</code> every time the
      <code class="literal">add(int, int)</code> operation is invoked.</p><pre class="programlisting">package org.springframework.jmx;
			
import org.springframework.jmx.export.notification.NotificationPublisherAware;
import org.springframework.jmx.export.notification.NotificationPublisher;
import javax.management.Notification;

public class JmxTestBean implements IJmxTestBean, NotificationPublisherAware {

    private String name;
    private int age;
    private boolean isSuperman;
    private NotificationPublisher publisher;

    <em class="lineannotation"><span class="lineannotation">// other getters and setters omitted for clarity</span></em>

    public int add(int x, int y) {
        int answer = x + y;
        this.publisher.sendNotification(new Notification("add", this, 0));
        return answer;
    }

    public void dontExposeMe() {
        throw new RuntimeException();
    }
    
    public void setNotificationPublisher(NotificationPublisher notificationPublisher) {
        this.publisher = notificationPublisher;
    }
}</pre><p>The <code class="classname">NotificationPublisher</code> interface and the
      machinery to get it all working is one of the nicer features of Spring's JMX support.
	  It does however come with the price tag of coupling your classes to both Spring and JMX; as
	  always, the advice here is to be pragmatic... if you need the functionality offered by the
      <code class="classname">NotificationPublisher</code> and you can accept the coupling to both Spring
	  and JMX, then do so.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-resources"></a>20.8.&nbsp;Further Resources</h2></div></div></div><p>This section contains links to further resources about JMX.</p><div class="itemizedlist"><ul type="disc"><li><p>The <a href="http://java.sun.com/products/JavaManagement/" target="_top">JMX homepage</a> at Sun</p></li><li><p>The <a href="http://jcp.org/aboutJava/communityprocess/final/jsr003/index3.html" target="_top">JMX specification</a> (JSR-000003)</p></li><li><p>The <a href="http://jcp.org/aboutJava/communityprocess/final/jsr160/index.html" target="_top">JMX Remote API specification</a> (JSR-000160)</p></li><li><p>The <a href="http://mx4j.sourceforge.net/" target="_top">MX4J
        homepage</a> (an Open Source implementation of various JMX
        specs)</p></li><li><p><a href="http://java.sun.com/developer/technicalArticles/J2SE/jmx.html" target="_top">Getting Started with JMX</a> - an introductory article from Sun.</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="cci"></a>Chapter&nbsp;21.&nbsp;JCA CCI</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cci-introduction"></a>21.1.&nbsp;Introduction</h2></div></div></div><p>J2EE provides a specification to standardize access to enterprise information systems (EIS):
    the JCA (Java Connector Architecture). This specification is divided into several different parts:</p><div class="itemizedlist"><ul type="disc"><li><p>SPI (Service provider interfaces) that the connector provider
        must implement. These interfaces constitute a resource adapter which
        can be deployed on a J2EE application server. In such a scenario, the
        server manages connection pooling, transaction and security (managed
        mode). The application server is also responsible for managing the
        configuration, which is held outside the client application. A connector
        can be used without an application server as well; in this case, the
        application must configure it directly (non-managed mode).</p></li><li><p>CCI (Common Client Interface) that an application can use to
        interact with the connector and thus communicate with an EIS. An API
        for local transaction demarcation is provided as well.</p></li></ul></div><p>The aim of the Spring CCI support is to provide classes to access
    a CCI connector in typical Spring style, leveraging the Spring Framework's general
    resource and transaction management facilities.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The client side of connectors doesn't alway use CCI. Some
        connectors expose their own APIs, only providing JCA resource adapter to
        use the system contracts of a J2EE container (connection pooling, global
        transactions, security). Spring does not offer special support for such
        connector-specific APIs.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cci-config"></a>21.2.&nbsp;Configuring CCI</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-config-connector"></a>21.2.1.&nbsp;Connector configuration</h3></div></div></div><p>The base resource to use JCA CCI is the
      <code class="interfacename">ConnectionFactory</code> interface. The connector used
      must provide an implementation of this interface.</p><p>To use your connector, you can deploy it on your application
      server and fetch the <code class="interfacename">ConnectionFactory</code> from the
      server's JNDI environment (managed mode). The connector must be
      packaged as a RAR file (resource adapter archive) and contain a
      <code class="filename">ra.xml</code> file to describe its deployment
      characteristics. The actual name of the resource is specified when
      you deploy it. To access it within Spring, simply use Spring's
      <code class="classname">JndiObjectFactoryBean</code> to fetch the factory
      by its JNDI name.</p><p>Another way to use a connector is to embed it in your application
      (non-managed mode), not using an application server to deploy and
      configure it. Spring offers the possibility to configure a connector
      as a bean, through a provided <code class="literal">FactoryBean</code>
      (<code class="classname">LocalConnectionFactoryBean</code>). In this manner,
      you only need the connector library in the classpath (no RAR file and
      no <code class="filename">ra.xml</code> descriptor needed). The library must
      be extracted from the connector's RAR file, if necessary.</p><p>Once you have got access to your <code class="interfacename">ConnectionFactory</code>
      instance, you can inject it into your components. These components can
      either be coded against the plain CCI API or leverage Spring's support
      classes for CCI access (e.g. <code class="classname">CciTemplate</code>).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>When you use a connector in
        non-managed mode, you can't use global transactions because the resource
        is never enlisted / delisted in the current global transaction of the
        current thread. The resource is simply not aware of any global J2EE
	    transactions that might be running.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-config-connectionfactory"></a>21.2.2.&nbsp;<code class="interfacename">ConnectionFactory</code> configuration in Spring</h3></div></div></div><p>In order to make connections to the EIS, you need to obtain a
      <code class="interfacename">ConnectionFactory</code> from the application server if
      you are in a managed mode, or directly from Spring if you are in a
      non-managed mode.</p><p>In a managed mode, you access a <code class="interfacename">ConnectionFactory</code>
      from JNDI; its properties will be configured in the application server.</p><pre class="programlisting">&lt;bean id="eciConnectionFactory" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
  &lt;property name="jndiName" value="eis/cicseci"/&gt;
&lt;/bean&gt;</pre><p>In non-managed mode, you must configure the <code class="interfacename">ConnectionFactory</code>
      you want to use in the configuration of Spring as a JavaBean. The
      <code class="classname">LocalConnectionFactoryBean</code> class offers this
      setup style, passing in the <code class="classname">ManagedConnectionFactory</code>
      implementation of your connector, exposing the application-level
	  CCI <code class="interfacename">ConnectionFactory</code>.</p><pre class="programlisting">&lt;bean id="eciManagedConnectionFactory" class="com.ibm.connector2.cics.ECIManagedConnectionFactory"&gt;
  &lt;property name="serverName" value="TXSERIES"/&gt;
  &lt;property name="connectionURL" value="tcp://localhost/"/&gt;
  &lt;property name="portNumber" value="2006"/&gt;
&lt;/bean&gt;

&lt;bean id="eciConnectionFactory" class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="eciManagedConnectionFactory"/&gt;
&lt;/bean&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can't directly instantiate a specific
        <code class="interfacename">ConnectionFactory</code>. You need to go through
        the corresponding implementation of the
        <code class="classname">ManagedConnectionFactory</code> interface for your
        connector. This interface is part of the JCA SPI specification.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-config-cci-connections"></a>21.2.3.&nbsp;Configuring CCI connections</h3></div></div></div><p>JCA CCI allow the developer to configure the connections to the
      EIS using the <code class="interfacename">ConnectionSpec</code> implementation of your
      connector. In order to configure its properties, you need to wrap the
      target connection factory with a dedicated adapter,
      <code class="classname">ConnectionSpecConnectionFactoryAdapter</code>. So, the
      dedicated <code class="interfacename">ConnectionSpec</code> can be configured with the
      property <code class="literal">connectionSpec</code> (as an inner bean).</p><p>This property is not mandatory because the CCI
      <code class="interfacename">ConnectionFactory</code> interface defines two different
      methods to obtain a CCI connection. Some of the
      <code class="interfacename">ConnectionSpec</code> properties can often be configured
	  in the application server (in managed mode) or on the corresponding local
	  <code class="classname">ManagedConnectionFactory</code> implementation.</p><pre class="programlisting">public interface ConnectionFactory implements Serializable, Referenceable {
  ...
  Connection getConnection() throws ResourceException;
  Connection getConnection(ConnectionSpec connectionSpec) throws ResourceException;
  ...
}</pre><p>Spring provides a <code class="classname">ConnectionSpecConnectionFactoryAdapter</code>
      that allows for specifying a <code class="interfacename">ConnectionSpec</code> instance
      to use for all operations on a given factory. If the adapter's
	  <code class="literal">connectionSpec</code> property is specified, the adapter
      uses the <code class="literal">getConnection</code> variant without argument,
      else the one with the <code class="interfacename">ConnectionSpec</code> argument.</p><pre class="programlisting">&lt;bean id="managedConnectionFactory"
    class="com.sun.connector.cciblackbox.CciLocalTxManagedConnectionFactory"&gt;
  &lt;property name="connectionURL" value="jdbc:hsqldb:hsql://localhost:9001"/&gt;
  &lt;property name="driverName" value="org.hsqldb.jdbcDriver"/&gt;
&lt;/bean&gt;

&lt;bean id="targetConnectionFactory"
    class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="managedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory"
    class="org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter"&gt;
  &lt;property name="targetConnectionFactory" ref="targetConnectionFactory"/&gt;
  &lt;property name="connectionSpec"&gt;
    &lt;bean class="com.sun.connector.cciblackbox.CciConnectionSpec"&gt;
      &lt;property name="user" value="sa"/&gt;
      &lt;property name="password" value=""/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-config-single-connection"></a>21.2.4.&nbsp;Using a single CCI connection</h3></div></div></div><p>If you want to use a single CCI connection, Spring provides a further
      <code class="interfacename">ConnectionFactory</code> adapter to manage this. The
      <code class="classname">SingleConnectionFactory</code> adapter class will open a single
      connection lazily and close it when this bean is destroyed at application
      shutdown. This class will expose special <code class="interfacename">Connection</code>
      proxies that behave accordingly, all sharing the same underlying physical
			connection.</p><pre class="programlisting">&lt;bean id="eciManagedConnectionFactory"
    class="com.ibm.connector2.cics.ECIManagedConnectionFactory"&gt;
  &lt;property name="serverName" value="TEST"/&gt;
  &lt;property name="connectionURL" value="tcp://localhost/"/&gt;
  &lt;property name="portNumber" value="2006"/&gt;
&lt;/bean&gt;

&lt;bean id="targetEciConnectionFactory"
    class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="eciManagedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="eciConnectionFactory"
    class="org.springframework.jca.cci.connection.SingleConnectionFactory"&gt;
  &lt;property name="targetConnectionFactory" ref="targetEciConnectionFactory"/&gt;
&lt;/bean&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>This <code class="interfacename">ConnectionFactory</code> adapter cannot directly be
        configured with a <code class="interfacename">ConnectionSpec</code>. Use an
        intermediary <code class="classname">ConnectionSpecConnectionFactoryAdapter</code>
        that the <code class="classname">SingleConnectionFactory</code> talks to
        if you require a single connection for a specific
        <code class="interfacename">ConnectionSpec</code>.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cci-using"></a>21.3.&nbsp;Using Spring's CCI access support</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-record-creator"></a>21.3.1.&nbsp;Record conversion</h3></div></div></div><p>One of the aims of the JCA CCI support is to provide convenient
			facilities for manipulating CCI records. The developer can specify the
      strategy to create records and extract datas from records, for use
      with Spring's <code class="classname">CciTemplate</code>. The following interfaces will configure the
      strategy to use input and output records if you don't want to work
      with records directly in your application.</p><p>In order to create an input <code class="interfacename">Record</code>, the
      developer can use a dedicated implementation of the
      <code class="interfacename">RecordCreator</code> interface.</p><pre class="programlisting">public interface RecordCreator {

  Record createRecord(RecordFactory recordFactory) throws ResourceException, DataAccessException;
}</pre><p>As you can see, the <code class="literal">createRecord(..)</code> method
      receives a <code class="interfacename">RecordFactory</code> instance as parameter,
			which corresponds to the <code class="interfacename">RecordFactory</code> of the
		  <code class="interfacename">ConnectionFactory</code> used. This reference can be
			used to create <code class="interfacename">IndexedRecord</code> or
      <code class="interfacename">MappedRecord</code> instances. The following sample
      shows how to use the <code class="interfacename">RecordCreator</code> interface
      and indexed/mapped records.</p><pre class="programlisting">public class MyRecordCreator implements RecordCreator {

  public Record createRecord(RecordFactory recordFactory) throws ResourceException {
    IndexedRecord input = recordFactory.createIndexedRecord("input");
    input.add(new Integer(id));
    return input;
  }
}</pre><p>An output <code class="interfacename">Record</code> can be used to receive
      data back from the EIS. Hence, a specific implementation of the
      <code class="interfacename">RecordExtractor</code> interface can be passed to
      Spring's <code class="classname">CciTemplate</code> for extracting data from the output
      <code class="interfacename">Record</code>.</p><pre class="programlisting">public interface RecordExtractor {

  Object extractData(Record record) throws ResourceException, SQLException, DataAccessException;
}</pre><p>The following sample shows how to use the <code class="interfacename">RecordExtractor</code> interface.</p><pre class="programlisting">public class MyRecordExtractor implements RecordExtractor {

  public Object extractData(Record record) throws ResourceException {
    CommAreaRecord commAreaRecord = (CommAreaRecord) record;
    String str = new String(commAreaRecord.toByteArray());
    String field1 = string.substring(0,6);
    String field2 = string.substring(6,1);
    return new OutputObject(Long.parseLong(field1), field2);
  }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-using-template"></a>21.3.2.&nbsp;The <code class="classname">CciTemplate</code></h3></div></div></div><p>The <code class="classname">CciTemplate</code> is the central class of the core CCI support package
      (<code class="literal">org.springframework.jca.cci.core</code>). It simplifies
      the use of CCI since it handles the creation and release of resources.
      This helps to avoid common errors like forgetting to always close the
      connection. It cares for the lifecycle of connection and interaction
			objects, letting application code focus on generating input records
      from application data and extracting application data from output
      records.</p><p>The JCA CCI specification defines two distinct methods to call
      operations on an EIS. The CCI <code class="interfacename">Interaction</code>
      interface provides two execute method signatures:</p><pre class="programlisting">public interface javax.resource.cci.Interaction {
  ...
  boolean execute(InteractionSpec spec, Record input, Record output) throws ResourceException;

  Record execute(InteractionSpec spec, Record input) throws ResourceException;
  ...
}</pre><p>Depending on the template method called, <code class="classname">CciTemplate</code>
      will know which <code class="literal">execute</code> method to call on the interaction.
      In any case, a correctly initialized <code class="interfacename">InteractionSpec</code>
      instance is mandatory.</p><p><code class="literal">CciTemplate.execute(..)</code> can be used in two ways:</p><div class="itemizedlist"><ul type="disc"><li><p>With direct <code class="interfacename">Record</code> arguments. In this case,
          you simply need to pass the CCI input record in, and the returned object
          be the corresponding CCI output record.</p></li><li><p>With application objects, using record mapping. In this case,
          you need to provide corresponding <code class="interfacename">RecordCreator</code>
				  and <code class="interfacename">RecordExtractor</code> instances.
          </p></li></ul></div><p>With the first approach, the following methods of the template
      will be used. These methods directly correspond to those on the
      <code class="interfacename">Interaction</code> interface.</p><pre class="programlisting">public class CciTemplate implements CciOperations {

  public Record execute(InteractionSpec spec, Record inputRecord)
      throws DataAccessException { ... }

  public void execute(InteractionSpec spec, Record inputRecord, Record outputRecord)
      throws DataAccessException { ... }

}</pre><p>With the second approach, we need to specify the record creation
      and record extraction strategies as arguments. The interfaces used
      are those describe in the previous section on record conversion.
      The corresponding <code class="classname">CciTemplate</code> methods are the
      following:</p><pre class="programlisting">public class CciTemplate implements CciOperations {

  public Record execute(InteractionSpec spec, RecordCreator inputCreator)
      throws DataAccessException { ... }

  public Object execute(InteractionSpec spec, Record inputRecord, RecordExtractor outputExtractor)
      throws DataAccessException { ... }

  public Object execute(InteractionSpec spec, RecordCreator creator, RecordExtractor extractor)
      throws DataAccessException { ... }

}</pre><p>Unless the <code class="literal">outputRecordCreator</code> property is
      set on the template (see the following section), every method will call
      the corresponding <code class="literal">execute</code> method of the CCI
      <code class="interfacename">Interaction</code> with two parameters:
      <code class="interfacename">InteractionSpec</code> and input <code class="interfacename">Record</code>,
			receiving an output <code class="interfacename">Record</code> as return value.
			</p><p><code class="classname">CciTemplate</code> also provides methods to create
			<code class="literal">IndexRecord</code> and <code class="literal">MappedRecord</code>
      outside a <code class="interfacename">RecordCreator</code> implementation, through
      its <code class="literal">createIndexRecord(..)</code> and
      <code class="literal">createMappedRecord(..)</code> methods. This can be used
			within DAO implementations to create <code class="interfacename">Record</code>
			instances to pass into corresponding
      <code class="literal">CciTemplate.execute(..)</code> methods.</p><pre class="programlisting">public class CciTemplate implements CciOperations {

  public IndexedRecord createIndexedRecord(String name) throws DataAccessException { ... }

  public MappedRecord createMappedRecord(String name) throws DataAccessException { ... }

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-using-dao"></a>21.3.3.&nbsp;DAO support</h3></div></div></div><p>Spring's CCI support provides a abstract class for DAOs,
      supporting injection of a <code class="interfacename">ConnectionFactory</code>
      or a <code class="classname">CciTemplate</code> instances. The name of the
      class is <code class="classname">CciDaoSupport</code>: It provides simple
      <code class="literal">setConnectionFactory</code> and
      <code class="literal">setCciTemplate</code> methods. Internally, this
      class will create a <code class="classname">CciTemplate</code> instance
      for a passed-in <code class="interfacename">ConnectionFactory</code>, exposing
      it to concrete data access implementations in subclasses.</p><pre class="programlisting">public abstract class CciDaoSupport {

  public void setConnectionFactory(ConnectionFactory connectionFactory) { ... }
  public ConnectionFactory getConnectionFactory() { ... }

  public void setCciTemplate(CciTemplate cciTemplate) { ... }
  public CciTemplate getCciTemplate() { ... }

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="automatic-output-generation"></a>21.3.4.&nbsp;Automatic output record generation</h3></div></div></div><p>If the connector used only supports the
	  <code class="methodname">Interaction.execute(..)</code> method with input and output
      records as parameters (that is, it requires the desired output record
      to be passed in instead of returning an appropriate output record),
      you can set the <code class="literal">outputRecordCreator</code> property of the
      <code class="classname">CciTemplate</code> to automatically generate an output
      record to be filled by the JCA connector when the response is received.
      This record will be then returned to the caller of the template.</p><p>This property simply holds an implementation of the
      <code class="interfacename">RecordCreator</code> interface, used for that purpose.
      The <code class="interfacename">RecordCreator</code> interface has already been
      discussed in the section entitled <a href="#cci-record-creator" title="21.3.1.&nbsp;Record conversion">Section&nbsp;21.3.1, &#8220;Record conversion&#8221;</a>.
      The <code class="literal">outputRecordCreator</code>
      property must be directly specified on the <code class="classname">CciTemplate</code>.
      This could be done in the application code like so:</p><pre class="programlisting">cciTemplate.setOutputRecordCreator(new EciOutputRecordCreator());</pre><p>Or (recommended) in the Spring configuration, if the <code class="classname">CciTemplate</code>
      is configured as a dedicated bean instance:</p><pre class="programlisting">&lt;bean id="eciOutputRecordCreator" class="eci.EciOutputRecordCreator"/&gt;

&lt;bean id="cciTemplate" class="org.springframework.jca.cci.core.CciTemplate"&gt;
  &lt;property name="connectionFactory" ref="eciConnectionFactory"/&gt;
  &lt;property name="outputRecordCreator" ref="eciOutputRecordCreator"/&gt;
&lt;/bean&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>As the <code class="classname">CciTemplate</code> class is thread-safe, it will
        usually be configured as a shared instance.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="template-summary"></a>21.3.5.&nbsp;Summary</h3></div></div></div><p>The following table summarizes the mechanisms of the
      <code class="classname">CciTemplate</code> class and the corresponding methods
      called on the CCI <code class="interfacename">Interaction</code> interface:</p><div class="table"><a name="cci-interaction-execute-methods"></a><p class="title"><b>Table&nbsp;21.1.&nbsp;Usage of <code class="interfacename">Interaction</code> execute methods</b></p><div class="table-contents"><table summary="Usage of Interaction execute methods" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">CciTemplate method signature</th><th align="center">CciTemplate outputRecordCreator
                property</th><th align="center">execute method called on the CCI
                Interaction</th></tr></thead><tbody><tr><td align="center">Record execute(InteractionSpec,
                Record)</td><td align="center">not set</td><td align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec,
                Record)</td><td align="center">set</td><td align="center">boolean execute(InteractionSpec, Record,
                Record)</td></tr><tr><td align="center">void execute(InteractionSpec, Record,
                Record)</td><td align="center">not set</td><td align="center">void execute(InteractionSpec, Record,
                Record)</td></tr><tr><td align="center">void execute(InteractionSpec, Record,
                Record)</td><td align="center">set</td><td align="center">void execute(InteractionSpec, Record,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec,
                RecordCreator)</td><td align="center">not set</td><td align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec,
                RecordCreator)</td><td align="center">set</td><td align="center">void execute(InteractionSpec, Record,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec, Record,
                RecordExtractor)</td><td align="center">not set</td><td align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec, Record,
                RecordExtractor)</td><td align="center">set</td><td align="center">void execute(InteractionSpec, Record,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec,
                RecordCreator, RecordExtractor)</td><td align="center">not set</td><td align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec,
                RecordCreator, RecordExtractor)</td><td align="center">set</td><td align="center">void execute(InteractionSpec, Record,
                Record)</td></tr></tbody></table></div></div><p><br class="table-break"></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-straight"></a>21.3.6.&nbsp;Using a CCI <code class="interfacename">Connection</code> and <code class="interfacename">Interaction</code> directly</h3></div></div></div><p><code class="classname">CciTemplate</code> also offers the possibility to
      work directly with CCI connections and interactions, in the same manner
      as <code class="classname">JdbcTemplate</code> and <code class="classname">JmsTemplate</code>.
      This is useful when you want to perform multiple operations on a CCI
      connection or interaction, for example.</p><p>The interface <code class="interfacename">ConnectionCallback</code> provides a
      CCI <code class="interfacename">Connection</code> as argument, in order to perform
      custom operations on it, plus the CCI <code class="interfacename">ConnectionFactory</code>
      which the <code class="interfacename">Connection</code> was created with. The latter
      can be useful for example to get an associated <code class="interfacename">RecordFactory</code>
      instance and create indexed/mapped records, for example.</p><pre class="programlisting">public interface ConnectionCallback {

  Object doInConnection(Connection connection, ConnectionFactory connectionFactory)
      throws ResourceException, SQLException, DataAccessException;
}</pre><p>The interface <code class="interfacename">InteractionCallback</code> provides
      the CCI <code class="interfacename">Interaction</code>, in order to perform custom
      operations on it, plus the corresponding CCI <code class="interfacename">ConnectionFactory</code>.
			</p><pre class="programlisting">public interface InteractionCallback {

  Object doInInteraction(Interaction interaction, ConnectionFactory connectionFactory)
      throws ResourceException, SQLException, DataAccessException;
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="interfacename">InteractionSpec</code> objects
        can either be shared across multiple template calls or newly created
        inside every callback method. This is completely up to the DAO implementation.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-template-example"></a>21.3.7.&nbsp;Example for <code class="classname">CciTemplate</code> usage</h3></div></div></div><p>In this section, the usage of the <code class="classname">CciTemplate</code>
      will be shown to acces to a CICS with ECI mode, with the IBM CICS ECI
      connector.</p><p>Firstly, some initializations on the CCI
      <code class="interfacename">InteractionSpec</code> must be done to specify which CICS
      program to access and how to interact with it.</p><pre class="programlisting">ECIInteractionSpec interactionSpec = new ECIInteractionSpec();
interactionSpec.setFunctionName("MYPROG");
interactionSpec.setInteractionVerb(ECIInteractionSpec.SYNC_SEND_RECEIVE);</pre><p>Then the program can use CCI via Spring's template and specify
      mappings between custom objects and CCI <code class="literal">Records</code>.</p><pre class="programlisting">public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public OutputObject getData(InputObject input) {
    ECIInteractionSpec interactionSpec = ...;

    OutputObject output = (ObjectOutput) getCciTemplate().execute(interactionSpec,
        new RecordCreator() {
          public Record createRecord(RecordFactory recordFactory) throws ResourceException {
            return new CommAreaRecord(input.toString().getBytes());
          }
        },
        new RecordExtractor() {
          public Object extractData(Record record) throws ResourceException {
            CommAreaRecord commAreaRecord = (CommAreaRecord)record;
            String str = new String(commAreaRecord.toByteArray());
            String field1 = string.substring(0,6);
            String field2 = string.substring(6,1);
            return new OutputObject(Long.parseLong(field1), field2);
          }
        });

    return output;
  }
}</pre><p>As discussed previously, callbacks can be used to work
      directly on CCI connections or interactions.</p><pre class="programlisting">public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public OutputObject getData(InputObject input) {
    ObjectOutput output = (ObjectOutput) getCciTemplate().execute(
        new ConnectionCallback() {
          public Object doInConnection(Connection connection, ConnectionFactory factory)
              throws ResourceException {
              
            <em class="lineannotation"><span class="lineannotation">// do something...</span></em>
          }
        });
    }
    return output;
  }
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>With a <code class="interfacename">ConnectionCallback</code>,
      the <code class="interfacename">Connection</code> used will be managed and closed by
			the <code class="classname">CciTemplate</code>, but any interactions created
      on the connection must be managed by the callback implementation.</p></td></tr></table></div><p>For a more specific callback, you can implement an
			<code class="interfacename">InteractionCallback</code>. The passed-in
			<code class="interfacename">Interaction</code> will be managed and closed by the
			<code class="classname">CciTemplate</code> in this case.</p><pre class="programlisting">public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public String getData(String input) {
    ECIInteractionSpec interactionSpec = ...;

    String output = (String) getCciTemplate().execute(interactionSpec,
        new InteractionCallback() {
          public Object doInInteraction(Interaction interaction, ConnectionFactory factory)
              throws ResourceException {
            Record input = new CommAreaRecord(inputString.getBytes());
            Record output = new CommAreaRecord();
            interaction.execute(holder.getInteractionSpec(), input, output);
            return new String(output.toByteArray());
          }
        });

    return output;
  }
}</pre><p>For the examples above, the corresponding configuration of the
      involved Spring beans could look like this in non-managed mode:</p><pre class="programlisting">&lt;bean id="managedConnectionFactory" class="com.ibm.connector2.cics.ECIManagedConnectionFactory"&gt;
  &lt;property name="serverName" value="TXSERIES"/&gt;
  &lt;property name="connectionURL" value="local:"/&gt;
  &lt;property name="userName" value="CICSUSER"/&gt;
  &lt;property name="password" value="CICS"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory" class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="managedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="component" class="mypackage.MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</pre><p>In managed mode (that is, in a J2EE environment), the configuration
			could look as follows:</p><pre class="programlisting">&lt;bean id="connectionFactory" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
  &lt;property name="jndiName" value="eis/cicseci"/&gt;
&lt;/bean&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cci-object"></a>21.4.&nbsp;Modeling CCI access as operation objects</h2></div></div></div><p>The <code class="literal">org.springframework.jca.cci.object</code> package
    contains support classes that allow you to access the EIS in a different
    style: through reusable operation objects, analogous to Spring's JDBC
    operation objects (see JDBC chapter). This will usually encapsulate the
    CCI API: an application-level input object will be passed to the operation
    object, so it can construct the input record and then convert the received
    record data to an application-level output object and return it.</p><p><span class="emphasis"><em>Note</em></span>: This approach is internally based on the
		<code class="classname">CciTemplate</code> class and the <code class="interfacename">RecordCreator</code>
     / <code class="interfacename">RecordExtractor</code> interfaces, reusing the machinery of
     Spring's core CCI support.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-object-mapping-record"></a>21.4.1.&nbsp;<code class="classname">MappingRecordOperation</code></h3></div></div></div><p><code class="classname">MappingRecordOperation</code> essentially performs the
      same work as <code class="classname">CciTemplate</code>, but represents a specific,
      pre-configured operation as an object. It provides two template methods
      to specify how to convert an input object to a input record, and how to
      convert an output record to an output object (record mapping):</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">createInputRecord(..)</code> to specify how to
          convert an input object to an input <code class="interfacename">Record</code></p></li><li><p><code class="literal">extractOutputData(..)</code> to specify how to
          extract an output object from an output <code class="interfacename">Record</code></p></li></ul></div><p>Here are the signatures of these methods:</p><pre class="programlisting">public abstract class MappingRecordOperation extends EisOperation {
  ...
  protected abstract Record createInputRecord(RecordFactory recordFactory, Object inputObject)
      throws ResourceException, DataAccessException { ... }

  protected abstract Object extractOutputData(Record outputRecord)
      throws ResourceException, SQLException, DataAccessException { ... }
  ...
}</pre><p>Thereafter, in order to execute an EIS operation, you need to use
      a single execute method, passing in an application-level input object
			and receiving an application-level output object as result:</p><pre class="programlisting">public abstract class MappingRecordOperation extends EisOperation {
  ...
  public Object execute(Object inputObject) throws DataAccessException {
  ...
}</pre><p>As you can see, contrary to the <code class="classname">CciTemplate</code> class,
			this <code class="methodname">execute(..)</code> method does not have an
			<code class="interfacename">InteractionSpec</code> as argument. Instead, the
			<code class="interfacename">InteractionSpec</code> is global to the operation.
			The following constructor must be used to instantiate an operation
      object with a specific <code class="interfacename">InteractionSpec</code>:</p><pre class="programlisting">InteractionSpec spec = ...;
MyMappingRecordOperation eisOperation = new MyMappingRecordOperation(getConnectionFactory(), spec);
...</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-object-mapping-comm-area"></a>21.4.2.&nbsp;<code class="classname">MappingCommAreaOperation</code></h3></div></div></div><p>Some connectors use records based on a COMMAREA which represents
      an array of bytes containing parameters to send to the EIS and data
      returned by it. Spring provides a special operation class for working
      directly on COMMAREA rather than on records. The
      <code class="classname">MappingCommAreaOperation</code> class extends the
      <code class="classname">MappingRecordOperation</code> class to provide such special
      COMMAREA support. It implicitly uses the <code class="classname">CommAreaRecord</code>
      class as input and output record type, and provides two new methods to
      convert an input object into an input COMMAREA and the output COMMAREA
      into an output object.</p><pre class="programlisting">public abstract class MappingCommAreaOperation extends MappingRecordOperation {
  ...
  protected abstract byte[] objectToBytes(Object inObject)
      throws IOException, DataAccessException;

  protected abstract Object bytesToObject(byte[] bytes)
      throws IOException, DataAccessException;
  ...
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-automatic-record-gen"></a>21.4.3.&nbsp;Automatic output record generation</h3></div></div></div><p>As every <code class="classname">MappingRecordOperation</code> subclass is
      based on CciTemplate internally, the same way to automatically generate
      output records as with <code class="classname">CciTemplate</code> is available.
			Every operation object provides a corresponding
      <code class="literal">setOutputRecordCreator(..)</code> method. For further information,
			see  the section entitled <a href="#automatic-output-generation" title="21.3.4.&nbsp;Automatic output record generation">Section&nbsp;21.3.4, &#8220;Automatic output record generation&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-object-summary"></a>21.4.4.&nbsp;Summary</h3></div></div></div><p>The operation object approach uses records in the same manner
      as the <code class="classname">CciTemplate</code> class.</p><div class="table"><a name="cci-interaction-methods"></a><p class="title"><b>Table&nbsp;21.2.&nbsp;Usage of Interaction execute methods</b></p><div class="table-contents"><table summary="Usage of Interaction execute methods" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center"><code class="classname">MappingRecordOperation</code> method
                signature</th><th align="center"><code class="classname">MappingRecordOperation</code>
                <code class="literal">outputRecordCreator</code> property</th><th align="center">execute method called on the CCI
                <code class="interfacename">Interaction</code></th></tr></thead><tbody><tr><td align="center">Object execute(Object)</td><td align="center">not set</td><td align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td align="center">Object execute(Object)</td><td align="center">set</td><td align="center">boolean execute(InteractionSpec, Record,
                Record)</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-objects-mappring-record-example"></a>21.4.5.&nbsp;Example for <code class="classname">MappingRecordOperation</code> usage</h3></div></div></div><p>In this section, the usage of the
      <code class="classname">MappingRecordOperation</code> will be shown to access a
      database with the Blackbox CCI connector.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The original version of this connector is provided by the J2EE SDK
        (version 1.3), available from Sun.</p></td></tr></table></div><p>Firstly, some initializations on the CCI
      <code class="interfacename">InteractionSpec</code> must be done to specify which SQL
      request to execute. In this sample, we directly define the way to
      convert the parameters of the request to a CCI record and the way to
      convert the CCI result record to an instance of the
      <code class="classname">Person</code> class.</p><pre class="programlisting">public class PersonMappingOperation extends MappingRecordOperation {

  public PersonMappingOperation(ConnectionFactory connectionFactory) {
    setConnectionFactory(connectionFactory);
    CciInteractionSpec interactionSpec = new CciConnectionSpec();
    interactionSpec.setSql("select * from person where person_id=?");
    setInteractionSpec(interactionSpec);
  }

  protected Record createInputRecord(RecordFactory recordFactory, Object inputObject)
      throws ResourceException {
    Integer id = (Integer) inputObject;
    IndexedRecord input = recordFactory.createIndexedRecord("input");
    input.add(new Integer(id));
    return input;
  }

  protected Object extractOutputData(Record outputRecord)
      throws ResourceException, SQLException {
    ResultSet rs = (ResultSet) outputRecord;
    Person person = null;
    if (rs.next()) {
      Person person = new Person();
      person.setId(rs.getInt("person_id"));
      person.setLastName(rs.getString("person_last_name"));
      person.setFirstName(rs.getString("person_first_name"));
    }
    return person;
  }
}</pre><p>Then the application can execute the operation object, with the
      person identifier as argument. Note that operation object could be
			set up as shared instance, as it is thread-safe.</p><pre class="programlisting">public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public Person getPerson(int id) {
    PersonMappingOperation query = new PersonMappingOperation(getConnectionFactory());
    Person person = (Person) query.execute(new Integer(id));
    return person;
  }
}</pre><p>The corresponding configuration of Spring beans could look
      as follows in non-managed mode:</p><pre class="programlisting">&lt;bean id="managedConnectionFactory"
    class="com.sun.connector.cciblackbox.CciLocalTxManagedConnectionFactory"&gt;
  &lt;property name="connectionURL" value="jdbc:hsqldb:hsql://localhost:9001"/&gt;
  &lt;property name="driverName" value="org.hsqldb.jdbcDriver"/&gt;
&lt;/bean&gt;

&lt;bean id="targetConnectionFactory"
    class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="managedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory"
    class="org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter"&gt;
  &lt;property name="targetConnectionFactory" ref="targetConnectionFactory"/&gt;
  &lt;property name="connectionSpec"&gt;
    &lt;bean class="com.sun.connector.cciblackbox.CciConnectionSpec"&gt;
      &lt;property name="user" value="sa"/&gt;
      &lt;property name="password" value=""/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</pre><p>In managed mode (that is, in a J2EE environment), the configuration
			could look as follows:</p><pre class="programlisting">&lt;bean id="targetConnectionFactory" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
  &lt;property name="jndiName" value="eis/blackbox"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory"
    class="org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter"&gt;
  &lt;property name="targetConnectionFactory" ref="targetConnectionFactory"/&gt;
  &lt;property name="connectionSpec"&gt;
    &lt;bean class="com.sun.connector.cciblackbox.CciConnectionSpec"&gt;
      &lt;property name="user" value="sa"/&gt;
      &lt;property name="password" value=""/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-objects-mapping-comm-area-example"></a>21.4.6.&nbsp;Example for <code class="classname">MappingCommAreaOperation</code> usage</h3></div></div></div><p>In this section, the usage of the
      <code class="classname">MappingCommAreaOperation</code> will be shown: accessing
      a CICS with ECI mode with the IBM CICS ECI connector.</p><p>Firstly, the CCI <code class="interfacename">InteractionSpec</code> needs to be
      initialized to specify which CICS program to access and how to interact
      with it.</p><pre class="programlisting">public abstract class EciMappingOperation extends MappingCommAreaOperation {

  public EciMappingOperation(ConnectionFactory connectionFactory, String programName) {
    setConnectionFactory(connectionFactory);
    ECIInteractionSpec interactionSpec = new ECIInteractionSpec(),
    interactionSpec.setFunctionName(programName);
    interactionSpec.setInteractionVerb(ECIInteractionSpec.SYNC_SEND_RECEIVE);
    interactionSpec.setCommareaLength(30);
    setInteractionSpec(interactionSpec);
    setOutputRecordCreator(new EciOutputRecordCreator());
  }

  private static class EciOutputRecordCreator implements RecordCreator {
    public Record createRecord(RecordFactory recordFactory) throws ResourceException {
      return new CommAreaRecord();
    }
  }
}</pre><p>The abstract <code class="classname">EciMappingOperation</code> class can
      then be subclassed to specify mappings between custom objects and
			<code class="literal">Records</code>.</p><pre class="programlisting">public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public OutputObject getData(Integer id) {
    EciMappingOperation query = new EciMappingOperation(getConnectionFactory(), "MYPROG") {
      protected abstract byte[] objectToBytes(Object inObject) throws IOException {
        Integer id = (Integer) inObject;
        return String.valueOf(id);
      }
      protected abstract Object bytesToObject(byte[] bytes) throws IOException;
        String str = new String(bytes);
        String field1 = str.substring(0,6);
        String field2 = str.substring(6,1);
        String field3 = str.substring(7,1);
        return new OutputObject(field1, field2, field3);
      }
    });

    return (OutputObject) query.execute(new Integer(id));
  }
}</pre><p>The corresponding configuration of Spring beans could look
			as follows in non-managed mode:</p><pre class="programlisting">&lt;bean id="managedConnectionFactory" class="com.ibm.connector2.cics.ECIManagedConnectionFactory"&gt;
  &lt;property name="serverName" value="TXSERIES"/&gt;
  &lt;property name="connectionURL" value="local:"/&gt;
  &lt;property name="userName" value="CICSUSER"/&gt;
  &lt;property name="password" value="CICS"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory" class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="managedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</pre><p>In managed mode (that is, in a J2EE environment), the configuration
			could look as follows:</p><pre class="programlisting">&lt;bean id="connectionFactory" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
  &lt;property name="jndiName" value="eis/cicseci"/&gt;
&lt;/bean&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cci-tx"></a>21.5.&nbsp;Transactions</h2></div></div></div><p>JCA specifies several levels of transaction support for resource adapters.
    The kind of transactions that your resource adapter supports is specified
    in its <code class="filename">ra.xml</code> file. There are essentially three options:
    none (for example with CICS EPI connector), local transactions (for
    example with a CICS ECI connector), global transactions (for example with an
    IMS connector).</p><pre class="programlisting">&lt;connector&gt;

  &lt;resourceadapter&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- &lt;transaction-support&gt;NoTransaction&lt;/transaction-support&gt; --&gt;</span></em>
    <em class="lineannotation"><span class="lineannotation">&lt;!-- &lt;transaction-support&gt;LocalTransaction&lt;/transaction-support&gt; --&gt;</span></em>
    &lt;transaction-support&gt;XATransaction&lt;/transaction-support&gt;

  &lt;resourceadapter&gt;

&lt;connector&gt;</pre><p>For global transactions, you can use Spring's generic transaction
		infrastructure to demarcate transactions, with <code class="classname">JtaTransactionManager</code> as
		backend (delegating to the J2EE server's distributed transaction coordinator
		underneath).</p><p>For local transactions on a single CCI <code class="interfacename">ConnectionFactory</code>,
    Spring provides a specific transaction management strategy for CCI, analogous
    to the <code class="classname">DataSourceTransactionManager</code> for JDBC. The CCI API
    defines a local transaction object and corresponding local transaction
		demarcation methods. Spring's <code class="classname">CciLocalTransactionManager</code>
    executes such local CCI transactions, fully compliant with Spring's generic
    <code class="interfacename">PlatformTransactionManager</code> abstraction.</p><pre class="programlisting">&lt;bean id="eciConnectionFactory" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
  &lt;property name="jndiName" value="eis/cicseci"/&gt;
&lt;/bean&gt;

&lt;bean id="eciTransactionManager"
    class="org.springframework.jca.cci.connection.CciLocalTransactionManager"&gt;
  &lt;property name="connectionFactory" ref="eciConnectionFactory"/&gt;
&lt;/bean&gt;</pre><p>Both transaction strategies can be used with any of Spring's
        transaction demarcation facilities, be it declarative or programmatic.
        This is a consequence of Spring's generic
        <code class="interfacename">PlatformTransactionManager</code> abstraction, which
		decouples transaction demarcation from the actual execution strategy.
		Simply switch between <code class="classname">JtaTransactionManager</code> and
		<code class="classname">CciLocalTransactionManager</code> as needed, keeping
		your transaction demarcation as-is.</p><p>For more information on Spring's transaction facilities, see the
		chapter entitled <a href="#transaction" title="Chapter&nbsp;9.&nbsp;Transaction management">Chapter&nbsp;9, <i>Transaction management</i></a>.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="mail"></a>Chapter&nbsp;22.&nbsp;Email</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mail-introduction"></a>22.1.&nbsp;Introduction</h2></div></div></div><div class="sidebar"><p class="title"><b>Library dependencies</b></p><p>The following additional jars to be on the classpath of your
		application in order to be able to use the Spring Framework's email library.</p><div class="itemizedlist"><ul type="disc"><li><p>The <a href="http://java.sun.com/products/javamail/" target="_top">JavaMail</a> <code class="filename">mail.jar</code> library</p></li><li><p>The <a href="http://java.sun.com/products/javabeans/jaf/downloads/index.html" target="_top">JAF</a> <code class="filename">activation.jar</code> library</p></li></ul></div><p>All of these libraries are available in the Spring-with-dependencies
		distribution of the Spring Framework (in addition to also being freely
		available on the web).</p></div><p>The Spring Framework provides a helpful utility library for sending
	email that shields the user from the specifics of the underlying mailing
	system and is responsible for low level resource handling on behalf of
    the client.</p><p>The <code class="literal">org.springframework.mail</code> package is the root level package
	for the Spring Framework's email support. The central interface for sending
	emails is the <code class="interfacename">MailSender</code> interface; a simple value object
	encapsulating the properties of a simple mail such as <span class="emphasis"><em>from</em></span> and
	<span class="emphasis"><em>to</em></span> (plus many others) is the <code class="classname">SimpleMailMessage</code> class.
    This package also contains a hierarchy of checked exceptions which provide
    a higher level of abstraction over the lower level mail system exceptions
    with the root exception being <code class="exceptionname">MailException</code>. Please
    refer to the Javadocs for more information on the rich mail exception hierarchy.</p><p>The <code class="interfacename">org.springframework.mail.javamail.JavaMailSender</code>
	interface adds specialized <span class="emphasis"><em>JavaMail</em></span> features such as MIME
    message support to the <code class="interfacename">MailSender</code> interface
	(from which it inherits). <code class="interfacename">JavaMailSender</code> also provides a
	callback interface for preparation of JavaMail MIME messages, called
    <code class="interfacename">org.springframework.mail.javamail.MimeMessagePreparator</code></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mail-usage"></a>22.2.&nbsp;Usage</h2></div></div></div><p>Let's assume there is a business interface called <code class="interfacename">OrderManager</code>:</p><pre class="programlisting">public interface OrderManager {

    void placeOrder(Order order);
}</pre><p>Let us also assume that there is a requirement stating that an email message
		with an order number needs to be generated and sent to a customer placing the
		relevant order.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mail-usage-simple"></a>22.2.1.&nbsp;Basic <code class="interfacename">MailSender</code> and <code class="classname">SimpleMailMessage</code> usage</h3></div></div></div><pre class="programlisting">import org.springframework.mail.MailException;
import org.springframework.mail.MailSender;
import org.springframework.mail.SimpleMailMessage;

public class SimpleOrderManager implements OrderManager {

    private MailSender mailSender;
    private SimpleMailMessage templateMessage;

    public void setMailSender(MailSender mailSender) {
        this.mailSender = mailSender;
    }

    public void setTemplateMessage(SimpleMailMessage templateMessage) {
        this.templateMessage = templateMessage;
    }

    public void placeOrder(Order order) {

        <em class="lineannotation"><span class="lineannotation">// Do the business calculations...</span></em>

        <em class="lineannotation"><span class="lineannotation">// Call the collaborators to persist the order...</span></em>

        <em class="lineannotation"><span class="lineannotation">// Create a thread safe "copy" of the template message and customize it</span></em>
        SimpleMailMessage msg = new SimpleMailMessage(this.templateMessage);
        msg.setTo(order.getCustomer().getEmailAddress());
        msg.setText(
            "Dear " + order.getCustomer().getFirstName()
                + order.getCustomer().getLastName()
                + ", thank you for placing order. Your order number is "
                + order.getOrderNumber());
        try{
            this.mailSender.send(msg);
        }
        catch(MailException ex) {
            <em class="lineannotation"><span class="lineannotation">// simply log it and go on...</span></em>
            System.err.println(ex.getMessage());            
        }
    }
}</pre><p>Find below the bean definitions for the above code:</p><pre class="programlisting">&lt;bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl"&gt;
  &lt;property name="host" value="mail.mycompany.com"/&gt;
&lt;/bean&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- this is a template message that we can pre-load with default state --&gt;</span></em>
&lt;bean id="templateMessage" class="org.springframework.mail.SimpleMailMessage"&gt;
  &lt;property name="from" value="customerservice@mycompany.com"/&gt;
  &lt;property name="subject" value="Your order"/&gt;
&lt;/bean&gt;

&lt;bean id="orderManager" class="com.mycompany.businessapp.support.SimpleOrderManager"&gt;
  &lt;property name="mailSender" ref="mailSender"/&gt;
  &lt;property name="templateMessage" ref="templateMessage"/&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mail-usage-mime"></a>22.2.2.&nbsp;Using the <code class="interfacename">JavaMailSender</code> and the <code class="classname">MimeMessagePreparator</code></h3></div></div></div><p>Here is another implementation of <code class="interfacename">OrderManager</code> using
			the <code class="interfacename">MimeMessagePreparator</code> callback interface. Please note
			in this case that the <code class="literal">mailSender</code> property is of type
			<code class="interfacename">JavaMailSender</code> so that we are able to use the JavaMail
			<code class="classname">MimeMessage</code> class:</p><pre class="programlisting">import javax.mail.Message;
import javax.mail.MessagingException;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;

import javax.mail.internet.MimeMessage;
import org.springframework.mail.MailException;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessagePreparator;

public class SimpleOrderManager implements OrderManager {

    private JavaMailSender mailSender;
    
    public void setMailSender(JavaMailSender mailSender) {
        this.mailSender = mailSender;
    }

    public void placeOrder(final Order order) {

        <em class="lineannotation"><span class="lineannotation">// Do the business calculations...</span></em>

        <em class="lineannotation"><span class="lineannotation">// Call the collaborators to persist the order...</span></em>
        
        MimeMessagePreparator preparator = new MimeMessagePreparator() {
        
            public void prepare(MimeMessage mimeMessage) throws Exception {
        
                mimeMessage.setRecipient(Message.RecipientType.TO, 
                        new InternetAddress(order.getCustomer().getEmailAddress()));
                mimeMessage.setFrom(new InternetAddress("mail@mycompany.com"));
                mimeMessage.setText(
                    "Dear " + order.getCustomer().getFirstName() + " "
                        + order.getCustomer().getLastName()
                        + ", thank you for placing order. Your order number is "
                        + order.getOrderNumber());
            }
        };
        try {
            this.mailSender.send(preparator);
        }
        catch (MailException ex) {
            <em class="lineannotation"><span class="lineannotation">// simply log it and go on...</span></em>
            System.err.println(ex.getMessage());            
        }
    }
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The mail code is a crosscutting concern and could well be a candidate
				for refactoring into a <a href="#aop" title="Chapter&nbsp;6.&nbsp;Aspect Oriented Programming with Spring">custom Spring AOP aspect</a>,
				which then could be executed at appropriate joinpoints on the
				<code class="interfacename">OrderManager</code> target.</p></td></tr></table></div><p>The Spring Framework's mail support ships with two
			<code class="interfacename">MailSender</code> implementations. The standard JavaMail
			implementation and the implementation on top of Jason Hunter's
			<code class="classname">MailMessage</code> class that is included in
			<a href="http://servlets.com/cos" target="_top">the <code class="literal">com.oreilly.servlet</code>
			package</a>. Please refer to the relevant Javadocs for more information.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mail-javamail-mime"></a>22.3.&nbsp;Using the JavaMail <code class="classname">MimeMessageHelper</code></h2></div></div></div><p>A class that comes in pretty handy when dealing with JavaMail messages is
		the <code class="classname">org.springframework.mail.javamail.MimeMessageHelper</code> class,
		which shields you from having to use the verbose JavaMail API. Using
		the <code class="classname">MimeMessageHelper</code> it is pretty easy to
		create a <code class="classname">MimeMessage</code>:</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// of course you would use DI in any real-world cases</span></em>
JavaMailSenderImpl sender = new JavaMailSenderImpl();
sender.setHost("mail.host.com");

MimeMessage message = sender.createMimeMessage();
MimeMessageHelper helper = new MimeMessageHelper(message);
helper.setTo("test@host.com");
helper.setText("Thank you for ordering!");

sender.send(message);</pre><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mail-javamail-mime-attachments"></a>22.3.1.&nbsp;Sending attachments and inline resources</h3></div></div></div><p>Multipart email messages allow for both attachments and inline resources.
			Examples of inline resources would be be images or a stylesheet you want to use
			in your message, but that you don't want displayed as an attachment.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mail-javamail-mime-attachments-attachment"></a>22.3.1.1.&nbsp;Attachments</h4></div></div></div><p>The following example shows you how to use the
				<code class="classname">MimeMessageHelper</code> to send an email along with a
				single JPEG image attachment.</p><pre class="programlisting">JavaMailSenderImpl sender = new JavaMailSenderImpl();
sender.setHost("mail.host.com");

MimeMessage message = sender.createMimeMessage();

<em class="lineannotation"><span class="lineannotation">// use the true flag to indicate you need a multipart message</span></em>
MimeMessageHelper helper = new MimeMessageHelper(message, true);
helper.setTo("test@host.com");

helper.setText("Check out this image!");

<em class="lineannotation"><span class="lineannotation">// let's attach the infamous windows Sample file (this time copied to c:/)</span></em>
FileSystemResource file = new FileSystemResource(new File("c:/Sample.jpg"));
helper.addAttachment("CoolImage.jpg", file);

sender.send(message);</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mail-javamail-mime-attachments-inline"></a>22.3.1.2.&nbsp;Inline resources</h4></div></div></div><p>The following example shows you how to use the
				<code class="classname">MimeMessageHelper</code> to send an email along with an
				inline image.</p><pre class="programlisting">JavaMailSenderImpl sender = new JavaMailSenderImpl();
sender.setHost("mail.host.com");

MimeMessage message = sender.createMimeMessage();

<em class="lineannotation"><span class="lineannotation">// use the true flag to indicate you need a multipart message</span></em>
MimeMessageHelper helper = new MimeMessageHelper(message, true);
helper.setTo("test@host.com");

<em class="lineannotation"><span class="lineannotation">// use the true flag to indicate the text included is HTML</span></em>
helper.setText("&lt;html&gt;&lt;body&gt;&lt;img src='cid:identifier1234'&gt;&lt;/body&gt;&lt;/html&gt;", true);

<em class="lineannotation"><span class="lineannotation">// let's include the infamous windows Sample file (this time copied to c:/)</span></em>
FileSystemResource res = new FileSystemResource(new File("c:/Sample.jpg"));
helper.addInline("identifier1234", res);

sender.send(message);</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="../images/admons/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>Inline resources are added to the mime message using the
					specified <code class="literal">Content-ID</code> (<code class="literal">identifier1234</code>
					in the above example). The order in which you are adding the text and the
					resource are <span class="bold"><strong>very</strong></span> important. Be sure to
					<span class="emphasis"><em>first add the text</em></span> and after that the resources. If
					you are doing it the other way around, it won't work!</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mail-templates"></a>22.3.2.&nbsp;Creating email content using a templating library</h3></div></div></div><p>The code in the previous examples explicitly has been creating the
			content of the email message, using methods calls such as
			<code class="methodname">message.setText(..)</code>. This is fine for
			simple cases, and it is okay in the context of the aforementioned
			examples, where the intent was to show you the very basics of the API.</p><p>In your typical enterprise application though, you are not going
			to create the content of your emails using the above approach for a number
			of reasons.</p><p>
				</p><div class="itemizedlist"><ul type="disc"><li><p>Creating HTML-based email content in Java code is tedious and error prone</p></li><li><p>There is no clear separation between display logic and business logic</p></li><li><p>Changing the display structure of the email content requires writing Java code, recompiling, redeploying...</p></li></ul></div><p>
			</p><p>Typically the approach taken to address these issues is to use a template library
			such as FreeMarker or Velocity to define the display structure of email content. This leaves
			your code tasked only with creating the data that is to be rendered in the email
			template and sending the email. It is definitely a best practice for when
			the content of your emails becomes even moderately complex, and with
			the Spring Framework's support classes for FreeMarker and Velocity becomes
			quite easy to do. Find below an example of using the Velocity template library
			to create email content.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mail-templates-example"></a>22.3.2.1.&nbsp;A Velocity-based example</h4></div></div></div><p>To use <a href="http://jakarta.apache.org/velocity/" target="_top">Velocity</a> to
				create your email template(s), you will need to have the Velocity libraries
				available on your classpath. You will also need to create one or more Velocity templates
				for the email content that your application needs. Find below the Velocity
				template that this example will be using... as you can see it is HTML-based,
				and since it is plain text it can be created using your favorite HTML editor
				without recourse to having to know Java.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation"># in the <code class="literal">com/foo/package</code></span></em>
&lt;html&gt;
&lt;body&gt;
&lt;h3&gt;Hi ${user.userName}, welcome to the Chipping Sodbury On-the-Hill message boards!&lt;/h3&gt;

&lt;div&gt;
   Your email address is &lt;a href="mailto:${user.emailAddress}"&gt;${user.emailAddress}&lt;/a&gt;.
&lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;</pre><p>Find below some simple code and Spring XML configuration that
				makes use of the above Velocity template to create email content and
				send email(s).</p><pre class="programlisting">package com.foo;

import org.apache.velocity.app.VelocityEngine;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.mail.javamail.MimeMessagePreparator;
import org.springframework.ui.velocity.VelocityEngineUtils;

import javax.mail.internet.MimeMessage;
import java.util.HashMap;
import java.util.Map;

public class SimpleRegistrationService implements RegistrationService {

   private JavaMailSender mailSender;
   private VelocityEngine velocityEngine;

   public void setMailSender(JavaMailSender mailSender) {
      this.mailSender = mailSender;
   }

   public void setVelocityEngine(VelocityEngine velocityEngine) {
      this.velocityEngine = velocityEngine;
   }

   public void register(User user) {

      <em class="lineannotation"><span class="lineannotation">// Do the registration logic...</span></em>

      sendConfirmationEmail(user);
   }

   private void sendConfirmationEmail(final User user) {
      MimeMessagePreparator preparator = new MimeMessagePreparator() {
         public void prepare(MimeMessage mimeMessage) throws Exception {
            MimeMessageHelper message = new MimeMessageHelper(mimeMessage);
            message.setTo(user.getEmailAddress());
            message.setFrom("webmaster@csonth.gov.uk"); <em class="lineannotation"><span class="lineannotation">// could be parameterized...</span></em>
            Map model = new HashMap();
            model.put("user", user);
            String text = VelocityEngineUtils.mergeTemplateIntoString(
               velocityEngine, "com/dns/registration-confirmation.vm", model);
            message.setText(text, true);
         }
      };
      this.mailSender.send(preparator);
   }
}</pre><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
   http://www.springframework.org/schema/beans/spring-beans-2.0.xsd"&gt;

   &lt;bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl"&gt;
      &lt;property name="host" value="mail.csonth.gov.uk"/&gt;
   &lt;/bean&gt;

   &lt;bean id="registrationService" class="com.foo.SimpleRegistrationService"&gt;
      &lt;property name="mailSender" ref="mailSender"/&gt;
      &lt;property name="velocityEngine" ref="velocityEngine"/&gt;
   &lt;/bean&gt;
   
   &lt;bean id="velocityEngine" class="org.springframework.ui.velocity.VelocityEngineFactoryBean"&gt;
      &lt;property name="velocityProperties"&gt;
         &lt;value&gt;
            resource.loader=class
            class.resource.loader.class=org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader
         &lt;/value&gt;
      &lt;/property&gt;
   &lt;/bean&gt;

&lt;/beans&gt;</pre></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="scheduling"></a>Chapter&nbsp;23.&nbsp;Scheduling and Thread Pooling</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduling-introduction"></a>23.1.&nbsp;Introduction</h2></div></div></div><p>
  			The Spring Framework features integration classes for scheduling support. Currently, Spring
  			supports the <code class="classname">Timer</code>, part of the JDK since 1.3, and the
  			Quartz Scheduler (<a href="http://www.opensymphony.com/quartz/" target="_top">http://www.opensymphony.com/quartz/</a>). Both schedulers
  			are set up using a <code class="interfacename">FactoryBean</code> with optional references
  			to <code class="classname">Timer</code> or <code class="classname">Trigger</code> instances, respectively.
  			Furthermore, a convenience class for both the Quartz Scheduler and the <code class="classname">Timer</code> is
  			available that allows you to invoke a method of an existing target object
			(analogous to the normal <code class="classname">MethodInvokingFactoryBean</code> operation).
			Spring also features classes for thread pooling that abstract
			away differences between Java 1.3, 1.4, 5 and JEE environments.
  		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduling-quartz"></a>23.2.&nbsp;Using the OpenSymphony Quartz Scheduler</h2></div></div></div><p>Quartz uses <code class="classname">Trigger</code>, <code class="classname">Job</code> and 
  		<code class="classname">JobDetail</code> objects to realize scheduling of all kinds of jobs.
  		For the basic concepts behind Quartz, have a look at 
  		<a href="http://www.opensymphony.com/quartz" target="_top">http://www.opensymphony.com/quartz</a>. For convenience purposes,
  		Spring offers a couple of classes that simplify the usage of Quartz within
  		Spring-based applications.
		</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-quartz-jobdetail"></a>23.2.1.&nbsp;Using the JobDetailBean</h3></div></div></div><p>
  				<code class="classname">JobDetail</code> objects contain all information needed to
  				run a job. The Spring Framework provides a <code class="classname">JobDetailBean</code>
  				that makes the <code class="classname">JobDetail</code> more of an actual JavaBean
  				with sensible defaults. Let's have a look at an example:
  			</p><pre class="programlisting">
&lt;bean name="exampleJob" class="org.springframework.scheduling.quartz.JobDetailBean"&gt;
  &lt;property name="jobClass" value="example.ExampleJob" /&gt;
  &lt;property name="jobDataAsMap"&gt;
    &lt;map&gt;
      &lt;entry key="timeout" value="5" /&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>The job detail bean has all information it needs to run the job (<code class="classname">ExampleJob</code>).
			The timeout is specified in the job data map. The job data map is
			available through the <code class="classname">JobExecutionContext</code>
			(passed to you at execution time), but the <code class="classname">JobDetailBean</code>
			also maps the properties from the job data map to properties of the actual job.
			So in this case, if the <code class="classname">ExampleJob</code> contains a property
			named <code class="literal">timeout</code>, the <code class="classname">JobDetailBean</code> will
			automatically apply it:</p><pre class="programlisting">package example;

public class ExampleJob extends QuartzJobBean {

  private int timeout;
  
  /**
   * Setter called after the ExampleJob is instantiated
   * with the value from the JobDetailBean (5)
   */ 
  public void setTimeout(int timeout) {
    this.timeout = timeout;
  }
  
  protected void executeInternal(JobExecutionContext ctx) throws JobExecutionException {
      <em class="lineannotation"><span class="lineannotation">// do the actual work</span></em>
  }
}</pre><p>All additional settings from the job detail bean are of course available to you as well.</p><p><span class="emphasis"><em>Note: Using the <code class="literal">name</code> and <code class="literal">group</code> properties,
			you can modify the name and the group of the job, respectively. By default, the name of
			the job matches the bean name of the job detail bean (in the example above, this is
			<code class="literal">exampleJob</code>).</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-quartz-method-invoking-job"></a>23.2.2.&nbsp;Using the <code class="classname">MethodInvokingJobDetailFactoryBean</code></h3></div></div></div><p>Often you just need to invoke a method on a specific object. Using the
			<code class="classname">MethodInvokingJobDetailFactoryBean</code> you can do exactly this:</p><pre class="programlisting">&lt;bean id="jobDetail" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"&gt;
  &lt;property name="targetObject" ref="exampleBusinessObject" /&gt;
  &lt;property name="targetMethod" value="doIt" /&gt;
&lt;/bean&gt;</pre><p>The above example will result in the <code class="literal">doIt</code> method being called on the
			<code class="literal">exampleBusinessObject</code> method (see below):</p><pre class="programlisting">public class ExampleBusinessObject {
  
  <em class="lineannotation"><span class="lineannotation">// properties and collaborators</span></em>
  
  public void doIt() {
    <em class="lineannotation"><span class="lineannotation">// do the actual work</span></em>
  }
}</pre><pre class="programlisting">
&lt;bean id="exampleBusinessObject" class="examples.ExampleBusinessObject"/&gt;</pre><p>Using the <code class="classname">MethodInvokingJobDetailFactoryBean</code>, you don't need to
			create one-line jobs that just invoke a method, and you only need to create the actual
			business object and wire up the detail object.</p><p>By default, Quartz Jobs are stateless, resulting in the possibility of jobs interfering
			with each other. If you specify two triggers for the same <code class="classname">JobDetail</code>,
			it might be possible that before the first job has finished, the second one will start.
			If <code class="classname">JobDetail</code> classes implement the
			<code class="interfacename">Stateful</code> interface, this won't happen. The second job
			will not start before the first one has finished. To make jobs resulting from the
			<code class="classname">MethodInvokingJobDetailFactoryBean</code> non-concurrent, set the
			<code class="literal">concurrent</code> flag to <code class="literal">false</code>.</p><pre class="programlisting">
&lt;bean id="jobDetail" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"&gt;
  &lt;property name="targetObject" ref="exampleBusinessObject" /&gt;
  &lt;property name="targetMethod" value="doIt" /&gt;
  &lt;property name="concurrent" value="false" /&gt;
&lt;/bean&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>By default, jobs will run in a concurrent fashion.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-quartz-cron"></a>23.2.3.&nbsp;Wiring up jobs using triggers and the <code class="classname">SchedulerFactoryBean</code></h3></div></div></div><p>
				We've created job details and jobs. We've also reviewed the convenience bean
				that allows to you invoke a method on a specific object. Of course, we still need
				to schedule the jobs themselves. This is done using triggers and a 
				<code class="classname">SchedulerFactoryBean</code>. Several triggers are available
				within Quartz. Spring offers two subclassed triggers with convenient defaults:
				<code class="classname">CronTriggerBean</code> and <code class="classname">SimpleTriggerBean</code>.
			</p><p>
				Triggers need to be scheduled. Spring offers a <code class="classname">SchedulerFactoryBean</code>
				that exposes triggers to be set as properties. <code class="classname">SchedulerFactoryBean</code>
				schedules the actual jobs with those triggers.
			</p><p>Find below a couple of examples:</p><pre class="programlisting">&lt;bean id="simpleTrigger" class="org.springframework.scheduling.quartz.SimpleTriggerBean"&gt;
    &lt;!-- see the example of method invoking job above --&gt;
    &lt;property name="jobDetail" ref="jobDetail" /&gt;
    &lt;!-- 10 seconds --&gt;
    &lt;property name="startDelay" value="10000" /&gt;
    &lt;!-- repeat every 50 seconds --&gt;
    &lt;property name="repeatInterval" value="50000" /&gt;
&lt;/bean&gt;

&lt;bean id="cronTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean"&gt;
    &lt;property name="jobDetail" ref="exampleJob" /&gt;
    &lt;!-- run every morning at 6 AM --&gt;
    &lt;property name="cronExpression" value="0 0 6 * * ?" /&gt;
&lt;/bean&gt;</pre><p>Now we've set up two triggers, one running every 50 seconds with a starting delay of
			10 seconds and one every morning at 6 AM. To finalize everything, we need to set up the
			<code class="classname">SchedulerFactoryBean</code>:</p><pre class="programlisting">&lt;bean class="org.springframework.scheduling.quartz.SchedulerFactoryBean"&gt;
    &lt;property name="triggers"&gt;
        &lt;list&gt;
            &lt;ref bean="cronTrigger" /&gt;
            &lt;ref bean="simpleTrigger" /&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>
				More properties are available for the <code class="classname">SchedulerFactoryBean</code> for you
				to set, such as the	calendars used by the job details, properties to customize Quartz with,
				etc. Have a look at the
				<a href="http://www.springframework.org/docs/api/org/springframework/scheduling/quartz/SchedulerFactoryBean.html" target="_top">SchedulerFactoryBean Javadoc</a>
				for more information.
			</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduling-jdk-timer"></a>23.3.&nbsp;Using JDK Timer support</h2></div></div></div><p>
  			The other way to schedule jobs in Spring is to use JDK
			<code class="classname">Timer</code> objects. You can create custom timers or
			use the timer that invokes methods. Wiring timers is done using the
			<code class="classname">TimerFactoryBean</code>.
  		</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-jdk-timer-creating"></a>23.3.1.&nbsp;Creating custom timers</h3></div></div></div><p>
  				Using the <code class="classname">TimerTask</code> you can create customer
				timer tasks, similar to Quartz jobs:
			</p><pre class="programlisting">public class CheckEmailAddresses extends TimerTask {

  private List emailAddresses;
  
  public void setEmailAddresses(List emailAddresses) {
    this.emailAddresses = emailAddresses;
  }
  
  public void run() {
    <em class="lineannotation"><span class="lineannotation">// iterate over all email addresses and archive them</span></em>
  }
}</pre><p>
				Wiring it up is simple:
			</p><pre class="programlisting">&lt;bean id="checkEmail" class="examples.CheckEmailAddress"&gt;
    &lt;property name="emailAddresses"&gt;
        &lt;list&gt;
            &lt;value&gt;test@springframework.org&lt;/value&gt;
            &lt;value&gt;foo@bar.com&lt;/value&gt;
            &lt;value&gt;john@doe.net&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="scheduledTask" class="org.springframework.scheduling.timer.ScheduledTimerTask"&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- wait 10 seconds before starting repeated execution --&gt;</span></em>
    &lt;property name="delay" value="10000" /&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- run every 50 seconds --&gt;</span></em>
    &lt;property name="period" value="50000" /&gt;
    &lt;property name="timerTask" ref="checkEmail" /&gt;
&lt;/bean&gt;</pre><p>
				<span class="emphasis"><em>
					Note that letting the task only run once can be done by changing the
					<code class="literal">period</code> property to 0 (or a negative value).
				</em></span>
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-jdk-timer-method-invoking-task"></a>23.3.2.&nbsp;Using the <code class="classname">MethodInvokingTimerTaskFactoryBean</code></h3></div></div></div><p>
				Similar to the Quartz support, the <code class="classname">Timer</code> support also features
				a component that allows you to periodically invoke a method:
			</p><pre class="programlisting">&lt;bean id="doIt" class="org.springframework.scheduling.timer.MethodInvokingTimerTaskFactoryBean"&gt;
    &lt;property name="targetObject" ref="exampleBusinessObject" /&gt;
    &lt;property name="targetMethod" value="doIt" /&gt;
&lt;/bean&gt;</pre><p>
				The above example will result in the <code class="literal">doIt</code> method being called on the
				<code class="literal">exampleBusinessObject</code> (see below):
			</p><pre class="programlisting">public class BusinessObject {
  
  <em class="lineannotation"><span class="lineannotation">// properties and collaborators</span></em>
  
  public void doIt() {
    <em class="lineannotation"><span class="lineannotation">// do the actual work</span></em>
  }
}</pre><p>Changing the <code class="literal">timerTask</code> reference of the
			<code class="classname">ScheduledTimerTask</code> example to the bean <code class="literal">doIt</code>
			will result in the <code class="literal">doIt</code> method being executed on a fixed schedule.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-jdk-timer-factory-bean"></a>23.3.3.&nbsp;Wrapping up: setting up the tasks using the <code class="classname">TimerFactoryBean</code></h3></div></div></div><p>The <code class="classname">TimerFactoryBean</code> is similar to the Quartz
			<code class="classname">SchedulerFactoryBean</code> in that it serves the same
			purpose: setting up the actual scheduling. The <code class="classname">TimerFactoryBean</code>
			sets up an actual <code class="classname">Timer</code> and schedules the tasks it has
			references to. You can specify whether or not daemon threads should be used.</p><pre class="programlisting">&lt;bean id="timerFactory" class="org.springframework.scheduling.timer.TimerFactoryBean"&gt;
    &lt;property name="scheduledTimerTasks"&gt;
        &lt;list&gt;
            <em class="lineannotation"><span class="lineannotation">&lt;!-- see the example above --&gt;</span></em>
            &lt;ref bean="scheduledTask" /&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduling-task-executor"></a>23.4.&nbsp;The Spring <code class="interfacename">TaskExecutor</code> abstraction</h2></div><div><h2 class="title" style="clear: both"><a name="scheduling-task-executor"></a>23.4.&nbsp;The Spring <code class="interfacename">TaskExecutor</code> abstraction</h2></div></div></div><p>Spring 2.0 introduces a new abstraction for dealing with
		Executors. Executors are the Java 5 name for the concept of
		thread pools. The odd naming is due to the fact that there
		is no guarantee that the underlying implementation is
		actually a pool. In fact, in many cases, the executor is
		single-threaded. Spring's abstraction helps bring thread
		pooling to Java 1.3 and 1.4 environments as well as hide
		implementation details between 1.3, 1.4, 5, and Java EE
		environments.</p><p>Spring's <code class="interfacename">TaskExecutor</code> interface is
		identical to the <code class="classname">java.util.concurrent.Executor</code>
		interface. In fact, its primary reason for existence is to abstract away
		the need for Java 5 when using thread pools. The interface has a single
		method <code class="classname">execute(Runnable task)</code> that accepts a task
		for execution based on the semantics and configuration of the thread pool.</p><p>The <code class="interfacename">TaskExecutor</code> was originally
		created to give other Spring components an abstraction for thread pooling where
		needed. Components such as the <code class="classname">ApplicationEventMulticaster</code>,
		JMS's <code class="classname">AbstractMessageListenerContainer</code>,
		and Quartz integration all use the <code class="interfacename">TaskExecutor</code>
		abstraction to pool threads. However, if your beans need thread pooling behavior,
		it is possible to use this abstraction for your own needs.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-task-executor-types"></a>23.4.1.&nbsp;<code class="interfacename">TaskExecutor</code> types</h3></div></div></div><p>There are a number of pre-built implementations of
			<code class="interfacename">TaskExecutor</code> included with the
			Spring distribution. In all likelihood, you shouldn't ever
			need to implement your own.</p><div class="itemizedlist"><ul type="disc"><li><p>
						<code class="classname">SimpleAsyncTaskExecutor</code>
					</p><p>
						This implementation does not reuse any threads,
						rather it starts up a new thread for each
						invocation. However, it does support a
						concurrency limit which will block any
						invocations that are over the limit until a slot
						has been freed up. If you're looking for true
						pooling, keep scrolling further down the page.
					</p></li><li><p><a name="syncTaskExecutor"></a>
						<code class="classname">SyncTaskExecutor</code>
					</p><p>
						This implementation doesn't execute
						invocations asynchronously. Instead, each
						invocation takes place in the calling thread. It
						is primarily used in situations where
						mutlithreading isn't necessary such as simple
						test cases.
					</p></li><li><p><a name="concurrentTaskExecutor"></a>
						<code class="classname">ConcurrentTaskExecutor</code>
					</p><p>
						This implementation is a wrapper for a Java 5
						<code class="classname">java.util.concurrent.Executor</code>.
						There is an alternative,
						<code class="classname">ThreadPoolTaskExecutor</code>,
						that exposes the <code class="classname">Executor</code>
						configuration parameters as bean properties. It
						is rare to need to use the <code class="classname">ConcurrentTaskExecutor</code>
						but if the
						<a href="#threadPoolTaskExecutor"><code class="classname">ThreadPoolTaskExecutor</code></a>
						isn't robust enough for your needs, the
						<code class="classname">ConcurrentTaskExecutor</code>
						is an alternative.
					</p></li><li><p><a name="simpleThreadPoolTaskExecutor"></a>
						<code class="classname">SimpleThreadPoolTaskExecutor</code>
					</p><p>
						This implementation is actually a subclass of
						Quartz's <code class="classname">SimpleThreadPool</code>
						which listens to Spring's lifecycle callbacks.
						This is typically used when you have a
						threadpool that may need to be shared by both
						Quartz and non-Quartz components.
					</p></li><li><p><a name="threadPoolTaskExecutor"></a>
						<code class="classname">ThreadPoolTaskExecutor</code>
					</p><div class="sidebar"><p>
							It is not possible to use any backport or
							alternate versions of the
							<code class="classname">java.util.concurrent</code>
							package with this implementation. Both Doug
							Lea's and Dawid Kurzyniec's implementations
							use different package structures which will
							prevent them from working correctly.
						</p></div><p>
						This implementation can only be used in a Java 5
						environment but is also the most commonly used
						one in that environment. It exposes bean properties for
						configuring a 
						<code class="classname">java.util.concurrent.ThreadPoolExecutor</code>
						and wraps it in a <code class="interfacename">TaskExecutor</code>.
						If you need something advanced such as a
						<code class="classname">ScheduledThreadPoolExecutor</code>,
						it is recommended that you use a
						<a href="#concurrentTaskExecutor"><code class="classname">ConcurrentTaskExecutor</code></a>
						instead.
                    </p></li><li><p>
						<code class="classname">TimerTaskExecutor</code>
					</p><p>
						This implementation uses a single
						<code class="classname">TimerTask</code>
						as its backing implementation. It's different
						from the
						<a href="#syncTaskExecutor"><code class="classname">SyncTaskExecutor</code></a>
						in that the method invocations are executed in a
						separate thread, although they are synchronous
						in that thread.
					</p></li><li><p>
						<code class="classname">WorkManagerTaskExecutor</code>
					</p><div class="sidebar"><p>
							CommonJ is a set of specifications jointly
							developed between BEA and IBM. These
							specifications are not Java EE standards, but
							are standard across BEA's and IBM's
							Application Server implementations.
						</p></div><p>
						This implementation uses the CommonJ WorkManager
						as its backing implementation and is the central
						convenience class for setting up a CommonJ
						WorkManager reference in a Spring context.
						Similar to the
						<a href="#simpleThreadPoolTaskExecutor"><code class="classname">SimpleThreadPoolTaskExecutor</code></a>,
						this class implements the WorkManager
						interface and therefore can be used directly as
						a WorkManager as well.
					</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-task-executor-usage"></a>23.4.2.&nbsp;Using a <code class="interfacename">TaskExecutor</code></h3></div></div></div><p>Spring's <code class="interfacename">TaskExecutor</code> implementations
			are used as simple JavaBeans.  In the example below, we define
			a bean that uses the <code class="classname">ThreadPoolTaskExecutor</code>
			to asynchronously print out a set of messages.</p><pre class="programlisting">import org.springframework.core.task.TaskExecutor;

public class TaskExecutorExample {

  private class MessagePrinterTask implements Runnable {

    private String message;

    public MessagePrinterTask(String message) {
      this.message = message;
    }

    public void run() {
      System.out.println(message);
    }

  }

  private TaskExecutor taskExecutor;

  public TaskExecutorExample(TaskExecutor taskExecutor) {
    this.taskExecutor = taskExecutor;
  }

  public void printMessages() {
    for(int i = 0; i &lt; 25; i++) {
      taskExecutor.execute(new MessagePrinterTask("Message" + i));
    }
  }
}</pre><p>As you can see, rather than retrieving a thread from the
			pool and executing yourself, you add your <code class="classname">Runnable</code>
			to the queue and the <code class="interfacename">TaskExecutor</code>
			uses it's internal rules to decide when the task gets executed.</p><p>To configure the rules that the <code class="interfacename">TaskExecutor</code>
			will use, simple bean properties have been exposed.</p><pre class="programlisting">&lt;bean id="taskExecutor" class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor"&gt;
  &lt;property name="corePoolSize" value="5" /&gt;
  &lt;property name="maxPoolSize" value="10" /&gt;
  &lt;property name="queueCapacity" value="25" /&gt;
&lt;/bean&gt;

&lt;bean id="taskExecutorExample" class="TaskExecutorExample"&gt;
  &lt;constructor-arg ref="taskExecutor" /&gt;
&lt;/bean&gt;</pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="dynamic-language"></a>Chapter&nbsp;24.&nbsp;Dynamic language support</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dynamic-language-introduction"></a>24.1.&nbsp;Introduction</h2></div></div></div><p>Spring 2.0 introduces comprehensive support for using classes and objects that have
		been defined using a dynamic language (such as JRuby) with Spring.</p><div class="sidebar"><p class="title"><b>Why only these languages?</b></p><p>
                The supported languages were chosen because a) the languages
                have a lot of traction in the Java enterprise community, b) no requests were made
                for other languages within the Spring 2.0 development timeframe, and
                c) the Spring developers were most familiar with them.
            </p><p>
				There is nothing stopping the inclusion of further languages though. If you want
				to see support for &lt;<span class="emphasis"><em>insert your favourite dynamic language here</em></span>&gt;,
                you can always raise an issue on Spring's
                <a href="http://opensource.atlassian.com/projects/spring/secure/Dashboard.jspa" target="_top">JIRA</a>
                page (or implement such support yourself).
            </p></div><p>
            This support allows you to write any number of classes in a supported dynamic
            language, and have the Spring container transparently instantiate, configure
            and dependency inject the resulting objects.
        </p><p>The dynamic languages currently supported are:</p><div class="itemizedlist"><ul type="disc"><li><p>JRuby</p></li><li><p>Groovy</p></li><li><p>BeanShell</p></li></ul></div><p>
            Fully working examples of where this dynamic language support can be immediately useful
            are described in the section entitled <a href="#dynamic-language-scenarios" title="24.4.&nbsp;Scenarios">Section&nbsp;24.4, &#8220;Scenarios&#8221;</a>.
        </p><p>
			Please note that the dynamic language support detailed in this chapter is
			<span class="emphasis"><em>only</em></span> available in Spring versions 2.0 and above. Currently
			there are <span class="emphasis"><em>no</em></span> plans to backport the dynamic language
			support to previous versions of Spring (most notably the 1.2.x line).
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dynamic-language-a-first-example"></a>24.2.&nbsp;A first example</h2></div></div></div><p>
			This bulk of this chapter is concerned with describing the dynamic language support
			in detail. Before diving into all of the ins and outs of the dynamic language support,
			let's look at a quick example of a bean defined in a dynamic language.
		</p><p>
            The dynamic language for this first bean is Groovy (the basis of this example
            was taken from the Spring test suite, so if you want to see equivalent examples
            in any of the other supported languages, take a look in the source code).
        </p><p>
            Let's look at the <code class="interfacename">Messenger</code> interface that the
            Groovy bean is going to be implementing. Note that this interface is defined
            in plain Java. Dependent objects that are injected with a reference to the
            <code class="interfacename">Messenger</code> won't know that the underlying
            implementation is a Groovy script.
        </p><pre class="programlisting">package org.springframework.scripting;

public interface Messenger {

    String getMessage();
}</pre><p>
            Here is the definition of a class that has a dependency on the
            <code class="interfacename">Messenger</code> interface.
        </p><pre class="programlisting">package org.springframework.scripting;

public class DefaultBookingService implements BookingService {

    private Messenger messenger;

    public void setMessenger(Messenger messenger) {
        this.messenger = messenger;
    }

    public void processBooking() {
        <em class="lineannotation"><span class="lineannotation">// use the injected <code class="interfacename">Messenger</code> object...</span></em>
    }
}</pre><p>Here is an implementation of the <code class="interfacename">Messenger</code> interface
		in Groovy.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// from the file 'Messenger.groovy'</span></em>
package org.springframework.scripting.groovy;

<em class="lineannotation"><span class="lineannotation">// import the Messenger interface (written in Java) that is to be implemented</span></em>
import org.springframework.scripting.Messenger

<em class="lineannotation"><span class="lineannotation">// define the implementation in Groovy</span></em>
class GroovyMessenger implements Messenger {

    String message
}</pre><p>
            Finally, here are the bean definitions that will effect the injection of the
            Groovy-defined <code class="interfacename">Messenger</code> implementation into
            an instance of the <code class="classname">DefaultBookingService</code> class.
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
                To use the custom dynamic language tags to define dynamic-language-backed beans,
                you need to have the XML Schema preamble at the top of your Spring XML
                configuration file. You also need to be using a Spring
                <code class="interfacename">ApplicationContext</code> implementation as your
                IoC container. Using the dynamic-language-backed beans with a plain
                <code class="interfacename">BeanFactory</code> implementation is supported,
                but you have to manage the plumbing of the Spring internals to do so.
            </p><p>For more information on schema-based configuration, see <a href="#xsd-config" title="Appendix&nbsp;A.&nbsp;XML Schema-based configuration">Appendix&nbsp;A, <i>XML Schema-based configuration</i></a>.</p></td></tr></table></div><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:lang="http://www.springframework.org/schema/lang"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang-2.0.xsd"&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- this is the bean definition for the Groovy-backed <code class="interfacename">Messenger</code> implementation --&gt;</span></em>
    &lt;lang:groovy id="messenger" script-source="classpath:Messenger.groovy"&gt;
        &lt;lang:property name="message" value="I Can Do The Frug" /&gt;
    &lt;/lang:groovy&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- an otherwise normal bean that will be injected by the Groovy-backed <code class="interfacename">Messenger</code> --&gt;</span></em>
    &lt;bean id="bookingService" class="x.y.DefaultBookingService"&gt;
        &lt;property name="messenger" ref="messenger" /&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre><p>
            The <code class="literal">bookingService</code> bean (a
            <code class="classname">DefaultBookingService</code>) can now use its private
            <code class="literal">messenger</code> member variable as normal because the
            <code class="interfacename">Messenger</code> instance that was injected
            into it <span class="emphasis"><em>is</em></span> a <code class="interfacename">Messenger</code>
            instance. There is nothing special going on here, just plain Java and
            plain Groovy.
        </p><p>
            Hopefully the above XML snippet is self-explanatory, but don't worry
            unduly if it isn't. Keep reading for the in-depth detail on the whys
            and wherefores of the above configuration.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dynamic-language-beans"></a>24.3.&nbsp;Defining beans that are backed by dynamic languages</h2></div></div></div><p>
            This section describes exactly how you define Spring managed beans in
            any of the supported dynamic languages.
        </p><p>
            Please note that this chapter does not attempt to explain the syntax and
            idioms of the supported dynamic languages. For example, if you want to
            use Groovy to write certain of the classes in your application, then the
            assumption is that you already know Groovy. If you need further details
            about the dynamic languages themselves, please consult the section
            entitled <a href="#dynamic-language-resources" title="24.6.&nbsp;Further Resources">Section&nbsp;24.6, &#8220;Further Resources&#8221;</a> at the end of this chapter.
        </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-beans-concepts"></a>24.3.1.&nbsp;Common concepts</h3></div></div></div><p>The steps involved in using dynamic-language-backed beans are as follows:</p><div class="orderedlist"><ol type="1"><li><p>Write the test for the dynamic language source code (naturally)</p></li><li><p><span class="emphasis"><em>Then</em></span> write the dynamic language source code itself :)</p></li><li><p>
						Define your dynamic-language-backed beans using the appropriate
						<code class="literal">&lt;lang:language/&gt;</code> element in the XML
						configuration (you can of course define such beans programmatically
						using the Spring API - although you will have to consult the source
						code for directions on how to do this as this type of advanced
						configuration is not covered in this chapter). Note this is an iterative
						step. You will need at least one bean definition per dynamic
						language source file (although the same dynamic language source
						file can of course be referenced by multiple bean definitions).
					</p></li></ol></div><p>
	            The first two steps (testing and writing your dynamic language source files)
	            are beyond the scope of this chapter. Refer to the language specification
	            and / or reference manual for your chosen dynamic language and crack on with
	            developing your dynamic language source files. You <span class="emphasis"><em>will</em></span>
	            first want to read the rest of this chapter though, as Spring's dynamic language
	            support does make some (small) assumptions about the contents of your dynamic
	            language source files.
			</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="dynamic-language-beans-concepts-xml-language-element"></a>24.3.1.1.&nbsp;The <code class="literal">&lt;lang:language/&gt;</code> element</h4></div></div></div><div class="sidebar"><p class="title"><b>XML Schema</b></p><p>
						All of the configuration examples in this chapter make use of the
						new XML Schema support that was added in Spring 2.0.
					</p><p>It is possible to forego the use of XML Schema and stick with the old-style
					DTD based validation of your Spring XML files, but then you lose out
					on the convenience offered by the <code class="literal">&lt;lang:language/&gt;</code>
					element. See the Spring test suite for examples of the older style
					configuration that doesn't require XML Schema-based validation
					(it is quite verbose and doesn't hide any of the underlying Spring
					implementation from you).</p></div><p>
					The final step involves defining dynamic-language-backed bean definitions,
					one for each bean that you want to configure (this is no different to
					normal Java bean configuration). However, instead of specifying the
					fully qualified classname of the class that is to be instantiated and
					configured by the container, you use the <code class="literal">&lt;lang:language/&gt;</code>
					element to define the dynamic language-backed bean.
				</p><p>
					Each of the supported languages has a corresponding
					<code class="literal">&lt;lang:language/&gt;</code> element:
				</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">&lt;lang:jruby/&gt;</code> (JRuby)</p></li><li><p><code class="literal">&lt;lang:groovy/&gt;</code> (Groovy)</p></li><li><p><code class="literal">&lt;lang:bsh/&gt;</code> (BeanShell)</p></li></ul></div><p>
					The exact attributes and child elements that are available for
					configuration depends on exactly which language the bean has been
					defined in (the language-specific sections below provide the full
					lowdown on this).
				</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="dynamic-language-refreshable-beans"></a>24.3.1.2.&nbsp;Refreshable beans</h4></div></div></div><p>
		            One of the (if not <span class="emphasis"><em>the</em></span>) most compelling value adds
		            of the dynamic language support in Spring is the
		            <em class="firstterm">'refreshable bean'</em> feature.
				</p><p>
		            A refreshable bean is a dynamic-language-backed bean that with a small
		            amount of configuration, a dynamic-language-backed bean can monitor
		            changes in its underlying source file resource, and then reload itself
		            when the dynamic language source file is changed (for example when a
		            developer edits and saves changes to the file on the filesystem).
				</p><p>
		            This allows a developer to deploy any number of dynamic language source
		            files as part of an application, configure the Spring container to create
		            beans backed by dynamic language source files (using the mechanisms
		            described in this chapter), and then later, as requirements change or
		            some other external factor comes into play, simply edit a dynamic language
		            source file and have any change they make reflected in the bean that is
		            backed by the changed dynamic language source file. There is no need to
		            shut down a running application (or redeploy in the case of a web application).
		            The dynamic-language-backed bean so amended will pick up the new state
		            and logic from the changed dynamic language source file.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Please note that this feature is <span class="emphasis"><em>off</em></span> by default.</p></td></tr></table></div><p>
		            Let's take a look at an example to see just how easy it is to start using
		            refreshable beans. To <span class="emphasis"><em>turn on</em></span> the refreshable beans
		            feature, you simply have to specify exactly <span class="emphasis"><em>one</em></span>
		            additional attribute on the <code class="literal">&lt;lang:language/&gt;</code> element
		            of your bean definition. So if we stick with
		            <a href="#dynamic-language-a-first-example" title="24.2.&nbsp;A first example">the example</a> from earlier
		            in this chapter, here's what we would change in the Spring XML configuration
		            to effect refreshable beans:
				</p><pre class="programlisting">&lt;beans&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- this bean is now 'refreshable' due to the presence of the 'refresh-check-delay' attribute --&gt;</span></em>
    &lt;lang:groovy id="messenger"
          refresh-check-delay="5000" <em class="lineannotation"><span class="lineannotation">&lt;!-- switches refreshing on with 5 seconds between checks --&gt;</span></em>
          script-source="classpath:Messenger.groovy"&gt;
        &lt;lang:property name="message" value="I Can Do The Frug" /&gt;
    &lt;/lang:groovy&gt;

    &lt;bean id="bookingService" class="x.y.DefaultBookingService"&gt;
        &lt;property name="messenger" ref="messenger" /&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre><p>
		            That really is all you have to do. The <code class="literal">'refresh-check-delay'</code>
		            attribute defined on the <code class="literal">'messenger'</code> bean definition
		            is the number of milliseconds after which the bean will be refreshed with
                    any changes made to the underlying dynamic language source file.
                    You can turn off the refresh behavior by assigning a negative value
                    to the <code class="literal">'refresh-check-delay'</code> attribute.
                    Remember that, by default, the refresh behavior is disabled. If you don't
                    want the refresh behavior, then simply don't define the attribute.
                </p><p>If we then run the following application we can exercise the refreshable feature;
				please do excuse the <span class="emphasis"><em>'jumping-through-hoops-to-pause-the-execution'</em></span>
		        shenanigans in this next slice of code. The <code class="literal">System.in.read()</code>
		        call is only there so that the execution of the program pauses while I (the author)
		        go off and edit the underlying dynamic language source file so that the refresh will
		        trigger on the dynamic-language-backed bean when the program resumes execution.</p><pre class="programlisting">import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.scripting.Messenger;

public final class Boot {

    public static void main(final String[] args) throws Exception {

        ApplicationContext ctx = new ClassPathXmlApplicationContext("beans.xml");
        Messenger messenger = (Messenger) ctx.getBean("messenger");
        System.out.println(messenger.getMessage());
        <em class="lineannotation"><span class="lineannotation">// pause execution while I go off and make changes to the source file...</span></em>
        System.in.read();
        System.out.println(messenger.getMessage());
    }
}</pre><p>Let's assume then, for the purposes of this example, that all
		        calls to the <code class="literal">getMessage()</code> method of
		        <code class="interfacename">Messenger</code> implementations have to be
		        changed such that the message is surrounded by quotes.
		        Below are the changes that I (the author) make to the
		        <code class="filename">Messenger.groovy</code> source file when the execution of
		        the program is paused.</p><pre class="programlisting">package org.springframework.scripting

class GroovyMessenger implements Messenger {

    private String message = "Bingo"

    public String getMessage() {
     <em class="lineannotation"><span class="lineannotation">   // change the implementation to surround the message in quotes</span></em>
        return "'" + this.message + "'"
    }

    public void setMessage(String message) {
        this.message = message
    }
}</pre><p>
		            When the program executes, the output before the input pause will be
		            <code class="computeroutput">I Can Do The Frug</code>. After the change
		            to the source file is made and saved, and the program resumes execution,
		            the result of calling the <code class="literal">getMessage()</code> method on the
		            dynamic-language-backed <code class="interfacename">Messenger</code> implementation
		            will be <code class="computeroutput">'I Can Do The Frug'</code> (notice
		            the inclusion of the additional quotes).
				</p><p>
		            It is important to understand that changes to a script will
		            <span class="emphasis"><em>not</em></span> trigger a refresh if the changes occur
		            within the window of the <code class="literal">'refresh-check-delay'</code> value.
		            It is equally important to understand that changes to the script are
		            <span class="emphasis"><em>not</em></span> actually 'picked up' until a method is called
		            on the dynamic-language-backed bean. It is only when a method is called on a
		            dynamic-language-backed bean that it checks to see if its underlying script
		            source has changed. Any exceptions relating to refreshing the script
		            (such as encountering a compilation error, or finding that the script
		            file has been deleted) will result in a <span class="emphasis"><em>fatal</em></span>
		            exception being propagated to the calling code.
				</p><p>
		            The refreshable bean behavior described above does
					<span class="emphasis"><em>not</em></span> apply to dynamic language source files
					defined using the <code class="literal">&lt;lang:inline-script/&gt;</code> element
					notation (see the section entitled <a href="#dynamic-language-beans-inline" title="24.3.1.3.&nbsp;Inline dynamic language source files">Section&nbsp;24.3.1.3, &#8220;Inline dynamic language source files&#8221;</a>).
					Additionally, it <span class="emphasis"><em>only</em></span> applies to beans where
					changes to the underlying source file can actually be detected;
					for example, by code that checks the last modified date of a
					dynamic language source file that exists on the filesystem.
				</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="dynamic-language-beans-inline"></a>24.3.1.3.&nbsp;Inline dynamic language source files</h4></div></div></div><p>
					The dynamic language support can also cater for dynamic language
					source files that are embedded directly in Spring bean definitions.
					More specifically, the <code class="literal">&lt;lang:inline-script/&gt;</code>
					element allows you to define dynamic language source immediately
					inside a Spring configuration file. An example will perhaps make the
		            inline script feature crystal clear:
		        </p><pre class="programlisting">&lt;lang:groovy id="messenger"&gt;
    &lt;lang:inline-script&gt;
package org.springframework.scripting.groovy;

import org.springframework.scripting.Messenger

class GroovyMessenger implements Messenger {

    String message
}
    &lt;/lang:inline-script&gt;
    &lt;lang:property name="message" value="I Can Do The Frug" /&gt;
&lt;/lang:groovy&gt;</pre><p>
					If we put to one side the issues surrounding whether it is good practice
					to define dynamic language source inside a Spring configuration file, the
					<code class="literal">&lt;lang:inline-script/&gt;</code> element can be useful in
					some scenarios. For instance, we might want to quickly add a Spring
					<code class="interfacename">Validator</code> implementation to a Spring MVC
					<code class="interfacename">Controller</code>. This is but a moment's work
					using inline source. (See the section entitled
					<a href="#dynamic-language-scenarios-validators" title="24.4.2.&nbsp;Scripted Validators">Section&nbsp;24.4.2, &#8220;Scripted Validators&#8221;</a>  for such an example.)
				</p><p>
		            Find below an example of defining the source for a JRuby-based bean
		            directly in a Spring XML configuration file using the
		            <code class="literal">inline:</code> notation. (Notice the use of the &amp;lt;
		            characters to denote a <code class="literal">'&lt;'</code> character. In such a case
					surrounding the inline source in a <code class="literal">&lt;![CDATA[]]&gt;</code> region might be better.)
				</p><pre class="programlisting">&lt;lang:jruby id="messenger" script-interfaces="org.springframework.scripting.Messenger"&gt;
    &lt;lang:inline-script&gt;
require 'java'

include_class 'org.springframework.scripting.Messenger'

class RubyMessenger &amp;lt; Messenger

 def setMessage(message)
  @@message = message
 end

 def getMessage
  @@message
 end
 
end
    &lt;/lang:inline-script&gt;
    &lt;lang:property name="message" value="Hello World!" /&gt;
&lt;/lang:jruby&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="dynamic-language-beans-ctor-injection"></a>24.3.1.4.&nbsp;Understanding Constructor Injection in the context of dynamic-language-backed beans</h4></div></div></div><p>
					There is one <span class="emphasis"><em>very</em></span> important thing to be aware of
					with regard to Spring's dynamic language support. Namely, it is not (currently)
					possible to supply constructor arguments to dynamic-language-backed beans (and hence
					constructor-injection is not available for dynamic-language-backed beans).
		            In the interests of making this special handling of constructors and
		            properties 100% clear, the following mixture of code and configuration
		            will <span class="emphasis"><em>not</em></span> work.
				</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// from the file 'Messenger.groovy'</span></em>
package org.springframework.scripting.groovy;

import org.springframework.scripting.Messenger

class GroovyMessenger implements Messenger {

    GroovyMessenger() {}

    <em class="lineannotation"><span class="lineannotation">// this constructor is <span class="bold"><strong>not</strong></span> available for Constructor Injection...</span></em>
    GroovyMessenger(String message) {
        this.message = message;
    }

    String message

    String anotherMessage
}</pre><pre class="programlisting">&lt;lang:groovy id="badMessenger"
    script-source="classpath:Messenger.groovy"&gt;

    <em class="lineannotation"><span class="lineannotation">&lt;!-- this next constructor argument will *not* be injected into the <code class="classname">GroovyMessenger</code> --&gt;</span></em>
    <em class="lineannotation"><span class="lineannotation">&lt;!--     in fact, this isn't even allowed according to the schema --&gt;</span></em>
    &lt;constructor-arg value="<em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>This will *not* work</strong></span></span></em>" /&gt;
    
    <em class="lineannotation"><span class="lineannotation">&lt;!-- <span class="bold"><strong>only</strong></span> property values are injected into the dynamic-language-backed object --&gt;</span></em>
    &lt;lang:property name="anotherMessage" value="Passed straight through to the dynamic-language-backed object" /&gt;

&lt;/lang&gt;</pre><p>
					In practice this limitation is not as significant as it first appears since
					setter injection is the injection style favored by the overwhelming majority
					of developers anyway (let's leave the discussion as to whether that is a good
					thing to another day).
				</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-beans-jruby"></a>24.3.2.&nbsp;JRuby beans</h3></div></div></div><div class="sidebar"><p class="title"><b>The JRuby library dependencies</b></p><p>
			        The JRuby scripting support in Spring requires the following
			        libraries to be on the classpath of your application.
			        (The  versions listed just happen to be the versions that the
					Spring team used in the development of the JRuby scripting support;
					you may well be able to use another version of a specific library.)
			    </p><div class="itemizedlist"><ul type="disc"><li><p><code class="filename">jruby.jar</code></p></li><li><p><code class="filename">cglib-nodep-2.1_3.jar</code></p></li></ul></div></div><p>From the JRuby homepage...</p>&#8220;<span class="quote">
				<span class="emphasis"><em>JRuby is an 100% pure-Java implementation of the Ruby programming language.</em></span>
			</span>&#8221;<p>
			    In keeping with the Spring philosophy of offering choice, Spring's
			    dynamic language support also supports beans defined in the JRuby
			    language. The JRuby language is based on the quite intuitive
			    Ruby language, and has support for inline regular expressions, blocks
			    (closures), and a whole host of other features that do make solutions
			    for some domain problems a whole lot easier to develop.
		    </p><p>
	            The implementation of the JRuby dynamic language support in Spring is
	            interesting in that what happens is this: Spring creates a JDK dynamic
	            proxy implementing all of the interfaces that are specified in the
	            <code class="literal">'script-interfaces'</code> attribute value of the
	            <code class="literal">&lt;lang:ruby&gt;</code> element (this is why
	            you <span class="emphasis"><em>must</em></span> supply at least one interface in the value
	            of the attribute, and (accordingly) program to interfaces when using
	            JRuby-backed beans).</p><p>
	            Let us look at a fully working example of using a JRuby-based bean. Here is
	            the JRuby implementation of the <code class="interfacename">Messenger</code>
	            interface that was defined earlier in this chapter (for your convenience it
	            is repeated below).
			</p><pre class="programlisting">package org.springframework.scripting;

public interface Messenger {

    String getMessage();
}</pre><pre class="programlisting">require 'java'

include_class 'org.springframework.scripting.Messenger'

class RubyMessenger &lt; Messenger

 def setMessage(message)
  @@message = message
 end

 def getMessage
  @@message
 end

end

RubyMessenger.new<em class="lineannotation"><span class="lineannotation"> # this last line is not essential (but see below)</span></em></pre><p>
	            And here is the Spring XML that defines an instance of the
	            <code class="classname">RubyMessenger</code> JRuby bean.
			</p><pre class="programlisting">&lt;lang:jruby id="messageService"
            script-interfaces="org.springframework.scripting.Messenger"
            script-source="classpath:RubyMessenger.rb"&gt;
    
    &lt;lang:property name="message" value="Hello World!" /&gt;

&lt;/lang:jruby&gt;</pre><p>
				Take note of the last line of that JRuby source (<code class="literal">'RubyMessenger.new'</code>).
				When using JRuby in the context of Spring's dynamic language support, you are encouraged
				to instantiate and return a new instance of the JRuby class that you want to use as a
				dynamic-language-backed bean as the result of the execution of your JRuby source. You
				can achieve this by simply instantiating a new instance of your JRuby class on the last
				line of the source file like so:
	        </p><pre class="programlisting">require 'java'

include_class 'org.springframework.scripting.Messenger'

<em class="lineannotation"><span class="lineannotation"># class definition same as above...</span></em>

<em class="lineannotation"><span class="lineannotation"># instantiate and return a new instance of the <code class="literal">RubyMessenger</code> class</span></em>
RubyMessenger.new</pre><p>
				If you forget to do this, it is not the end of the world; this will however result in
				Spring having to trawl (reflectively) through the type representation of your JRuby class
				looking for a class to instantiate. In the grand scheme of things this will be so fast
				that you'll never notice it, but it is something that can be avoided by simply
				having a line such as the one above as the last line of your JRuby script. If you don't
				supply such a line, or if Spring cannot find a JRuby class in your script to instantiate
				then an opaque <code class="classname">ScriptCompilationException</code>
				will be thrown immediately after the source is executed by the JRuby
				interpreter. The key text that identifies this as the root cause of an
				exception can be found immediately below (so if your Spring container
				throws the following exception when creating your dynamic-language-backed bean
				and the following text is there in the corresponding stacktrace, this will hopefully
				allow you to identify and then easily rectify the issue):
			</p><pre class="programlisting">org.springframework.scripting.ScriptCompilationException: Compilation of JRuby script returned ''</pre><p>
	            To rectify this, simply instantiate a new instance of whichever class
	            you want to expose as a JRuby-dynamic-language-backed bean (as shown above). Please
	            also note that you can actually define as many classes and objects
	            as you want in your JRuby script; what is important is that the
	            source file as a whole must return an object (for Spring to configure).
			</p><p>
				See the section entitled <a href="#dynamic-language-scenarios" title="24.4.&nbsp;Scenarios">Section&nbsp;24.4, &#8220;Scenarios&#8221;</a> for some
				scenarios where you might want to use JRuby-based beans.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-beans-groovy"></a>24.3.3.&nbsp;Groovy beans</h3></div></div></div><div class="sidebar"><p class="title"><b>The Groovy library dependencies</b></p><p>
			        The Groovy scripting support in Spring requires the following
			        libraries to be on the classpath of your application.
			    </p><div class="itemizedlist"><ul type="disc"><li><p><code class="filename">groovy-1.0.jar</code></p></li><li><p><code class="filename">asm-2.2.2.jar</code></p></li><li><p><code class="filename">antlr-2.7.6.jar</code></p></li></ul></div></div><p>From the Groovy homepage...</p>&#8220;<span class="quote">
				<span class="emphasis"><em>Groovy is an agile dynamic language for the Java 2 Platform that has
				many of the	features that people like so much in languages like Python, Ruby
				and Smalltalk, making them available to Java developers using a Java-like syntax.
				</em></span>
			</span>&#8221;<p>
	            If you have read this chapter straight from the top, you will already have
	            <a href="#dynamic-language-a-first-example" title="24.2.&nbsp;A first example">seen an example</a> of a
	            Groovy-dynamic-language-backed bean. Let's look at another example (again
	            using an example from the Spring test suite).
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Groovy itself requires JDK 1.4+.</p></td></tr></table></div><pre class="programlisting">package org.springframework.scripting;

public interface Calculator {

    int add(int x, int y);
}</pre><p>
                Here is an implementation of the <code class="interfacename">Calculator</code>
                interface in Groovy.
            </p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// from the file 'calculator.groovy'</span></em>
package org.springframework.scripting.groovy

class GroovyCalculator implements Calculator {

    int add(int x, int y) {
        x + y
    }
}</pre><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;-- from the file 'beans.xml' --&gt;</span></em>
&lt;beans&gt;
    &lt;lang:groovy id="calculator" script-source="classpath:calculator.groovy"/&gt;
&lt;/beans&gt;</pre><p>
				Lastly, here is a small application to exercise the above configuration.
			</p><pre class="programlisting">package org.springframework.scripting;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class Main {

    public static void Main(String[] args) {
        ApplicationContext ctx = new ClassPathXmlApplicationContext("beans.xml");
        Calculator calc = (Calculator) ctx.getBean("calculator");
        System.out.println(calc.add(2, 8));
    }
}</pre><p>
	            The resulting output from running the above program will be
	            (unsurprisingly) <code class="computeroutput">10</code>.
	            (Exciting example, huh? Remember that the intent is to illustrate the
	            concept. Please consult the dynamic language showcase project for a
	            more complex example, or indeed the section entitled
	            <a href="#dynamic-language-scenarios" title="24.4.&nbsp;Scenarios">Section&nbsp;24.4, &#8220;Scenarios&#8221;</a> later in this chapter).
			</p><p>
	            It is important that you <span class="emphasis"><em>do not</em></span> define more than one
	            class per Groovy source file. While this is perfectly legal in Groovy, it
	            is (arguably) a bad practice: in the interests of a consistent approach,
	            you should (in the opinion of this author) respect the standard Java
	            conventions of one (public) class per source file.
			</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="dynamic-language-beans-groovy-customizer"></a>24.3.3.1.&nbsp;Customising Groovy objects via a callback</h4></div></div></div><p>
					The <code class="interfacename">GroovyObjectCustomizer</code>
					interface is a callback that allows you to hook additional
					creation logic into the process of creating a Groovy-backed bean.
					For example, implementations of this interface could invoke
					any required initialization method(s), or set some default property
					values, or specify a custom <code class="classname">MetaClass</code>.
				</p><pre class="programlisting">public interface GroovyObjectCustomizer {

   void customize(GroovyObject goo);
}</pre><p>
					The Spring Framework will instantiate an instance of your Groovy-backed
					bean, and will then pass the created <code class="interfacename">GroovyObject</code>
					to the specified <code class="interfacename">GroovyObjectCustomizer</code>
					if one has been defined. You can do whatever you like with the supplied
					<code class="interfacename">GroovyObject</code> reference: it is expected
					that the setting of a custom <code class="classname">MetaClass</code> is what most
					folks will want to do with this callback, and you can see an example
					of doing that below.
				</p><pre class="programlisting">public final class SimpleMethodTracingCustomizer implements GroovyObjectCustomizer {

   public void customize(GroovyObject goo) {
      DelegatingMetaClass metaClass = new DelegatingMetaClass(goo.getMetaClass()) {

         public Object invokeMethod(Object object, String methodName, Object[] arguments) {
            System.out.println("Invoking '" + methodName + "'.");
            return super.invokeMethod(object, methodName, arguments);
         }
      };
      metaClass.initialize();
      goo.setMetaClass(metaClass);
   }
}</pre><p>
					A full discussion of meta-programming in Groovy is beyond the scope of the
					Spring reference manual. Consult the relevant section of the Groovy
					reference manual, or do a search online: there are plenty of articles
					concerning this topic.
					Actually making use of a <code class="interfacename">GroovyObjectCustomizer</code>
					is easy if you are using the Spring 2.0 namespace support.
				</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- define the <code class="interfacename">GroovyObjectCustomizer</code> just like any other bean --&gt;</span></em>
&lt;bean id="tracingCustomizer" class="example.SimpleMethodTracingCustomizer" /&gt;

   <em class="lineannotation"><span class="lineannotation">&lt;!-- ... and plug it into the desired Groovy bean via the '<code class="literal">customizer-ref</code>' attribute --&gt;</span></em>
   &lt;lang:groovy id="calculator"
      script-source="classpath:org/springframework/scripting/groovy/Calculator.groovy"
      customizer-ref="tracingCustomizer" /&gt;</pre><p>
					If you are not using the Spring 2.0 namespace support, you can still
					use the <code class="interfacename">GroovyObjectCustomizer</code> functionality.
				</p><pre class="programlisting">&lt;bean id="calculator" class="org.springframework.scripting.groovy.GroovyScriptFactory"&gt;
      &lt;constructor-arg value="classpath:org/springframework/scripting/groovy/Calculator.groovy"/&gt;
      <em class="lineannotation"><span class="lineannotation">&lt;!-- define the <code class="interfacename">GroovyObjectCustomizer</code> (as an inner bean) --&gt;</span></em>
      &lt;constructor-arg&gt;
         &lt;bean id="tracingCustomizer" class="example.SimpleMethodTracingCustomizer" /&gt;
      &lt;/constructor-arg&gt;
&lt;/bean&gt;

&lt;bean class="org.springframework.scripting.support.ScriptFactoryPostProcessor"/&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-beans-bsh"></a>24.3.4.&nbsp;BeanShell beans</h3></div></div></div><div class="sidebar"><p class="title"><b>The BeanShell library dependencies</b></p><p>
			        The BeanShell scripting support in Spring requires the following
			        libraries to be on the classpath of your application.
			    </p><div class="itemizedlist"><ul type="disc"><li><p><code class="filename">bsh-2.0b4.jar</code></p></li><li><p><code class="filename">cglib-nodep-2.1_3.jar</code></p></li></ul></div><p>All of these libraries are available in the Spring-with-dependencies
                distribution of Spring (in addition to also being freely available
                on the web).</p></div><p>From the BeanShell homepage...</p>&#8220;<span class="quote">
				<span class="emphasis"><em>BeanShell is a small, free, embeddable Java source interpreter
				with dynamic language features, written in Java. BeanShell dynamically
				executes standard Java syntax and extends it with common scripting
				conveniences such as loose types, commands, and method closures like those
				in Perl and JavaScript.</em></span>
			</span>&#8221;<p>
	            In contrast to Groovy, BeanShell-backed bean definitions require some (small)
	            additional configuration. The implementation of the BeanShell dynamic language
	            support in Spring is interesting in that what happens is this: Spring creates
	            a JDK dynamic proxy implementing all of the interfaces that are specified in the
	            <code class="literal">'script-interfaces'</code> attribute value of the
	            <code class="literal">&lt;lang:bsh&gt;</code> element (this is why
	            you <span class="emphasis"><em>must</em></span> supply at least one interface in the value
	            of the attribute, and (accordingly) program to interfaces when using
	            BeanShell-backed beans). This means that every method call on a BeanShell-backed
	            object is going through the JDK dynamic proxy invocation mechanism.
			</p><p>
	            Let's look at a fully working example of using a BeanShell-based bean
	            that implements the <code class="interfacename">Messenger</code> interface
	            that was defined earlier in this chapter (repeated below for your
	            convenience).
			</p><pre class="programlisting">package org.springframework.scripting;

public interface Messenger {

    String getMessage();
}</pre><p>Here is the BeanShell 'implementation' (the term is used loosely here) of the
	        <code class="interfacename">Messenger</code> interface.</p><pre class="programlisting">String message;

String getMessage() {
    return message;
}

void setMessage(String aMessage) {
    message = aMessage;
}</pre><p>And here is the Spring XML that defines an 'instance' of the above 'class'
	        (again, the term is used very loosely here).</p><pre class="programlisting">&lt;lang:bsh id="messageService" script-source="classpath:BshMessenger.bsh"
    script-interfaces="org.springframework.scripting.Messenger"&gt;

    &lt;lang:property name="message" value="Hello World!" /&gt;
&lt;/lang:bsh&gt;</pre><p>See the section entitled <a href="#dynamic-language-scenarios" title="24.4.&nbsp;Scenarios">Section&nbsp;24.4, &#8220;Scenarios&#8221;</a> for some
			scenarios where you might want to use BeanShell-based beans.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dynamic-language-scenarios"></a>24.4.&nbsp;Scenarios</h2></div></div></div><p>
            The possible scenarios where defining Spring managed beans in a scripting
            language would be beneficial are, of course, many and varied. This section
            describes two possible use cases for the dynamic language support in Spring.
        </p><p>
            Please note that the Spring distribution ships with a showcase project
            for this dynamic language support in the relevant section of the Spring distribution.
            (A showcase project is a small project that is limited in scope to covering
            one particular aspect of the Spring Framework.)
        </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-scenarios-controllers"></a>24.4.1.&nbsp;Scripted Spring MVC Controllers</h3></div></div></div><p>
				One group of classes that may benefit from using dynamic-language-backed
				beans is that of Spring MVC controllers. In pure Spring MVC applications,
				the	navigational flow through a web application is to a large extent
				determined by code encapsulated within your Spring MVC controllers.
				As the navigational flow and other presentation layer logic of a web
				application needs to be updated to respond to support issues or changing
				business requirements, it may well be easier to effect any such required
				changes	by editing one or more dynamic language source files and seeing
				those changes being immediately reflected in the state of a running
				application.
			</p><p>
				Remember that in the lightweight architectural model espoused by projects
				such as Spring, you are typically aiming to have a really
				<span class="emphasis"><em>thin</em></span> presentation layer, with all the meaty business
				logic of an application being contained in the domain and service layer
				classes. Developing Spring MVC controllers as dynamic-language-backed beans
				allows you to change presentation layer logic by simply editing and saving
				text files; any changes to such dynamic language source files will (depending
				on the configuration) automatically be reflected in the beans that are backed
	            by dynamic language source files.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
		            In order to effect this automatic 'pickup' of any changes
		            to dynamic-language-backed beans, you will have had to enable the
		            'refreshable beans' functionality. See the section entitle
		             <a href="#dynamic-language-refreshable-beans" title="24.3.1.2.&nbsp;Refreshable beans">Section&nbsp;24.3.1.2, &#8220;Refreshable beans&#8221;</a> for a full treatment
		             of this feature.
				</p></td></tr></table></div><p>
	            Find below an example of an
	            <code class="interfacename">org.springframework.web.servlet.mvc.Controller</code>
	            implemented using the Groovy dynamic language. This example is taken in
	            part from the dynamic language support showcase project that is supplied
	            with the Spring distribution; please do see the project in the
	            <code class="filename">'samples/showcases/dynamvc/'</code> directory
	            of the Spring distribution.
			</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// from the file '<code class="filename">/WEB-INF/groovy/FortuneController.groovy</code>'</span></em>
package org.springframework.showcase.fortune.web

import org.springframework.showcase.fortune.service.FortuneService
import org.springframework.showcase.fortune.domain.Fortune
import org.springframework.web.servlet.ModelAndView
import org.springframework.web.servlet.mvc.Controller

import javax.servlet.http.HttpServletRequest
import javax.servlet.http.HttpServletResponse

class FortuneController implements Controller {

    FortuneService fortuneService

    ModelAndView handleRequest(
            HttpServletRequest request, HttpServletResponse httpServletResponse) {

        return new ModelAndView("tell", "fortune", this.fortuneService.tellFortune())
    }
}</pre><pre class="programlisting">&lt;lang:groovy id="fortune"
             refresh-check-delay="3000"
             script-source="/WEB-INF/groovy/FortuneController.groovy"&gt;
    &lt;lang:property name="fortuneService" ref="fortuneService"/&gt;
&lt;/lang:groovy&gt;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-scenarios-validators"></a>24.4.2.&nbsp;Scripted Validators</h3></div></div></div><p>
				Another area of application development with Spring that may benefit
				from the flexibility afforded by dynamic-language-backed beans is that of
				validation. It <span class="emphasis"><em>may</em></span> be easier to express complex validation
				logic using a loosely typed dynamic language (that may also have support
				for inline regular expressions) as opposed to regular Java.
			</p><p>
	            Again, developing validators as dynamic-language-backed beans allows you to change
	            validation logic by simply editing and saving a simple text file; any such
	            changes will (depending on the configuration) automatically be reflected
	            in the execution of a running application and would not require the restart
	            of an application.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
		            Please note that in order to effect the automatic 'pickup' of any changes
		            to dynamic-language-backed beans, you will have had to enable the
		            'refreshable beans' feature. See the section entitled
		            <a href="#dynamic-language-refreshable-beans" title="24.3.1.2.&nbsp;Refreshable beans">Section&nbsp;24.3.1.2, &#8220;Refreshable beans&#8221;</a> for a full and
		            detailed treatment of this feature.
				</p></td></tr></table></div><p>
	            Find below an example of a Spring
	            <code class="interfacename">org.springframework.validation.Validator</code>
	            implemented using the Groovy dynamic language. (See the section entitled
	            <a href="#validator" title="5.2.&nbsp;Validation using Spring's Validator interface">Section&nbsp;5.2, &#8220;Validation using Spring's <code class="interfacename">Validator</code> interface&#8221;</a> for a discussion of the
	            <code class="interfacename">Validator</code> interface.)
			</p><pre class="programlisting">import org.springframework.validation.Validator
import org.springframework.validation.Errors
import org.springframework.beans.TestBean

class TestBeanValidator implements Validator {

    boolean supports(Class clazz) {
        return TestBean.class.isAssignableFrom(clazz)
    }
    
    void validate(Object bean, Errors errors) {
        if(bean.name?.trim()?.size() &gt; 0) {
            return
        }
	errors.reject("whitespace", "Cannot be composed wholly of whitespace.")
    }
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dynamic-language-final-notes"></a>24.5.&nbsp;Bits and bobs</h2></div></div></div><p>
			This last section contains some bits and bobs related to the dynamic language
			support.
		</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-final-notes-aop"></a>24.5.1.&nbsp;AOP - advising scripted beans</h3></div></div></div><p>
				It is possible to use the Spring AOP framework to advise scripted beans.
				The Spring AOP framework actually is unaware that a bean that is being
				advised might be a scripted bean, so all of the AOP use cases and functionality
				that you may be using or aim to use will work with scripted beans. There is
				just one (small) thing that you need to be aware of when advising scripted
				beans... you cannot use class-based proxies, you must use
				<a href="#aop-proxying" title="6.6.&nbsp;Proxying mechanisms">interface-based proxies</a>.
			</p><p>
				You are of course not just limited to advising scripted beans... you can
				also write aspects themselves in a supported dynamic language and use such
				beans to advise other Spring beans. This really would be an advanced use of
				the dynamic language support though.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-final-notes-scopes"></a>24.5.2.&nbsp;Scoping</h3></div></div></div><p>
				In case it is not immediately obvious, scripted beans can of course be scoped
				just like any other bean. The <code class="literal">scope</code> attribute on the
				various <code class="literal">&lt;lang:language/&gt;</code> elements allows you to
				control the scope of the underlying scripted bean, just as it does with a
				regular bean. (The default scope is
				<a href="#beans-factory-scopes-singleton" title="3.4.1.&nbsp;The singleton scope">singleton</a>, just as it
				is with 'regular' beans.)
			</p><p>
				Find below an example of using the <code class="literal">scope</code> attribute
				to define a Groovy bean scoped as a
				<a href="#beans-factory-scopes-prototype" title="3.4.2.&nbsp;The prototype scope">prototype</a>.
			</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:lang="http://www.springframework.org/schema/lang"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang-2.0.xsd"&gt;

    &lt;lang:groovy id="messenger" script-source="classpath:Messenger.groovy" <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>scope="prototype"</strong></span></span></em>&gt;
        &lt;lang:property name="message" value="I Can Do The RoboCop" /&gt;
    &lt;/lang:groovy&gt;

    &lt;bean id="bookingService" class="x.y.DefaultBookingService"&gt;
        &lt;property name="messenger" ref="messenger" /&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre><p>
				See the section entitled <a href="#beans-factory-scopes" title="3.4.&nbsp;Bean scopes">Section&nbsp;3.4, &#8220;Bean scopes&#8221;</a> in <a href="#beans" title="Chapter&nbsp;3.&nbsp;The IoC container">Chapter&nbsp;3, <i>The IoC container</i></a>
				for a fuller discussion of the scoping support in the Spring Framework.
			</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dynamic-language-resources"></a>24.6.&nbsp;Further Resources</h2></div></div></div><p>
			Find below links to further resources about the various dynamic languages described
			in this chapter.
		</p><div class="itemizedlist"><ul type="disc"><li><p>The <a href="http://jruby.codehaus.org/" target="_top">JRuby</a> homepage</p></li><li><p>The <a href="http://groovy.codehaus.org/" target="_top">Groovy</a> homepage</p></li><li><p>The <a href="http://www.beanshell.org/" target="_top">BeanShell</a> homepage</p></li></ul></div><p>
			Some of the more active members of the Spring community have also added support for
			a number of additional dynamic languages above and beyond the ones covered in this
			chapter. While it is possible that such third party contributions may be added to the
			list of languages supported by the main Spring distribution, your best bet for seeing
			if your favourite scripting language is supported is the
			<a href="https://springmodules.dev.java.net/" target="_top">Spring Modules project</a>.
		</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="metadata"></a>Chapter&nbsp;25.&nbsp;Annotations and Source Level Metadata Support</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="metadata-introduction"></a>25.1.&nbsp;Introduction</h2></div></div></div><p>Source-level metadata is the addition of <span class="emphasis"><em>attributes</em></span> or
		<span class="emphasis"><em>annotations</em></span> to program elements - usually, classes
		and/or methods.</p><p>For example, we might add metadata to a class as follows:</p><pre class="programlisting">/**
 * Normal comments here
 * @@org.springframework.transaction.interceptor.DefaultTransactionAttribute()
 */
public class PetStoreImpl implements PetStoreFacade, OrderService {</pre><p>We could add metadata to a method as follows:</p><pre class="programlisting">/**
 * Normal comments here
 * @@org.springframework.transaction.interceptor.RuleBasedTransactionAttribute()
 * @@org.springframework.transaction.interceptor.RollbackRuleAttribute(Exception.class)
 * @@org.springframework.transaction.interceptor.NoRollbackRuleAttribute("ServletException")
 */
public void echoException(Exception ex) throws Exception {
    ....
}</pre><p>Both of these examples use Jakarta Commons Attributes syntax.</p><p>
			Source-level metadata was introduced to the mainstream by XDoclet
			(in the Java world) and by the release of Microsoft's .NET platform, which
			uses source-level attributes to control transactions, pooling and other
			behavior.
		</p><p>
			The value in this approach has been recognized in the J2EE
			community. For example, it's much less verbose than the traditional XML
			deployment descriptors used exclusively by EJB. While it is desirable to
			externalize some things from program source code, some important
			enterprise settings - notably transaction characteristics - arguably belong
			in program source. Contrary to the assumptions of the EJB spec, it seldom
			makes sense to modify the transactional characteristics of a method
			(although parameters like transaction timeouts might change!).
		</p><p>
			Although metadata attributes are typically used mainly by framework
			infrastructure to describe the services application classes require, it
			should also be possible for metadata attributes to be queried at runtime.
			This is a key distinction from solutions such as XDoclet, which
			view metadata primarily as a way of generating code such as EJB artefacts.
		</p><p>
			There are a number of solutions in this space, including:
		</p><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>Standard Java Annotations</strong></span>: the
                standard Java metadata implementation (developed as JSR-175 and available
                in Java 5). Spring has specific Java 5 annotations for transactional
                demarcation, JMX, and aspects (to be precise they are AspectJ annotations).
                However, since Spring supports both Java 1.3 and 1.4 a solution for said
                JVM versions is needed too. Spring metadata support provides such a
                solution.</p></li><li><p><span class="bold"><strong>XDoclet</strong></span>: well-established
                solution, primarily intended for code generation.</p></li><li><p>Various <span class="bold"><strong>open source attribute
                implementations</strong></span>, for Java 1.3 and 1.4, of which Commons
                Attributes is the most complete implementation. All these require a
                special pre- or post-compilation step.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="metadata-spring"></a>25.2.&nbsp;Spring's metadata support</h2></div></div></div><p>In keeping with its provision of abstractions over important
		concepts, Spring provides a facade to metadata implementations, in the
		form of the <code class="interfacename">org.springframework.metadata.Attributes</code>
		interface. Such a facade adds value for several reasons:</p><div class="itemizedlist"><ul type="disc"><li><p>Even though Java 5 provides metadata support at language level, there will
                still be value in providing such an abstraction:
				</p><div class="itemizedlist"><ul type="circle"><li><p>Java 5 metadata is static. It is associated with a class
						at compile time, and cannot be changed in a deployed
						environment (annotation state can actually be changed
						at runtime using reflection, but doing so would really be
						a bad practice). There is a need for hierarchical metadata,
						providing the ability to override certain attribute values in
						deployment - for example, in an XML file.</p></li><li><p>Java 5 metadata is returned through the Java reflection
						API. This makes it impossible to mock during test time. Spring
						provides a simple interface to allow this.</p></li><li><p>There will be a need for metadata support in 1.3 and 1.4
						applications for at least two years. Spring aims to provide
						working solutions <span class="emphasis"><em>now</em></span>; forcing the use of
						Java 5 is not an option in such an important area.</p></li></ul></div></li><li><p>Current metadata APIs, such as Commons Attributes (used by
				Spring 1.0-1.2) are hard to test. Spring provides a simple metadata
				interface that is much easier to mock.</p></li></ul></div><p>The Spring <code class="interfacename">Attributes</code> interface looks like this:</p><pre class="programlisting">public interface Attributes {

    Collection getAttributes(Class targetClass);

    Collection getAttributes(Class targetClass, Class filter);

    Collection getAttributes(Method targetMethod);

    Collection getAttributes(Method targetMethod, Class filter);

    Collection getAttributes(Field targetField);

    Collection getAttributes(Field targetField, Class filter);
}</pre><p>
			This is a lowest common denominator interface. JSR-175 offers more
			capabilities than this, such as attributes on method arguments. As of
			Spring 1.0, Spring aimed to provide the subset of metadata required to
			provide effective declarative enterprise services in the vein of EJB
			or .NET, on Java 1.3+. As of Spring 1.2, analogous Java 5 annotations
			are also supported, as a direct alternative to Commons Attributes.
		</p><p>
			Note that this interface offers <code class="classname">Object</code>
			attributes, like .NET. This distinguishes it from attribute systems such
			as that of Nanning Aspects, which offer only <code class="classname">String</code>
			attributes. There is a significant advantage in supporting
			<code class="classname">Object</code> attributes, namely that it enables
			attributes to participate in class hierarchies and allows such
			attributes to react intelligently to their configuration parameters.
		</p><p>
			With most attribute providers, attribute classes are configured
			via constructor arguments or JavaBean properties. Commons Attributes
			supports both.
		</p><p>As with all Spring abstraction APIs, <code class="interfacename">Attributes</code>
		is an interface. This makes it easy to mock attribute implementations for unit tests.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="metadata-annotations"></a>25.3.&nbsp;Annotations</h2></div></div></div><p>
			The Spring Framework ships with a number of custom Java 5+ annotations.
		</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="metadata-annotations-required"></a>25.3.1.&nbsp;@<code class="interfacename">Required</code></h3></div></div></div><p>The @<code class="interfacename">Required</code> annotation in the
			<code class="literal">org.springframework.beans.factory.annotation</code>
			package can be used to <span class="emphasis"><em>mark</em></span> a property as
			being <span class="emphasis"><em>'required-to-be-set'</em></span> (i.e. an
			annotated (setter) method of a class must be configured to be
			dependency injected with a value), else an
			<code class="classname">Exception</code> will be thrown by the container
			at runtime.</p><p>The best way to illustrate the usage of this annotation is to
			show an example:</p><pre class="programlisting">public class SimpleMovieLister {

    <em class="lineannotation"><span class="lineannotation">// the <code class="classname">SimpleMovieLister</code> has a dependency on the <code class="interfacename">MovieFinder</code></span></em>
    private MovieFinder movieFinder;

    <em class="lineannotation"><span class="lineannotation">// a setter method so that the Spring container can 'inject' a <code class="interfacename">MovieFinder</code></span></em>
    @Required
    public void setMovieFinder(MovieFinder movieFinder) {
        this.movieFinder = movieFinder;
    }
    
    <em class="lineannotation"><span class="lineannotation">// business logic that actually 'uses' the injected <code class="interfacename">MovieFinder</code> is omitted...</span></em>
}</pre><p>
				Hopefully the above class definition reads easy on the eye.
				Any and all <code class="interfacename">BeanDefinitions</code> for the
				<code class="classname">SimpleMovieLister</code> class must be provided
				with a value.
			</p><p>
				Let's look at an example of some XML configuration that will
				<span class="bold"><strong>not</strong></span> pass validation.
			</p><pre class="programlisting">&lt;bean id="movieLister" class="x.y.SimpleMovieLister"&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- whoops, no MovieFinder is set (and this property is @<code class="interfacename">Required</code>) --&gt;</span></em>
&lt;/bean&gt;</pre><p>
				At runtime the following message will be generated by the Spring container
				(the rest of the stack trace has been truncated).
			</p><pre class="programlisting">Exception in thread "main" java.lang.IllegalArgumentException:
    Property 'movieFinder' is required for bean 'movieLister'.</pre><p>
				There is one last little (small, tiny) piece of Spring configuration
				that is required to actually <span class="emphasis"><em>'switch on'</em></span> this
				behavior. Simply annotating the <span class="emphasis"><em>'setter'</em></span> properties
				of your classes is not enough to get this behavior. You need
				to enable a component that is aware of the @<code class="interfacename">Required</code>
				annotation and that can process it appropriately.
			</p><p>
				This component is the <code class="classname">RequiredAnnotationBeanPostProcessor</code> class.
				This is a special <code class="interfacename">BeanPostProcessor</code>
				implementation that is @<code class="interfacename">Required</code>-aware
				and actually provides the <span class="emphasis"><em>'blow up if this required property
				has not been set'</em></span> logic. It is <span class="emphasis"><em>very</em></span> easy
				to configure; simply drop the following bean definition into your Spring
				XML configuration.
			</p><pre class="programlisting">&lt;bean class="org.springframework.beans.factory.annotation.RequiredAnnotationBeanPostProcessor"/&gt;</pre><p>
				Finally, one can configure an instance of the
				<code class="classname">RequiredAnnotationBeanPostProcessor</code> class to look
				for <span class="emphasis"><em>another</em></span> <code class="interfacename">Annotation</code> type.
				This is great if you already have your own
				@<code class="interfacename">Required</code>-style annotation. Simply plug it into
				the definition of a <code class="classname">RequiredAnnotationBeanPostProcessor</code> and
				you are good to go. 
			</p><p>
				By way of an example, let's suppose you (or your organization / team) have
				defined an attribute called @ <code class="interfacename">Mandatory</code>.
				You can make a <code class="classname">RequiredAnnotationBeanPostProcessor</code>
				instance @<code class="interfacename">Mandatory</code>-aware like so:
			</p><pre class="programlisting">&lt;bean class="org.springframework.beans.factory.annotation.RequiredAnnotationBeanPostProcessor"&gt;
    &lt;property name="requiredAnnotationType" value="your.company.package.Mandatory"/&gt;
&lt;/bean&gt;</pre><p>
				Here is the source code for the @<code class="interfacename">Mandatory</code>
				annotation. You will need to ensure that your custom annotation type
				is itself annotated with appropriate annotations for it's target
				and runtime retention policy.
			</p><pre class="programlisting">package your.company.package;

import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Mandatory {
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="metadata-annotations-other"></a>25.3.2.&nbsp;Other @Annotations in Spring</h3></div></div></div><p>
				Annotations are also used in a number of other places throughout Spring.
				Rather than being described here, these annotations are described in that
				section or chapter of the reference documentation to which they are most
				relevant.
			</p><div class="itemizedlist"><ul type="disc"><li><p><a href="#transaction-declarative-annotations" title="9.5.6.&nbsp;Using @Transactional">Section&nbsp;9.5.6, &#8220;Using <code class="interfacename">@Transactional</code>&#8221;</a></p></li><li><p><a href="#aop-atconfigurable" title="6.8.1.&nbsp;Using AspectJ to dependency inject domain objects with Spring">Section&nbsp;6.8.1, &#8220;Using AspectJ to dependency inject domain objects with Spring&#8221;</a></p></li><li><p><a href="#aop-ataspectj" title="6.2.&nbsp;@AspectJ support">Section&nbsp;6.2, &#8220;@AspectJ support&#8221;</a></p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="metadata-commons"></a>25.4.&nbsp;Integration with Jakarta Commons Attributes</h2></div></div></div><p>
			Presently Spring supports only Jakarta Commons Attributes out of the
			box, although it is easy to provide implementations of the
			<code class="interfacename">org.springframework.metadata.Attributes</code> interface for
			other metadata providers.
		</p><p>
			<span class="bold"><strong>Commons Attributes 2.1</strong></span>
			(<a href="http://jakarta.apache.org/commons/attributes/" target="_top">http://jakarta.apache.org/commons/attributes/</a>)
			is a capable attributes solution. It supports attribute configuration via
			constructor arguments and JavaBean properties, which offers better
			self-documentation in attribute definitions. (Support for JavaBean
			properties was added at the request of the Spring team.)
		</p><p>
			We've already seen two examples of Commons Attributes attributes
			definitions. In general, we will need to express:
		</p><div class="itemizedlist"><ul type="disc"><li><p>
					<span class="emphasis"><em>The name of the attribute class</em></span>. This can
					be a fully qualified name (FQN), as shown above. If the relevant attribute class has already
					been imported, the FQN isn't required. It's also possible to specify
					"attribute packages" in attribute compiler configuration.
				</p></li><li><p>
					<span class="emphasis"><em>Any necessary parameterization.</em></span> This is done via
					constructor arguments or JavaBean properties.
				</p></li></ul></div><p>Bean properties look as follows:</p><pre class="programlisting">/**
 * @@MyAttribute(myBooleanJavaBeanProperty=true)
 */</pre><p>
			It's possible to combine constructor arguments and JavaBean
			properties (as in Spring IoC).
		</p><p>
			Because, unlike Java 1.5 attributes, Commons Attributes is not
			integrated with the Java language, it is necessary to run a special
			<span class="emphasis"><em>attribute compilation</em></span> step as part of the build
			process.
		</p><p>
			To run Commons Attributes as part of the build process, you will
			need to do the following:
		</p><p>
			1. Copy the necessary library jars to
			<code class="literal">$ANT_HOME/lib</code>. Four Jars are required, and all are
			distributed with Spring:
		</p><div class="itemizedlist"><ul type="disc"><li><p>the Commons Attributes compiler jar and API jar</p></li><li><p>xJavadoc.jar from XDoclet</p></li><li><p>commons-collections.jar from Jakarta Commons</p></li></ul></div><p>
			2. Import the Commons Attributes ant tasks into your project build
			script, as follows:
		</p><pre class="programlisting">&lt;taskdef resource="org/apache/commons/attributes/anttasks.properties"/&gt;</pre><p>
			3. Next, define an attribute compilation task, which will use the
			Commons Attributes attribute-compiler task to "compile" the attributes in
			the source. This process results in the generation of additional sources,
			to a location specified by the <code class="literal">destdir</code> attribute. Here we show the use of
			a temporary directory for storing the generated files:
		</p><pre class="programlisting">&lt;target name="compileAttributes"&gt;

  &lt;attribute-compiler destdir="${commons.attributes.tempdir}"&gt;
    &lt;fileset dir="${src.dir}" includes="**/*.java"/&gt;
  &lt;/attribute-compiler&gt;

&lt;/target&gt;</pre><p>
			The compile target that runs javac over the sources should depend on
			this attribute compilation task, and must also compile the generated
			sources, which we output to our destination temporary directory. If there
			are syntax errors in your attribute definitions, they will normally be
			caught by the attribute compiler. However, if the attribute definitions
			are syntactically plausible, but specify invalid types or class names, the
			compilation of the generated attribute classes may fail. In this case, you
			can look at the generated classes to establish the cause of the
			problem.
		</p><p class="remark"><i><span class="remark">
			Commons Attributes also provides Maven support. Please refer to
			Commons Attributes documentation for further information.
		</span></i></p><p>
			While this attribute compilation process may look complex, in fact
			it's a one-off cost. Once set up, attribute compilation is incremental, so
			it doesn't usually noticeably slow the build process. And once the
			compilation process is set up, you may find that use of attributes as
			described in this chapter can save you a lot of time in other
			areas.
		</p><p>
			If you require attribute indexing support (only currently required
			by Spring for attribute-targeted web controllers, discussed below), you
			will need an additional step, which must be performed on a jar file of
			your compiled classes. In this additional step, Commons Attributes will
			create an index of all the attributes defined on your sources, for
			efficient lookup at runtime. The step looks like this:
		</p><pre class="programlisting">&lt;attribute-indexer jarFile="myCompiledSources.jar"&gt;
    
  &lt;classpath refid="master-classpath"/&gt;

&lt;/attribute-indexer&gt;</pre><p class="remark"><i><span class="remark">
			See the <code class="literal">/attributes</code> directory of the Spring JPetStore sample
			application for an example of this build process. You can take the build
			script it contains and modify it for your own projects.
		</span></i></p><p>
			If your unit tests depend on attributes, try to express the
			dependency on the Spring Attributes abstraction, rather than Commons
			Attributes. Not only is this more portable - for example, your tests will
			still work if you switch to Java 1.5 attributes in future - it simplifies
			testing. Also, Commons Attributes is a static API, while Spring provides a
			metadata interface that you can easily mock.
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="metadata-uses"></a>25.5.&nbsp;Metadata and Spring AOP autoproxying</h2></div></div></div><p>
			The most important uses of metadata attributes are in conjunction
			with Spring AOP. This provides a .NET-like programming model, where
			declarative services are automatically provided to application objects
			that declare metadata attributes. Such metadata attributes can be
			supported out of the box by the framework, as in the case of declarative
			transaction management, or can be custom.
		</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="metadata-fundamentals"></a>25.5.1.&nbsp;Fundamentals</h3></div></div></div><p>
				This builds on the Spring AOP autoproxy functionality.
				Configuration might look like this:
			</p><pre class="programlisting">&lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/&gt;

&lt;bean class="org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"&gt;
  &lt;property name="transactionInterceptor" ref="txInterceptor" /&gt;
&lt;/bean&gt;

&lt;bean id="txInterceptor" class="org.springframework.transaction.interceptor.TransactionInterceptor"&gt;
  &lt;property name="transactionManager" ref="transactionManager" /&gt;
  &lt;property name="transactionAttributeSource"&gt;
    &lt;bean class="org.springframework.transaction.interceptor.AttributesTransactionAttributeSource"&gt;
      &lt;property name="attributes" ref="attributes" /&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="attributes" class="org.springframework.metadata.commons.CommonsAttributes" /&gt;</pre><p>
				The basic concepts here should be familiar from the discussion of
				autoproxying in the AOP chapter.
			</p><p>
				The most important bean definitions are the auto-proxy creator
				and the advisor. Note that the actual bean names are not important;
				what matters is their class.
			</p><p>
				The bean definition of class
				<code class="classname">org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator</code>
				will automatically advise ("auto-proxy") all bean instances in the
				current factory based on matching advisor implementations. This class
				knows nothing about attributes, but relies on advisors' pointcuts
				matching. The pointcuts, however, do know about attributes.
			</p><p>
				Thus we simply need an AOP advisor that will provide declarative
				transaction management based on attributes.
			</p><p>
				It is possible to add arbitrary custom advisor implementations as
				well, and they will also be evaluated and applied automatically. (You
				can use advisors whose pointcuts match on criteria besides attributes in
				the same autoproxy configuration, if necessary.)
			</p><p>
				Finally, the <code class="literal">attributes</code> bean is the Commons
				Attributes Attributes implementation. Replace it with another
				implementation of the
				<code class="interfacename">org.springframework.metadata.Attributes</code>
				interface to source attributes from a different source.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="metadata-tx"></a>25.5.2.&nbsp;Declarative transaction management</h3></div></div></div><p>
				The most common use of source-level attributes is to provide
				declarative transaction management. Once the bean definitions
				shown above are in place, you can define any number of application
				objects requiring declarative transactions. Only those classes or
				methods with transaction attributes will be given transaction advice.
				You need to do nothing except define the required transaction
				attributes.
			</p><p>Please note that you can specify transaction attributes at either class
			or method level. Class-level attributes, if specified, will be "inherited"
			by all methods whereas method attributes will wholly override any
			class-level attributes.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="metadata-pool"></a>25.5.3.&nbsp;Pooling</h3></div></div></div><p>You can also enable pooling behavior via class-level attributes. Spring
			can apply this behavior to any POJO. You simply need to specify a pooling
			attribute, as follows, in the business object to be pooled:</p><pre class="programlisting"> /** 
 * @@org.springframework.aop.framework.autoproxy.target.PoolingAttribute(10)
 */
public class MyClass {</pre><p>
				You'll need the usual autoproxy
				infrastructure configuration. You then need to specify a pooling
				<code class="interfacename">TargetSourceCreator</code>, as follows. Because pooling
				affects the creation of the target, we can't use a regular advice. Note
				that pooling will apply even if there are no advisors applicable to the
				class, if that class has a pooling attribute.
			</p><pre class="programlisting">&lt;bean id="poolingTargetSourceCreator"
  class="org.springframework.aop.framework.autoproxy.metadata.AttributesPoolingTargetSourceCreator"&gt;
  &lt;property name="attributes" ref="attributes" /&gt;
&lt;/bean&gt;</pre><p>
				The relevant autoproxy bean definition needs to specify a list of
				"custom target source creators", including the Pooling target source
				creator. We could modify the example shown above to include this
				property as follows:
			</p><pre class="programlisting">&lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"&gt;
  &lt;property name="customTargetSourceCreators"&gt;
    &lt;list&gt;
      &lt;ref bean="poolingTargetSourceCreator" /&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>
				As with the use of metadata in Spring in general, this is a
				one-off cost: once setup is out of the way, it's very easy to use
				pooling for additional business objects.
			</p><p class="remark"><i><span class="remark">
				It's arguable that the need for pooling is rare, so there's
				seldom a need to apply pooling to a large number of business objects.
				Hence this feature does not appear to be used often.
			</span></i></p><p>
				Please see the Javadoc for the
				<code class="literal">org.springframework.aop.framework.autoproxy</code> package
				for more details. It's possible to use a different pooling
				implementation than Commons Pool with minimal custom coding.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="metadata-arbitrary"></a>25.5.4.&nbsp;Custom metadata</h3></div></div></div><p>
				We can even go beyond the capabilities of .NET metadata
				attributes, because of the flexibility of the underlying autoproxying
				infrastructure.
			</p><p>
				We can define custom attributes, to provide any kind of
				declarative behavior. To do this, you need to:
			</p><div class="itemizedlist"><ul type="disc"><li><p>Define your custom attribute class.</p></li><li><p>
						Define a Spring AOP <code class="interfacename">Advisor</code> with a
						pointcut that fires on the presence of this custom attribute.
					</p></li><li><p>
						Add that <code class="interfacename">Advisor</code> as a bean definition
						to an application context with the generic autoproxy infrastructure
						in place.
					</p></li><li><p>Add attributes to your POJOs.</p></li></ul></div><p>
				There are several potential areas you might want to do this, such
				as custom declarative security, or possibly caching.
			</p><p class="remark"><i><span class="remark">
				This is a powerful mechanism which can significantly reduce
				configuration effort in some projects. However, remember that it does
				rely on AOP under the covers. The more advisors you have in play, the
				more complex your runtime configuration will be.
			</span></i></p><p class="remark"><i><span class="remark">
				(If you want to see what advice applies to any object, try
				casting a reference to
				<code class="interfacename">org.springframework.aop.framework.Advised</code>. This
				will enable you to examine the advisors.)
			</span></i></p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="metadata-attributes-mvc"></a>25.6.&nbsp;Using attributes to minimize MVC web tier configuration</h2></div></div></div><p>
			The other main use of Spring metadata as of 1.0 is to provide an
			option to simplify Spring MVC web configuration.
		</p><p>
			Spring MVC offers flexible <span class="emphasis"><em>handler mappings</em></span>:
			mappings of incoming request to controller (or other handler) instance.
			Normally handler mappings are configured in the
			<code class="literal">xxxx-servlet.xml</code> file for the relevant Spring
			<code class="classname">DispatcherServlet</code>.
		</p><p>
			Holding these mappings in the <code class="classname">DispatcherServlet</code>
			configuration file is normally A Good Thing. It provides maximum flexibility.
			In particular:
		</p><div class="itemizedlist"><ul type="disc"><li><p>
					The controller instance is explicitly managed by Spring IoC,
					through an XML bean definition.
				</p></li><li><p>
					The mapping is external to the controller, so the same
					controller instance could be given multiple mappings in
					the same <code class="classname">DispatcherServlet</code> context
					or reused in a different configuration.
				</p></li><li><p>
					Spring MVC is able to support mappings based on any criteria,
					rather than merely the request URL-to-controller mappings available
					in most other frameworks.
				</p></li></ul></div><p>
			However, this does mean that for each controller we typically need
			both a handler mapping (normally in a handler mapping XML bean definition)
			and an XML mapping for the controller itself.
		</p><p>
			Spring offers a simpler approach based on source-level attributes,
			which is an attractive option in simpler scenarios.
		</p><p class="remark"><i><span class="remark">
			The approach described in this section is best suited to
			relatively simple MVC scenarios. It sacrifices some of the power of Spring
			MVC, such as the ability to use the same controller with different
			mappings, and the ability to base mappings on something other than request
			URL.
		</span></i></p><p>
			In this approach, controllers are marked with one or more
			class-level metadata attributes, each specifying one URL they should be
			mapped to.
		</p><p>
			The following examples show the approach. In each case, we have a
			controller that depends on a business object of type
			<code class="interfacename">Cruncher</code>. As usual,
			this dependency will be resolved by Dependency Injection. The
			<code class="interfacename">Cruncher</code>
			must be available through a bean definition in the relevant
			<code class="classname">DispatcherServlet</code> XML file, or a parent context.
		</p><p>
			We attach an attribute to the controller class specifying the URL
			that should map to it. We can express the dependency through a JavaBean
			property or a constructor argument. This dependency must be resolvable by
			autowiring: that is, there must be exactly one business object of type
			<code class="interfacename">Cruncher</code> available in the context.
		</p><pre class="programlisting">/**
 * Normal comments here
 *
 * @@org.springframework.web.servlet.handler.metadata.PathMap("/bar.cgi")
 */
public class BarController extends AbstractController {

    private Cruncher cruncher;

    public void setCruncher(Cruncher cruncher) {
        this.cruncher = cruncher;
    }

    protected ModelAndView handleRequestInternal (
            HttpServletRequest request, HttpServletResponse response) throws Exception {
        System.out.println("Bar Crunching c and d =" + cruncher.concatenate("c", "d"));
        return new ModelAndView("test");
    }
}</pre><p>
			For this auto-mapping to work, we need to add the following to the
			relevant <code class="literal">xxxx-servlet.xml</code> file, specifying the
			attributes handler mapping. This special handler mapping can handle any
			number of controllers with attributes as shown above. The bean id
			("commonsAttributesHandlerMapping") is not important. The type is what
			matters:
		</p><pre class="programlisting">&lt;bean id="commonsAttributesHandlerMapping"      
    class="org.springframework.web.servlet.handler.metadata.CommonsPathMapHandlerMapping"/&gt;</pre><p>
			We <span class="emphasis"><em>do not </em></span>currently need an Attributes bean
			definition, as in the above example, because this class works directly
			with the Commons Attributes API, not via the Spring metadata
			abstraction.
		</p><p>
			We now need no XML configuration for each controller. Controllers
			are automatically mapped to the specified URL(s). Controllers benefit from
			IoC, using Spring's autowiring capability. For example, the dependency
			expressed in the "cruncher" bean property of the simple controller shown
			above is automatically resolved in the current web application context.
			Both Setter and Constructor Dependency Injection are available, each with
			zero configuration.
		</p><p>
			An example of Constructor Injection, also showing multiple URL paths:
		</p><pre class="programlisting">/**
 * Normal comments here
 *
 * @@org.springframework.web.servlet.handler.metadata.PathMap("/foo.cgi")
 * @@org.springframework.web.servlet.handler.metadata.PathMap("/baz.cgi")
 */
public class FooController extends AbstractController {

    private Cruncher cruncher;

    public FooController(Cruncher cruncher) {
        this.cruncher = cruncher;
    }

    protected ModelAndView handleRequestInternal (
            HttpServletRequest request, HttpServletResponse response) throws Exception {
        return new ModelAndView("test");
    }
}</pre><p>This approach has the following benefits:</p><div class="itemizedlist"><ul type="disc"><li><p>
					Significantly reduced volume of configuration. Each time we add
					a controller we need add <span class="emphasis"><em>no</em></span> XML configuration.
					As with attribute-driven transaction management, once the basic
					infrastructure is in place, it is very easy to add more application
					classes.
				</p></li><li><p>
					We retain much of the power of Spring IoC to configure controllers.
				</p></li></ul></div><p>
			This approach has the following limitations:
		</p><div class="itemizedlist"><ul type="disc"><li><p>
					One-off cost in a more complex build process. We need an attribute
					compilation step and an attribute indexing step. However, once in
					place, this should not be an issue.
				</p></li><li><p>
					Currently Commons Attributes only, although support for other
					attribute providers may be added in future.
				</p></li><li><p>
					Only "autowiring by type" dependency injection is supported for
					such controllers. However, this still leaves them far in advance of
					Struts Actions (with no IoC support from the framework) and, arguably,
					WebWork Actions (with only rudimentary IoC support) where IoC is
					concerned.
				</p></li><li><p>
					Reliance on automagical IoC resolution may be confusing.
				</p></li></ul></div><p>
			Because autowiring by type means there must be exactly one
			dependency of the specified type, we need to be careful if we use AOP. In
			the common case using <code class="classname">TransactionProxyFactoryBean</code>,
			for example, we end up with <span class="emphasis"><em>two</em></span> implementations of a
			business interface such as <code class="interfacename">Cruncher</code>: the
			original POJO definition, and the transactional AOP
			proxy. This won't work, as the owning application context can't resolve
			the type dependency unambiguously. The solution is to use AOP
			autoproxying, setting up the autoproxy infrastructure so that there is
			only one implementation of <code class="interfacename">Cruncher</code> defined,
			and that implementation is
			automatically advised. Thus this approach works well with
			attribute-targeted declarative services as described above. As the
			attributes compilation process must be in place to handle the web
			controller targeting, this is easy to set up.
		</p><p>
			Unlike other metadata functionality, there is currently only a
			Commons Attributes implementation available:
			<code class="classname">org.springframework.web.servlet.handler.metadata.CommonsPathMapHandlerMapping.</code>
			This limitation is due to the fact that not only do we need attribute
			compilation, we need attribute <span class="emphasis"><em>indexing</em></span>: the ability
			to ask the attributes API for all classes with the <code class="literal">PathMap</code> attribute.
			Indexing is not currently offered on the
			<code class="classname">org.springframework.metadata.Attributes</code> abstraction
			interface, although it may be in future. (If you want to add support for
			another attributes implementation - which must support indexing - you can
			easily extend the <code class="classname">AbstractPathMapHandlerMapping</code>
			superclass of <code class="classname">CommonsPathMapHandlerMapping</code>,
			implementing the two <code class="literal">protected</code> <code class="literal">abstract</code>
			methods to use your preferred attributes API.)
		</p><p>
			In summary, we need two additional steps in the build process: attribute
			compilation and attribute indexing. Use of the attribute indexer task was
			shown above. Note that Commons Attributes presently requires a jar file as
			input to indexing.
		</p></div></div></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="spring-samples"></a>Part&nbsp;V.&nbsp;Sample applications</h1></div></div></div><div class="partintro" lang="en"><div></div><p>
				This final part of the reference documentation covers
				the sample applications that come with the Spring Framework
				distribution.
			</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="showcases"></a>Chapter&nbsp;26.&nbsp;Showcase applications</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="showcases-introduction"></a>26.1.&nbsp;Introduction</h2></div></div></div><p>
			The Spring Framework distribution also ships with a number of so-called
			<span class="emphasis"><em>showcase</em></span> applications. Each showcase application provides
			fully working examples, focused on demonstrating exactly one new Spring 2.0 feature
			at a time. The idea is that you can take the code in these showcases and experiment
			with it, as opposed to having to create your own small project to test out new Spring
			2.0 features. The scope of these showcase applications is deliberately limited; the
			domain model (if there even is one) consists of maybe one or two classes, and typical
			enterprise concerns such as security, error-checking, and transactional integrity are
			omitted deliberately.
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="showcases-dynamvc"></a>26.2.&nbsp;Spring MVC Controllers implemented in a dynamic language</h2></div></div></div><p>
		This small application showcases implementing Spring MVC Controllers
		using the dynamic language support introduced in Spring 2.0.
	</p><p>
		The web application is <span class="emphasis"><em>very</em></span> simplistic, because the
		intent is to convey the basics of the dynamic language support as applied to
		Spring MVC and pretty much nothing else.
	</p><p>
		There is one Groovy file in the application. It is called
		'FortuneController.groovy' and it is located in the 'war/WEB-INF/groovy'
		folder. This Groovy script file is referenced by the 'fortune'
		bean in the 'war/WEB-INF/fortune-servlet.xml' Spring MVC configuration file.
	</p><p>
		You will notice that the 'fortune' bean is set as refreshable via the use
		of the 'refresh-check-delay' attribute on the &lt;lang:groovy/&gt; element. The
		value of this attribute is set to '3000' which means that changes to the
		'FortuneController.groovy' file will be picked up after a delay of 3 seconds.
	</p><p>
		If you deploy the application to Tomcat (for example), you can then go into
		the exploded '/WEB-INF/groovy' folder and edit the 'FortuneController.groovy'
		file directly. Any such changes that you make will be picked up automatically
		and the 'fortune' bean will be reconfigured... all without having to stop,
		redeploy and restart the application. Try it yourself... now admittedly
		there is not a lot of complex logic in the 'FortuneController.groovy' file
		(which is good because Controllers in Spring MVC should be as thin as possible).
	</p><p>
		You could try returning a default Fortune instead of delegating to the injected
		FortuneService, or you could return a different logical view name, or
		(if you are feeling more ambitious) you could try creating a custom
		Groovy implementation of the FortuneService interface and try plugging that into
		the web application. Perhaps your custom Groovy FortuneService could access
		a web service to get some Fortunes, or apply some different randomizing logic
		to the returned Fortune, or whatever. The key point is that you will be able to make
		these changes without having to redeploy (or bounce) your application. This is
		a great boon with regard to rapid prototyping.
	</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="showcases-dynamvc-build"></a>26.2.1.&nbsp;Build and deployment</h3></div></div></div><p>
			The <span class="emphasis"><em>samples/showcases/dynamvc</em></span> directory contains the web-app
			source. For deployment, it needs to be built with Apache Ant. The only requirements
			are JDK &gt;=1.4 (it is Groovy that requires at a minimum JDK 1.4) and Ant &gt;=1.5.
		</p><p>
			Run "build.bat" in this directory for available targets (e.g. "build.bat build",
			"build.bat warfile"). Note that to start Ant this way, you'll need an XML parser
			in your classpath (e.g. in "%JAVA_HOME%/jre/lib/ext"; included in JDK 1.4). You can
			use "warfile.bat" as a shortcut for WAR file creation. The WAR file will be created
			in the "dist" directory.
		</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="showcases-java5-dao"></a>26.3.&nbsp;Implementing DAOs using <code class="classname">SimpleJdbcTemplate</code> and <code class="interfacename">@Repository</code>
	</h2></div></div></div><p>
		This small project showcases using some of the Java5 features in Spring to implement DAOs with Hibernate and
		JDBC. This project is <span class="emphasis"><em>very</em></span> simplistic, because the intent is to convey the basics of
		using the <code class="classname">SimpleJdbcTemplate</code> and the <code class="interfacename">@Repository</code>
		annotation and several other DAO-related features, but nothing else.
	</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="showcases-java5-dao-the-domain"></a>26.3.1.&nbsp;The domain</h3></div></div></div><p>The domain in this sample application concerns itself with car parts.
			There are two domain classes: <code class="classname">Part</code> and <code class="classname">CarModel</code>.
			Using a <code class="interfacename">CarPartsInventory</code> car plants for example will
			be able to query for parts, update the stock of certain parts and add new parts.
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="showcases-java5-dao-the-daos"></a>26.3.2.&nbsp;The data access objects</h3></div></div></div><p>
			Based on a <code class="interfacename">CarPartsInventory</code> interface there are 3 DAO implementations, each using
			a different style. Two are using Hibernate and the other is using JDBC.
			The <code class="classname">JdbcCarPartsInventoryImpl</code> uses JDBC and the <code class="classname">SimpleJdbcTemplate</code>.
			If you look closely at this DAO you will see that the Java5 features the
			<code class="classname">SimpleJdbcTemplate</code> uses significantly clean up your data access code.
		</p><p>
			The <code class="classname">TemplateHibernateCarPartsInventoryImpl</code>
			uses the <code class="classname">HibernateTemplate</code> to query for Parts and update part stock. This is
			nothing out of the ordinary if you're used to programming using Spring and Hibernate.
			The <code class="literal">PlainHibernateCarPartsInventoryImpl</code>
			however does not use the <code class="classname">HibernateTemplate</code> anymore. It uses the plain Hibernate3 API to query the
			session and the database for parts. Of course, the Hibernate3 API does not throw
			Spring <code class="exceptionname">DataAccessExceptions</code> while this was originally one of the reasons to
			start using the <code class="classname">HibernateTemplate</code>. Spring 2.0 however adds an annotation
			that still allows you to get the same behavior. The <code class="interfacename">@Repository</code> annotation (if you look
			carefully at the <code class="classname">PlainHibernateCarPartsInventoryImpl</code>, you'll see it's marked as such)
			in combination with the <code class="classname">PersistenceExceptionTranslatorPostProcessor</code> automatically take
			care of translation Hibernate exception into Spring <code class="classname">DataAccessExceptions</code>.
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="showcases-java5-dao-build"></a>26.3.3.&nbsp;Build</h3></div></div></div><p>
			The <span class="emphasis"><em>samples/showcases/java5-dao</em></span> directory contains the project's source.
			The project only contains unit tests that you can look at apart from the source code. To build and
			run the unit tests, you need to build with Apache Ant (or run the sample in your favorite IDE).
			Run <code class="literal">ant tests</code> using a Java5 VM (the project uses annotations and generics)
		</p></div></div></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xsd-config"></a>Appendix&nbsp;A.&nbsp;XML Schema-based configuration</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xsd-config-introduction"></a>A.1.&nbsp;Introduction</h2></div></div></div><p>This appendix details the XML Schema-based configuration introduced in Spring 2.0.</p><div class="sidebar"><p class="title"><b>DTD support?</b></p><p>Authoring Spring configuration files using the older DTD style
            is still fully supported.</p><p>Nothing will break if you forego the use of the new XML Schema-based
            approach to authoring Spring XML configuration files. All that you lose
            out on is the opportunity to have more succinct and clearer configuration.
            Regardless of whether the XML configuration is DTD- or Schema-based, in the end
            it all boils down to the same object model in the container (namely one or
            more <code class="interfacename">BeanDefinition</code> instances).</p></div><p>The central motivation for moving to XML Schema based configuration files was
        to make Spring XML configuration easier. The <span class="emphasis"><em>'classic'</em></span>
        <code class="literal">&lt;bean/&gt;</code>-based approach is good, but its generic-nature comes
        with a price in terms of configuration overhead.</p><p>From the Spring IoC containers point-of-view, <span class="emphasis"><em>everything</em></span>
        is a bean. That's great news for the Spring IoC container, because if everything is
        a bean then everything can be treated in the exact same fashion. The same, however,
        is not true from a developer's point-of-view. The objects defined in a Spring
        XML configuration file are not all generic, vanilla beans. Usually, each bean requires
        some degree of specific configuration.</p><p>Spring 2.0's new XML Schema-based configuration addresses this issue.
        The <code class="literal">&lt;bean/&gt;</code> element is still present, and if you
        wanted to, you could continue to write the <span class="emphasis"><em>exact same</em></span>
        style of Spring XML configuration using only <code class="literal">&lt;bean/&gt;</code>
        elements. The new XML Schema-based configuration does, however, make
        Spring XML configuration files substantially clearer to read. In addition, it allows
        you to express the intent of a bean definition.</p><p>The key thing to remember is that the new custom tags work best for infrastructure
        or integration beans: for example, AOP, collections, transactions, integration with
        3rd-party frameworks such as Mule, etc., while the existing bean tags are best suited to
        application-specific beans, such as DAOs, service layer objects, validators, etc.</p><p>The examples included below will hopefully convince you that the inclusion
        of XML Schema support in Spring 2.0 was a good idea. The reception in the community
        has been encouraging; also, please note the fact that this new configuration mechanism
        is totally customisable and extensible. This means you can write your own domain-specific
        configuration tags that would better represent your application's domain; the process
        involved in doing so is covered in the appendix entitled <a href="#extensible-xml" title="Appendix&nbsp;B.&nbsp;Extensible XML authoring">Appendix&nbsp;B, <i>Extensible XML authoring</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xsd-config-body"></a>A.2.&nbsp;XML Schema-based configuration</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-referencing"></a>A.2.1.&nbsp;Referencing the schemas</h3></div></div></div><p>To switch over from the DTD-style to the new XML Schema-style, you need
            to make the following change.</p><pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN"
    "http://www.springframework.org/dtd/spring-beans-2.0.dtd"&gt;

&lt;beans&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- <code class="literal">&lt;bean/&gt;</code> definitions here --&gt;</span></em>

&lt;/beans&gt;</pre><p>The equivalent file in the XML Schema-style would be...</p><pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd"&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- <code class="literal">&lt;bean/&gt;</code> definitions here --&gt;</span></em>

&lt;/beans&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">'xsi:schemaLocation'</code> fragment is not actually required,
                but can be included to reference a local copy of a schema (which can be useful
                during development).</p></td></tr></table></div><p>The above Spring XML configuration fragment is boilerplate that you can copy and paste
            (!) and then plug <code class="literal">&lt;bean/&gt;</code> definitions into like you have always
            done. However, the entire point of switching over is to
            take advantage of the new Spring 2.0 XML tags since they make configuration easier. The
            section entitled <a href="#xsd-config-body-schemas-util" title="A.2.2.&nbsp;The util schema">Section&nbsp;A.2.2, &#8220;The <code class="literal">util</code> schema&#8221;</a> demonstrates how you can
            start immediately by using some of the more common utility tags.</p></div><p>The rest of this chapter is devoted to showing examples of the new Spring XML Schema
        based configuration, with at least one example for every new tag. The format follows
        a before and after style, with a <span class="emphasis"><em>before</em></span> snippet of XML showing
        the old (but still 100% legal and supported) style, followed immediately
        by an <span class="emphasis"><em>after</em></span> example showing the equivalent in the new XML Schema-based
        style.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-util"></a>A.2.2.&nbsp;The <code class="literal">util</code> schema</h3></div></div></div><p>First up is coverage of the <code class="literal">util</code> tags. As the name
            implies, the <code class="literal">util</code> tags deal with common, <span class="emphasis"><em>utility</em></span>
            configuration issues, such as configuring collections, referencing constants,
            and suchlike.</p><p>To use the tags in the <code class="literal">util</code> schema, you need to have
            the following preamble at the top of your Spring XML configuration file;
            the emboldened text in the snippet below references the correct schema so that
            the tags in the <code class="literal">util</code> namespace are available to you.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       <span class="bold"><strong>xmlns:util="http://www.springframework.org/schema/util"</strong></span>
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
<span class="bold"><strong>http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd"</strong></span>&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- <code class="literal">&lt;bean/&gt;</code> definitions here --&gt;</span></em>

&lt;/beans&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-util-constant"></a>A.2.2.1.&nbsp;<code class="literal">&lt;util:constant/&gt;</code></h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;bean id="..." class="..."&gt;
  &lt;property name="isolation"&gt;
    &lt;bean id="java.sql.Connection.TRANSACTION_SERIALIZABLE"
    class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean" /&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>The above configuration uses a Spring <code class="interfacename">FactoryBean</code>
                implementation, the <code class="classname">FieldRetrievingFactoryBean</code>, to
                set the value of the <code class="literal">'isolation'</code> property on a bean
                to the value of the <code class="literal">'java.sql.Connection.TRANSACTION_SERIALIZABLE'</code>
                constant. This is all well and good, but it is a tad verbose and (unneccessarily)
                exposes Spring's internal plumbing to the end user.
                </p><p>The following XML Schema-based version is more concise
                and clearly expresses the developer's intent (<span class="emphasis"><em>'inject this constant
                value'</em></span>), and it just reads better.
                </p><pre class="programlisting">&lt;bean id="..." class="..."&gt;
  &lt;property name="isolation"&gt;
    &lt;util:constant static-field="java.sql.Connection.TRANSACTION_SERIALIZABLE"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="xsd-config-body-schemas-util-frfb"></a>A.2.2.1.1.&nbsp;Setting a bean property or constructor arg from a field value</h5></div></div></div><p>
			            <a href="http://www.springframework.org/docs/api/org/springframework/beans/factory/config/FieldRetrievingFactoryBean.html" target="_top"><code class="classname">FieldRetrievingFactoryBean</code></a>
			            is a <code class="interfacename">FactoryBean</code> which retrieves a
			            <code class="literal">static</code> or non-static field value. It is typically
			            used for retrieving <code class="literal">public</code> <code class="literal">static</code>
			            <code class="literal">final</code> constants, which may then be used to set a
			            property value or constructor arg for another bean.
		            </p><p>
			            Find below an example which shows how a <code class="literal">static</code> field is exposed, by
			            using the <a href="http://www.springframework.org/docs/api/org/springframework/beans/factory/config/FieldRetrievingFactoryBean.html#setStaticField(java.lang.String)" target="_top"><code class="literal">staticField</code></a>
			            property:
		            </p><pre class="programlisting">&lt;bean id="myField"
        class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean"&gt;
  &lt;property name="staticField" value="java.sql.Connection.TRANSACTION_SERIALIZABLE"/&gt;
&lt;/bean&gt;</pre><p>There is also a convenience usage form where the <code class="literal">static</code>
                    field is specified as the bean name:</p><pre class="programlisting">&lt;bean id="java.sql.Connection.TRANSACTION_SERIALIZABLE"
    class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean"/&gt;</pre><p>
			            This does mean that there is no longer any choice in what the bean id is (so
			            any other bean that refers to it will also have to use this longer name),
			            but this form is very concise to define, and very convenient to use as an
			            inner bean since the id doesn't have to be specified for the bean
			            reference:
		            </p><pre class="programlisting">&lt;bean id="..." class="..."&gt;
  &lt;property name="isolation"&gt;
    &lt;bean id="java.sql.Connection.TRANSACTION_SERIALIZABLE"
          class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean" /&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>
			            It is also possible to access a non-static (instance) field of another bean,
			            as described in the API documentation for the 
			            <a href="http://www.springframework.org/docs/api/org/springframework/beans/factory/config/FieldRetrievingFactoryBean.html" target="_top"><code class="classname">FieldRetrievingFactoryBean</code></a>
			            class.
		            </p><p>
			            Injecting enum values into beans as either property or constructor arguments is very
			            easy to do in Spring, in that you don't actually have to <span class="emphasis"><em>do</em></span>
			            anything or know anything about the Spring internals (or even about classes such
			            as the <code class="classname">FieldRetrievingFactoryBean</code>). Let's look at an example
			            to see how easy injecting an enum value is; consider this JDK 5 enum:
		            </p><pre class="programlisting">package javax.persistence;
     
public enum PersistenceContextType {

    TRANSACTION,
    EXTENDED

}</pre><p>Now consider a setter of type <code class="classname">PersistenceContextType</code>:</p><pre class="programlisting">package example;

public class Client {

    private PersistenceContextType persistenceContextType;

    public void setPersistenceContextType(PersistenceContextType type) { 
        this.persistenceContextType = type;
    }
}</pre><p>.. and the corresponding bean definition:</p><pre class="programlisting">&lt;bean class="example.Client"&gt;
    &lt;property name="persistenceContextType" value="TRANSACTION" /&gt;
&lt;/bean&gt;</pre><p>
			            This works for classic type-safe emulated enums (on JDK 1.4 and JDK 1.3) as well;
			            Spring will automatically attempt to match the string property value to a constant
			            on the enum class.
		            </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-util-property-path"></a>A.2.2.2.&nbsp;<code class="literal">&lt;util:property-path/&gt;</code></h4></div></div></div><p>Before...</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- target bean to be referenced by name --&gt;</span></em>
&lt;bean id="testBean" class="org.springframework.beans.TestBean" scope="prototype"&gt;
  &lt;property name="age" value="10"/&gt;
  &lt;property name="spouse"&gt;
    &lt;bean class="org.springframework.beans.TestBean"&gt;
      &lt;property name="age" value="11"/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- will result in 10, which is the value of property 'age' of bean 'testBean' --&gt;</span></em>
&lt;bean id="testBean.age" class="org.springframework.beans.factory.config.PropertyPathFactoryBean"/&gt;</pre><p>The above configuration uses a Spring <code class="interfacename">FactoryBean</code>
                implementation, the <code class="classname">PropertyPathFactoryBean</code>, to
                create a bean (of type <code class="classname">int</code>) called
                <code class="literal">'testBean.age'</code> that has a value equal to the <code class="literal">'age'</code>
                property of the <code class="literal">'testBean'</code> bean.
                </p><p>After...</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- target bean to be referenced by name --&gt;</span></em>
&lt;bean id="testBean" class="org.springframework.beans.TestBean" scope="prototype"&gt;
  &lt;property name="age" value="10"/&gt;
  &lt;property name="spouse"&gt;
    &lt;bean class="org.springframework.beans.TestBean"&gt;
      &lt;property name="age" value="11"/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- will result in 10, which is the value of property 'age' of bean 'testBean' --&gt;</span></em>
&lt;util:property-path id="name" path="testBean.age"/&gt;</pre><p>The value of the <code class="literal">'path'</code> attribute of the
                <code class="literal">&lt;property-path/&gt;</code> tag follows the form <code class="literal">'beanName.beanProperty'</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="xsd-config-body-schemas-util-property-path-dependency"></a>A.2.2.2.1.&nbsp;Using <code class="literal">&lt;util:property-path/&gt;</code> to set a bean property or constructor-argument</h5></div></div></div><p><code class="classname">PropertyPathFactoryBean</code> is a
			        <code class="interfacename">FactoryBean</code> that evaluates a property path on a given
			        target object. The target object can be specified directly or via a bean
			        name. This value may then be used in another bean definition as a property
			        value or constructor argument.</p><p>Here's an example where a path is used against another bean, by name:</p><pre class="programlisting">// target bean to be referenced by name
&lt;bean id="person" class="org.springframework.beans.TestBean" scope="prototype"&gt;
  &lt;property name="age" value="10"/&gt;
  &lt;property name="spouse"&gt;
    &lt;bean class="org.springframework.beans.TestBean"&gt;
      &lt;property name="age" value="11"/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;

<em class="lineannotation"><span class="lineannotation">// will result in 11, which is the value of property 'spouse.age' of bean 'person'</span></em>
&lt;bean id="theAge"
    class="org.springframework.beans.factory.config.PropertyPathFactoryBean"&gt;
  &lt;property name="targetBeanName" value="person"/&gt;
  &lt;property name="propertyPath" value="spouse.age"/&gt;
&lt;/bean&gt;</pre><p>In this example, a path is evaluated against an inner bean:</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- will result in 12, which is the value of property 'age' of the inner bean --&gt;</span></em>
&lt;bean id="theAge"
    class="org.springframework.beans.factory.config.PropertyPathFactoryBean"&gt;
  &lt;property name="targetObject"&gt;
    &lt;bean class="org.springframework.beans.TestBean"&gt;
      &lt;property name="age" value="12"/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
  &lt;property name="propertyPath" value="age"/&gt;
&lt;/bean&gt;</pre><p>There is also a shortcut form, where the bean name is the property path.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- will result in 10, which is the value of property 'age' of bean 'person' --&gt;</span></em>
&lt;bean id="person.age"
    class="org.springframework.beans.factory.config.PropertyPathFactoryBean"/&gt;</pre><p>This form does mean that there is no choice in the name of the bean.
		            Any reference to it will also have to use the same id, which is the path.
		            Of course, if used as an inner bean, there is no need to refer to it at
		            all:</p><pre class="programlisting">&lt;bean id="..." class="..."&gt;
  &lt;property name="age"&gt;
    &lt;bean id="person.age"
        class="org.springframework.beans.factory.config.PropertyPathFactoryBean"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>The result type may be specifically set in the actual definition.
			        This is not necessary for most use cases, but can be of use for some.
			        Please see the Javadocs for more info on this feature.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-util-properties"></a>A.2.2.3.&nbsp;<code class="literal">&lt;util:properties/&gt;</code></h4></div></div></div><p>Before...</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- creates a <code class="classname">java.util.Properties</code> instance with values loaded from the supplied location --&gt;</span></em>
&lt;bean id="jdbcConfiguration" class="org.springframework.beans.factory.config.PropertiesFactoryBean"&gt;
  &lt;property name="location" value="classpath:com/foo/jdbc-production.properties"/&gt;
&lt;/bean&gt;</pre><p>The above configuration uses a Spring <code class="interfacename">FactoryBean</code>
                implementation, the <code class="classname">PropertiesFactoryBean</code>, to
                instantiate a <code class="classname">java.util.Properties</code> instance with values loaded from
                the supplied <a href="#resources" title="Chapter&nbsp;4.&nbsp;Resources"><code class="interfacename">Resource</code></a> location).
                </p><p>After...</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- creates a <code class="classname">java.util.Properties</code> instance with values loaded from the supplied location --&gt;</span></em>
&lt;util:properties id="jdbcConfiguration" location="classpath:com/foo/jdbc-production.properties"/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-util-list"></a>A.2.2.4.&nbsp;<code class="literal">&lt;util:list/&gt;</code></h4></div></div></div><p>Before...</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- creates a <code class="classname">java.util.List</code> instance with values loaded from the supplied <code class="literal">'sourceList'</code> --&gt;</span></em>
&lt;bean id="emails" class="org.springframework.beans.factory.config.ListFactoryBean"&gt;
  &lt;property name="sourceList"&gt;
      &lt;list&gt;
        &lt;value&gt;pechorin@hero.org&lt;/value&gt;
        &lt;value&gt;raskolnikov@slums.org&lt;/value&gt;
        &lt;value&gt;stavrogin@gov.org&lt;/value&gt;
        &lt;value&gt;porfiry@gov.org&lt;/value&gt;
      &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>The above configuration uses a Spring <code class="interfacename">FactoryBean</code>
                implementation, the <code class="classname">ListFactoryBean</code>, to
                create a <code class="classname">java.util.List</code> instance initialized
                with values taken from the supplied <code class="literal">'sourceList'</code>.
                </p><p>After...</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- creates a <code class="classname">java.util.List</code> instance with values loaded from the supplied <code class="literal">'sourceList'</code> --&gt;</span></em>
&lt;util:list id="emails"&gt;
    &lt;value&gt;pechorin@hero.org&lt;/value&gt;
    &lt;value&gt;raskolnikov@slums.org&lt;/value&gt;
    &lt;value&gt;stavrogin@gov.org&lt;/value&gt;
    &lt;value&gt;porfiry@gov.org&lt;/value&gt;
&lt;/util:list&gt;</pre><p>You can also explicitly control the exact type of <code class="interfacename">List</code>
                that will be instantiated and populated via the use of the <code class="literal">'list-class'</code>
                attribute on the <code class="literal">&lt;util:list/&gt;</code> element. For example, if we
                really need a <code class="classname">java.util.LinkedList</code> to be instantiated, we could
                use the following configuration:</p><pre class="programlisting">&lt;util:list id="emails" list-class="java.util.LinkedList"&gt;
    &lt;value&gt;jackshaftoe@vagabond.org&lt;/value&gt;
    &lt;value&gt;eliza@thinkingmanscrumpet.org&lt;/value&gt;
    &lt;value&gt;vanhoek@pirate.org&lt;/value&gt;
    &lt;value&gt;d'Arcachon@nemesis.org&lt;/value&gt;
&lt;/util:list&gt;</pre><p>If no <code class="literal">'list-class'</code> attribute is supplied, a
                <code class="interfacename">List</code> implementation will be chosen by the container.</p><p>Finally, you can also control the merging behavior using the
                <code class="literal">'merge'</code> attribute of the <code class="literal">&lt;util:list/&gt;</code>
                element; collection merging is described in more detail in the section entitled
                <a href="#beans-collection-elements-merging" title="3.3.3.4.1.&nbsp;Collection merging">Section&nbsp;3.3.3.4.1, &#8220;Collection merging&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-util-map"></a>A.2.2.5.&nbsp;<code class="literal">&lt;util:map/&gt;</code></h4></div></div></div><p>Before...</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- creates a <code class="classname">java.util.Map</code> instance with values loaded from the supplied <code class="literal">'sourceMap'</code> --&gt;</span></em>
&lt;bean id="emails" class="org.springframework.beans.factory.config.MapFactoryBean"&gt;
  &lt;property name="sourceMap"&gt;
      &lt;map&gt;
        &lt;entry key="pechorin" value="pechorin@hero.org"/&gt;
        &lt;entry key="raskolnikov" value="raskolnikov@slums.org"/&gt;
        &lt;entry key="stavrogin" value="stavrogin@gov.org"/&gt;
        &lt;entry key="porfiry" value="porfiry@gov.org"/&gt;
      &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>The above configuration uses a Spring <code class="interfacename">FactoryBean</code>
                implementation, the <code class="classname">MapFactoryBean</code>, to
                create a <code class="classname">java.util.Map</code> instance initialized
                with key-value pairs taken from the supplied <code class="literal">'sourceMap'</code>.
                </p><p>After...</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- creates a <code class="classname">java.util.Map</code> instance with values loaded from the supplied <code class="literal">'sourceMap'</code> --&gt;</span></em>
&lt;util:map id="emails"&gt;
    &lt;entry key="pechorin" value="pechorin@hero.org"/&gt;
    &lt;entry key="raskolnikov" value="raskolnikov@slums.org"/&gt;
    &lt;entry key="stavrogin" value="stavrogin@gov.org"/&gt;
    &lt;entry key="porfiry" value="porfiry@gov.org"/&gt;
&lt;/util:map&gt;</pre><p>You can also explicitly control the exact type of <code class="interfacename">Map</code>
                that will be instantiated and populated via the use of the <code class="literal">'map-class'</code>
                attribute on the <code class="literal">&lt;util:map/&gt;</code> element. For example, if we
                really need a <code class="classname">java.util.TreeMap</code> to be instantiated, we could
                use the following configuration:</p><pre class="programlisting">&lt;util:map id="emails" map-class="java.util.TreeMap"&gt;
    &lt;entry key="pechorin" value="pechorin@hero.org"/&gt;
    &lt;entry key="raskolnikov" value="raskolnikov@slums.org"/&gt;
    &lt;entry key="stavrogin" value="stavrogin@gov.org"/&gt;
    &lt;entry key="porfiry" value="porfiry@gov.org"/&gt;
&lt;/util:map&gt;</pre><p>If no <code class="literal">'map-class'</code> attribute is supplied, a
                <code class="interfacename">Map</code> implementation will be chosen by the container.</p><p>Finally, you can also control the merging behavior using the
                <code class="literal">'merge'</code> attribute of the <code class="literal">&lt;util:map/&gt;</code>
                element; collection merging is described in more detail in the section entitled
                <a href="#beans-collection-elements-merging" title="3.3.3.4.1.&nbsp;Collection merging">Section&nbsp;3.3.3.4.1, &#8220;Collection merging&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-util-set"></a>A.2.2.6.&nbsp;<code class="literal">&lt;util:set/&gt;</code></h4></div></div></div><p>Before...</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- creates a <code class="classname">java.util.Set</code> instance with values loaded from the supplied <code class="literal">'sourceSet'</code> --&gt;</span></em>
&lt;bean id="emails" class="org.springframework.beans.factory.config.SetFactoryBean"&gt;
  &lt;property name="sourceSet"&gt;
      &lt;set&gt;
        &lt;value&gt;pechorin@hero.org&lt;/value&gt;
        &lt;value&gt;raskolnikov@slums.org&lt;/value&gt;
        &lt;value&gt;stavrogin@gov.org&lt;/value&gt;
        &lt;value&gt;porfiry@gov.org&lt;/value&gt;
      &lt;/set&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>The above configuration uses a Spring <code class="interfacename">FactoryBean</code>
                implementation, the <code class="classname">SetFactoryBean</code>, to
                create a <code class="classname">java.util.Set</code> instance initialized
                with values taken from the supplied <code class="literal">'sourceSet'</code>.
                </p><p>After...</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- creates a <code class="classname">java.util.Set</code> instance with values loaded from the supplied <code class="literal">'sourceSet'</code> --&gt;</span></em>
&lt;util:set id="emails"&gt;
    &lt;value&gt;pechorin@hero.org&lt;/value&gt;
    &lt;value&gt;raskolnikov@slums.org&lt;/value&gt;
    &lt;value&gt;stavrogin@gov.org&lt;/value&gt;
    &lt;value&gt;porfiry@gov.org&lt;/value&gt;
&lt;/util:set&gt;</pre><p>You can also explicitly control the exact type of <code class="interfacename">Set</code>
                that will be instantiated and populated via the use of the <code class="literal">'set-class'</code>
                attribute on the <code class="literal">&lt;util:set/&gt;</code> element. For example, if we
                really need a <code class="classname">java.util.TreeSet</code> to be instantiated, we could
                use the following configuration:</p><pre class="programlisting">&lt;util:set id="emails" set-class="java.util.TreeSet"&gt;
    &lt;value&gt;pechorin@hero.org&lt;/value&gt;
    &lt;value&gt;raskolnikov@slums.org&lt;/value&gt;
    &lt;value&gt;stavrogin@gov.org&lt;/value&gt;
    &lt;value&gt;porfiry@gov.org&lt;/value&gt;
&lt;/util:set&gt;</pre><p>If no <code class="literal">'set-class'</code> attribute is supplied, a
                <code class="interfacename">Set</code> implementation will be chosen by the container.</p><p>Finally, you can also control the merging behavior using the
                <code class="literal">'merge'</code> attribute of the <code class="literal">&lt;util:set/&gt;</code>
                element; collection merging is described in more detail in the section entitled
                <a href="#beans-collection-elements-merging" title="3.3.3.4.1.&nbsp;Collection merging">Section&nbsp;3.3.3.4.1, &#8220;Collection merging&#8221;</a>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-jee"></a>A.2.3.&nbsp;The <code class="literal">jee</code> schema</h3></div></div></div><p>The <code class="literal">jee</code> tags deal with JEE (Java Enterprise Edition)-related
            configuration issues, such as looking up a JNDI object and defining EJB references.</p><p>To use the tags in the <code class="literal">jee</code> schema, you need to have
            the following preamble at the top of your Spring XML configuration file;
            the emboldened text in the following snippet references the correct schema so that
            the tags in the <code class="literal">jee</code> namespace are available to you.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       <span class="bold"><strong>xmlns:jee="http://www.springframework.org/schema/jee"</strong></span>
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
<span class="bold"><strong>http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-2.0.xsd"</strong></span>&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- <code class="literal">&lt;bean/&gt;</code> definitions here --&gt;</span></em>

&lt;/beans&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-jndi-lookup"></a>A.2.3.1.&nbsp;<code class="literal">&lt;jee:jndi-lookup/&gt;</code> (simple)</h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;bean id="simple" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName" value="jdbc/MyDataSource"/&gt;
&lt;/bean&gt;</pre><p>After...</p><pre class="programlisting">&lt;jee:jndi-lookup id="simple" jndi-name="jdbc/MyDataSource"/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-jndi-lookup-environment-single"></a>A.2.3.2.&nbsp;<code class="literal">&lt;jee:jndi-lookup/&gt;</code> (with single JNDI environment setting)</h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;bean id="simple" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName" value="jdbc/MyDataSource"/&gt;
    &lt;property name="jndiEnvironment"&gt;
        &lt;props&gt;
            &lt;prop key="foo"&gt;bar&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>After...</p><pre class="programlisting">&lt;jee:jndi-lookup id="simple" jndi-name="jdbc/MyDataSource"&gt;
    &lt;jee:environment&gt;foo=bar&lt;/jee:environment&gt;
&lt;/jee:jndi-lookup&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-jndi-lookup-evironment-multiple"></a>A.2.3.3.&nbsp;<code class="literal">&lt;jee:jndi-lookup/&gt;</code> (with multiple JNDI environment settings)</h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;bean id="simple" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName" value="jdbc/MyDataSource"/&gt;
    &lt;property name="jndiEnvironment"&gt;
        &lt;props&gt;
            &lt;prop key="foo"&gt;bar&lt;/prop&gt;
            &lt;prop key="ping"&gt;pong&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>After...</p><pre class="programlisting">&lt;jee:jndi-lookup id="simple" jndi-name="jdbc/MyDataSource"&gt;
    <em class="lineannotation"><span class="lineannotation">&lt;!-- newline-separated, key-value pairs for the environment (standard <code class="classname">Properties</code> format) --&gt;</span></em>
    &lt;jee:environment&gt;
        foo=bar
        ping=pong
    &lt;/jee:environment&gt;
&lt;/jee:jndi-lookup&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-jndi-lookup-complex"></a>A.2.3.4.&nbsp;<code class="literal">&lt;jee:jndi-lookup/&gt;</code> (complex)</h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;bean id="simple" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName" value="jdbc/MyDataSource"/&gt;
    &lt;property name="cache" value="true"/&gt;
    &lt;property name="resourceRef" value="true"/&gt;
    &lt;property name="lookupOnStartup" value="false"/&gt;
    &lt;property name="expectedType" value="com.myapp.DefaultFoo"/&gt;
    &lt;property name="proxyInterface" value="com.myapp.Foo"/&gt;
&lt;/bean&gt;</pre><p>After...</p><pre class="programlisting">&lt;jee:jndi-lookup id="simple"
             jndi-name="jdbc/MyDataSource"
             cache="true"
             resource-ref="true"
             lookup-on-startup="false"
             expected-type="com.myapp.DefaultFoo"
             proxy-interface="com.myapp.Foo"/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-local-slsb"></a>A.2.3.5.&nbsp;<code class="literal">&lt;jee:local-slsb/&gt;</code> (simple)</h4></div></div></div><p>The <code class="literal">&lt;jee:local-slsb/&gt;</code> tag configures a
                reference to an EJB Stateless SessionBean.</p><p>Before...</p><pre class="programlisting">&lt;bean id="simple"
      class="org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean"&gt;
  &lt;property name="jndiName" value="ejb/RentalServiceBean"/&gt;
  &lt;property name="businessInterface" value="com.foo.service.RentalService"/&gt;
&lt;/bean&gt;</pre><p>After...</p><pre class="programlisting">&lt;jee:local-slsb id="simpleSlsb" jndi-name="ejb/RentalServiceBean"
    business-interface="com.foo.service.RentalService"/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-local-slsb-complex"></a>A.2.3.6.&nbsp;<code class="literal">&lt;jee:local-slsb/&gt;</code> (complex)</h4></div></div></div><pre class="programlisting">&lt;bean id="complexLocalEjb"
      class="org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean"&gt;
  &lt;property name="jndiName" value="ejb/RentalServiceBean"/&gt;
  &lt;property name="businessInterface" value="com.foo.service.RentalService"/&gt;
  &lt;property name="cacheHome" value="true"/&gt;
  &lt;property name="lookupHomeOnStartup" value="true"/&gt;
  &lt;property name="resourceRef" value="true"/&gt;
&lt;/bean&gt;</pre><p>After...</p><pre class="programlisting">&lt;jee:local-slsb id="complexLocalEjb"
    jndi-name="ejb/RentalServiceBean"
    business-interface="com.foo.service.RentalService"
    cache-home="true"
    lookup-home-on-startup="true"
    resource-ref="true"&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-remote-slsb"></a>A.2.3.7.&nbsp;<code class="literal">&lt;jee:remote-slsb/&gt;</code></h4></div></div></div><p>The <code class="literal">&lt;jee:remote-slsb/&gt;</code> tag configures a
                reference to a <code class="literal">remote</code> EJB Stateless SessionBean.</p><p>Before...</p><pre class="programlisting">&lt;bean id="complexRemoteEjb"
      class="org.springframework.ejb.access.SimpleRemoteStatelessSessionProxyFactoryBean"&gt;
  &lt;property name="jndiName" value="ejb/MyRemoteBean"/&gt;
  &lt;property name="businessInterface" value="com.foo.service.RentalService"/&gt;
  &lt;property name="cacheHome" value="true"/&gt;
  &lt;property name="lookupHomeOnStartup" value="true"/&gt;
  &lt;property name="resourceRef" value="true"/&gt;
  &lt;property name="homeInterface" value="com.foo.service.RentalService"/&gt;
  &lt;property name="refreshHomeOnConnectFailure" value="true"/&gt;
&lt;/bean&gt;</pre><p>After...</p><pre class="programlisting">&lt;jee:remote-slsb id="complexRemoteEjb"
    jndi-name="ejb/MyRemoteBean"
    business-interface="com.foo.service.RentalService"
    cache-home="true"
    lookup-home-on-startup="true"
    resource-ref="true"
    home-interface="com.foo.service.RentalService"
    refresh-home-on-connect-failure="true"&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-lang"></a>A.2.4.&nbsp;The <code class="literal">lang</code> schema</h3></div></div></div><p>The <code class="literal">lang</code> tags deal with exposing objects that have been
            written in a dynamic language such as JRuby or Groovy as beans in the Spring
            container.</p><p>These tags (and the dynamic language support) are comprehensively covered
            in the chapter entitled <a href="#dynamic-language" title="Chapter&nbsp;24.&nbsp;Dynamic language support">Chapter&nbsp;24, <i>Dynamic language support</i></a>. Please do consult that
            chapter for full details on this support and the <code class="literal">lang</code> tags
            themselves.</p><p>In the interest of completeness, to use the tags in the <code class="literal">lang</code>
            schema, you need to have the following preamble at the top of your Spring XML
            configuration file; the emboldened text in the following snippet references the
            correct schema so that the tags in the <code class="literal">lang</code> namespace are
            available to you.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       <span class="bold"><strong>xmlns:lang="http://www.springframework.org/schema/lang"</strong></span>
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
<span class="bold"><strong>http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang-2.0.xsd"</strong></span>&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- <code class="literal">&lt;bean/&gt;</code> definitions here --&gt;</span></em>

&lt;/beans&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-tx"></a>A.2.5.&nbsp;The <code class="literal">tx</code> (transaction) schema</h3></div></div></div><p>The <code class="literal">tx</code> tags deal with configuring all of those
            beans in Spring's comprehensive support for transactions. These tags are
            covered in the chapter entitled <a href="#transaction" title="Chapter&nbsp;9.&nbsp;Transaction management">Chapter&nbsp;9, <i>Transaction management</i></a>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You are strongly encouraged to look at the
                <code class="filename">'spring-tx-2.0.xsd'</code> file that ships with the Spring
                distribution. This file is (of course), the XML Schema for Spring's
                transaction configuration, and covers all of the various tags in the
                <code class="literal">tx</code> namespace, including attribute defaults and
                suchlike. This file is documented inline, and thus the information is
                not repeated here in the interests of adhering to the DRY (Don't Repeat
                Yourself) principle.</p></td></tr></table></div><p>In the interest of completeness, to use the tags in the <code class="literal">tx</code>
            schema, you need to have the following preamble at the top of your Spring XML
            configuration file; the emboldened text in the following snippet references the
            correct schema so that the tags in the <code class="literal">tx</code> namespace are
            available to you.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:aop="http://www.springframework.org/schema/aop"
	   <span class="bold"><strong>xmlns:tx="http://www.springframework.org/schema/tx"</strong></span>
	   xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
<span class="bold"><strong>http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd</strong></span>
http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- <code class="literal">&lt;bean/&gt;</code> definitions here --&gt;</span></em>

&lt;/beans&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Often when using the tags in the <code class="literal">tx</code> namespace you will also be using
                the tags from the <code class="literal">aop</code> namespace (since the declarative transaction support in Spring is implemented using
                AOP). The above XML snippet contains the relevant lines needed to reference the <code class="literal">aop</code> schema
                so that the tags in the <code class="literal">aop</code> namespace are available to you.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-aop"></a>A.2.6.&nbsp;The <code class="literal">aop</code> schema</h3></div></div></div><p>The <code class="literal">aop</code> tags deal with configuring all things
            AOP in Spring: this includes Spring's own proxy-based AOP framework and Spring's
            integration with the AspectJ AOP framework. These tags are
            comprehensively covered in the chapter entitled <a href="#aop" title="Chapter&nbsp;6.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;6, <i>Aspect Oriented Programming with Spring</i></a>.</p><p>In the interest of completeness, to use the tags in the <code class="literal">aop</code>
            schema, you need to have the following preamble at the top of your Spring XML
            configuration file; the emboldened text in the following snippet references the
            correct schema so that the tags in the <code class="literal">aop</code> namespace are
            available to you.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   <span class="bold"><strong>xmlns:aop="http://www.springframework.org/schema/aop"</strong></span>
	   xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
<span class="bold"><strong>http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"</strong></span>&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- <code class="literal">&lt;bean/&gt;</code> definitions here --&gt;</span></em>

&lt;/beans&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-tool"></a>A.2.7.&nbsp;The <code class="literal">tool</code> schema</h3></div></div></div><p>The <code class="literal">tool</code> tags are for use when you want to add
            tooling-specific metadata to your custom configuration elements. This metadata
            can then be consumed by tools that are aware of this metadata, and the tools can
            then do pretty much whatever they want with it (validation, etc.).</p><p>The <code class="literal">tool</code> tags are not documented in this release of
            Spring as they are currently undergoing review. If you are a third party tool
            vendor and you would like to contribute to this review process, then do mail
            the Spring mailing list. The currently supported <code class="literal">tool</code>
            tags can be found in the file <code class="literal">'spring-tool-2.0.xsd'</code> in the
            <code class="literal">'src/org/springframework/beans/factory/xml'</code> directory of the
            Spring source distribution.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-beans"></a>A.2.8.&nbsp;The <code class="literal">beans</code> schema</h3></div></div></div><p>Last but not least we have the tags in the <code class="literal">beans</code> schema.
            These are the same tags that have been in Spring since the very dawn of the framework.
            Examples of the various tags in the <code class="literal">beans</code> schema are not shown here
            because they are quite comprehensively covered in the section entitled <a href="#beans-factory-properties-detailed" title="3.3.3.&nbsp;Bean properties and constructor arguments detailed">Section&nbsp;3.3.3, &#8220;Bean properties and constructor arguments detailed&#8221;</a>
            (and indeed in that entire <a href="#beans" title="Chapter&nbsp;3.&nbsp;The IoC container">chapter</a>).</p><p>One thing that is new to the beans tags themselves in Spring 2.0 is the idea
            of arbitrary bean metadata. In Spring 2.0 it is now possible to add zero or more
            key / value pairs to <code class="literal">&lt;bean/&gt;</code> XML definitions. What, if
            anything, is done with this extra metadata is totally up to your own custom logic (and
            so is typically only of use if you are writing your own custom tags as described in
            the appendix entitled <a href="#extensible-xml" title="Appendix&nbsp;B.&nbsp;Extensible XML authoring">Appendix&nbsp;B, <i>Extensible XML authoring</i></a>).</p><p>Find below an example of the <code class="literal">&lt;meta/&gt;</code> tag in the context
            of a surrounding <code class="literal">&lt;bean/&gt;</code> (please note that without any logic
            to interpret it the metadata is effectively useless as-is).</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd"&gt;

    &lt;bean id="foo" class="x.y.Foo"&gt;
        <span class="bold"><strong>&lt;meta key="cacheName" value="foo"/&gt;</strong></span>
        &lt;property name="name" value="Rick"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre><p>In the case of the above example, you would assume that there is some
            logic that will consume the bean definition and set up some caching infrastructure
            using the supplied metadata.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xsd-config-setup"></a>A.3.&nbsp;Setting up your IDE</h2></div></div></div><p>This final section documents the steps involved in setting up a number of
        popular Java IDEs to effect the easier editing of Spring's XML Schema-based
        configuration files. If your favourite Java IDE or editor is not included in the
		list of documented IDEs, then please do
        <a href="http://opensource.atlassian.com/projects/spring/secure/Dashboard.jspa" target="_top">raise an issue</a>
        and an example with your favorite IDE/editor <span class="emphasis"><em>may</em></span> be included
		in the next release.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-setup-eclipse"></a>A.3.1.&nbsp;Setting up Eclipse</h3></div></div></div><div class="procedure"><p>The following steps illustrate setting up
            <a href="http://www.eclipse.org/" target="_top">Eclipse</a> to be XSD-aware. 
            The assumption in the following steps is that you already have an Eclipse
            project open (either a brand new project or an already existing one).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The following steps were created using Eclipse <span class="bold"><strong>3.2</strong></span>.
                The setup will probably be the same (or similar) on an earlier or later
                version of Eclipse.</p></td></tr></table></div><ol type="1"><li><p class="title"><b>Step One</b></p><p>Create a new XML file. You can name this file whatever you want. In the
                example below, the file is named <code class="literal">'context.xml'</code>.
                Copy and paste the following text into the file so that it matches the screenshot.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd"&gt;

&lt;/beans&gt;</pre><p>
			        </p><div class="mediaobject" align="center"><img src="images/eclipse-setup-1.png" align="middle"></div><p>
		        </p></li><li><p class="title"><b>Step Two</b></p><p>As can be seen in the above screenshot (unless you have a customised
                version of Eclipse with the correct plugins) the XML file will be treated
                as plain text. There is no XML editing support out of the box in Eclipse,
                and as such there is not even any syntax highlighting of elements and attributes.
                To address this, you will have to install an XML editor plugin for Eclipse...</p><div class="table"><a name="xsd-config-setup-eclipse-plugins"></a><p class="title"><b>Table&nbsp;A.1.&nbsp;Eclipse XML editors</b></p><div class="table-contents"><table summary="Eclipse XML editors" border="1"><colgroup><col align="left"><col></colgroup><thead><tr><th align="center">XML Editor</th><th align="center">Link</th></tr></thead><tbody><tr><td align="left">
							        <p>The Eclipse Web Tools Platform (WTP)</p>
						        </td><td>
							        <a href="http://www.eclipse.org/webtools/" target="_top">http://www.eclipse.org/webtools/</a>
						        </td></tr><tr><td align="left">
							        <p>A list of Eclipse XML plugins</p>
						        </td><td>
							        <a href="http://eclipse-plugins.2y.net/eclipse/plugins.jsp?category=XML" target="_top">http://eclipse-plugins.2y.net/eclipse/plugins.jsp?category=XML</a>
						        </td></tr></tbody></table></div></div><br class="table-break"><div class="sidebar"><p class="title"><b>Contributing documentation...</b></p><p>Patches showing how to configure an Eclipse XML editor are
                    welcomed. Any such contributions are best submitted as patches via
                    the Spring Framework
                    <a href="http://opensource.atlassian.com/projects/spring/secure/Dashboard.jspa" target="_top">JIRA Issue Tracker</a>
                    and <span class="emphasis"><em>may</em></span> be featured in the next release.</p></div><p>Unfortunately, precisely because there is no standard XML editor for Eclipse,
                there are (bar the one below) no further steps showing you how to configure XML
                Schema support in Eclipse... each XML editor plugin would require its very own
                dedicated section, and this is <span class="emphasis"><em>Spring</em></span> reference documentation,
                not Eclipse XML editor documentation. You will have to read the documentation that
                comes with your XML editor plugin (good luck there) and figure it out for yourself.</p></li><li><p class="title"><b>Step Three</b></p><p>However, if you are using the Web Tools Platform (WTP) for Eclipse, you don't need to
                do anything other than open a Spring XML configuration file using the WTP platform's
                XML editor. As can be seen in the screenshot below, you immediately get some slick
                IDE-level support for autocompleting tags and suchlike. The moral of this story
                is... download and install the <a href="http://www.eclipse.org/webtools/" target="_top">WTP</a>,
                because (quite simply, and to paraphrase one of the Spring-WebFlow developers)...
                &#8220;<span class="quote"><span class="emphasis"><em>[WTP] rocks!</em></span></span>&#8221;</p><p>
			        </p><div class="mediaobject" align="center"><img src="images/eclipse-setup-2.png" align="middle"></div><p>
		        </p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-setup-idea"></a>A.3.2.&nbsp;Setting up IntelliJ IDEA</h3></div></div></div><div class="procedure"><p>The following steps illustrate setting up the
            <a href="http://www.jetbrains.com/idea/" target="_top">IntelliJ IDEA</a> IDE to be XSD-aware.
            The assumption in the following steps is that you already have an IDEA project
            open (either a brand new project or an already existing one).</p><p>Repeat as required for setting up IDEA to reference the other Spring XSD files.</p><ol type="1"><li><p class="title"><b>Step One</b></p><p>Create a new XML file (you can name this file whatever you want). In the
                example below, the file is named <code class="literal">'context.xml'</code>. Copy and paste
                the following text into the file so that it matches the screenshot.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd"&gt;

&lt;/beans&gt;</pre><p>
			        </p><div class="mediaobject" align="center"><img src="images/idea-setup-1.png" align="middle"></div><p>
		        </p></li><li><p class="title"><b>Step Two</b></p><p>As can be seen in the above screenshot, the XML file has a number
                of nasty red contextual error markers. To rectify this, IDEA has to be
                made aware of the location of the referenced XSD namespace(s).</p><p>To do this, simply position the cursor over the squiggly red
                area (see the screenshot below); then press the <span><strong class="keycap">Alt</strong></span>-<span><strong class="keycap">Enter</strong></span> keystroke combination, and press the <span><strong class="keycap">Enter</strong></span> key again when the popup becomes active to fetch the external
                 resource.</p><p>
			        </p><div class="mediaobject" align="center"><img src="images/idea-setup-6.png" align="middle"></div><p>
		        </p></li><li><p class="title"><b>Step Three</b></p><p>If the external resource could not be fetched (maybe no active Internet
                connection is available), you can manually configure the resource to
                reference a local copy of the XSD file. Simply open up the <code class="literal">'Settings'</code> dialog
                (using the <span><strong class="keycap">Ctrl</strong></span>-<span><strong class="keycap">A</strong></span>-<span><strong class="keycap">S</strong></span> keystroke combination or via the <code class="literal">'File|Settings'</code> menu),
                 and click on the <code class="literal">'Resources'</code> button.</p><p>
			        </p><div class="mediaobject" align="center"><img src="images/idea-setup-2.png" align="middle"></div><p>
		        </p></li><li><p class="title"><b>Step Four</b></p><p>As can be seen in the following screenshot, this will bring up a dialog
                that allows you to add an explicit reference to a local copy of the
                <code class="literal">util</code> schema file. (You can find all of the various Spring
                XSD files in the <code class="literal">'src'</code> directory of the Spring distribution.)</p><p>
			        </p><div class="mediaobject" align="center"><img src="images/idea-setup-3.png" align="middle"></div><p>
		        </p></li><li><p class="title"><b>Step Five</b></p><p>Clicking the <code class="literal">'Add'</code> button will bring up another dialog
                that allows you to explicitly to associate a namespace URI with the path to the
                relevant XSD file. As can be seen in the following screenshot, the
                <code class="literal">'http://www.springframework.org/schema/util'</code> namespace
                is being associated with the file resource
                <code class="literal">'C:\bench\spring\src\org\springframework\beans\factory\xml\spring-util-2.0.xsd'</code>.</p><p>
			        </p><div class="mediaobject" align="center"><img src="images/idea-setup-4.png" align="middle"></div><p>
		        </p></li><li><p class="title"><b>Step Six</b></p><p>Exiting out of the nested dialogs by clicking the <code class="literal">'OK'</code> button
                will then bring back the main editing window, and as can be seen in the
                following screenshot, the contextual error markers have disappeared; typing
                the <code class="literal">'&lt;'</code> character into the editing window now also
                brings up a handy dropdown box that contains all of the imported tags from
                the <code class="literal">util</code> namespace.</p><p>
			        </p><div class="mediaobject" align="center"><img src="images/idea-setup-5.png" align="middle"></div><p>
		        </p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-integration"></a>A.3.3.&nbsp;Integration issues</h3></div></div></div><p>This final section details integration issues that may arise when you switch over
            to using the above XSD-style for Spring 2.0 configuration.</p><p>This section is quite small at the moment (and hopefully it will stay that way).
            It has been included in the Spring documentation as a convenience to Spring users
            so that if you encounter an issue when switching over to the XSD-style in some
            specific environment you can refer to this section for the authoritative answer.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-integration-resin"></a>A.3.3.1.&nbsp;XML parsing errors in the Resin v.3 application server</h4></div></div></div><p>If you are using the XSD-style for Spring 2.0 XML configuration
                and deploying to v.3 of Caucho's Resin application server, you will need
                to set some configuration options prior to startup so that an XSD-aware
                parser is available to Spring.</p><p>Please do read this resource,
                <a href="http://www.caucho.com/resin-3.0/xml/jaxp.xtp#xerces" target="_top">http://www.caucho.com/resin-3.0/xml/jaxp.xtp#xerces</a>,
                for further details.</p></div></div></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="extensible-xml"></a>Appendix&nbsp;B.&nbsp;Extensible XML authoring</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-introduction"></a>B.1.&nbsp;Introduction</h2></div></div></div><p>Since version 2.0, Spring has featured a mechanism for schema-based extensions
        to the basic Spring XML format for defining and configuring beans. This section is
        devoted to detailing how you would go about writing your own custom XML bean definition
        parsers and integrating such parsers into the Spring IoC container.</p><p>To facilitate the authoring of configuration files using a schema-aware XML editor,
    	Spring's extensible XML configuration mechanism is based on XML Schema. If you are
    	not familiar with Spring's current XML configuration extensions that come with the
    	standard Spring distribution, please first read the appendix entitled
    	<a href="#xsd-config" title="Appendix&nbsp;A.&nbsp;XML Schema-based configuration">Appendix&nbsp;A, <i>XML Schema-based configuration</i></a>.</p><p>Creating new XML configuration extensions can be done by following these (relatively)
    	simple steps:</p><p>
    	    </p><div class="orderedlist"><ol type="1"><li><p><a href="#extensible-xml-schema" title="B.2.&nbsp;Authoring the schema">Authoring</a> an XML schema to describe your custom element(s).</p></li><li><p><a href="#extensible-xml-namespacehandler" title="B.3.&nbsp;Coding a NamespaceHandler">Coding</a> a custom <code class="interfacename">NamespaceHandler</code>
                    implementation (this is an easy step, don't worry).</p></li><li><p><a href="#extensible-xml-parser" title="B.4.&nbsp;Coding a BeanDefinitionParser">Coding</a> one or more <code class="interfacename">BeanDefinitionParser</code>
                    implementations (this is where the real work is done).</p></li><li><p><a href="#extensible-xml-registration" title="B.5.&nbsp;Registering the handler and the schema">Registering</a> the above artifacts with Spring (this too is an easy step).</p></li></ol></div><p>
    	</p><p>What follows is a description of each of these steps. For the example, we will create
    	an XML extension (a custom XML element) that allows us to configure objects of the type
    	<code class="classname">SimpleDateFormat</code> (from the <code class="literal">java.text</code> package)
    	in an easy manner. When we are done, we will be able to define bean definitions of type
    	<code class="classname">SimpleDateFormat</code> like this:</p><pre class="programlisting">&lt;myns:dateformat id="dateFormat" 
    pattern="yyyy-MM-dd HH:mm"
    lenient="true"/&gt;
</pre><p><span class="emphasis"><em>(Don't worry about the fact that this example is very simple; much more
        detailed examples follow afterwards. The intent in this first simple example is to walk
        you through the basic steps involved.)</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-schema"></a>B.2.&nbsp;Authoring the schema</h2></div></div></div><p>Creating an XML configuration extension for use with Spring's IoC container
    	starts with authoring an XML Schema to describe the extension. What follows
    	is the schema we'll use to configure <code class="classname">SimpleDateFormat</code>
    	objects.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- myns.xsd (inside package org/springframework/samples/xml) --&gt;</span></em>

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsd:schema xmlns="http://www.mycompany.com/schema/myns"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:beans="http://www.springframework.org/schema/beans"
    targetNamespace="http://www.mycompany.com/schema/myns"
    elementFormDefault="qualified"
    attributeFormDefault="unqualified"&gt;

   &lt;xsd:import namespace="http://www.springframework.org/schema/beans"/&gt;

   &lt;xsd:element name="dateformat"&gt;
      &lt;xsd:complexType&gt;
         &lt;xsd:complexContent&gt;
            <span class="bold"><strong>&lt;xsd:extension base="beans:identifiedType"&gt;</strong></span>
               &lt;xsd:attribute name="lenient" type="xsd:boolean"/&gt;
               &lt;xsd:attribute name="pattern" type="xsd:string" use="required"/&gt;
            &lt;/xsd:extension&gt;
         &lt;/xsd:complexContent&gt;
      &lt;/xsd:complexType&gt;
   &lt;/xsd:element&gt;

&lt;/xsd:schema&gt;</pre><p>(The emphasized line contains an extension base for all tags that
    	will be identifiable (meaning they have an <code class="literal">id</code> attribute
    	that will be used as the bean identifier in the container). We are able to use this
    	attribute because we imported the Spring-provided <code class="literal">'beans'</code>
    	namespace.)</p><p>The above schema will be used to configure <code class="classname">SimpleDateFormat</code>
		objects, directly in an XML application context file using the
		<code class="literal">&lt;myns:dateformat/&gt;</code> element.</p><pre class="programlisting">&lt;myns:dateformat id="dateFormat" 
    pattern="yyyy-MM-dd HH:mm"
    lenient="true"/&gt;
</pre><p>Note that after we've created the infrastructure classes, the above snippet of XML
		will essentially be exactly the same as the following XML snippet. In other words,
		we're just creating a bean in the container, identified by the name
		<code class="literal">'dateFormat'</code> of type <code class="classname">SimpleDateFormat</code>, with a
		couple of properties set.</p><pre class="programlisting">&lt;bean id="dateFormat" class="java.text.SimpleDateFormat"&gt;
    &lt;constructor-arg value="yyyy-HH-dd HH:mm"/&gt;
    &lt;property name="lenient" value="true"/&gt;
&lt;/bean&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The schema-based approach to creating configuration format allows for
			tight integration with an IDE that has a schema-aware XML editor. Using a properly
			authored schema, you can use autocompletion to have a user choose between several
			configuration options defined in the enumeration.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-namespacehandler"></a>B.3.&nbsp;Coding a <code class="interfacename">NamespaceHandler</code></h2></div></div></div><p>In addition to the schema, we need a <code class="interfacename">NamespaceHandler</code>
		that will parse all elements of this specific namespace Spring encounters
		while parsing configuration files. The <code class="interfacename">NamespaceHandler</code>
		should in our case take care of the parsing of the <code class="literal">myns:dateformat</code>
		element.</p><p>The <code class="interfacename">NamespaceHandler</code> interface is pretty simple in that 
		it features just three methods:</p><div class="itemizedlist"><ul type="disc" compact><li><p><code class="methodname">init()</code> - allows for initialization of
				the <code class="interfacename">NamespaceHandler</code> and will be called by Spring
				before the handler is used</p></li><li><p><code class="methodname">BeanDefinition parse(Element, ParserContext)</code> - 
				called when Spring encounters a top-level element (not nested inside a bean definition
				or a different namespace). This method can register bean definitions itself and/or
				return a bean definition.</p></li><li><p><code class="methodname">BeanDefinitionHolder decorate(Node, BeanDefinitionHolder, ParserContext)</code> -
				called when Spring encounters an attribute or nested element of a different namespace.
				The decoration of one or more bean definitions is used for example with the
				<a href="#beans-factory-scopes" title="3.4.&nbsp;Bean scopes">out-of-the-box	scopes Spring 2.0 supports</a>.
				We'll start by highlighting a simple example, without using decoration, after which
				we will	show decoration in a somewhat more advanced example.</p></li></ul></div><p>Although it is perfectly possible to code your own
		<code class="interfacename">NamespaceHandler</code> for the entire namespace
		(and hence provide code that parses each and every element in the namespace),
		it is often the case that each top-level XML element in a Spring XML
		configuration file results in a single bean definition (as in our
		case, where a single <code class="literal">&lt;myns:dateformat/&gt;</code> element
		results in a single <code class="classname">SimpleDateFormat</code> bean definition).
		Spring features a number of convenience classes that support this scenario.
		In this example, we'll make use the <code class="classname">NamespaceHandlerSupport</code> class:</p><pre class="programlisting">package org.springframework.samples.xml;

import org.springframework.beans.factory.xml.NamespaceHandlerSupport;

public class MyNamespaceHandler extends NamespaceHandlerSupport {
    
    public void init() {<span class="bold"><strong>
        registerBeanDefinitionParser("dateformat", new SimpleDateFormatBeanDefinitionParser());        
    </strong></span>}
}</pre><p>The observant reader will notice that there isn't actually a whole lot of
        parsing logic in this class. Indeed... the <code class="classname">NamespaceHandlerSupport</code>
        class has a built in notion of delegation. It supports the registration of any number
        of <code class="interfacename">BeanDefinitionParser</code> instances, to which it will delegate
        to when it needs to parse an element in it's namespace. This clean separation of concerns
        allows a <code class="interfacename">NamespaceHandler</code> to handle the orchestration
        of the parsing of <span class="emphasis"><em>all</em></span> of the custom elements in it's namespace,
        while delegating to <code class="literal">BeanDefinitionParsers</code> to do the grunt work of the
        XML parsing; this means that each <code class="interfacename">BeanDefinitionParser</code> will
        contain just the logic for parsing a single custom element, as we can see in the next step</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-parser"></a>B.4.&nbsp;Coding a <code class="interfacename">BeanDefinitionParser</code></h2></div></div></div><p>A <code class="interfacename">BeanDefinitionParser</code> will be used if the
		<code class="interfacename">NamespaceHandler</code> encounters an XML element of the type
		that has been mapped to the specific bean definition parser (which is <code class="literal">'dateformat'</code>
		in this case). In other words, the <code class="interfacename">BeanDefinitionParser</code> is
		responsible for parsing <span class="emphasis"><em>one</em></span> distinct top-level XML element defined in the
		schema. In the parser, we'll have access to the XML element (and thus it's subelements too)
		so that we can parse our custom XML content, as can be seen in the following example:</p><pre class="programlisting">package org.springframework.samples.xml;

import org.springframework.beans.factory.support.BeanDefinitionBuilder;
import org.springframework.beans.factory.xml.AbstractSingleBeanDefinitionParser;
import org.springframework.util.StringUtils;
import org.w3c.dom.Element;

import java.text.SimpleDateFormat;

public class SimpleDateFormatBeanDefinitionParser extends AbstractSingleBeanDefinitionParser { <a name="extensible-xml-parser-simpledateformat-co-1"></a><img src="../images/callouts/1.png" alt="1" border="0">

   protected Class getBeanClass(Element element) {
      return SimpleDateFormat.class; <a name="extensible-xml-parser-simpledateformat-co-2"></a><img src="../images/callouts/2.png" alt="2" border="0">
   }

   protected void doParse(Element element, BeanDefinitionBuilder bean) {
      <em class="lineannotation"><span class="lineannotation">// this will never be null since the schema explicitly requires that a value be supplied</span></em>
      String pattern = element.getAttribute("pattern");
      bean.addConstructorArg(pattern);

      <em class="lineannotation"><span class="lineannotation">// this however is an optional property</span></em>
      String lenient = element.getAttribute("lenient");
      if (StringUtils.hasText(lenient)) {
         bean.addPropertyValue("lenient", Boolean.valueOf(lenient));
      }
   }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#extensible-xml-parser-simpledateformat-co-1"><img src="../images/callouts/1.png" alt="1" border="0"></a> </td><td valign="top" align="left"><p>We use the Spring-provided <code class="classname">AbstractSingleBeanDefinitionParser</code>
			    to handle a lot of the basic grunt work of creating a <span class="emphasis"><em>single</em></span>
			    <code class="interfacename">BeanDefinition</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#extensible-xml-parser-simpledateformat-co-2"><img src="../images/callouts/2.png" alt="2" border="0"></a> </td><td valign="top" align="left"><p>We supply the <code class="classname">AbstractSingleBeanDefinitionParser</code> superclass
			    with the type that our single <code class="interfacename">BeanDefinition</code> will represent.</p></td></tr></table></div><p>In this simple case, this is all that we need to do. The creation of our single
		<code class="interfacename">BeanDefinition</code> is handled by the <code class="classname">AbstractSingleBeanDefinitionParser</code>
		superclass, as is the extraction and setting of the bean definition's unique identifier.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-registration"></a>B.5.&nbsp;Registering the handler and the schema</h2></div></div></div><p>The coding is finished! All that remains to be done is to somehow make the Spring XML
		parsing infrastructure aware of our custom element; we do this by registering our custom
		<code class="interfacename">namespaceHandler</code> and custom XSD file in two special purpose
		properties files. These properties files are both placed in a
		<code class="filename">'META-INF'</code> directory in your application, and can, for
		example, be distributed alongside your binary classes in a JAR file. The Spring XML parsing
		infrastructurewill automatically pick up your new extension by consuming these special
		properties files, the formats of which are detailed below.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="extensible-xml-registration-spring-handlers"></a>B.5.1.&nbsp;<code class="filename">'META-INF/spring.handlers'</code></h3></div></div></div><p>The properties file called <code class="filename">'spring.handlers'</code> contains a mapping
			of XML Schema URIs to namespace handler classes. So for our example, we need to write the
			following:</p><pre class="programlisting">http\://www.mycompany.com/schema/myns=org.springframework.samples.xml.MyNamespaceHandler</pre><p><span class="emphasis"><em>(The <code class="literal">':'</code> character is a valid delimiter in the Java properties format,
			and so the <code class="literal">':'</code> character in the URI needs to be escaped with a backslash.)</em></span></p><p>The first part (the key) of the key-value pair is the URI associated with your custom namespace
			extension, and needs to <span class="emphasis"><em>match exactly</em></span> the value of the
			<code class="literal">'targetNamespace'</code> attribute as specified in your custom XSD schema.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="extensible-xml-registration-spring-schemas"></a>B.5.2.&nbsp;<code class="filename">'META-INF/spring.schemas'</code></h3></div></div></div><p>The properties file called <code class="filename">'spring.schemas'</code> contains a mapping
			of XML Schema locations (referred to along with the schema declaration in XML files
			that use the schema as part of the <code class="literal">'xsi:schemaLocation'</code> attribute)
			to <span class="emphasis"><em>classpath</em></span> resources. This file is needed to prevent Spring from
			absolutely having to use a default <code class="interfacename">EntityResolver</code> that requires
			Internet access to retrieve the schema file. If you specify the mapping in this properties file,
			Spring will search for the schema on the classpath (in this case <code class="literal">'myns.xsd'</code>
			in the <code class="literal">'org.springframework.samples.xml'</code> package):</p><pre class="programlisting">http\://www.mycompany.com/schema/myns/myns.xsd=org/springframework/samples/xml/myns.xsd</pre><p>The upshot of this is that you are encouraged to deploy your XSD file(s) right alongside
			the <code class="interfacename">NamespaceHandler</code> and <code class="interfacename">BeanDefinitionParser</code>
			classes on the classpath.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-using"></a>B.6.&nbsp;Using a custom extension in your Spring XML configuration</h2></div></div></div><p>Using a custom extension that you yourself have implemented is no different from
		using one of the 'custom' extensions that Spring provides straight out of the box. Find below
		an example of using the custom <code class="literal">&lt;dateformat/&gt;</code> element developed in the
		previous steps in a Spring XML configuration file.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:myns="http://www.mycompany.com/schema/myns"
      xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
http://www.mycompany.com/schema/myns http://www.mycompany.com/schema/myns/myns.xsd"&gt;

   <em class="lineannotation"><span class="lineannotation">&lt;!-- as a top-level bean --&gt;</span></em>
   &lt;myns:dateformat id="defaultDateFormat" pattern="yyyy-MM-dd HH:mm" lenient="true"/&gt;

   &lt;bean id="jobDetailTemplate" abstract="true"&gt;
      &lt;property name="dateFormat"&gt;
         <em class="lineannotation"><span class="lineannotation">&lt;!-- as an inner bean --&gt;</span></em>
         &lt;myns:dateformat pattern="HH:mm MM-dd-yyyy"/&gt;
      &lt;/property&gt;
   &lt;/bean&gt;

&lt;/beans&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-meat"></a>B.7.&nbsp;Meatier examples</h2></div></div></div><p>Find below some much meatier examples of custom XML extensions.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="extensible-xml-custom-nested"></a>B.7.1.&nbsp;Nesting custom tags within custom tags</h3></div></div></div><p>This example illustrates how you might go about writing the various artifacts
		    required to satisfy a target of the following configuration:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:foo="http://www.foo.com/schema/component"
      xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
http://www.foo.com/schema/component http://www.foo.com/schema/component/component.xsd"&gt;

   <em class="lineannotation"><span class="lineannotation">&lt;foo:component id="bionic-family" name="Bionic-1"&gt;
      &lt;foo:component name="Sport-1"/&gt;
      &lt;foo:component name="Rock-1"/&gt;
   &lt;/foo:component&gt;</span></em>

&lt;/beans&gt;</pre><p>The above configuration actually nests custom extensions within each other. The class
            that is actually configured by the above <code class="literal">&lt;foo:component/&gt;</code>
            element is the <code class="classname">Component</code> class (shown directly below). Notice
            how the <code class="classname">Component</code> class does <span class="emphasis"><em>not</em></span> expose
            a setter method for the <code class="literal">'components'</code> property; this makes it hard
            (or rather impossible) to configure a bean definition for the <code class="classname">Component</code>
            class using setter injection.</p><pre class="programlisting">package com.foo;

import java.util.ArrayList;
import java.util.List;

public class Component {

   private String name;
   private List components = new ArrayList();

   <em class="lineannotation"><span class="lineannotation">// mmm, there is no setter method for the <code class="literal">'components'</code></span></em>
   public void addComponent(Component component) {
      this.components.add(component);
   }

   public List getComponents() {
      return components;
   }

   public String getName() {
      return name;
   }

   public void setName(String name) {
      this.name = name;
   }
}</pre><p>The typical solution to this issue is to create a custom <code class="interfacename">FactoryBean</code>
            that exposes a setter property for the <code class="literal">'components'</code> property.</p><pre class="programlisting">package com.foo;

import org.springframework.beans.factory.FactoryBean;

import java.util.Iterator;
import java.util.List;

public class ComponentFactoryBean implements FactoryBean {

   private Component parent;
   private List children;

   public void setParent(Component parent) {
      this.parent = parent;
   }

   public void setChildren(List children) {
      this.children = children;
   }

   public Object getObject() throws Exception {
      if (this.children != null &amp;&amp; this.children.size() &gt; 0) {
         for (Iterator it = children.iterator(); it.hasNext();) {
            Component childComponent = (Component) it.next();
            this.parent.addComponent(childComponent);
         }
      }
      return this.parent;
   }

   public Class getObjectType() {
      return Component.class;
   }

   public boolean isSingleton() {
      return true;
   }
}</pre><p>This is all very well, and does work nicely, but exposes a lot of Spring plumbing to the
            end user. What we are going to do is write a custom extension that hides away all of this
            Spring plumbing. If we stick to <a href="#extensible-xml-introduction" title="B.1.&nbsp;Introduction">the steps described
            previously</a>, we'll start off by creating the XSD schema to define the structure of
            our custom tag.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;

&lt;xsd:schema xmlns="http://www.foo.com/schema/component"
         xmlns:xsd="http://www.w3.org/2001/XMLSchema"
         targetNamespace="http://www.foo.com/schema/component"
         elementFormDefault="qualified"
         attributeFormDefault="unqualified"&gt;

   &lt;xsd:element name="component"&gt;
      &lt;xsd:complexType&gt;
         &lt;xsd:choice minOccurs="0" maxOccurs="unbounded"&gt;
            &lt;xsd:element ref="component"/&gt;
         &lt;/xsd:choice&gt;
         &lt;xsd:attribute name="id" type="xsd:ID"/&gt;
         &lt;xsd:attribute name="name" use="required" type="xsd:string"/&gt;
      &lt;/xsd:complexType&gt;
   &lt;/xsd:element&gt;

&lt;/xsd:schema&gt;
</pre><p>We'll then create a custom <code class="interfacename">NamespaceHandler</code>.</p><pre class="programlisting">package com.foo;

import org.springframework.beans.factory.xml.NamespaceHandlerSupport;

public class ComponentNamespaceHandler extends NamespaceHandlerSupport {

   public void init() {
      registerBeanDefinitionParser("component", new ComponentBeanDefinitionParser());
   }
}</pre><p>Next up is the custom <code class="interfacename">BeanDefinitionParser</code>. Remember
            that what we are creating is a <code class="interfacename">BeanDefinition</code> describing
            a <code class="classname">ComponentFactoryBean</code>.</p><pre class="programlisting">package com.foo;

import org.springframework.beans.factory.support.AbstractBeanDefinition;
import org.springframework.beans.factory.support.BeanDefinitionBuilder;
import org.springframework.beans.factory.support.ManagedList;
import org.springframework.beans.factory.xml.AbstractBeanDefinitionParser;
import org.springframework.beans.factory.xml.ParserContext;
import org.springframework.util.xml.DomUtils;
import org.w3c.dom.Element;

import java.util.List;

public class ComponentBeanDefinitionParser extends AbstractBeanDefinitionParser {

   protected AbstractBeanDefinition parseInternal(Element element, ParserContext parserContext) {
      BeanDefinitionBuilder factory = BeanDefinitionBuilder.rootBeanDefinition(ComponentFactoryBean.class);
      BeanDefinitionBuilder parent = parseComponent(element);
      factory.addPropertyValue("parent", parent.getBeanDefinition());

      List childElements = DomUtils.getChildElementsByTagName(element, "component");
      if (childElements != null &amp;&amp; childElements.size() &gt; 0) {
         parseChildComponents(childElements, factory);
      }
      return factory.getBeanDefinition();
   }

   private static BeanDefinitionBuilder parseComponent(Element element) {
      BeanDefinitionBuilder component = BeanDefinitionBuilder.rootBeanDefinition(Component.class);
      component.addPropertyValue("name", element.getAttribute("name"));
      return component;
   }

   private static void parseChildComponents(List childElements, BeanDefinitionBuilder factory) {
      ManagedList children = new ManagedList(childElements.size());
      for (int i = 0; i &lt; childElements.size(); ++i) {
         Element childElement = (Element) childElements.get(i);
         BeanDefinitionBuilder child = parseComponent(childElement);
         children.add(child.getBeanDefinition());
      }
      factory.addPropertyValue("children", children);
   }
}</pre><p>Lastly, the various artifacts need to be registered with the Spring XML infrastructure.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation"># in <code class="filename">'META-INF/spring.handlers'</code></span></em>
http\://www.foo.com/schema/component=com.foo.ComponentNamespaceHandler</pre><pre class="programlisting"><em class="lineannotation"><span class="lineannotation"># in <code class="filename">'META-INF/spring.schemas'</code></span></em>
http\://www.foo.com/schema/component/component.xsd=com/foo/component.xsd</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="extensible-xml-custom-just-attributes"></a>B.7.2.&nbsp;Custom attributes on 'normal' elements</h3></div></div></div><p>Writing your own custom parser and the associated artifacts isn't hard, but sometimes it
		    is not the right thing to do. Consider the scenario where you need to add metadata to already
		    existing bean definitions. In this case you certainly don't want to have to go off and write
		    your own entire custom extension; rather you just want to add an additional attribute
		    to the existing bean definition element.</p><p>By way of another example, let's say that the service class that you are defining a bean
		    definition for a service object that will (unknown to it) be accessing a clustered
		    <a href="http://jcp.org/en/jsr/detail?id=107" target="_top">JCache</a>, and you want to ensure that
		    the named JCache instance is eagerly started within the surrounding cluster:</p><pre class="programlisting">&lt;bean id="checkingAccountService" class="com.foo.DefaultCheckingAccountService"
      <em class="lineannotation"><span class="lineannotation"><span class="bold"><strong>jcache:cache-name="checking.account"&gt;</strong></span></span></em>
   <em class="lineannotation"><span class="lineannotation">&lt;!-- other dependencies here... --&gt;</span></em>
&lt;/bean&gt;</pre><p>What we are going to do here is create another <code class="interfacename">BeanDefinition</code>
            when the <code class="literal">'jcache:cache-name'</code> attribute is parsed; this
            <code class="interfacename">BeanDefinition</code> will then initialize the named JCache
            for us. We will also modify the existing <code class="interfacename">BeanDefinition</code> for the
            <code class="literal">'checkingAccountService'</code> so that it will have a dependency on this
            new JCache-initializing <code class="interfacename">BeanDefinition</code>.</p><pre class="programlisting">package com.foo;

public class JCacheInitializer {

   private String name;

   public JCacheInitializer(String name) {
      this.name = name;
   }

   public void initialize() {
      <em class="lineannotation"><span class="lineannotation">// lots of JCache API calls to initialize the named cache...</span></em>
   }
}</pre><p>Now onto the custom extension. Firstly, the authoring of the XSD schema describing the
            custom attribute (quite easy in this case).</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;

&lt;xsd:schema xmlns="http://www.foo.com/schema/jcache"
            xmlns:xsd="http://www.w3.org/2001/XMLSchema"
            targetNamespace="http://www.foo.com/schema/jcache"
            elementFormDefault="qualified"&gt;

   &lt;xsd:attribute name="cache-name" type="xsd:string"/&gt;

&lt;/xsd:schema&gt;
</pre><p>Next, the associated <code class="interfacename">NamespaceHandler</code>.</p><pre class="programlisting">package com.foo;

import org.springframework.beans.factory.xml.NamespaceHandlerSupport;

public class JCacheNamespaceHandler extends NamespaceHandlerSupport {

   public void init() {
      super.registerBeanDefinitionDecoratorForAttribute("cache-name",
            new JCacheInitializingBeanDefinitionDecorator());
   }
}
</pre><p>Next, the parser. Note that in this case, because we are going to be parsing an XML
            attribute, we write a <code class="interfacename">BeanDefinitionDecorator</code> rather than a
            <code class="interfacename">BeanDefinitionParser</code>.</p><pre class="programlisting">package com.foo;

import org.springframework.beans.factory.config.BeanDefinitionHolder;
import org.springframework.beans.factory.support.AbstractBeanDefinition;
import org.springframework.beans.factory.support.BeanDefinitionBuilder;
import org.springframework.beans.factory.xml.BeanDefinitionDecorator;
import org.springframework.beans.factory.xml.ParserContext;
import org.w3c.dom.Attr;
import org.w3c.dom.Node;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public class JCacheInitializingBeanDefinitionDecorator implements BeanDefinitionDecorator {
   
   private static final String[] EMPTY_STRING_ARRAY = new String[0];

   public BeanDefinitionHolder decorate(
         Node source, BeanDefinitionHolder holder, ParserContext ctx) {
      String initializerBeanName = registerJCacheInitializer(source, ctx);
      createDependencyOnJCacheInitializer(holder, initializerBeanName);
      return holder;
   }

   private void createDependencyOnJCacheInitializer(BeanDefinitionHolder holder, String initializerBeanName) {
      AbstractBeanDefinition definition = ((AbstractBeanDefinition) holder.getBeanDefinition());
      String[] dependsOn = definition.getDependsOn();
      if (dependsOn == null) {
         dependsOn = new String[]{initializerBeanName};
      } else {
         List dependencies = new ArrayList(Arrays.asList(dependsOn));
         dependencies.add(initializerBeanName);
         dependsOn = (String[]) dependencies.toArray(EMPTY_STRING_ARRAY);
      }
      definition.setDependsOn(dependsOn);
   }

   private String registerJCacheInitializer(Node source, ParserContext ctx) {
      String cacheName = ((Attr) source).getValue();
      String beanName = cacheName + "-initializer";
      if (!ctx.getRegistry().containsBeanDefinition(beanName)) {
         BeanDefinitionBuilder initializer = BeanDefinitionBuilder.rootBeanDefinition(JCacheInitializer.class);
         initializer.addConstructorArg(cacheName);
         ctx.getRegistry().registerBeanDefinition(beanName, initializer.getBeanDefinition());
      }
      return beanName;
   }
}
</pre><p>Lastly, the various artifacts need to be registered with the Spring XML infrastructure.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation"># in <code class="filename">'META-INF/spring.handlers'</code></span></em>
http\://www.foo.com/schema/jcache=com.foo.JCacheNamespaceHandler</pre><pre class="programlisting"><em class="lineannotation"><span class="lineannotation"># in <code class="filename">'META-INF/spring.schemas'</code></span></em>
http\://www.foo.com/schema/jcache/jcache.xsd=com/foo/jcache.xsd</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-resources"></a>B.8.&nbsp;Further Resources</h2></div></div></div><p>Find below links to further resources concerning XML Schema and the extensible XML support
		described in this chapter.</p><div class="itemizedlist"><ul type="disc"><li><p>The <a href="http://www.w3.org/TR/2004/REC-xmlschema-1-20041028/" target="_top">XML Schema Part 1: Structures Second Edition</a></p></li><li><p>The <a href="http://www.w3.org/TR/2004/REC-xmlschema-2-20041028/" target="_top">XML Schema Part 2: Datatypes Second Edition</a></p></li></ul></div></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="springbeansdtd"></a>Appendix&nbsp;C.&nbsp;<code class="literal">spring-beans-2.0.dtd</code></h2></div></div></div><pre class="programlisting">&lt;!--
	Spring XML Beans DTD, version 2.0
	Authors: Rod Johnson, Juergen Hoeller, Alef Arendsen, Colin Sampaleanu, Rob Harrop

	This defines a simple and consistent way of creating a namespace
	of JavaBeans objects, managed by a Spring BeanFactory, read by
	XmlBeanDefinitionReader (with DefaultBeanDefinitionDocumentReader).

	This document type is used by most Spring functionality, including
	web application contexts, which are based on bean factories.

	Each "bean" element in this document defines a JavaBean.
	Typically the bean class is specified, along with JavaBean properties
	and/or constructor arguments.

	A bean instance can be a "singleton" (shared instance) or a "prototype"
	(independent instance). Further scopes can be provided by extended
	bean factories, for example in a web environment.

	References among beans are supported, that is, setting a JavaBean property
	or a constructor argument to refer to another bean in the same factory
	(or an ancestor factory).

	As alternative to bean references, "inner bean definitions" can be used.
	Singleton flags of such inner bean definitions are effectively ignored:
	Inner beans are typically anonymous prototypes.

	There is also support for lists, sets, maps, and java.util.Properties
	as bean property types or constructor argument types.

	For simple purposes, this DTD is sufficient. As of Spring 2.0,
	XSD-based bean definitions are supported as more powerful alternative.

	XML documents that conform to this DTD should declare the following doctype:

	&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN"
		"http://www.springframework.org/dtd/spring-beans-2.0.dtd"&gt;
--&gt;


&lt;!--
	The document root. A document can contain bean definitions only,
	imports only, or a mixture of both (typically with imports first).
--&gt;
&lt;!ELEMENT beans (
	description?,
	(import | alias | bean)*
)&gt;

&lt;!--
	Default values for all bean definitions. Can be overridden at
	the "bean" level. See those attribute definitions for details.
--&gt;
&lt;!ATTLIST beans default-lazy-init (true | false) "false"&gt;
&lt;!ATTLIST beans default-autowire (no | byName | byType | constructor | autodetect) "no"&gt;
&lt;!ATTLIST beans default-dependency-check (none | objects | simple | all) "none"&gt;
&lt;!ATTLIST beans default-init-method CDATA #IMPLIED&gt;
&lt;!ATTLIST beans default-destroy-method CDATA #IMPLIED&gt;
&lt;!ATTLIST beans default-merge (true | false) "false"&gt;

&lt;!--
	Element containing informative text describing the purpose of the enclosing
	element. Always optional.
	Used primarily for user documentation of XML bean definition documents.
--&gt;
&lt;!ELEMENT description (#PCDATA)&gt;


&lt;!--
	Specifies an XML bean definition resource to import.
--&gt;
&lt;!ELEMENT import EMPTY&gt;

&lt;!--
	The relative resource location of the XML bean definition file to import,
	for example "myImport.xml" or "includes/myImport.xml" or "../myImport.xml".
--&gt;
&lt;!ATTLIST import resource CDATA #REQUIRED&gt;


&lt;!--
	Defines an alias for a bean, which can reside in a different definition file.
--&gt;
&lt;!ELEMENT alias EMPTY&gt;

&lt;!--
	The name of the bean to define an alias for.
--&gt;
&lt;!ATTLIST alias name CDATA #REQUIRED&gt;

&lt;!--
	The alias name to define for the bean.
--&gt;
&lt;!ATTLIST alias alias CDATA #REQUIRED&gt;

&lt;!--
  Allows for arbitrary metadata to be attached to a bean definition.
--&gt;
&lt;!ELEMENT meta EMPTY&gt;

&lt;!--
  Specifies the key name of the metadata parameter being defined.
--&gt;
&lt;!ATTLIST meta key CDATA #REQUIRED&gt;

&lt;!--
  Specifies the value of the metadata parameter being defined as a String.
--&gt;
&lt;!ATTLIST meta value CDATA #REQUIRED&gt;

&lt;!--
	Defines a single (usually named) bean.

	A bean definition may contain nested tags for constructor arguments,
	property values, lookup methods, and replaced methods. Mixing constructor
	injection and setter injection on the same bean is explicitly supported.
--&gt;
&lt;!ELEMENT bean (
	description?,
	(meta | constructor-arg | property | lookup-method | replaced-method)*
)&gt;

&lt;!--
	Beans can be identified by an id, to enable reference checking.

	There are constraints on a valid XML id: if you want to reference your bean
	in Java code using a name that's illegal as an XML id, use the optional
	"name" attribute. If neither is given, the bean class name is used as id
	(with an appended counter like "#2" if there is already a bean with that name).
--&gt;
&lt;!ATTLIST bean id ID #IMPLIED&gt;

&lt;!--
	Optional. Can be used to create one or more aliases illegal in an id.
	Multiple aliases can be separated by any number of spaces, commas, or
	semi-colons (or indeed any mixture of the three).
--&gt;
&lt;!ATTLIST bean name CDATA #IMPLIED&gt;

&lt;!--
	Each bean definition must specify the fully qualified name of the class,
	except if it pure serves as parent for child bean definitions.
--&gt;
&lt;!ATTLIST bean class CDATA #IMPLIED&gt;

&lt;!--
	Optionally specify a parent bean definition.

	Will use the bean class of the parent if none specified, but can
	also override it. In the latter case, the child bean class must be
	compatible with the parent, i.e. accept the parent's property values
	and constructor argument values, if any.

	A child bean definition will inherit constructor argument values,
	property values and method overrides from the parent, with the option
	to add new values. If init method, destroy method, factory bean and/or factory
	method are specified, they will override the corresponding parent settings.

	The remaining settings will always be taken from the child definition:
	depends on, autowire mode, dependency check, scope, lazy init.
--&gt;
&lt;!ATTLIST bean parent CDATA #IMPLIED&gt;

&lt;!--
	The scope of this bean: typically "singleton" (one shared instance,
	which will be returned by all calls to getBean() with the id),
	or "prototype" (independent instance resulting from each call to
	getBean(). Default is "singleton".

	Singletons are most commonly used, and are ideal for multi-threaded
	service objects. Further scopes, such as "request" or "session",
	might be supported by extended bean factories (for example, in a
	web environment).

	Note: This attribute will not be inherited by child bean definitions.
	Hence, it needs to be specified per concrete bean definition.

	Inner bean definitions inherit the singleton status of their containing
	bean definition, unless explicitly specified: The inner bean will be a
	singleton if the containing bean is a singleton, and a prototype if
	the containing bean has any other scope.
--&gt;
&lt;!ATTLIST bean scope CDATA #IMPLIED&gt;

&lt;!--
	Is this bean "abstract", i.e. not meant to be instantiated itself but
	rather just serving as parent for concrete child bean definitions.
	Default is "false". Specify "true" to tell the bean factory to not try to
	instantiate that particular bean in any case.

	Note: This attribute will not be inherited by child bean definitions.
	Hence, it needs to be specified per abstract bean definition.
--&gt;
&lt;!ATTLIST bean abstract (true | false) #IMPLIED&gt;

&lt;!--
	If this bean should be lazily initialized.
	If false, it will get instantiated on startup by bean factories
	that perform eager initialization of singletons.

	Note: This attribute will not be inherited by child bean definitions.
	Hence, it needs to be specified per concrete bean definition.
--&gt;
&lt;!ATTLIST bean lazy-init (true | false | default) "default"&gt;

&lt;!--
  Indicates whether or not this bean should be considered when looking
  for candidates to satisfy another beans autowiring requirements.
--&gt;
&lt;!ATTLIST bean autowire-candidate (true | false) #IMPLIED&gt;

&lt;!--
	Optional attribute controlling whether to "autowire" bean properties.
	This is an automagical process in which bean references don't need to be coded
	explicitly in the XML bean definition file, but Spring works out dependencies.

	There are 5 modes:

	1. "no"
	The traditional Spring default. No automagical wiring. Bean references
	must be defined in the XML file via the &lt;ref&gt; element. We recommend this
	in most cases as it makes documentation more explicit.

	2. "byName"
	Autowiring by property name. If a bean of class Cat exposes a dog property,
	Spring will try to set this to the value of the bean "dog" in the current factory.
	If there is no matching bean by name, nothing special happens;
	use dependency-check="objects" to raise an error in that case.

	3. "byType"
	Autowiring if there is exactly one bean of the property type in the bean factory.
	If there is more than one, a fatal error is raised, and you can't use byType
	autowiring for that bean. If there is none, nothing special happens;
	use dependency-check="objects" to raise an error in that case.

	4. "constructor"
	Analogous to "byType" for constructor arguments. If there isn't exactly one bean
	of the constructor argument type in the bean factory, a fatal error is raised.

	5. "autodetect"
	Chooses "constructor" or "byType" through introspection of the bean class.
	If a default constructor is found, "byType" gets applied.

	The latter two are similar to PicoContainer and make bean factories simple to
	configure for small namespaces, but doesn't work as well as standard Spring
	behaviour for bigger applications.

	Note that explicit dependencies, i.e. "property" and "constructor-arg" elements,
	always override autowiring. Autowire behavior can be combined with dependency
	checking, which will be performed after all autowiring has been completed.

	Note: This attribute will not be inherited by child bean definitions.
	Hence, it needs to be specified per concrete bean definition.
--&gt;
&lt;!ATTLIST bean autowire (no | byName | byType | constructor | autodetect | default) "default"&gt;

&lt;!--
	Optional attribute controlling whether to check whether all this
	beans dependencies, expressed in its properties, are satisfied.
	Default is no dependency checking.

	"simple" type dependency checking includes primitives and String
	"object" includes collaborators (other beans in the factory)
	"all" includes both types of dependency checking

	Note: This attribute will not be inherited by child bean definitions.
	Hence, it needs to be specified per concrete bean definition.
--&gt;
&lt;!ATTLIST bean dependency-check (none | objects | simple | all | default) "default"&gt;

&lt;!--
	The names of the beans that this bean depends on being initialized.
	The bean factory will guarantee that these beans get initialized before.

	Note that dependencies are normally expressed through bean properties or
	constructor arguments. This property should just be necessary for other kinds
	of dependencies like statics (*ugh*) or database preparation on startup.

	Note: This attribute will not be inherited by child bean definitions.
	Hence, it needs to be specified per concrete bean definition.
--&gt;
&lt;!ATTLIST bean depends-on CDATA #IMPLIED&gt;

&lt;!--
	Optional attribute for the name of the custom initialization method
	to invoke after setting bean properties. The method must have no arguments,
	but may throw any exception.
--&gt;
&lt;!ATTLIST bean init-method CDATA #IMPLIED&gt;

&lt;!--
	Optional attribute for the name of the custom destroy method to invoke
	on bean factory shutdown. The method must have no arguments,
	but may throw any exception.

	Note: Only invoked on beans whose lifecycle is under full control
	of the factory - which is always the case for singletons, but not
	guaranteed for any other scope.
--&gt;
&lt;!ATTLIST bean destroy-method CDATA #IMPLIED&gt;

&lt;!--
	Optional attribute specifying the name of a factory method to use to
	create this object. Use constructor-arg elements to specify arguments
	to the factory method, if it takes arguments. Autowiring does not apply
	to factory methods.

	If the "class" attribute is present, the factory method will be a static
	method on the class specified by the "class" attribute on this bean
	definition. Often this will be the same class as that of the constructed
	object - for example, when the factory method is used as an alternative
	to a constructor. However, it may be on a different class. In that case,
	the created object will *not* be of the class specified in the "class"
	attribute. This is analogous to FactoryBean behavior.

	If the "factory-bean" attribute is present, the "class" attribute is not
	used, and the factory method will be an instance method on the object
	returned from a getBean call with the specified bean name. The factory
	bean may be defined as a singleton or a prototype.

	The factory method can have any number of arguments. Autowiring is not
	supported. Use indexed constructor-arg elements in conjunction with the
	factory-method attribute.

	Setter Injection can be used in conjunction with a factory method.
	Method Injection cannot, as the factory method returns an instance,
	which will be used when the container creates the bean.
--&gt;
&lt;!ATTLIST bean factory-method CDATA #IMPLIED&gt;

&lt;!--
	Alternative to class attribute for factory-method usage.
	If this is specified, no class attribute should be used.
	This should be set to the name of a bean in the current or
	ancestor factories that contains the relevant factory method.
	This allows the factory itself to be configured using Dependency
	Injection, and an instance (rather than static) method to be used.
--&gt;
&lt;!ATTLIST bean factory-bean CDATA #IMPLIED&gt;

&lt;!--
	Bean definitions can specify zero or more constructor arguments.
	This is an alternative to "autowire constructor".
	Arguments correspond to either a specific index of the constructor argument
	list or are supposed to be matched generically by type.

	Note: A single generic argument value will just be used once, rather than
	potentially matched multiple times (as of Spring 1.1).

	constructor-arg elements are also used in conjunction with the factory-method
	element to construct beans using static or instance factory methods.
--&gt;
&lt;!ELEMENT constructor-arg (
	description?,
	(bean | ref | idref | value | null | list | set | map | props)?
)&gt;

&lt;!--
	The constructor-arg tag can have an optional index attribute,
	to specify the exact index in the constructor argument list. Only needed
	to avoid ambiguities, e.g. in case of 2 arguments of the same type.
--&gt;
&lt;!ATTLIST constructor-arg index CDATA #IMPLIED&gt;

&lt;!--
	The constructor-arg tag can have an optional type attribute,
	to specify the exact type of the constructor argument. Only needed
	to avoid ambiguities, e.g. in case of 2 single argument constructors
	that can both be converted from a String.
--&gt;
&lt;!ATTLIST constructor-arg type CDATA #IMPLIED&gt;

&lt;!--
  A short-cut alternative to a child element "ref bean=".
--&gt;
&lt;!ATTLIST constructor-arg ref CDATA #IMPLIED&gt;

&lt;!--
  A short-cut alternative to a child element "value".
--&gt;
&lt;!ATTLIST constructor-arg value CDATA #IMPLIED&gt;


&lt;!--
	Bean definitions can have zero or more properties.
	Property elements correspond to JavaBean setter methods exposed
	by the bean classes. Spring supports primitives, references to other
	beans in the same or related factories, lists, maps and properties.
--&gt;
&lt;!ELEMENT property (
	description?, meta*,
	(bean | ref | idref | value | null | list | set | map | props)?
)&gt;

&lt;!--
	The property name attribute is the name of the JavaBean property.
	This follows JavaBean conventions: a name of "age" would correspond
	to setAge()/optional getAge() methods.
--&gt;
&lt;!ATTLIST property name CDATA #REQUIRED&gt;

&lt;!--
  A short-cut alternative to a child element "ref bean=".
--&gt;
&lt;!ATTLIST property ref CDATA #IMPLIED&gt;

&lt;!--
  A short-cut alternative to a child element "value".
--&gt;
&lt;!ATTLIST property value CDATA #IMPLIED&gt;


&lt;!--
	A lookup method causes the IoC container to override the given method and return
	the bean with the name given in the bean attribute. This is a form of Method Injection.
	It's particularly useful as an alternative to implementing the BeanFactoryAware
	interface, in order to be able to make getBean() calls for non-singleton instances
	at runtime. In this case, Method Injection is a less invasive alternative.
--&gt;
&lt;!ELEMENT lookup-method EMPTY&gt;

&lt;!--
	Name of a lookup method. This method should take no arguments.
--&gt;
&lt;!ATTLIST lookup-method name CDATA #IMPLIED&gt;

&lt;!--
	Name of the bean in the current or ancestor factories that the lookup method
	should resolve to. Often this bean will be a prototype, in which case the
	lookup method will return a distinct instance on every invocation. This
	is useful for single-threaded objects.
--&gt;
&lt;!ATTLIST lookup-method bean CDATA #IMPLIED&gt;


&lt;!--
	Similar to the lookup method mechanism, the replaced-method element is used to control
	IoC container method overriding: Method Injection. This mechanism allows the overriding
	of a method with arbitrary code.
--&gt;
&lt;!ELEMENT replaced-method (
	(arg-type)*
)&gt;

&lt;!--
	Name of the method whose implementation should be replaced by the IoC container.
	If this method is not overloaded, there's no need to use arg-type subelements.
	If this method is overloaded, arg-type subelements must be used for all
	override definitions for the method.
--&gt;
&lt;!ATTLIST replaced-method name CDATA #IMPLIED&gt;

&lt;!--
	Bean name of an implementation of the MethodReplacer interface in the current
	or ancestor factories. This may be a singleton or prototype bean. If it's
	a prototype, a new instance will be used for each method replacement.
	Singleton usage is the norm.
--&gt;
&lt;!ATTLIST replaced-method replacer CDATA #IMPLIED&gt;

&lt;!--
	Subelement of replaced-method identifying an argument for a replaced method
	in the event of method overloading.
--&gt;
&lt;!ELEMENT arg-type (#PCDATA)&gt;

&lt;!--
	Specification of the type of an overloaded method argument as a String.
	For convenience, this may be a substring of the FQN. E.g. all the
	following would match "java.lang.String":
	- java.lang.String
	- String
	- Str

	As the number of arguments will be checked also, this convenience can often
	be used to save typing.
--&gt;
&lt;!ATTLIST arg-type match CDATA #IMPLIED&gt;


&lt;!--
	Defines a reference to another bean in this factory or an external
	factory (parent or included factory).
--&gt;
&lt;!ELEMENT ref EMPTY&gt;

&lt;!--
	References must specify a name of the target bean.
	The "bean" attribute can reference any name from any bean in the context,
	to be checked at runtime.
	Local references, using the "local" attribute, have to use bean ids;
	they can be checked by this DTD, thus should be preferred for references
	within the same bean factory XML file.
--&gt;
&lt;!ATTLIST ref bean CDATA #IMPLIED&gt;
&lt;!ATTLIST ref local IDREF #IMPLIED&gt;
&lt;!ATTLIST ref parent CDATA #IMPLIED&gt;


&lt;!--
	Defines a string property value, which must also be the id of another
	bean in this factory or an external factory (parent or included factory).
	While a regular 'value' element could instead be used for the same effect,
	using idref in this case allows validation of local bean ids by the XML
	parser, and name completion by supporting tools.
--&gt;
&lt;!ELEMENT idref EMPTY&gt;

&lt;!--
	ID refs must specify a name of the target bean.
	The "bean" attribute can reference any name from any bean in the context,
	potentially to be checked at runtime by bean factory implementations.
	Local references, using the "local" attribute, have to use bean ids;
	they can be checked by this DTD, thus should be preferred for references
	within the same bean factory XML file.
--&gt;
&lt;!ATTLIST idref bean CDATA #IMPLIED&gt;
&lt;!ATTLIST idref local IDREF #IMPLIED&gt;


&lt;!--
	Contains a string representation of a property value.
	The property may be a string, or may be converted to the required
	type using the JavaBeans PropertyEditor machinery. This makes it
	possible for application developers to write custom PropertyEditor
	implementations that can convert strings to arbitrary target objects.

	Note that this is recommended for simple objects only.
	Configure more complex objects by populating JavaBean
	properties with references to other beans.
--&gt;
&lt;!ELEMENT value (#PCDATA)&gt;

&lt;!--
	The value tag can have an optional type attribute, to specify the
	exact type that the value should be converted to. Only needed
	if the type of the target property or constructor argument is
	too generic: for example, in case of a collection element.
--&gt;
&lt;!ATTLIST value type CDATA #IMPLIED&gt;

&lt;!--
	Denotes a Java null value. Necessary because an empty "value" tag
	will resolve to an empty String, which will not be resolved to a
	null value unless a special PropertyEditor does so.
--&gt;
&lt;!ELEMENT null (#PCDATA)&gt;


&lt;!--
	A list can contain multiple inner bean, ref, collection, or value elements.
	Java lists are untyped, pending generics support in Java 1.5,
	although references will be strongly typed.
	A list can also map to an array type. The necessary conversion
	is automatically performed by the BeanFactory.
--&gt;
&lt;!ELEMENT list (
	(bean | ref | idref | value | null | list | set | map | props)*
)&gt;

&lt;!--
	Enable/disable merging for collections when using parent/child beans.
--&gt;
&lt;!ATTLIST list merge (true | false | default) "default"&gt;

&lt;!--
	Specify the default Java type for nested values.
--&gt;
&lt;!ATTLIST list value-type CDATA #IMPLIED&gt;


&lt;!--
	A set can contain multiple inner bean, ref, collection, or value elements.
	Java sets are untyped, pending generics support in Java 1.5,
	although references will be strongly typed.
--&gt;
&lt;!ELEMENT set (
	(bean | ref | idref | value | null | list | set | map | props)*
)&gt;

&lt;!--
	Enable/disable merging for collections when using parent/child beans.
--&gt;
&lt;!ATTLIST set merge (true | false | default) "default"&gt;

&lt;!--
	Specify the default Java type for nested values.
--&gt;
&lt;!ATTLIST set value-type CDATA #IMPLIED&gt;


&lt;!--
	A Spring map is a mapping from a string key to object.
	Maps may be empty.
--&gt;
&lt;!ELEMENT map (
	(entry)*
)&gt;

&lt;!--
	Enable/disable merging for collections when using parent/child beans.
--&gt;
&lt;!ATTLIST map merge (true | false | default) "default"&gt;

&lt;!--
	Specify the default Java type for nested entry keys.
--&gt;
&lt;!ATTLIST map key-type CDATA #IMPLIED&gt;

&lt;!--
	Specify the default Java type for nested entry values.
--&gt;
&lt;!ATTLIST map value-type CDATA #IMPLIED&gt;

&lt;!--
	A map entry can be an inner bean, ref, value, or collection.
	The key of the entry is given by the "key" attribute or child element.
--&gt;
&lt;!ELEMENT entry (
  key?,
	(bean | ref | idref | value | null | list | set | map | props)?
)&gt;

&lt;!--
	Each map element must specify its key as attribute or as child element.
	A key attribute is always a String value.
--&gt;
&lt;!ATTLIST entry key CDATA #IMPLIED&gt;

&lt;!--
  A short-cut alternative to a "key" element with a "ref bean=" child element.
--&gt;
&lt;!ATTLIST entry key-ref CDATA #IMPLIED&gt;

&lt;!--
  A short-cut alternative to a child element "value".
--&gt;
&lt;!ATTLIST entry value CDATA #IMPLIED&gt;

&lt;!--
  A short-cut alternative to a child element "ref bean=".
--&gt;
&lt;!ATTLIST entry value-ref CDATA #IMPLIED&gt;

&lt;!--
	A key element can contain an inner bean, ref, value, or collection.
--&gt;
&lt;!ELEMENT key (
	(bean | ref | idref | value | null | list | set | map | props)
)&gt;


&lt;!--
	Props elements differ from map elements in that values must be strings.
	Props may be empty.
--&gt;
&lt;!ELEMENT props (
	(prop)*
)&gt;

&lt;!--
	Enable/disable merging for collections when using parent/child beans.
--&gt;
&lt;!ATTLIST props merge (true | false | default) "default"&gt;

&lt;!--
	Element content is the string value of the property.
	Note that whitespace is trimmed off to avoid unwanted whitespace
	caused by typical XML formatting.
--&gt;
&lt;!ELEMENT prop (#PCDATA)&gt;

&lt;!--
	Each property element must specify its key.
--&gt;
&lt;!ATTLIST prop key CDATA #REQUIRED&gt;</pre></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="spring.tld"></a>Appendix&nbsp;D.&nbsp;spring.tld</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld-intro"></a>D.1.&nbsp;Introduction</h2></div></div></div></div><p>One of the view technologies you can use with the Spring Framework
			    is Java Server Pages (JSPs). To help you implement views using Java Server Pages
			    the Spring Framework provides you with some tags for evaluating errors, setting
			    themes and outputting internationalized messages.</p><p>Please note that the various tags generated by this form tag library
                are compliant with the <a href="http://www.w3.org/TR/xhtml1/" target="_top">XHTML-1.0-Strict specification</a> and attendant <a href="http://www.w3.org/TR/xhtml1/dtds.html#a_dtd_XHTML-1.0-Strict" target="_top">DTD</a>.</p><p>This appendix describes the <code class="literal">spring.tld</code> tag library.</p><div class="itemizedlist"><ul type="disc"><li><a href="#spring.tld.bind" title="D.2.&nbsp;The bind tag">Section&nbsp;D.2, &#8220;The <code class="literal">bind</code> tag&#8221;</a></li><li><a href="#spring.tld.escapeBody" title="D.3.&nbsp;The escapeBody tag">Section&nbsp;D.3, &#8220;The <code class="literal">escapeBody</code> tag&#8221;</a></li><li><a href="#spring.tld.hasBindErrors" title="D.4.&nbsp;The hasBindErrors tag">Section&nbsp;D.4, &#8220;The <code class="literal">hasBindErrors</code> tag&#8221;</a></li><li><a href="#spring.tld.htmlEscape" title="D.5.&nbsp;The htmlEscape tag">Section&nbsp;D.5, &#8220;The <code class="literal">htmlEscape</code> tag&#8221;</a></li><li><a href="#spring.tld.message" title="D.6.&nbsp;The message tag">Section&nbsp;D.6, &#8220;The <code class="literal">message</code> tag&#8221;</a></li><li><a href="#spring.tld.nestedPath" title="D.7.&nbsp;The nestedPath tag">Section&nbsp;D.7, &#8220;The <code class="literal">nestedPath</code> tag&#8221;</a></li><li><a href="#spring.tld.theme" title="D.8.&nbsp;The theme tag">Section&nbsp;D.8, &#8220;The <code class="literal">theme</code> tag&#8221;</a></li><li><a href="#spring.tld.transform" title="D.9.&nbsp;The transform tag">Section&nbsp;D.9, &#8220;The <code class="literal">transform</code> tag&#8221;</a></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.bind"></a>D.2.&nbsp;The <code class="literal">bind</code> tag</h2></div></div></div><p>
			Provides BindStatus object for the given bind path.
			The HTML escaping flag participates in a page-wide or application-wide setting
			(i.e. by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).
		</p><div class="table"><a name="spring.tld.bind.table"></a><p class="title"><b>Table&nbsp;D.1.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set HTML escaping for this tag, as boolean value. Overrides
			the default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td align="center">
                     <p>ignoreNestedPath</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set whether to ignore a nested path, if any. Default is to not ignore.</p>
                  </td></tr><tr><td align="center">
                     <p>path</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The path to the bean or bean property to bind status
			information for. For instance account.name, company.address.zipCode
			or just employee. The status object will exported to the page scope,
			specifically for this bean or bean property</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.escapeBody"></a>D.3.&nbsp;The <code class="literal">escapeBody</code> tag</h2></div></div></div><p>
			Escapes its enclosed body content, applying HTML escaping and/or JavaScript escaping.
			The HTML escaping flag participates in a page-wide or application-wide setting
			(i.e. by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).
		</p><div class="table"><a name="spring.tld.escapeBody.table"></a><p class="title"><b>Table&nbsp;D.2.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set HTML escaping for this tag, as boolean value. Overrides the
			default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td align="center">
                     <p>javaScriptEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set JavaScript escaping for this tag, as boolean value.
			Default is false.</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.hasBindErrors"></a>D.4.&nbsp;The <code class="literal">hasBindErrors</code> tag</h2></div></div></div><p>
			Provides Errors instance in case of bind errors.
			The HTML escaping flag participates in a page-wide or application-wide setting
			(i.e. by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).
		</p><div class="table"><a name="spring.tld.hasBindErrors.table"></a><p class="title"><b>Table&nbsp;D.3.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set HTML escaping for this tag, as boolean value.
			Overrides the default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td align="center">
                     <p>name</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The name of the bean in the request, that needs to be
			inspected for errors. If errors are available for this bean, they
			will be bound under the 'errors' key.</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.htmlEscape"></a>D.5.&nbsp;The <code class="literal">htmlEscape</code> tag</h2></div></div></div><p>
			Sets default HTML escape value for the current page.
			Overrides a "defaultHtmlEscape" context-param in web.xml, if any.
		</p><div class="table"><a name="spring.tld.htmlEscape.table"></a><p class="title"><b>Table&nbsp;D.4.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>defaultHtmlEscape</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set the default value for HTML escaping, to be put
				into the current PageContext.</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.message"></a>D.6.&nbsp;The <code class="literal">message</code> tag</h2></div></div></div><p>
			Retrieves the message with the given code, or text if code isn't resolvable.
			The HTML escaping flag participates in a page-wide or application-wide setting
			(i.e. by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).
		</p><div class="table"><a name="spring.tld.message.table"></a><p class="title"><b>Table&nbsp;D.5.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>arguments</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set optional message arguments for this tag, as a
			(comma-)delimited String (each String argument can contain JSP EL),
			an Object array (used as argument array), or a single Object (used
			as single argument).</p>
                  </td></tr><tr><td align="center">
                     <p>argumentSeparator</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The separator character to be used for splitting the
			arguments string value; defaults to a 'comma' (',').</p>
                  </td></tr><tr><td align="center">
                     <p>code</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The code (key) to use when looking up the message.
			If code is not provided, the text attribute will be used.</p>
                  </td></tr><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set HTML escaping for this tag, as boolean value.
			Overrides the default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td align="center">
                     <p>javaScriptEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set JavaScript escaping for this tag, as boolean value. Default is false.</p>
                  </td></tr><tr><td align="center">
                     <p>message</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>A MessageSourceResolvable argument (direct or through JSP EL).
				Fits nicely when used in conjunction with Spring's own validation error
				classes which all implement the MessageSourceResolvable interface. For
				example, this allows you to iterate over all of the errors in a form,
				passing each error (using a runtime expression) as the value of this
				'message' attribute, thus effecting the easy display of such error
				messages.</p>
                  </td></tr><tr><td align="center">
                     <p>scope</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The scope to use when exporting the result to a variable.
			This attribute is only used when var is also set. Possible values are
			page, request, session and application.</p>
                  </td></tr><tr><td align="center">
                     <p>text</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Default text to output when a message for the given code
			could not be found. If both text and code are not set, the tag will
			output null.</p>
                  </td></tr><tr><td align="center">
                     <p>var</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The string to use when binding the result to the page,
			request, session or application scope. If not specified, the result
			gets outputted to the writer (i.e. typically directly to the JSP).</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.nestedPath"></a>D.7.&nbsp;The <code class="literal">nestedPath</code> tag</h2></div></div></div><p>
			Sets a nested path to be used by the bind tag's path.
		</p><div class="table"><a name="spring.tld.nestedPath.table"></a><p class="title"><b>Table&nbsp;D.6.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>path</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set the path that this tag should apply. E.g. 'customer'
			to allow bind paths like 'address.street' rather than
			'customer.address.street'.</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.theme"></a>D.8.&nbsp;The <code class="literal">theme</code> tag</h2></div></div></div><p>
			Retrieves the theme message with the given code, or text if code isn't resolvable.
			The HTML escaping flag participates in a page-wide or application-wide setting
			(i.e. by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).
		</p><div class="table"><a name="spring.tld.theme.table"></a><p class="title"><b>Table&nbsp;D.7.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>arguments</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set optional message arguments for this tag, as a
			(comma-)delimited String (each String argument can contain JSP EL),
			an Object array (used as argument array), or a single Object (used
			as single argument).</p>
                  </td></tr><tr><td align="center">
                     <p>argumentSeparator</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The separator character to be used for splitting the
			arguments string value; defaults to a 'comma' (',').</p>
                  </td></tr><tr><td align="center">
                     <p>code</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The code (key) to use when looking up the message.
			If code is not provided, the text attribute will be used.</p>
                  </td></tr><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set HTML escaping for this tag, as boolean value.
			Overrides the default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td align="center">
                     <p>javaScriptEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set JavaScript escaping for this tag, as boolean value. Default is false.</p>
                  </td></tr><tr><td align="center">
                     <p>message</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>A MessageSourceResolvable argument (direct or through JSP EL).</p>
                  </td></tr><tr><td align="center">
                     <p>scope</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The scope to use when exporting the result to a variable.
			This attribute is only used when var is also set. Possible values are
			page, request, session and application.</p>
                  </td></tr><tr><td align="center">
                     <p>text</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Default text to output when a message for the given code
			could not be found. If both text and code are not set, the tag will
			output null.</p>
                  </td></tr><tr><td align="center">
                     <p>var</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The string to use when binding the result to the page,
			request, session or application scope. If not specified, the result
			gets outputted to the writer (i.e. typically directly to the JSP).</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.transform"></a>D.9.&nbsp;The <code class="literal">transform</code> tag</h2></div></div></div><p>
			Provides transformation of variables to Strings, using an appropriate
			custom PropertyEditor from BindTag (can only be used inside BindTag).
			The HTML escaping flag participates in a page-wide or application-wide setting
			(i.e. by HtmlEscapeTag or a 'defaultHtmlEscape' context-param in web.xml).
		</p><div class="table"><a name="spring.tld.transform.table"></a><p class="title"><b>Table&nbsp;D.8.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Set HTML escaping for this tag, as boolean value. Overrides
			the default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td align="center">
                     <p>scope</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The scope to use when exported the result to a variable.
			This attribute is only used when var is also set. Possible values are
			page, request, session and application.</p>
                  </td></tr><tr><td align="center">
                     <p>value</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The value to transform. This is the actual object you want
			to have transformed (for instance a Date). Using the PropertyEditor that
			is currently in use by the 'spring:bind' tag.</p>
                  </td></tr><tr><td align="center">
                     <p>var</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The string to use when binding the result to the page,
			request, session or application scope. If not specified, the result gets
			outputted to the writer (i.e. typically directly to the JSP).</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="spring-form.tld"></a>Appendix&nbsp;E.&nbsp;spring-form.tld</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld-intro"></a>E.1.&nbsp;Introduction</h2></div></div></div></div><p>One of the view technologies you can use with the Spring Framework
			    is Java Server Pages (JSPs). To help you implement views using Java Server Pages
			    the Spring Framework provides you with some tags for evaluating errors, setting
			    themes and outputting internationalized messages.</p><p>Please note that the various tags generated by this form tag library
                are compliant with the <a href="http://www.w3.org/TR/xhtml1/" target="_top">XHTML-1.0-Strict specification</a> and attendant <a href="http://www.w3.org/TR/xhtml1/dtds.html#a_dtd_XHTML-1.0-Strict" target="_top">DTD</a>.</p><p>This appendix describes the <code class="literal">spring-form.tld</code> tag library.</p><div class="itemizedlist"><ul type="disc"><li><a href="#spring-form.tld.checkbox" title="E.2.&nbsp;The checkbox tag">Section&nbsp;E.2, &#8220;The <code class="literal">checkbox</code> tag&#8221;</a></li><li><a href="#spring-form.tld.errors" title="E.3.&nbsp;The errors tag">Section&nbsp;E.3, &#8220;The <code class="literal">errors</code> tag&#8221;</a></li><li><a href="#spring-form.tld.form" title="E.4.&nbsp;The form tag">Section&nbsp;E.4, &#8220;The <code class="literal">form</code> tag&#8221;</a></li><li><a href="#spring-form.tld.hidden" title="E.5.&nbsp;The hidden tag">Section&nbsp;E.5, &#8220;The <code class="literal">hidden</code> tag&#8221;</a></li><li><a href="#spring-form.tld.input" title="E.6.&nbsp;The input tag">Section&nbsp;E.6, &#8220;The <code class="literal">input</code> tag&#8221;</a></li><li><a href="#spring-form.tld.label" title="E.7.&nbsp;The label tag">Section&nbsp;E.7, &#8220;The <code class="literal">label</code> tag&#8221;</a></li><li><a href="#spring-form.tld.option" title="E.8.&nbsp;The option tag">Section&nbsp;E.8, &#8220;The <code class="literal">option</code> tag&#8221;</a></li><li><a href="#spring-form.tld.options" title="E.9.&nbsp;The options tag">Section&nbsp;E.9, &#8220;The <code class="literal">options</code> tag&#8221;</a></li><li><a href="#spring-form.tld.password" title="E.10.&nbsp;The password tag">Section&nbsp;E.10, &#8220;The <code class="literal">password</code> tag&#8221;</a></li><li><a href="#spring-form.tld.radiobutton" title="E.11.&nbsp;The radiobutton tag">Section&nbsp;E.11, &#8220;The <code class="literal">radiobutton</code> tag&#8221;</a></li><li><a href="#spring-form.tld.select" title="E.12.&nbsp;The select tag">Section&nbsp;E.12, &#8220;The <code class="literal">select</code> tag&#8221;</a></li><li><a href="#spring-form.tld.textarea" title="E.13.&nbsp;The textarea tag">Section&nbsp;E.13, &#8220;The <code class="literal">textarea</code> tag&#8221;</a></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.checkbox"></a>E.2.&nbsp;The <code class="literal">checkbox</code> tag</h2></div></div></div><p>Renders an HTML 'input' tag with type 'checkbox'.</p><div class="table"><a name="spring-form.tld.checkbox.table"></a><p class="title"><b>Table&nbsp;E.1.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>accesskey</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssErrorClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td align="center">
                     <p>cssStyle</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>dir</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>disabled</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td align="center">
                     <p>id</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>lang</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onblur</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onchange</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>ondblclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onfocus</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeydown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeypress</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeyup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousedown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousemove</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseout</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseover</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>path</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td align="center">
                     <p>tabindex</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>title</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>value</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.errors"></a>E.3.&nbsp;The <code class="literal">errors</code> tag</h2></div></div></div><p>Renders field errors in an HTML 'span' tag.</p><div class="table"><a name="spring-form.tld.errors.table"></a><p class="title"><b>Table&nbsp;E.2.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>cssClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssStyle</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>delimiter</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Delimiter for displaying multiple error messages. Defaults to the br tag.</p>
                  </td></tr><tr><td align="center">
                     <p>dir</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>element</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Specifies the HTML element that is used to render the enclosing errors.</p>
                  </td></tr><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td align="center">
                     <p>id</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>lang</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>ondblclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeydown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeypress</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeyup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousedown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousemove</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseout</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseover</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>path</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Path to errors object for data binding</p>
                  </td></tr><tr><td align="center">
                     <p>tabindex</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>title</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.form"></a>E.4.&nbsp;The <code class="literal">form</code> tag</h2></div></div></div><p>Renders an HTML 'form' tag and exposes a binding path to inner tags for binding.</p><div class="table"><a name="spring-form.tld.form.table"></a><p class="title"><b>Table&nbsp;E.3.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>action</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Required Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>commandName</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Name of the attribute under which the command name is exposed.
				Defaults to 'command'.</p>
                  </td></tr><tr><td align="center">
                     <p>cssClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssStyle</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>dir</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>enctype</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td align="center">
                     <p>id</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>lang</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>method</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>name</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute - added for backwards compatibility cases</p>
                  </td></tr><tr><td align="center">
                     <p>onclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>ondblclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeydown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeypress</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeyup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousedown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousemove</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseout</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseover</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onreset</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onsubmit</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>title</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.hidden"></a>E.5.&nbsp;The <code class="literal">hidden</code> tag</h2></div></div></div><p>Renders an HTML 'input' tag with type 'hidden' using the bound value.</p><div class="table"><a name="spring-form.tld.hidden.table"></a><p class="title"><b>Table&nbsp;E.4.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td align="center">
                     <p>id</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>path</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Path to property for data binding</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.input"></a>E.6.&nbsp;The <code class="literal">input</code> tag</h2></div></div></div><p>Renders an HTML 'input' tag with type 'text' using the bound value.</p><div class="table"><a name="spring-form.tld.input.table"></a><p class="title"><b>Table&nbsp;E.5.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>accesskey</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>alt</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>autocomplete</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Common Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssErrorClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td align="center">
                     <p>cssStyle</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>dir</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>disabled</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td align="center">
                     <p>id</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>lang</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>maxlength</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onblur</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onchange</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>ondblclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onfocus</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeydown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeypress</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeyup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousedown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousemove</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseout</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseover</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onselect</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>path</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td align="center">
                     <p>readonly</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will make the HTML element readonly.</p>
                  </td></tr><tr><td align="center">
                     <p>size</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>tabindex</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>title</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.label"></a>E.7.&nbsp;The <code class="literal">label</code> tag</h2></div></div></div><p>Renders a form field label in an HTML 'label' tag.</p><div class="table"><a name="spring-form.tld.label.table"></a><p class="title"><b>Table&nbsp;E.6.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>cssClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute.</p>
                  </td></tr><tr><td align="center">
                     <p>cssErrorClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used only when errors are present.</p>
                  </td></tr><tr><td align="center">
                     <p>cssStyle</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>dir</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>for</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td align="center">
                     <p>id</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>lang</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>ondblclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeydown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeypress</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeyup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousedown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousemove</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseout</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseover</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>path</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Path to errors object for data binding</p>
                  </td></tr><tr><td align="center">
                     <p>tabindex</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>title</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.option"></a>E.8.&nbsp;The <code class="literal">option</code> tag</h2></div></div></div><p>Renders a single HTML 'option'. Sets 'selected' as appropriate based on bound value.</p><div class="table"><a name="spring-form.tld.option.table"></a><p class="title"><b>Table&nbsp;E.7.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>disabled</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td align="center">
                     <p>label</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>value</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.options"></a>E.9.&nbsp;The <code class="literal">options</code> tag</h2></div></div></div><p>Renders a list of HTML 'option' tags. Sets 'selected' as appropriate based on bound
			value.</p><div class="table"><a name="spring-form.tld.options.table"></a><p class="title"><b>Table&nbsp;E.8.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td align="center">
                     <p>itemLabel</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Name of the property mapped to the inner text of the 'option' tag</p>
                  </td></tr><tr><td align="center">
                     <p>items</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The Collection, Map or array of objects used to generate the inner 'option' tags</p>
                  </td></tr><tr><td align="center">
                     <p>itemValue</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Name of the property mapped to 'value' attribute of the 'option' tag</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.password"></a>E.10.&nbsp;The <code class="literal">password</code> tag</h2></div></div></div><p>Renders an HTML 'input' tag with type 'password' using the bound value.</p><div class="table"><a name="spring-form.tld.password.table"></a><p class="title"><b>Table&nbsp;E.9.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>accesskey</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>alt</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>autocomplete</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Common Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssErrorClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td align="center">
                     <p>cssStyle</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>dir</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>disabled</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td align="center">
                     <p>id</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>lang</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>maxlength</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onblur</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onchange</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>ondblclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onfocus</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeydown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeypress</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeyup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousedown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousemove</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseout</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseover</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onselect</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>path</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td align="center">
                     <p>readonly</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will make the HTML element readonly.</p>
                  </td></tr><tr><td align="center">
                     <p>showPassword</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Is the password value to be shown? Defaults to false.</p>
                  </td></tr><tr><td align="center">
                     <p>size</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>tabindex</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>title</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.radiobutton"></a>E.11.&nbsp;The <code class="literal">radiobutton</code> tag</h2></div></div></div><p>Renders an HTML 'input' tag with type 'radio'.</p><div class="table"><a name="spring-form.tld.radiobutton.table"></a><p class="title"><b>Table&nbsp;E.10.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>accesskey</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssErrorClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td align="center">
                     <p>cssStyle</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>dir</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>disabled</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td align="center">
                     <p>id</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>lang</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onblur</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onchange</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>ondblclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onfocus</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeydown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeypress</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeyup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousedown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousemove</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseout</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseover</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>path</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td align="center">
                     <p>tabindex</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>title</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>value</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.select"></a>E.12.&nbsp;The <code class="literal">select</code> tag</h2></div></div></div><p>Renders an HTML 'select' element. Supports databinding to the selected option.</p><div class="table"><a name="spring-form.tld.select.table"></a><p class="title"><b>Table&nbsp;E.11.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>accesskey</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssErrorClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td align="center">
                     <p>cssStyle</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>dir</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>disabled</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td align="center">
                     <p>id</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>itemLabel</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Name of the property mapped to the inner text of the 'option' tag</p>
                  </td></tr><tr><td align="center">
                     <p>items</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>The Collection, Map or array of objects used to generate the inner 'option' tags</p>
                  </td></tr><tr><td align="center">
                     <p>itemValue</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Name of the property mapped to 'value' attribute of the 'option' tag</p>
                  </td></tr><tr><td align="center">
                     <p>lang</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>multiple</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onblur</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onchange</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>ondblclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onfocus</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeydown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeypress</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeyup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousedown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousemove</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseout</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseover</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>path</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td align="center">
                     <p>size</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>tabindex</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>title</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.textarea"></a>E.13.&nbsp;The <code class="literal">textarea</code> tag</h2></div></div></div><p>Renders an HTML 'textarea'.</p><div class="table"><a name="spring-form.tld.textarea.table"></a><p class="title"><b>Table&nbsp;E.12.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" border="1"><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required?</th><th align="center">Runtime Expression?</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">
                     <p>accesskey</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cols</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Required Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>cssErrorClass</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td align="center">
                     <p>cssStyle</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>dir</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>disabled</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td align="center">
                     <p>htmlEscape</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td align="center">
                     <p>id</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>lang</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onblur</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onchange</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>ondblclick</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onfocus</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeydown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeypress</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onkeyup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousedown</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmousemove</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseout</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseover</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onmouseup</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>onselect</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>path</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td align="center">
                     <p>readonly</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will make the HTML element readonly.</p>
                  </td></tr><tr><td align="center">
                     <p>rows</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Required Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>tabindex</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td align="center">
                     <p>title</p>
                  </td><td align="center">
                     <p>false</p>
                  </td><td align="center">
                     <p>true</p>
                  </td><td align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div></div></div></body></html>